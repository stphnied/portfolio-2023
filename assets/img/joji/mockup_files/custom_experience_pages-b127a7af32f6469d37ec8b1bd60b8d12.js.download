var CROP=function(){return function(e){var t=e,i=10,n=7500;this.eles={ele:void 0,container:void 0,img:void 0,overlay:void 0,slider:void 0,topLine:void 0,rightLine:void 0,bottomLine:void 0,leftLine:void 0},this.img=void 0,this.imgInfo={aw:0,ah:0,w:0,h:0,at:0,al:0,t:0,l:0,s:1},this.stageInfo=Helpers.StageType.getStageInfo(),this.constraints={zoom:!0,movement:!0},this.lockIndex=0,this.trimStart=null,this.trimEnd=null,this.init=function(e,t){var i=$(document);this.isVideo=t||!1,this.settings={slider:e+" .cropSlider"};var n,s,r,o,a,l,c,e=$(e+" .cropMain"),u=this;s=$("<div />").attr({"class":"crop-container"}).css({width:e.width(),height:e.height()}),n=$(this.isVideo?"<video muted playsinline disableRemotePlayback/>":'<img crossOrigin="anonymous" />').attr({"class":"crop-img"}).css({zIndex:5999,top:0,left:0}),r=$("<div />").attr({"class":"crop-overlay"}).css({zIndex:6e3}),o=$("<div />").attr({"class":"cropper-top-line cropper-line"}),a=$("<div />").attr({"class":"cropper-right-line cropper-line"}),l=$("<div />").attr({"class":"cropper-bottom-line cropper-line"}),c=$("<div />").attr({"class":"cropper-left-line cropper-line"}),s.append(r),s.append(n),s.append(o),s.append(a),s.append(l),s.append(c),e.append(s),this.eles.ele=e,this.eles.container=s,this.eles.img=n,this.eles.overlay=r,this.eles.topLine=o,this.eles.rightLine=a,this.eles.bottomLine=l,this.eles.leftLine=c,r.bind("mousedown touchstart",function(e){var t={x:e.pageX||e.originalEvent.pageX||e.originalEvent.changedTouches[0].pageX,y:e.pageY||e.originalEvent.pageY||e.originalEvent.changedTouches[0].pageY};return e.preventDefault(),i.bind("mousemove touchmove",function(e){var i=e.touches||e.originalEvent&&e.originalEvent.targetTouches;if(!(i&&i.length>1)&&(!i||e.target===r.get(0))&&u.lockMovement!==!0&&(e.pageX||e.pageY||void 0!==typeof e.originalEvent.changedTouches[0])){var n={x:e.pageX||(e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].pageX:0),y:e.pageY||(e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].pageY:0)},s={t:t.y-n.y,l:t.x-n.x};t=n,u.lockIndex<=0?(u.lockIndex=0,u.moveChange=!0,u.imgMove(s),u.snap(s)):u.lockIndex--}}),!1}),i.bind("mouseup touchend",function(e){u.moveChange&&(u.eles.ele.trigger("cropperChange"),u.moveChange=!1),i.unbind("mousemove touchmove")}),this.slider()},this.loadImg=function(e,t){var i=this;this.eles.img.attr("src",e).load(function(){return i.imageExceedsDimensions()?void i.eles.ele.trigger("imageDimensionsExceeded"):(i.imgSize(t),t?i.updateSlider(t.s):i.centerImage(),void i.eles.ele.trigger("imageLoaded"))}),this.img=this.eles.img[0]},this.loadVideo=function(e,t,i){var n=this;Object.defineProperties(n.eles.img[0],{width:{get:function(){return $(this).width()}},height:{get:function(){return $(this).height()}}}),this.eles.img.attr("src",e),this.eles.img[0].load(),this.eles.img.on("loadeddata",function(e){n.imgSize(t),t?n.eles.rangeButtons.setValue(t.s):n.centerImage(),n.eles.ele.trigger("imageLoaded")}),this.img=this.eles.img[0];var s=function(e,t){return Helpers.App.extractNumbersFromString(Helpers.App.getFileNameFromURI(e)).pop()-Helpers.App.extractNumbersFromString(Helpers.App.getFileNameFromURI(t)).pop()},r={totalLength:parseFloat(i.duration),start:parseFloat(i.trimStart||0),end:parseFloat(i.trimEnd||i.fragmentDuration),videoWidth:parseFloat(i.width),videoHeight:parseFloat(i.height),containerWidth:this.eles.container.width(),resizable:i.resizable,minLength:i.minLength};i.showSeekableTimeline!==!1?(r.thumbs=i.timelineUrls.sort(s),r.showSeekableTimeline=!0):r.showSeekableTimeline=!1,this.buildVideoUI(r)},this.getVideoTrimStart=function(){return this.trimStart},this.getVideoTrimEnd=function(){return this.trimEnd},this.buildVideoUI=function(e){function t(){var e;l.fragmentPlayer.isPlaying()!==!1&&(e=function t(){l.fragmentPlayer.play(),void 0!==l.eles.seekableTimeline&&(l.eles.seekableTimeline.unbind("dragend",t),l.eles.seekableTimeline.unbind("resizeend",t))},l.fragmentPlayer.pause(),void 0!==l.eles.seekableTimeline&&(l.eles.seekableTimeline.bind("dragend",e),l.eles.seekableTimeline.bind("resizeend",e)))}function i(e,t){l.trimStart=t.start,l.trimEnd=t.end,l.fragmentPlayer.setBoundaries(t.start,t.end)}function n(e,t){l.fragmentPlayer.setCurrentTime(t.currentTime)}function s(e,t){void 0!==l.eles.seekableTimeline&&l.eles.seekableTimeline.setIndicatorPosition(t.currentTime)}function r(){l.fragmentPlayer.isPlaying()===!1?(l.fragmentPlayer.play(),$(this).addClass("is-playing")):(l.fragmentPlayer.pause(),$(this).removeClass("is-playing"))}function o(e,t){l.imgResize(t.value)}function a(){l.imgReset()}var l=this,c='<div class="playback-button">',u=1,d=4;l.trimStart=e.start,l.trimEnd=e.end,l.constraints.zoom!==!0&&(u=.25,d=5),l.fragmentPlayer=new UI.FragmentPlayer(l.eles.img[0],e.start,e.end),l.fragmentPlayer.setMute(!0),l.fragmentPlayer.setCurrentTime(e.start),l.eles.rangeButtons=new UI.RangeButtons({value:1,step:.1,min:u,max:d}),l.eles.rangeButtons.render(l.eles.container),e.showSeekableTimeline===!0&&(l.eles.seekableTimeline=new UI.SeekableTimeline({totalLength:e.totalLength,start:e.start,end:e.end,videoWidth:e.videoWidth,videoHeight:e.videoHeight,thumbs:e.thumbs,forceContainerWidth:e.containerWidth,resizable:e.resizable,minLength:e.minLength}),l.eles.seekableTimeline.render($(".seekable-timeline-container"))),l.eles.playbackButton=$(c),l.eles.playbackButton.appendTo(l.eles.container),l.eles.slider.hide(),void 0!==l.eles.seekableTimeline&&(l.eles.seekableTimeline.bind("timeupdate",n),l.eles.seekableTimeline.bind("dragstart",t),l.eles.seekableTimeline.bind("resizestart",t),l.eles.seekableTimeline.bind("change",i)),l.eles.rangeButtons.bind("change",o),l.eles.rangeButtons.bind("reset",a),l.eles.playbackButton.on("click",r),l.fragmentPlayer.bind("timeupdate",s)},this.getDurationChangeDispatcher=function(){return this.eles.seekableTimeline},this.getCropperChangeDispatcher=function(){return this.eles.ele},this.getZoomChangeDispatcher=function(){return this.eles.rangeButtons},this.centerImage=function(){var e=this.eles.container,t=this.eles.img[0],i=e.width(),n=e.height(),s=(t.width-i)/2+t.offsetLeft,r=(t.height-n)/2+t.offsetTop;Helpers.StageType.getStageInfo();this.imgMove({l:s,t:r})},this.imgSize=function(e){var i,n,s,r,o,a=this.eles.img,l={w:a.css("width","").width(),h:a.css("height","").height()},c=this.eles.container,u=Helpers.StageType.getStageInfo(),d=2*t,h=c.width(),p=c.height();({wh:this.eles.container.width()/this.eles.container.height(),hw:this.eles.container.height()/this.eles.container.width()});e&&(this.imgInfo=e),this.imgInfo.aw=l.w,this.imgInfo.ah=l.h,i=8===u.image_type||14===u.image_type?l.w<l.h:l.w>l.h,i?(this.imgInfo.w=h-d,this.imgInfo.h=this.imgInfo.w*(l.h/l.w),this.imgInfo.al=t,this.imgInfo.at=p/2-this.imgInfo.h/2):(this.imgInfo.h=p-d,this.imgInfo.w=this.imgInfo.h*(l.w/l.h),this.imgInfo.at=t,this.imgInfo.al=h/2-this.imgInfo.w/2),n=8===u.image_type||14===u.image_type?this.imgInfo.h<p-d:this.imgInfo.h>p-d,n&&(this.imgInfo.h=p-d,this.imgInfo.w=this.imgInfo.h*(l.w/l.h),this.imgInfo.at=p/2-this.imgInfo.h/2),s=8===u.image_type||14===u.image_type?this.imgInfo.w<h-d:this.imgInfo.w>h-d,s&&(this.imgInfo.w=h-d,this.imgInfo.h=this.imgInfo.w*(l.h/l.w),this.imgInfo.al=h/2-this.imgInfo.w/2),r=$(".cropper-top-line").get(0).clientWidth,o=$(".cropper-left-line").get(0).clientHeight,this.imgInfo.w===r?this.imgInfo.longerSide="width":this.imgInfo.longerSide="height",this.imgResize()},this.imgResize=function(e){var t=this.eles.img,i=this.imgInfo,n=i.s;i.s=e||i.s,t.css({width:i.w*i.s,height:i.h*i.s}),this.imgMove({t:-(i.h*n-i.h*i.s)/2,l:-(i.w*n-i.w*i.s)/2})},this.imgMove=function(e){var i,n,s=this.eles.img,r=this.imgInfo,o=this.eles.container,a=o.width(),l=o.height();r.t+=e.t,r.l+=e.l,i=parseInt(r.at-r.t,10),n=parseInt(r.al-r.l,10),this.constraints.movement===!0&&(i>t?i=t:i<-(r.h*r.s-(l-t))&&(i=-(r.h*r.s-(l-t))),n>t?n=t:n<-(r.w*r.s-(a-t))&&(n=-(r.w*r.s-(a-t)))),s.css({top:i,left:n})},this.imgReset=function(){this.imgInfo={aw:0,ah:0,w:0,h:0,at:0,al:0,t:0,l:0,s:1},this.img.removeAttribute("style"),this.imgSize(),this.centerImage(),this.updateSlider(1),this.eles.rangeButtons&&this.eles.rangeButtons.setValue(1),this.eles.ele.trigger("cropperChange")},this.setConstraints=function(e){return Object.keys(e).forEach(function(t){e.hasOwnProperty(t)&&(this.constraints[t]=e[t])}.bind(this)),this},this.slider=function(){var e,t=this,i=.002;e=this.getZoomRange(),this.eles.slider=$(this.settings.slider),this.eles.slider.noUiSlider({range:e,start:1,step:i,handles:1,slide:function(){var e=$(this).val();t.imgResize(e),t.eles.ele.trigger("cropperChange")}})},coordinates=function s(e){var i=e.imgInfo,n=e.eles.container,r=e.eles.img,o=r.attr("src"),s={x:-(parseInt(r.css("left"))-t)*(i.aw/(i.w*i.s)),y:-(parseInt(r.css("top"))-t)*(i.ah/(i.h*i.s)),w:(n.width()-2*t)*(i.aw/(i.w*i.s)),h:(n.height()-2*t)*(i.ah/(i.h*i.s)),image:o};return s},this.snap=function(e){var t=this.getDirections(e),i=this.getBoundaries(),n=this.getSnapTargets(t,i),s=this.getSnapValues(n);this.imgMove(s)},this.getDirections=function(e){var t={top:!1,bottom:!1,left:!1,right:!1};return e.t>0?t.top=!0:e.t<0&&(t.bottom=!0),e.l>0?t.left=!0:e.l<0&&(t.right=!0),t},this.getBoundaries=function(){var e=(this.eles.img,this.getBordersAndBoundaries()),t={top:null,bottom:null,left:null,right:null};return e.borders.top>e.boundaries.top?t.top="outer":t.top="inner",e.borders.bottom>e.boundaries.bottom?t.bottom="inner":t.bottom="outer",e.borders.left>e.boundaries.left?t.left="outer":t.left="inner",e.borders.right>e.boundaries.right?t.right="inner":t.right="outer",t},this.getSnapTargets=function(e,t){var i={top:!1,bottom:!1,left:!1,right:!1};return e.top===!0&&"outer"===t.top&&(i.top=!0),e.top===!0&&"inner"===t.bottom&&(i.bottom=!0),e.bottom===!0&&"outer"===t.bottom&&(i.bottom=!0),e.bottom===!0&&"inner"===t.top&&(i.top=!0),e.left===!0&&"outer"===t.left&&(i.left=!0),e.left===!0&&"inner"===t.right&&(i.right=!0),e.right===!0&&"outer"===t.right&&(i.right=!0),e.right===!0&&"inner"===t.left&&(i.left=!0),i},this.getSnapValues=function(e){var t,n,s,r,o,a,l,c;return t=this.getBordersAndBoundaries(),c={t:0,l:0},e.top===!0&&e.bottom===!1?r=t.borders.top-t.boundaries.top:e.bottom===!0&&e.top===!1?r=t.borders.bottom-t.boundaries.bottom:e.bottom===!0&&e.top===!0&&(n=t.borders.top-t.boundaries.top,s=t.borders.bottom-t.boundaries.bottom,r=Math.abs(n)<=Math.abs(s)?n:s),e.left===!0&&e.right===!1?l=t.borders.left-t.boundaries.left:e.left===!1&&e.right===!0?l=t.borders.right-t.boundaries.right:e.left===!0&&e.right===!0&&(o=t.borders.left-t.boundaries.left,a=t.borders.right-t.boundaries.right,l=Math.abs(o)<=Math.abs(a)?o:a),Math.abs(r)<=i&&(c.t=r,this.lockIndex=10),Math.abs(l)<=i&&(c.l=Math.floor(l),this.lockIndex=10),c},this.getBordersAndBoundaries=function(){var e,t;return e=this.eles.img,t={borders:{top:e.position().top,bottom:e.position().top+e.height(),left:e.position().left,right:e.position().left+e.width()},boundaries:{top:this.eles.topLine.position().top,bottom:this.eles.bottomLine.position().top,left:this.eles.leftLine.position().left,right:this.eles.rightLine.position().left}}},this.destroy=function(){"VIDEO"===this.eles.img[0].tagName&&(this.fragmentPlayer.destroy(),this.eles.seekableTimeline.destroy(),this.eles.rangeButtons.destroy(),this.eles.img.remove(),this.eles.img[0].src="",this.eles.img[0].load(),this.eles.img=null)},this.getImg=function(){return this.eles.img[0]},this.imageExceedsDimensions=function(){var e=this.getImg();return e.height>n||e.width>n},this.updateSlider=function(e){this.eles.slider.val(e)},this.getZoomRange=function(){var e;return e=this.constraints.zoom===!0?[1,4]:[.25,5]},this.getCurrentZoom=function(){return this.imgInfo.s},this.setZoom=function(e){this.updateSlider(e),this.imgResize(e),this.eles.rangeButtons&&this.eles.rangeButtons.setValue(e)},this.toggleMovementLock=function(e){this.lockMovement=e}}}();!function(e){e.fn.noUiSlider=function(t,i){function n(e,t,i){"function"==typeof e&&e.call(t,i)}function s(e,t,i){var n=t.data("setup"),s=n.handles,r=n.settings,o=n.pos;if(e=0>e?0:e>100?100:e,2==r.handles)if(i.is(":first-child")){var l=parseFloat(s[1][0].style[o])-r.margin;e=e>l?l:e}else{var l=parseFloat(s[0][0].style[o])+r.margin;e=l>e?l:e}if(r.step){var c=a.from(r.range,r.step);e=Math.round(e/c)*c}return e}function r(e){try{return[e.clientX||e.originalEvent.clientX||e.originalEvent.touches[0].clientX,e.clientY||e.originalEvent.clientY||e.originalEvent.touches[0].clientY]}catch(t){return["x","y"]}}function o(e,t){return parseFloat(e[0].style[t])}var a={to:function(e,t){return t=e[0]<0?t+Math.abs(e[0]):t-e[0],100*t/this._length(e)},from:function(e,t){return 100*t/this._length(e)},is:function(e,t){return t*this._length(e)/100+e[0]},_length:function(e){return e[0]>e[1]?e[0]-e[1]:e[1]-e[0]}},l={handles:2,serialization:{to:["",""],resolution:.01}};methods={create:function(){return this.each(function(){function i(e,t,i){e.css(c,t+"%").data("input").val(a.is(d.range,t).toFixed(b))}var c,u,d=e.extend(l,t),h="<a><div></div></a>",p=e(this).data("_isnS_",!0),f=[],m="",g=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},v=(d.serialization.resolution=d.serialization.resolution||.01).toString().split("."),b=1==v[0]?0:v[1].length;d.start=g(d.start)?[d.start,0]:d.start,e.each(d,function(e,t){g(t)?d[e]=parseFloat(t):"object"==typeof t&&g(t[0])&&(t[0]=parseFloat(t[0]),g(t[1])&&(t[1]=parseFloat(t[1])));var i=!1;switch(t="undefined"==typeof t?"x":t,e){case"range":case"start":i=2!=t.length||!g(t[0])||!g(t[1]);break;case"handles":i=1>t||t>2||!g(t);break;case"connect":i="lower"!=t&&"upper"!=t&&"boolean"!=typeof t;break;case"orientation":i="vertical"!=t&&"horizontal"!=t;break;case"margin":case"step":i="undefined"!=typeof t&&!g(t);break;case"serialization":i="object"!=typeof t||!g(t.resolution)||"object"==typeof t.to&&t.to.length<d.handles;break;case"slide":i="function"!=typeof t}i&&console&&console.error("Bad input for "+e+" on slider:",p)}),d.margin=d.margin?a.from(d.range,d.margin):0,(d.serialization.to instanceof jQuery||"string"==typeof d.serialization.to||d.serialization.to===!1)&&(d.serialization.to=[d.serialization.to]),"vertical"==d.orientation?(m+="vertical",c="top",u=1):(m+="horizontal",c="left",u=0),m+=d.connect?"lower"==d.connect?" connect lower":" connect":"",p.addClass(m);for(var y=0;y<d.handles;y++){f[y]=p.append(h).children(":last");var _=a.to(d.range,d.start[y]);f[y].css(c,_+"%"),100==_&&f[y].is(":first-child")&&f[y].css("z-index",2);var w=".noUiSlider",C="mousedown"+w+"X MSPointerDown"+w+"X touchstart"+w+"X",S="mousemove"+w+" MSPointerMove"+w+" touchmove"+w,T="mouseup"+w+" MSPointerUp"+w+" touchend"+w;f[y].find("div").on(C,function(t){if(e("body").bind("selectstart"+w,function(){return!1}),!p.hasClass("disabled")){e("body").addClass("TOUCH");var i=e(this).addClass("active").parent(),o=i.add(e(document)).add("body"),l=parseFloat(i[0].style[c]),h=r(t),m=h,g=!1;e(document).on(S,function(e){e.preventDefault();var t=r(e);if("x"!=t[0]){t[0]-=h[0],t[1]-=h[1];var o=[m[0]!=t[0],m[1]!=t[1]],v=l+100*t[u]/(u?p.height():p.width());v=s(v,p,i),o[u]&&v!=g&&(i.css(c,v+"%").data("input").val(a.is(d.range,v).toFixed(b)),n(d.slide,p.data("_n",!0)),g=v,i.css("z-index",2==f.length&&100==v&&i.is(":first-child")?2:1)),m=t}}).on(T,function(){o.off(w),e("body").removeClass("TOUCH"),p.find(".active").removeClass("active").end().data("_n")&&p.data("_n",!1).change()})}}).on("click",function(e){e.stopPropagation()})}p.on("click",function(e){if(!p.hasClass("disabled")){var t=r(e),o=100*(t[u]-p.offset()[c])/(u?p.height():p.width()),a=f.length>1?t[u]<(f[0].offset()[c]+f[1].offset()[c])/2?f[0]:f[1]:f[0];i(a,s(o,p,a),p),n(d.slide,p),p.change()}});for(var y=0;y<f.length;y++){var k=a.is(d.range,o(f[y],c)).toFixed(b);"string"==typeof d.serialization.to[y]?f[y].data("input",p.append('<input type="hidden" name="'+d.serialization.to[y]+'">').find("input:last").val(k).change(function(e){e.stopPropagation()})):0==d.serialization.to[y]?f[y].data("input",{val:function(e){return"undefined"==typeof e?this.handle.data("noUiVal"):void this.handle.data("noUiVal",e)},handle:f[y]}):f[y].data("input",d.serialization.to[y].data("handleNR",y).val(k).change(function(){var t=[null,null];t[e(this).data("handleNR")]=e(this).val(),p.val(t)}))}e(this).data("setup",{settings:d,handles:f,pos:c,res:b})})},val:function(){if("undefined"!=typeof arguments[0]){var t="number"==typeof arguments[0]?[arguments[0]]:arguments[0];return this.each(function(){for(var i=e(this).data("setup"),n=0;n<i.handles.length;n++)if(null!=t[n]){var r=s(a.to(i.settings.range,t[n]),e(this),i.handles[n]);i.handles[n].css(i.pos,r+"%").data("input").val(a.is(i.settings.range,r).toFixed(i.res))}})}for(var i=e(this).data("setup").handles,n=[],r=0;r<i.length;r++)n.push(parseFloat(i[r].data("input").val()));return 1==n.length?n[0]:n},disabled:function(){return i?e(this).addClass("disabled"):e(this).removeClass("disabled")}};var c=jQuery.fn.val;return jQuery.fn.val=function(){return this.data("_isnS_")?methods.val.apply(this,arguments):c.apply(this,arguments)},"disabled"==t?methods.disabled.apply(this):methods.create.apply(this)}}(jQuery),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jquery")):e(jQuery)}(function(e,t){"use strict";function i(t,i,n,s){for(var r=[],o=0;o<t.length;o++){var a=t[o];if(a){var l=tinycolor(a),c=l.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";c+=tinycolor.equals(i,a)?" sp-thumb-active":"";var u=l.toString(s.preferredFormat||"rgb"),d=g?"background-color:"+l.toRgbString():"filter:"+l.toFilter();r.push('<span title="'+u+'" data-color="'+l.toRgbString()+'" class="'+c+'"><span class="sp-thumb-inner" style="'+d+';" /></span>')}else{var h="sp-clear-display";r.push(e("<div />").append(e('<span data-color="" style="background-color:transparent;" class="'+h+'"></span>').attr("title",s.noColorSelectedText)).html())}}return"<div class='sp-cf "+n+"'>"+r.join("")+"</div>"}function n(){for(var e=0;e<f.length;e++)f[e]&&f[e].hide()}function s(t,i){var n=e.extend({},p,t);return n.callbacks={move:c(n.move,i),change:c(n.change,i),show:c(n.show,i),hide:c(n.hide,i),beforeShow:c(n.beforeShow,i)},n}function r(r,a){function c(){if(V.showPaletteOnly&&(V.showPalette=!0),$e.text(V.showPaletteOnly?V.togglePaletteMoreText:V.togglePaletteLessText),V.palette){pe=V.palette.slice(0),fe=e.isArray(pe[0])?pe:[pe],me={};for(var t=0;t<fe.length;t++)for(var i=0;i<fe[t].length;i++){var n=tinycolor(fe[t][i]).toRgbString();me[n]=!0}}Se.toggleClass("sp-flat",q),Se.toggleClass("sp-input-disabled",!V.showInput),Se.toggleClass("sp-alpha-enabled",V.showAlpha),Se.toggleClass("sp-clear-enabled",Ke),Se.toggleClass("sp-buttons-disabled",!V.showButtons),Se.toggleClass("sp-palette-buttons-disabled",!V.togglePaletteOnly),Se.toggleClass("sp-palette-disabled",!V.showPalette),Se.toggleClass("sp-palette-only",V.showPaletteOnly),Se.toggleClass("sp-initial-disabled",!V.showInitial),Se.addClass(V.className).addClass(V.containerClassName),H()}function p(){function t(t){return t.data&&t.data.ignore?(M(e(t.target).closest(".sp-thumb-el").data("color")),N()):(M(e(t.target).closest(".sp-thumb-el").data("color")),N(),B(!0),V.hideAfterPaletteSelect&&D()),!1}if(m&&Se.find("*:not(input)").attr("unselectable","on"),c(),Fe&&we.after(je).hide(),Ke||Ne.hide(),q)we.after(Se).hide();else{var i="parent"===V.appendTo?we.parent():e(V.appendTo);1!==i.length&&(i=e("body")),i.append(Se)}y(),We.bind("click.spectrum touchstart.spectrum",function(t){Ce||I(),t.stopPropagation(),e(t.target).is("input")||t.preventDefault()}),(we.is(":disabled")||V.disabled===!0)&&z(),Se.click(l),Le.change(E),Le.bind("paste",function(){setTimeout(E,1)}),Le.keydown(function(e){13==e.keyCode&&E()}),Re.text(V.cancelText),Re.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),L(),D()}),Ne.attr("title",V.clearText),Ne.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),Xe=!0,N(),q&&B(!0)}),Ue.text(V.chooseText),Ue.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),m&&Le.is(":focus")&&Le.trigger("change"),R()&&(B(!0),D())}),$e.text(V.showPaletteOnly?V.togglePaletteMoreText:V.togglePaletteLessText),$e.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),V.showPaletteOnly=!V.showPaletteOnly,V.showPaletteOnly||q||Se.css("left","-="+(Te.outerWidth(!0)+5)),c()}),u(Ae,function(e,t,i){he=e/oe,Xe=!1,i.shiftKey&&(he=Math.round(10*he)/10),N()},T,k),u(Ie,function(e,t){ce=parseFloat(t/se),Xe=!1,V.showAlpha||(he=1),N()},T,k),u(ke,function(e,t,i){if(i.shiftKey){if(!ye){var n=ue*te,s=ie-de*ie,r=Math.abs(e-n)>Math.abs(t-s);ye=r?"x":"y"}}else ye=null;var o=!ye||"x"===ye,a=!ye||"y"===ye;o&&(ue=parseFloat(e/te)),a&&(de=parseFloat((ie-t)/ie)),Xe=!1,V.showAlpha||(he=1),N()},T,k),Ge?(M(Ge),U(),qe=V.preferredFormat||tinycolor(Ge).format,_(Ge)):U(),q&&x();var n=m?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Me.delegate(".sp-thumb-el",n,t),Oe.delegate(".sp-thumb-el:nth-child(1)",n,{ignore:!0},t)}function y(){if(X&&window.localStorage){try{var t=window.localStorage[X].split(",#");t.length>1&&(delete window.localStorage[X],e.each(t,function(e,t){_(t)}))}catch(i){}try{ge=window.localStorage[X].split(";")}catch(i){}}}function _(t){if(Y){var i=tinycolor(t).toRgbString();if(!me[i]&&-1===e.inArray(i,ge))for(ge.push(i);ge.length>ve;)ge.shift();if(X&&window.localStorage)try{window.localStorage[X]=ge.join(";")}catch(n){}}}function w(){var e=[];if(V.showPalette)for(var t=0;t<ge.length;t++){var i=tinycolor(ge[t]).toRgbString();me[i]||e.push(ge[t])}return e.reverse().slice(0,V.maxSelectionSize)}function C(){var t=O(),n=e.map(fe,function(e,n){return i(e,t,"sp-palette-row sp-palette-row-"+n,V)});y(),ge&&n.push(i(w(),t,"sp-palette-row sp-palette-row-selection",V)),Me.html(n.join(""))}function S(){if(V.showInitial){var e=Ve,t=O();Oe.html(i([e,t],t,"sp-palette-row-initial",V))}}function T(){(0>=ie||0>=te||0>=se)&&H(),ee=!0,Se.addClass(be),ye=null,we.trigger("dragstart.spectrum",[O()])}function k(){ee=!1,Se.removeClass(be),we.trigger("dragstop.spectrum",[O()])}function E(){var e=Le.val();if(null!==e&&""!==e||!Ke){var t=tinycolor(e);t.isValid()?(M(t),B(!0)):Le.addClass("sp-validation-error")}else M(null),B(!0)}function I(){Z?D():x()}function x(){var t=e.Event("beforeShow.spectrum");return Z?void H():(we.trigger(t,[O()]),void(Q.beforeShow(O())===!1||t.isDefaultPrevented()||(n(),Z=!0,e(_e).bind("keydown.spectrum",P),e(_e).bind("click.spectrum",A),e(window).bind("resize.spectrum",J),je.addClass("sp-active"),Se.removeClass("sp-hidden"),H(),U(),Ve=O(),S(),Q.show(Ve),we.trigger("show.spectrum",[Ve]))))}function P(e){27===e.keyCode&&D()}function A(e){2!=e.button&&(ee||(Ye?B(!0):L(),D()))}function D(){Z&&!q&&(Z=!1,e(_e).unbind("keydown.spectrum",P),e(_e).unbind("click.spectrum",A),e(window).unbind("resize.spectrum",J),je.removeClass("sp-active"),Se.addClass("sp-hidden"),Q.hide(O()),we.trigger("hide.spectrum",[O()]))}function L(){M(Ve,!0)}function M(e,t){if(tinycolor.equals(e,O()))return void U();var i,n;!e&&Ke?Xe=!0:(Xe=!1,i=tinycolor(e),n=i.toHsv(),ce=n.h%360/360,ue=n.s,de=n.v,he=n.a),U(),i&&i.isValid()&&!t&&(qe=V.preferredFormat||i.getFormat())}function O(e){return e=e||{},Ke&&Xe?null:tinycolor.fromRatio({h:ce,s:ue,v:de,a:Math.round(100*he)/100},{format:e.format||qe})}function R(){return!Le.hasClass("sp-validation-error")}function N(){U(),Q.move(O()),we.trigger("move.spectrum",[O()])}function U(){Le.removeClass("sp-validation-error"),$();var e=tinycolor.fromRatio({h:ce,s:1,v:1});ke.css("background-color",e.toHexString());var t=qe;1>he&&(0!==he||"name"!==t)&&("hex"===t||"hex3"===t||"hex6"===t||"name"===t)&&(t="rgb");var i=O({format:t}),n="";if(ze.removeClass("sp-clear-display"),ze.css("background-color","transparent"),!i&&Ke)ze.addClass("sp-clear-display");else{var s=i.toHexString(),r=i.toRgbString();if(g||1===i.alpha?ze.css("background-color",r):(ze.css("background-color","transparent"),ze.css("filter",i.toFilter())),V.showAlpha){var o=i.toRgb();o.a=0;var a=tinycolor(o).toRgbString(),l="linear-gradient(left, "+a+", "+s+")";m?Pe.css("filter",tinycolor(a).toFilter({gradientType:1},s)):(Pe.css("background","-webkit-"+l),Pe.css("background","-moz-"+l),Pe.css("background","-ms-"+l),Pe.css("background","linear-gradient(to right, "+a+", "+s+")"))}n=i.toString(t)}V.showInput&&Le.val(n),V.showPalette&&C(),S()}function $(){var e=ue,t=de;if(Ke&&Xe)De.hide(),xe.hide(),Ee.hide();else{De.show(),xe.show(),Ee.show();var i=e*te,n=ie-t*ie;i=Math.max(-ne,Math.min(te-ne,i-ne)),n=Math.max(-ne,Math.min(ie-ne,n-ne)),Ee.css({top:n+"px",left:i+"px"});var s=he*oe;De.css({left:s-ae/2+"px"});var r=ce*se;xe.css({top:r-le+"px"})}}function B(e){var t=O(),i="",n=!tinycolor.equals(t,Ve);t&&(i=t.toString(qe),_(t)),Be&&we.val(i),e&&n&&(Q.change(t),we.trigger("change",[t]))}function H(){Z&&(te=ke.width(),ie=ke.height(),ne=Ee.height(),re=Ie.width(),se=Ie.height(),le=xe.height(),oe=Ae.width(),ae=De.width(),q||(Se.css("position","absolute"),V.offset?Se.offset(V.offset):Se.offset(o(Se,We))),$(),V.showPalette&&C(),we.trigger("reflow.spectrum"))}function F(){we.show(),We.unbind("click.spectrum touchstart.spectrum"),Se.remove(),je.remove(),f[Qe.id]=null}function j(i,n){return i===t?e.extend({},V):n===t?V[i]:(V[i]=n,"preferredFormat"===i&&(qe=V.preferredFormat),void c())}function W(){Ce=!1,we.attr("disabled",!1),We.removeClass("sp-disabled")}function z(){D(),Ce=!0,we.attr("disabled",!0),We.addClass("sp-disabled")}function G(e){V.offset=e,H()}var V=s(a,r),q=V.flat,Y=V.showSelectionPalette,X=V.localStorageKey,K=V.theme,Q=V.callbacks,J=d(H,10),Z=!1,ee=!1,te=0,ie=0,ne=0,se=0,re=0,oe=0,ae=0,le=0,ce=0,ue=0,de=0,he=1,pe=[],fe=[],me={},ge=V.selectionPalette.slice(0),ve=V.maxSelectionSize,be="sp-dragging",ye=null,_e=r.ownerDocument,we=(_e.body,e(r)),Ce=!1,Se=e(b,_e).addClass(K),Te=Se.find(".sp-picker-container"),ke=Se.find(".sp-color"),Ee=Se.find(".sp-dragger"),Ie=Se.find(".sp-hue"),xe=Se.find(".sp-slider"),Pe=Se.find(".sp-alpha-inner"),Ae=Se.find(".sp-alpha"),De=Se.find(".sp-alpha-handle"),Le=Se.find(".sp-input"),Me=Se.find(".sp-palette"),Oe=Se.find(".sp-initial"),Re=Se.find(".sp-cancel"),Ne=Se.find(".sp-clear"),Ue=Se.find(".sp-choose"),$e=Se.find(".sp-palette-toggle"),Be=we.is("input"),He=Be&&"color"===we.attr("type")&&h(),Fe=Be&&!q,je=Fe?e(v).addClass(K).addClass(V.className).addClass(V.replacerClassName):e([]),We=Fe?je:we,ze=je.find(".sp-preview-inner"),Ge=V.color||Be&&we.val(),Ve=!1,qe=V.preferredFormat,Ye=!V.showButtons||V.clickoutFiresChange,Xe=!Ge,Ke=V.allowEmpty&&!He;p();var Qe={show:x,hide:D,toggle:I,reflow:H,option:j,enable:W,disable:z,offset:G,set:function(e){M(e),B()},get:O,destroy:F,container:Se};return Qe.id=f.push(Qe)-1,Qe}function o(t,i){var n=0,s=t.outerWidth(),r=t.outerHeight(),o=i.outerHeight(),a=t[0].ownerDocument,l=a.documentElement,c=l.clientWidth+e(a).scrollLeft(),u=l.clientHeight+e(a).scrollTop(),d=i.offset();return d.top+=o,d.left-=Math.min(d.left,d.left+s>c&&c>s?Math.abs(d.left+s-c):0),d.top-=Math.min(d.top,d.top+r>u&&u>r?Math.abs(r+o-n):n),d}function a(){}function l(e){e.stopPropagation()}function c(e,t){var i=Array.prototype.slice,n=i.call(arguments,2);return function(){return e.apply(t,n.concat(i.call(arguments)))}}function u(t,i,n,s){function r(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function o(e){if(u){if(m&&c.documentMode<9&&!e.button)return l();var n=e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches[0],s=n&&n.pageX||e.pageX,o=n&&n.pageY||e.pageY,a=Math.max(0,Math.min(s-d.left,p)),g=Math.max(0,Math.min(o-d.top,h));f&&r(e),i.apply(t,[a,g,e])}}function a(i){var s=i.which?3==i.which:2==i.button;s||u||n.apply(t,arguments)!==!1&&(u=!0,h=e(t).height(),p=e(t).width(),d=e(t).offset(),e(c).bind(g),e(c.body).addClass("sp-dragging"),o(i),r(i))}function l(){u&&(e(c).unbind(g),e(c.body).removeClass("sp-dragging"),setTimeout(function(){s.apply(t,arguments)},0)),u=!1}i=i||function(){},n=n||function(){},s=s||function(){};var c=document,u=!1,d={},h=0,p=0,f="ontouchstart"in window,g={};g.selectstart=r,g.dragstart=r,g["touchmove mousemove"]=o,g["touchend mouseup"]=l,e(t).bind("touchstart mousedown",a)}function d(e,t,i){var n;return function(){var s=this,r=arguments,o=function(){n=null,e.apply(s,r)};i&&clearTimeout(n),(i||!n)&&(n=setTimeout(o,t))}}function h(){return e.fn.spectrum.inputTypeColorSupport()}var p={beforeShow:a,move:a,change:a,show:a,hide:a,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},f=[],m=!!/msie/i.exec(window.navigator.userAgent),g=function(){function e(e,t){return!!~(""+e).indexOf(t)}var t=document.createElement("div"),i=t.style;return i.cssText="background-color:rgba(0,0,0,.5)",e(i.backgroundColor,"rgba")||e(i.backgroundColor,"hsla")}(),v=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd p-icon down-arrow'></div>","</div>"].join(""),b=function(){var e="";if(m)for(var t=1;6>=t;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),y="spectrum.id";e.fn.spectrum=function(t,i){if("string"==typeof t){var n=this,s=Array.prototype.slice.call(arguments,1);return this.each(function(){var i=f[e(this).data(y)];if(i){var r=i[t];if(!r)throw new Error("Spectrum: no such method: '"+t+"'");"get"==t?n=i.get():"container"==t?n=i.container:"option"==t?n=i.option.apply(i,s):"destroy"==t?(i.destroy(),e(this).removeData(y)):r.apply(i,s)}}),n}return this.spectrum("destroy").each(function(){var i=e.extend({},t,e(this).data()),n=r(this,i);e(this).data(y,n.id)})},e.fn.spectrum.load=!0,e.fn.spectrum.loadOpts={},e.fn.spectrum.draggable=u,e.fn.spectrum.defaults=p,e.fn.spectrum.inputTypeColorSupport=function _(){if("undefined"==typeof _._cachedResult){var t=e("<input type='color'/>")[0];_._cachedResult="color"===t.type&&""!==t.value}return _._cachedResult},e.spectrum={},e.spectrum.localization={},e.spectrum.palettes={},e.fn.spectrum.processNativeColorInputs=function(){var t=e("input[type=color]");t.length&&!h()&&t.spectrum({preferredFormat:"hex6"})},function(){function e(e){var i={r:0,g:0,b:0},s=1,o=!1,a=!1;return"string"==typeof e&&(e=L(e)),"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(i=t(e.r,e.g,e.b),o=!0,a="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=P(e.s),e.v=P(e.v),i=r(e.h,e.s,e.v),o=!0,a="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=P(e.s),e.l=P(e.l),i=n(e.h,e.s,e.l),o=!0,a="hsl"),e.hasOwnProperty("a")&&(s=e.a)),s=C(s),{ok:o,format:e.format||a,r:$(255,B(i.r,0)),g:$(255,B(i.g,0)),b:$(255,B(i.b,0)),a:s}}function t(e,t,i){return{r:255*S(e,255),g:255*S(t,255),b:255*S(i,255)}}function i(e,t,i){e=S(e,255),t=S(t,255),i=S(i,255);var n,s,r=B(e,t,i),o=$(e,t,i),a=(r+o)/2;if(r==o)n=s=0;else{var l=r-o;switch(s=a>.5?l/(2-r-o):l/(r+o),r){case e:n=(t-i)/l+(i>t?6:0);break;case t:n=(i-e)/l+2;break;case i:n=(e-t)/l+4}n/=6}return{h:n,s:s,l:a}}function n(e,t,i){function n(e,t,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?e+6*(t-e)*i:.5>i?t:2/3>i?e+(t-e)*(2/3-i)*6:e;
}var s,r,o;if(e=S(e,360),t=S(t,100),i=S(i,100),0===t)s=r=o=i;else{var a=.5>i?i*(1+t):i+t-i*t,l=2*i-a;s=n(l,a,e+1/3),r=n(l,a,e),o=n(l,a,e-1/3)}return{r:255*s,g:255*r,b:255*o}}function s(e,t,i){e=S(e,255),t=S(t,255),i=S(i,255);var n,s,r=B(e,t,i),o=$(e,t,i),a=r,l=r-o;if(s=0===r?0:l/r,r==o)n=0;else{switch(r){case e:n=(t-i)/l+(i>t?6:0);break;case t:n=(i-e)/l+2;break;case i:n=(e-t)/l+4}n/=6}return{h:n,s:s,v:a}}function r(e,t,i){e=6*S(e,360),t=S(t,100),i=S(i,100);var n=N.floor(e),s=e-n,r=i*(1-t),o=i*(1-s*t),a=i*(1-(1-s)*t),l=n%6,c=[i,o,r,r,a,i][l],u=[a,i,i,o,r,r][l],d=[r,r,a,i,i,o][l];return{r:255*c,g:255*u,b:255*d}}function o(e,t,i,n){var s=[x(U(e).toString(16)),x(U(t).toString(16)),x(U(i).toString(16))];return n&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function a(e,t,i,n){var s=[x(A(n)),x(U(e).toString(16)),x(U(t).toString(16)),x(U(i).toString(16))];return s.join("")}function l(e,t){t=0===t?0:t||10;var i=F(e).toHsl();return i.s-=t/100,i.s=T(i.s),F(i)}function c(e,t){t=0===t?0:t||10;var i=F(e).toHsl();return i.s+=t/100,i.s=T(i.s),F(i)}function u(e){return F(e).desaturate(100)}function d(e,t){t=0===t?0:t||10;var i=F(e).toHsl();return i.l+=t/100,i.l=T(i.l),F(i)}function h(e,t){t=0===t?0:t||10;var i=F(e).toRgb();return i.r=B(0,$(255,i.r-U(255*-(t/100)))),i.g=B(0,$(255,i.g-U(255*-(t/100)))),i.b=B(0,$(255,i.b-U(255*-(t/100)))),F(i)}function p(e,t){t=0===t?0:t||10;var i=F(e).toHsl();return i.l-=t/100,i.l=T(i.l),F(i)}function f(e,t){var i=F(e).toHsl(),n=(U(i.h)+t)%360;return i.h=0>n?360+n:n,F(i)}function m(e){var t=F(e).toHsl();return t.h=(t.h+180)%360,F(t)}function g(e){var t=F(e).toHsl(),i=t.h;return[F(e),F({h:(i+120)%360,s:t.s,l:t.l}),F({h:(i+240)%360,s:t.s,l:t.l})]}function v(e){var t=F(e).toHsl(),i=t.h;return[F(e),F({h:(i+90)%360,s:t.s,l:t.l}),F({h:(i+180)%360,s:t.s,l:t.l}),F({h:(i+270)%360,s:t.s,l:t.l})]}function b(e){var t=F(e).toHsl(),i=t.h;return[F(e),F({h:(i+72)%360,s:t.s,l:t.l}),F({h:(i+216)%360,s:t.s,l:t.l})]}function y(e,t,i){t=t||6,i=i||30;var n=F(e).toHsl(),s=360/i,r=[F(e)];for(n.h=(n.h-(s*t>>1)+720)%360;--t;)n.h=(n.h+s)%360,r.push(F(n));return r}function _(e,t){t=t||6;for(var i=F(e).toHsv(),n=i.h,s=i.s,r=i.v,o=[],a=1/t;t--;)o.push(F({h:n,s:s,v:r})),r=(r+a)%1;return o}function w(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}function C(e){return e=parseFloat(e),(isNaN(e)||0>e||e>1)&&(e=1),e}function S(e,t){E(e)&&(e="100%");var i=I(e);return e=$(t,B(0,parseFloat(e))),i&&(e=parseInt(e*t,10)/100),N.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function T(e){return $(1,B(0,e))}function k(e){return parseInt(e,16)}function E(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)}function I(e){return"string"==typeof e&&-1!=e.indexOf("%")}function x(e){return 1==e.length?"0"+e:""+e}function P(e){return 1>=e&&(e=100*e+"%"),e}function A(e){return Math.round(255*parseFloat(e)).toString(16)}function D(e){return k(e)/255}function L(e){e=e.replace(M,"").replace(O,"").toLowerCase();var t=!1;if(j[e])e=j[e],t=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=z.rgb.exec(e))?{r:i[1],g:i[2],b:i[3]}:(i=z.rgba.exec(e))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=z.hsl.exec(e))?{h:i[1],s:i[2],l:i[3]}:(i=z.hsla.exec(e))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=z.hsv.exec(e))?{h:i[1],s:i[2],v:i[3]}:(i=z.hsva.exec(e))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=z.hex8.exec(e))?{a:D(i[1]),r:k(i[2]),g:k(i[3]),b:k(i[4]),format:t?"name":"hex8"}:(i=z.hex6.exec(e))?{r:k(i[1]),g:k(i[2]),b:k(i[3]),format:t?"name":"hex"}:(i=z.hex3.exec(e))?{r:k(i[1]+""+i[1]),g:k(i[2]+""+i[2]),b:k(i[3]+""+i[3]),format:t?"name":"hex"}:!1}var M=/^[\s,#]+/,O=/\s+$/,R=0,N=Math,U=N.round,$=N.min,B=N.max,H=N.random,F=function(t,i){if(t=t?t:"",i=i||{},t instanceof F)return t;if(!(this instanceof F))return new F(t,i);var n=e(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=U(100*this._a)/100,this._format=i.format||n.format,this._gradientType=i.gradientType,this._r<1&&(this._r=U(this._r)),this._g<1&&(this._g=U(this._g)),this._b<1&&(this._b=U(this._b)),this._ok=n.ok,this._tc_id=R++};F.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},setAlpha:function(e){return this._a=C(e),this._roundA=U(100*this._a)/100,this},toHsv:function(){var e=s(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=s(this._r,this._g,this._b),t=U(360*e.h),i=U(100*e.s),n=U(100*e.v);return 1==this._a?"hsv("+t+", "+i+"%, "+n+"%)":"hsva("+t+", "+i+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var e=i(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=i(this._r,this._g,this._b),t=U(360*e.h),n=U(100*e.s),s=U(100*e.l);return 1==this._a?"hsl("+t+", "+n+"%, "+s+"%)":"hsla("+t+", "+n+"%, "+s+"%, "+this._roundA+")"},toHex:function(e){return o(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return a(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:U(this._r),g:U(this._g),b:U(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+U(this._r)+", "+U(this._g)+", "+U(this._b)+")":"rgba("+U(this._r)+", "+U(this._g)+", "+U(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:U(100*S(this._r,255))+"%",g:U(100*S(this._g,255))+"%",b:U(100*S(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+U(100*S(this._r,255))+"%, "+U(100*S(this._g,255))+"%, "+U(100*S(this._b,255))+"%)":"rgba("+U(100*S(this._r,255))+"%, "+U(100*S(this._g,255))+"%, "+U(100*S(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":this._a<1?!1:W[o(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+a(this._r,this._g,this._b,this._a),i=t,n=this._gradientType?"GradientType = 1, ":"";if(e){var s=F(e);i=s.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+t+",endColorstr="+i+")"},toString:function(e){var t=!!e;e=e||this._format;var i=!1,n=this._a<1&&this._a>=0,s=!t&&n&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e);return s?"name"===e&&0===this._a?this.toName():this.toRgbString():("rgb"===e&&(i=this.toRgbString()),"prgb"===e&&(i=this.toPercentageRgbString()),("hex"===e||"hex6"===e)&&(i=this.toHexString()),"hex3"===e&&(i=this.toHexString(!0)),"hex8"===e&&(i=this.toHex8String()),"name"===e&&(i=this.toName()),"hsl"===e&&(i=this.toHslString()),"hsv"===e&&(i=this.toHsvString()),i||this.toHexString())},_applyModification:function(e,t){var i=e.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(d,arguments)},brighten:function(){return this._applyModification(h,arguments)},darken:function(){return this._applyModification(p,arguments)},desaturate:function(){return this._applyModification(l,arguments)},saturate:function(){return this._applyModification(c,arguments)},greyscale:function(){return this._applyModification(u,arguments)},spin:function(){return this._applyModification(f,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(y,arguments)},complement:function(){return this._applyCombination(m,arguments)},monochromatic:function(){return this._applyCombination(_,arguments)},splitcomplement:function(){return this._applyCombination(b,arguments)},triad:function(){return this._applyCombination(g,arguments)},tetrad:function(){return this._applyCombination(v,arguments)}},F.fromRatio=function(e,t){if("object"==typeof e){var i={};for(var n in e)e.hasOwnProperty(n)&&("a"===n?i[n]=e[n]:i[n]=P(e[n]));e=i}return F(e,t)},F.equals=function(e,t){return e&&t?F(e).toRgbString()==F(t).toRgbString():!1},F.random=function(){return F.fromRatio({r:H(),g:H(),b:H()})},F.mix=function(e,t,i){i=0===i?0:i||50;var n,s=F(e).toRgb(),r=F(t).toRgb(),o=i/100,a=2*o-1,l=r.a-s.a;n=a*l==-1?a:(a+l)/(1+a*l),n=(n+1)/2;var c=1-n,u={r:r.r*n+s.r*c,g:r.g*n+s.g*c,b:r.b*n+s.b*c,a:r.a*o+s.a*(1-o)};return F(u)},F.readability=function(e,t){var i=F(e),n=F(t),s=i.toRgb(),r=n.toRgb(),o=i.getBrightness(),a=n.getBrightness(),l=Math.max(s.r,r.r)-Math.min(s.r,r.r)+Math.max(s.g,r.g)-Math.min(s.g,r.g)+Math.max(s.b,r.b)-Math.min(s.b,r.b);return{brightness:Math.abs(o-a),color:l}},F.isReadable=function(e,t){var i=F.readability(e,t);return i.brightness>125&&i.color>500},F.mostReadable=function(e,t){for(var i=null,n=0,s=!1,r=0;r<t.length;r++){var o=F.readability(e,t[r]),a=o.brightness>125&&o.color>500,l=3*(o.brightness/125)+o.color/500;(a&&!s||a&&s&&l>n||!a&&!s&&l>n)&&(s=a,n=l,i=F(t[r]))}return i};var j=F.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},W=F.hexNames=w(j),z=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",i="(?:"+t+")|(?:"+e+")",n="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?",s="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?";return{rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+s),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();window.tinycolor=F}(),e(function(){e.fn.spectrum.load&&e.fn.spectrum.processNativeColorInputs()})}),"function"==typeof require&&require("neon"),Class("Chameleon")({COLOR_NAMES:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},RGBRegExp:/^\s*rgba?\s*\((\d+)\,\s*(\d+)\,\s*(\d+)(,\s*(\d+(\.\d+)?))?\)\s*$/,HTMLRegExp:/^\#([0-9A-Fa-f]{6})$/,HTMLShortRegExp:/^\#([0-9A-Fa-f]{3})$/,RGBToHSV:function(e,t,i){e/=255,t/=255,i/=255;var n,s,r,o=Math.max(e,t,i),a=Math.min(e,t,i);return o===a?n=0:o===e?n=(60*((t-i)/(o-a))+360)%360:o===t?n=60*((i-e)/(o-a))+120:o===i&&(n=60*((e-t)/(o-a))+240),s=0===o?0:(o-a)/o,r=o,n=Math.round(n),s=Math.round(100*s),r=Math.round(100*r),{h:n,s:s,v:r}},HexStringToHSV:function(e){var t=parseInt(e.substr(0,2),16),i=parseInt(e.substr(2,2),16),n=parseInt(e.substr(4,2),16);return isNaN(t)||isNaN(i)||isNaN(n)?void 0:this.RGBToHSV(t,i,n)},HSVToRGB:function(e,t,i){var n,s,r;if(0===t)n=s=r=Math.round(2.55*i);else{e/=60,t/=100,i/=100;var o=Math.floor(e),a=e-o,l=i*(1-t),c=i*(1-t*a),u=i*(1-t*(1-a));switch(o){case 0:n=i,s=u,r=l;break;case 1:n=c,s=i,r=l;break;case 2:n=l,s=i,r=u;break;case 3:n=l,s=c,r=i;break;case 4:n=u,s=l,r=i;break;default:n=i,s=l,r=c}n=Math.round(255*n),s=Math.round(255*s),r=Math.round(255*r)}return{r:n,g:s,b:r}},HSVToLAB:function(e,t,i){var n,s,r,o,a,l,c=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],u=[],d=[],h=[],p=this.HSVToRGB(e,t,i);for(u.push(p.r/255),u.push(p.g/255),u.push(p.b/255),o=0;o<u.length;o++)u[o]>.04045?u[o]=Math.pow((u[o]+.055)/1.055,2.4):u[o]=u[o]/12.92;for(a=0;a<u.length;a++)d.push(u[0]*c[a][0]+u[1]*c[a][1]+u[2]*c[a][2]);for(d[0]=100*d[0]/95.047,d[1]=100*d[1]/100,d[2]=100*d[2]/108.883,l=0;l<d.length;l++)d[l]>.008856?h.push(Math.pow(d[l],1/3)):h.push((903.3*d[l]+16)/116);return n=Math.round(116*h[1]-16),s=Math.round(500*(h[0]-h[1])),r=Math.round(200*(h[1]-h[2])),{l:n,a:s,b:r}},LABToHSV:function(e,t,i){var n,s,r,o=[],a=[];for(o[1]=(e+16)/116,o[0]=t/500+o[1],o[2]=o[1]-i/200,n=0;n<o.length;n++)o[n]=Math.pow(o[n],3),!o[n]>.008856&&(o[n]=(o[n]-16/116)/7.787);for(o[0]=.95047*o[0],o[1]=1*o[1],o[2]=1.08883*o[2],a[0]=3.2406*o[0]+-1.5372*o[1]+o[2]*-.4986,a[1]=o[0]*-.9689+1.8758*o[1]+.0415*o[2],a[2]=.0557*o[0]+o[1]*-.204+1.057*o[2],s=0;s<a.length;s++)a[s]>.0031308?a[s]=1.055*Math.pow(a[s],1/2.4)-.055:a[s]=12.92*a[s],a[s]=255*Math.min(Math.max(0,a[s]),1);return r=this.RGBToHSV(a[0],a[1],a[2]),{h:r.h,s:r.s,v:r.v}},prototype:{_h:0,_s:0,_v:0,_a:100,_o:1,isAchromatic:!1,init:function(e){if(e instanceof Chameleon)this._h=e.getHue(),this._s=e.getSaturation(),this._v=e.getValue();else if("transparent"===e)this._a=0;else if("string"==typeof e&&this.constructor.RGBRegExp.test(e)){var t=this.constructor.RGBToHSV(parseInt(RegExp.$1),parseInt(RegExp.$2),parseInt(RegExp.$3));this._h=t.h,this._s=t.s,this._v=t.v,this._o=RegExp.$5}else if("string"==typeof e&&this.constructor.HTMLRegExp.test(e)){var t=this.constructor.HexStringToHSV(RegExp.$1);this._h=t.h,this._s=t.s,this._v=t.v}else if("string"==typeof e&&this.constructor.HTMLShortRegExp.test(e)){for(var i=e.match(this.constructor.HTMLShortRegExp)[1].split(""),n=[],s=0;s<i.length;s++)n.push(i[s]),n.push(i[s]);var r=n.join(""),t=this.constructor.HexStringToHSV(r);this._h=t.h,this._s=t.s,this._v=t.v}else if("string"==typeof e&&this.constructor.COLOR_NAMES[e.toLowerCase()]){var o=this.constructor.COLOR_NAMES[e.toLowerCase()].replace("#",""),t=this.constructor.HexStringToHSV(o);this._h=t.h,this._s=t.s,this._v=t.v}else if(e instanceof Object&&e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")){var t=this.constructor.RGBToHSV(e.r,e.g,e.b);this._h=t.h,this._s=t.s,this._v=t.v}else{if(!(e instanceof Object&&e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")))throw console.log("color could not be parsed"),console.log("color",typeof e),console.log(e),new Error("unparseable color");this._h=e.h,this._s=e.s,this._v=e.v}0===this._s&&(this.isAchromatic=!0)},getHue:function(){return this._h},getSaturation:function(){return this._s},getValue:function(){return this._v},setHue:function(e){return this._h=e,this},setSaturation:function(e){return this._s=e,0===this._s?this.isAchromatic=!0:this.isAchromatic=!1,this},setValue:function(e){return this._v=e,this},iluminateBy:function(e){return this._v=this._v+e,this._v>100&&(this._v=100),this},luminosityBy:function(e){var t,i;return t=this.toLAB(),t.l+=e,t.l>100&&(t.l-=100),i=this.constructor.LABToHSV(t.l,t.a,t.b),this._h=i.h,this._s=i.s,this._v=i.v,this},obscureBy:function(e){return this._v=this._v-e,this._v<0&&(this._v=0),this},saturateBy:function(e){return 0===this._s?this.isAchromatic=!0:this.setSaturation(this._s+e),this._s>100&&(this._s=100),this.isAchromatic===!0&&(this._s=0),this},desaturateBy:function(e){return this.setSaturation(this._s-e),this._s<0&&(this._s=0,this.isAchromatic=!0),1==this.isAchromatic&&(this._s=0),this},rotateBy:function(e){var t=this.copy();return t._h+=e,t._h>=360&&(t._h-=360),t._h<0&&(t._h+=360),t},warmBy:function(e){},coolBy:function(e){},transform:function(e,t,i){return e>-1&&(this._h=e),t>-1&&(this._s=t),i>-1&&(this._v=i),0===this._s&&(this.isAchromatic=!0),this.isAchromatic===!0&&(this._s=0),this},setSV:function(e,t){return this.transform(-1,e,t),this},setBalancedSV:function(e,t){var i=this.toGray();return i._v>50?(e>-1&&this.desaturateBy(e),t>-1&&this.obscureBy(t)):(e>-1&&this.saturateBy(e),t>-1&&this.iluminateBy(t)),this},gradientSV:function(e,t){return this._v>50?(e>-1&&100==this.saturation?this.desaturateBy(e):e>-1&&0===this.saturation&&this.saturateBy(e),t>-1&&this.obscureBy(t)):(e>-1&&0===this.saturation?this.saturateBy(e):e>-1&&100==this.saturation&&this.desaturateBy(e),t>-1&&this.iluminateBy(t)),this},copy:function(){return new this.constructor(this)},getLuminance:function(){var e=this.toLAB();return e.l},isLegible:function(e){var t=e.toGray(),i=this.toGray();return Math.abs(t.getValue()-i.getValue())>30?!0:!1},getLegibles:function(e){var t=[];this.isLegible(e)&&t.push(e);var i,n=e.getHue();if(e.isAchromatic)for(var s=0;100>=s;s+=1)i=new this.constructor({h:n,s:0,v:s}),this.isLegible(i)&&t.push(i);else for(var r=0;100>=r;r+=10)for(var s=0;100>=s;s+=10)i=new this.constructor({h:n,s:r,v:s}),this.isLegible(i)&&t.push(i);for(var o={},a=0;a<t.length;a++)o[t[a].toHTML()]=!0;var l=[];for(var a in o)l.push(a);for(var c=[],u=[],d=l.length,a=0;d>a;a++){var e=new Chameleon(l[a]),h=e._s+e._v;130>=h?u.push(l[a]):c.push(l[a])}c.sort(function(e,t){return parseInt(e.substr(1,e.length-2),16)-parseInt(t.substr(1,t.length-2),16)}),u.sort(function(e,t){return parseInt(e.substr(1,e.length-2),16)-parseInt(t.substr(1,t.length-2),16)}),l=u.concat(c);for(var p=[],f=Math.round(l.length/10),a=0;9>a;a++)p.push(l[f*a]);return p},getLegible:function(e){if(this.isLegible(e))return this;for(var t=this.getLegibles(e),i=[],n=0;n<t.length;n++)i.push(new Chameleon(t[n].toString()));return this.byNearestColor(i)[0]},byNearestColor:function(e){var t=this;return e.sort(function(e,i){return Math.abs(e.toHex()-t.toHex())-Math.abs(i.toHex()-t.toHex())})},toGray:function(){var e,t,i,n=this.toRGB();return e=t=i=Math.round((11*n.r+16*n.g+5*n.b)/32),new this.constructor({r:e,g:t,b:i})},toRGB:function(){return this.constructor.HSVToRGB(this._h,this._s,this._v)},toHSV:function(){return{h:this._h,s:this._s,v:this._v}},toLAB:function(){return this.constructor.HSVToLAB(this._h,this._s,this._v)},toHex:function e(){var e=Number(this.toHTML().toString().replace("#","0x"));return e},toHTML:function(){if(0===this._a)return"transparent";var e=this.toRGB(),t=e.r.toString(16),i=e.g.toString(16),n=e.b.toString(16);return 1===t.length&&(t="0"+t),1===i.length&&(i="0"+i),1===n.length&&(n="0"+n),"#"+t.toString()+i.toString()+n.toString()},toHTMLRGB:function(){if(0===this._a)return"transparent";var e=this.toRGB();return!this._o&&0!==this._o||1==this._o?"rgb("+e.r+", "+e.g+","+e.b+")":"rgba("+e.r+", "+e.g+","+e.b+", "+this._o/100+")"},complementary:function(){return this.rotateBy(180)},triadic:function(e,t){return e=e||"1",t=t||120,"1"==e?this.rotateBy(t):this.rotateBy(-1*t)},analogous:function(e,t){return e=e||"1",t=t||30,"1"==e?this.rotateBy(t):this.rotateBy(-1*t)},split:function(e,t){return e=e||"1",t=t||150,"1"==e?this.rotateBy(t):this.rotateBy(-1*t)},balanceChoose:function(e,t){var i=this.toGray();return i._v>50?t:e}}}),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=Chameleon),/**
 * jQuery Grid-A-Licious(tm) v3.01
 *
 * Terms of Use - jQuery Grid-A-Licious(tm)
 * under the MIT (http://www.opensource.org/licenses/mit-license.php) License.
 *
 * Copyright 2008-2012 Andreas Pihlström (Suprb). All rights reserved.
 * (http://suprb.com/apps/gridalicious/)
 *
 */
function(e,t){var i=function(e,t,i){var n;return function(){function s(){i||e.apply(r,o),n=null}var r=this,o=arguments;n?clearTimeout(n):i&&e.apply(r,o),n=setTimeout(s,t||150)}};jQuery.fn[t]=function(e){return e?this.bind("resize",i(e)):this.trigger(t)}}(jQuery,"smartresize"),function(e){e.Gal=function(t,i){this.element=e(i),this._init(t)},e.Gal.settings={selector:".item",width:225,gutter:20,animate:!1,animationOptions:{speed:200,duration:300,effect:"fadeInOnAppear",queue:!0,complete:function(){}}},e.Gal.prototype={_init:function(t){var i=this;this.name=this._setName(5),this.gridArr=[],this.gridArrAppend=[],this.gridArrPrepend=[],this.setArr=!1,this.setGrid=!1,this.setOptions,this.cols=0,this.itemCount=0,this.prependCount=0,this.isPrepending=!1,this.appendCount=0,this.resetCount=!0,this.ifCallback=!0,this.box=this.element,this.boxWidth=this.box.width(),this.options=e.extend(!0,{},e.Gal.settings,t),this.gridArr=e.makeArray(this.box.find(this.options.selector)),this.isResizing=!1,this.w=0,this.boxArr=[],this._setCols(),this._renderGrid("append"),e(this.box).addClass("gridalicious"),e(window).smartresize(function(){i.resize()})},_setName:function(e,t){return t=t?t:"",e?this._setName(--e,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".charAt(Math.floor(60*Math.random()))+t):t},_setCols:function(){this.cols=Math.floor(this.box.width()/this.options.width),this.cols<1&&(this.cols=1),diff=(this.box.width()-this.cols*this.options.width-this.options.gutter)/this.cols,w=(this.options.width+diff)/this.box.width()*100,this.w=w;for(var t=0;t<this.cols;t++){var i=e("<ul></ul>").addClass("galcolumn").attr("id","item"+t+this.name).css({width:w+"%",paddingLeft:this.options.gutter,paddingBottom:this.options.gutter,"float":"left","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","-o-box-sizing":"border-box","box-sizing":"border-box"});this.box.append(i)}this.box.find(e("#clear"+this.name)).remove();var n=e("<div></div>").css({clear:"both",height:"0",width:"0",display:"block"}).attr("id","clear"+this.name);this.box.append(n)},_renderGrid:function(t,i,n,s){var r=[],o=[],a=0,l=(this.prependCount,this.appendCount),c=this.options.gutter,u=this.cols,d=this.name;e(".galcolumn").width();i?(o=i,"append"==t&&(l+=n,a=this.appendCount),"prepend"==t&&(this.isPrepending=!0,a=Math.round(n%u),0>=a&&(a=u)),"renderAfterPrepend"==t&&(l+=n,a=n)):(o=this.gridArr,l=e(this.gridArr).size()),e.each(o,function(i,n){var s=e(n),o="100%";if(s.hasClass("not-responsive")&&(o="auto"),s.css({marginBottom:c,zoom:"1",filter:"alpha(opacity=0)",opacity:"0"}).find("img, object, embed, iframe").css({width:o,height:"auto",display:"block","margin-left":"auto","margin-right":"auto"}),"prepend"==t)a--,e("#item"+a+d).prepend(s),r.push(s),0==a&&(a=u);else{for(var h=e("#item0"+d),p=e("#item0"+d).height(),f=1;u>f;f++){var m=e("#item"+f+d),g=e("#item"+f+d).height();p-30>g&&(p=g,h=m,a=f)}h.append(s),r.push(s),l>=u&&(l-=u)}}),this.appendCount=l,this.itemCount=a,"append"==t||"prepend"==t?("prepend"==t&&this._updateAfterPrepend(this.gridArr,o),this._renderItem(r),this.isPrepending=!1):this._renderItem(this.gridArr)},_collectItems:function(){var t=[];return e(this.box).find(this.options.selector).each(function(i){t.push(e(this))}),t},_renderItem:function(t){var i=this.options.animationOptions.speed,n=this.options.animationOptions.effect,s=this.options.animationOptions.duration,r=this.options.animationOptions.queue,o=this.options.animate,a=this.options.animationOptions.complete,l=0,c=0;o!==!0||this.isResizing?(e.each(t,function(t,i){e(i).css({opacity:"1",filter:"alpha(opacity=100)"})}),this.ifCallback&&a.call(t)):(r===!0&&"fadeInOnAppear"==n?(this.isPrepending&&t.reverse(),e.each(t,function(n,r){setTimeout(function(){e(r).animate({opacity:"1.0"},s),c++,c==t.length&&a.call(void 0,t)},l*i),l++})):r===!1&&"fadeInOnAppear"==n&&(this.isPrepending&&t.reverse(),e.each(t,function(i,n){e(n).animate({opacity:"1.0"},s),c++,c==t.length&&this.ifCallback&&a.call(void 0,t)})),r!==!0||n||e.each(t,function(i,n){e(n).css({opacity:"1",filter:"alpha(opacity=100)"}),c++,c==t.length&&this.ifCallback&&a.call(void 0,t)}))},_updateAfterPrepend:function(t,i){var n=this.gridArr;e.each(i,function(e,t){n.unshift(t)}),this.gridArr=n},resize:function(t){if(this.box.width()!==this.boxWidth||void 0!=t&&0!=t){this.box.css("display","block");var i=this.box.find(e(".galcolumn"));i.detach(),this._setCols(),this.ifCallback=!1,this.isResizing=!0,this._renderGrid("append"),this.ifCallback=!0,this.isResizing=!1,this.boxWidth=this.box.width(),i.remove(),this.box.trigger("gridalicious:resized")}},append:function(t){var i=this.gridArr,n=this.gridArrPrepend;e.each(t,function(e,t){i.push(t),n.push(t)}),this._renderGrid("append",t,e(t).size())},prepend:function(t){this.ifCallback=!1,this._renderGrid("prepend",t,e(t).size()),this.ifCallback=!0}},e.fn.gridalicious=function(t,i){return"string"==typeof t?this.each(function(){var n=e.data(this,"gridalicious");n[t].apply(n,[i])}):this.each(function(){e.data(this,"gridalicious",new e.Gal(t,this))}),this}}(jQuery),/*! algoliasearch 3.19.0 | © 2014, 2015 Algolia SAS | github.com/algolia/algoliasearch-client-js */
!function(e){var t;"undefined"!=typeof window?t=window:"undefined"!=typeof self&&(t=self),t.ALGOLIA_MIGRATION_LAYER=e()}(function(){return function e(t,i,n){function s(o,a){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[o]={exports:{}};t[o][0].call(u.exports,function(e){var i=t[o][1][e];return s(i?i:e)},u,u.exports,e,t,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(e,t,i){function n(e,t){for(var i in t)e.setAttribute(i,t[i])}function s(e,t){e.onload=function(){this.onerror=this.onload=null,t(null,e)},e.onerror=function(){this.onerror=this.onload=null,t(new Error("Failed to load "+this.src),e)}}function r(e,t){e.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,t(null,e))}}t.exports=function(e,t,i){var o=document.head||document.getElementsByTagName("head")[0],a=document.createElement("script");"function"==typeof t&&(i=t,t={}),t=t||{},i=i||function(){},a.type=t.type||"text/javascript",a.charset=t.charset||"utf8",a.async=!("async"in t&&!t.async),a.src=e,t.attrs&&n(a,t.attrs),t.text&&(a.text=""+t.text);var l="onload"in a?s:r;l(a,i),a.onload||s(a,i),o.appendChild(a)}},{}],2:[function(e,t,i){"use strict";function n(e){for(var t=new RegExp("cdn\\.jsdelivr\\.net/algoliasearch/latest/"+e.replace(".","\\.")+"(?:\\.min)?\\.js$"),i=document.getElementsByTagName("script"),n=!1,s=0,r=i.length;r>s;s++)if(i[s].src&&t.test(i[s].src)){n=!0;break}return n}t.exports=n},{}],3:[function(e,t,i){"use strict";function n(t){var i=e(1),n="//cdn.jsdelivr.net/algoliasearch/2/"+t+".min.js",r="-- AlgoliaSearch `latest` warning --\nWarning, you are using the `latest` version string from jsDelivr to load the AlgoliaSearch library.\nUsing `latest` is no more recommended, you should load //cdn.jsdelivr.net/algoliasearch/2/algoliasearch.min.js\n\nAlso, we updated the AlgoliaSearch JavaScript client to V3. If you want to upgrade,\nplease read our migration guide at https://github.com/algolia/algoliasearch-client-js/wiki/Migration-guide-from-2.x.x-to-3.x.x\n-- /AlgoliaSearch  `latest` warning --";window.console&&(window.console.warn?window.console.warn(r):window.console.log&&window.console.log(r));try{document.write("<script>window.ALGOLIA_SUPPORTS_DOCWRITE = true</script>"),window.ALGOLIA_SUPPORTS_DOCWRITE===!0?(document.write('<script src="'+n+'"></script>'),s("document.write")()):i(n,s("DOMElement"))}catch(o){i(n,s("DOMElement"))}}function s(e){return function(){var t="AlgoliaSearch: loaded V2 script using "+e;window.console&&window.console.log&&window.console.log(t)}}t.exports=n},{1:1}],4:[function(e,t,i){"use strict";function n(){var e="-- AlgoliaSearch V2 => V3 error --\nYou are trying to use a new version of the AlgoliaSearch JavaScript client with an old notation.\nPlease read our migration guide at https://github.com/algolia/algoliasearch-client-js/wiki/Migration-guide-from-2.x.x-to-3.x.x\n-- /AlgoliaSearch V2 => V3 error --";window.AlgoliaSearch=function(){throw new Error(e)},window.AlgoliaSearchHelper=function(){throw new Error(e)},window.AlgoliaExplainResults=function(){throw new Error(e)}}t.exports=n},{}],5:[function(e,t,i){"use strict";function n(t){var i=e(2),n=e(3),s=e(4);i(t)?n(t):s()}n("algoliasearch")},{2:2,3:3,4:4}]},{},[5])(5)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.algoliasearch=e()}}(function(){var e;return function t(e,i,n){function s(o,a){if(!i[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){var i=e[o][1][t];return s(i?i:t)},u,u.exports,t,e,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(e,t,i){function n(e){if(e=""+e,!(e.length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var i=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return i*d;case"days":case"day":case"d":return i*u;case"hours":case"hour":case"hrs":case"hr":case"h":return i*c;case"minutes":case"minute":case"mins":case"min":case"m":return i*l;case"seconds":case"second":case"secs":case"sec":case"s":return i*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i}}}}function s(e){return e>=u?Math.round(e/u)+"d":e>=c?Math.round(e/c)+"h":e>=l?Math.round(e/l)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function r(e){return o(e,u,"day")||o(e,c,"hour")||o(e,l,"minute")||o(e,a,"second")||e+" ms"}function o(e,t,i){return t>e?void 0:1.5*t>e?Math.floor(e/t)+" "+i:Math.ceil(e/t)+" "+i+"s"}var a=1e3,l=60*a,c=60*l,u=24*c,d=365.25*u;t.exports=function(e,t){return t=t||{},"string"==typeof e?n(e):t["long"]?r(e):s(e)}},{}],2:[function(e,t,i){function n(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function r(e){if(d===setTimeout)return setTimeout(e,0);if((d===n||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function o(e){if(h===clearTimeout)return clearTimeout(e);if((h===s||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function a(){g&&f&&(g=!1,f.length?m=f.concat(m):v=-1,m.length&&l())}function l(){if(!g){var e=r(a);g=!0;for(var t=m.length;t;){for(f=m,m=[];++v<t;)f&&f[v].run();v=-1,t=m.length}f=null,g=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var d,h,p=t.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:n}catch(e){d=n}try{h="function"==typeof clearTimeout?clearTimeout:s}catch(e){h=s}}();var f,m=[],g=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];m.push(new c(e,t)),1!==m.length||g||r(l)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],3:[function(e,t,i){function n(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function s(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+i.humanize(this.diff),!t)return e;var n="color: "+this.color;e=[e[0],n,"color: inherit"].concat(Array.prototype.slice.call(e,1));var s=0,r=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(s++,"%c"===e&&(r=s))}),e.splice(r,0,n),e}function r(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(e){try{null==e?i.storage.removeItem("debug"):i.storage.debug=e}catch(t){}}function a(){var e;try{e=i.storage.debug}catch(t){}return e}function l(){try{return window.localStorage}catch(e){}}i=t.exports=e(4),i.log=r,i.formatArgs=s,i.save=o,i.load=a,i.useColors=n,i.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:l(),i.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],i.formatters.j=function(e){return JSON.stringify(e)},i.enable(a())},{4:4}],4:[function(e,t,i){function n(){return i.colors[u++%i.colors.length]}function s(e){function t(){}function s(){var e=s,t=+new Date,r=t-(c||t);e.diff=r,e.prev=c,e.curr=t,c=t,null==e.useColors&&(e.useColors=i.useColors()),null==e.color&&e.useColors&&(e.color=n());var o=Array.prototype.slice.call(arguments);o[0]=i.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var a=0;o[0]=o[0].replace(/%([a-z%])/g,function(t,n){if("%%"===t)return t;a++;var s=i.formatters[n];if("function"==typeof s){var r=o[a];t=s.call(e,r),o.splice(a,1),a--}return t}),"function"==typeof i.formatArgs&&(o=i.formatArgs.apply(e,o));var l=s.log||i.log||console.log.bind(console);l.apply(e,o)}t.enabled=!1,s.enabled=!0;var r=i.enabled(e)?s:t;return r.namespace=e,r}function r(e){i.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,s=0;n>s;s++)t[s]&&(e=t[s].replace(/\*/g,".*?"),"-"===e[0]?i.skips.push(new RegExp("^"+e.substr(1)+"$")):i.names.push(new RegExp("^"+e+"$")))}function o(){i.enable("")}function a(e){var t,n;for(t=0,n=i.skips.length;n>t;t++)if(i.skips[t].test(e))return!1;for(t=0,n=i.names.length;n>t;t++)if(i.names[t].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}i=t.exports=s,i.coerce=l,i.disable=o,i.enable=r,i.enabled=a,i.humanize=e(1),i.names=[],i.skips=[],i.formatters={};var c,u=0},{1:1}],5:[function(t,i,n){(function(n,s){(function(){"use strict";function r(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return"function"==typeof e}function a(e){X=e}function l(e){Z=e}function c(){return function(){n.nextTick(f)}}function u(){return function(){Y(f)}}function d(){var e=0,t=new ie(f),i=document.createTextNode("");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}function h(){var e=new MessageChannel;return e.port1.onmessage=f,function(){e.port2.postMessage(0)}}function p(){return function(){setTimeout(f,1)}}function f(){for(var e=0;J>e;e+=2){var t=re[e],i=re[e+1];t(i),re[e]=void 0,re[e+1]=void 0}J=0}function m(){try{var e=t,i=e("vertx");return Y=i.runOnLoop||i.runOnContext,u()}catch(n){return p()}}function g(e,t){var i=this,n=new this.constructor(b);void 0===n[le]&&U(n);var s=i._state;if(s){var r=arguments[s-1];Z(function(){O(s,n,r,i._result)})}else A(i,n,e,t);return n}function v(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var i=new t(b);return E(i,e),i}function b(){}function y(){return new TypeError("You cannot resolve a promise with itself")}function _(){return new TypeError("A promises callback cannot return that same promise.")}function w(e){try{return e.then}catch(t){return he.error=t,he}}function C(e,t,i,n){try{e.call(t,i,n)}catch(s){return s}}function S(e,t,i){Z(function(e){var n=!1,s=C(i,t,function(i){n||(n=!0,t!==i?E(e,i):x(e,i))},function(t){n||(n=!0,P(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&s&&(n=!0,P(e,s))},e)}function T(e,t){t._state===ue?x(e,t._result):t._state===de?P(e,t._result):A(t,void 0,function(t){E(e,t)},function(t){P(e,t)})}function k(e,t,i){t.constructor===e.constructor&&i===oe&&constructor.resolve===ae?T(e,t):i===he?P(e,he.error):void 0===i?x(e,t):o(i)?S(e,t,i):x(e,t)}function E(e,t){e===t?P(e,y()):r(t)?k(e,t,w(t)):x(e,t)}function I(e){e._onerror&&e._onerror(e._result),D(e)}function x(e,t){e._state===ce&&(e._result=t,e._state=ue,0!==e._subscribers.length&&Z(D,e))}function P(e,t){e._state===ce&&(e._state=de,e._result=t,Z(I,e))}function A(e,t,i,n){var s=e._subscribers,r=s.length;e._onerror=null,s[r]=t,s[r+ue]=i,s[r+de]=n,0===r&&e._state&&Z(D,e)}function D(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var n,s,r=e._result,o=0;o<t.length;o+=3)n=t[o],s=t[o+i],n?O(i,n,s,r):s(r);e._subscribers.length=0}}function L(){this.error=null}function M(e,t){try{return e(t)}catch(i){return pe.error=i,pe}}function O(e,t,i,n){var s,r,a,l,c=o(i);if(c){if(s=M(i,n),s===pe?(l=!0,r=s.error,s=null):a=!0,t===s)return void P(t,_())}else s=n,a=!0;t._state!==ce||(c&&a?E(t,s):l?P(t,r):e===ue?x(t,s):e===de&&P(t,s))}function R(e,t){try{t(function(t){E(e,t)},function(t){P(e,t)})}catch(i){P(e,i)}}function N(){return fe++}function U(e){e[le]=fe++,e._state=void 0,e._result=void 0,e._subscribers=[]}function $(e){return new ye(this,e).promise}function B(e){var t=this;return new t(Q(e)?function(i,n){for(var s=e.length,r=0;s>r;r++)t.resolve(e[r]).then(i,n)}:function(e,t){t(new TypeError("You must pass an array to race."))})}function H(e){var t=this,i=new t(b);return P(i,e),i}function F(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function j(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function W(e){this[le]=N(),this._result=this._state=void 0,this._subscribers=[],b!==e&&("function"!=typeof e&&F(),this instanceof W?R(this,e):j())}function z(e,t){this._instanceConstructor=e,this.promise=new e(b),this.promise[le]||U(this.promise),Q(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?x(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&x(this.promise,this._result))):P(this.promise,G())}function G(){return new Error("Array Methods must be provided an Array")}function V(){var e;if("undefined"!=typeof s)e=s;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var i=e.Promise;i&&"[object Promise]"===Object.prototype.toString.call(i.resolve())&&!i.cast||(e.Promise=be)}var q;q=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var Y,X,K,Q=q,J=0,Z=function(e,t){re[J]=e,re[J+1]=t,J+=2,2===J&&(X?X(f):K())},ee="undefined"!=typeof window?window:void 0,te=ee||{},ie=te.MutationObserver||te.WebKitMutationObserver,ne="undefined"==typeof self&&"undefined"!=typeof n&&"[object process]"==={}.toString.call(n),se="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,re=new Array(1e3);K=ne?c():ie?d():se?h():void 0===ee&&"function"==typeof t?m():p();var oe=g,ae=v,le=Math.random().toString(36).substring(16),ce=void 0,ue=1,de=2,he=new L,pe=new L,fe=0,me=$,ge=B,ve=H,be=W;W.all=me,W.race=ge,W.resolve=ae,W.reject=ve,W._setScheduler=a,W._setAsap=l,W._asap=Z,W.prototype={constructor:W,then:oe,"catch":function(e){return this.then(null,e)}};var ye=z;z.prototype._enumerate=function(){for(var e=this.length,t=this._input,i=0;this._state===ce&&e>i;i++)this._eachEntry(t[i],i)},z.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,n=i.resolve;if(n===ae){var s=w(e);if(s===oe&&e._state!==ce)this._settledAt(e._state,t,e._result);else if("function"!=typeof s)this._remaining--,this._result[t]=e;else if(i===be){var r=new i(b);k(r,e,s),this._willSettleAt(r,t)}else this._willSettleAt(new i(function(t){t(e)}),t)}else this._willSettleAt(n(e),t)},z.prototype._settledAt=function(e,t,i){var n=this.promise;n._state===ce&&(this._remaining--,e===de?P(n,i):this._result[t]=i),0===this._remaining&&x(n,this._result)},z.prototype._willSettleAt=function(e,t){var i=this;A(e,void 0,function(e){i._settledAt(ue,t,e)},function(e){i._settledAt(de,t,e)})};var _e=V,we={Promise:be,polyfill:_e};"function"==typeof e&&e.amd?e(function(){return we}):"undefined"!=typeof i&&i.exports?i.exports=we:"undefined"!=typeof this&&(this.ES6Promise=we),_e()}).call(this)}).call(this,t(2),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],6:[function(e,t,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(e){return"function"==typeof e}function r(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,i,n,r,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(i=this._events[e],a(i))return!1;if(s(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),i.apply(this,r)}else if(o(i))for(r=Array.prototype.slice.call(arguments,1),c=i.slice(),n=c.length,l=0;n>l;l++)c[l].apply(this,r);return!0},n.prototype.addListener=function(e,t){var i;if(!s(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,s(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!s(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var i,n,r,a;if(!s(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],r=i.length,n=-1,i===t||s(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(i)){for(a=r;a-->0;)if(i[a]===t||i[a].listener&&i[a].listener===t){n=a;break}if(0>n)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],s(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?s(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(s(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],7:[function(e,t,i){var n=Object.prototype.hasOwnProperty,s=Object.prototype.toString;t.exports=function(e,t,i){if("[object Function]"!==s.call(t))throw new TypeError("iterator must be a function");var r=e.length;if(r===+r)for(var o=0;r>o;o++)t.call(i,e[o],o,e);else for(var a in e)n.call(e,a)&&t.call(i,e[a],a,e)}},{}],8:[function(e,t,i){(function(e){"undefined"!=typeof window?t.exports=window:"undefined"!=typeof e?t.exports=e:"undefined"!=typeof self?t.exports=self:t.exports={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(e,t,i){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},{}],10:[function(e,t,i){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],11:[function(e,t,i){"use strict";var n=Object.prototype.hasOwnProperty,s=Object.prototype.toString,r=Array.prototype.slice,o=e(12),a=Object.prototype.propertyIsEnumerable,l=!a.call({toString:null},"toString"),c=a.call(function(){},"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=function(e){var t=e.constructor;return t&&t.prototype===e},h={$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!h["$"+e]&&n.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{d(window[e])}catch(t){return!0}}catch(t){return!0}return!1}(),f=function(e){if("undefined"==typeof window||!p)return d(e);try{return d(e)}catch(t){return!1}},m=function(e){var t=null!==e&&"object"==typeof e,i="[object Function]"===s.call(e),r=o(e),a=t&&"[object String]"===s.call(e),d=[];if(!t&&!i&&!r)throw new TypeError("Object.keys called on a non-object");var h=c&&i;if(a&&e.length>0&&!n.call(e,0))for(var p=0;p<e.length;++p)d.push(String(p));if(r&&e.length>0)for(var m=0;m<e.length;++m)d.push(String(m));else for(var g in e)h&&"prototype"===g||!n.call(e,g)||d.push(String(g));if(l)for(var v=f(e),b=0;b<u.length;++b)v&&"constructor"===u[b]||!n.call(e,u[b])||d.push(u[b]);return d};m.shim=function(){if(Object.keys){var e=function(){return 2===(Object.keys(arguments)||"").length}(1,2);if(!e){var t=Object.keys;Object.keys=function(e){return t(o(e)?r.call(e):e)}}}else Object.keys=m;return Object.keys||m},t.exports=m},{12:12}],12:[function(e,t,i){"use strict";var n=Object.prototype.toString;t.exports=function(e){var t=n.call(e),i="[object Arguments]"===t;return i||(i="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===n.call(e.callee)),i}},{}],13:[function(e,t,i){"use strict";function n(e,t){if(e.map)return e.map(t);for(var i=[],n=0;n<e.length;n++)i.push(t(e[n],n));return i}var s=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,i,a){return t=t||"&",i=i||"=",null===e&&(e=void 0),"object"==typeof e?n(o(e),function(o){var a=encodeURIComponent(s(o))+i;return r(e[o])?n(e[o],function(e){return a+encodeURIComponent(s(e))}).join(t):a+encodeURIComponent(s(e[o]))}).join(t):a?encodeURIComponent(s(a))+i+encodeURIComponent(s(e)):""};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=Object.keys||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return t}},{}],14:[function(e,t,i){function n(){l.apply(this,arguments)}function s(){var e="Not implemented in this environment.\nIf you feel this is a mistake, write to support@algolia.com";throw new u.AlgoliaSearchError(e)}t.exports=n;var r=e(16),o=e(26),a=e(27),l=e(15),c=e(9),u=e(28);c(n,l),n.prototype.deleteIndex=function(e,t){return this._jsonRequest({method:"DELETE",url:"/1/indexes/"+encodeURIComponent(e),hostType:"write",callback:t})},n.prototype.moveIndex=function(e,t,i){var n={operation:"move",destination:t};return this._jsonRequest({method:"POST",url:"/1/indexes/"+encodeURIComponent(e)+"/operation",body:n,hostType:"write",callback:i})},n.prototype.copyIndex=function(e,t,i){var n={operation:"copy",destination:t};return this._jsonRequest({method:"POST",url:"/1/indexes/"+encodeURIComponent(e)+"/operation",body:n,hostType:"write",callback:i})},n.prototype.getLogs=function(t,i,n){var s=e(25),r={};return"object"==typeof t?(r=s(t),n=i):0===arguments.length||"function"==typeof t?n=t:1===arguments.length||"function"==typeof i?(n=i,r.offset=t):(r.offset=t,r.length=i),void 0===r.offset&&(r.offset=0),void 0===r.length&&(r.length=10),this._jsonRequest({method:"GET",url:"/1/logs?"+this._getSearchParams(r,""),hostType:"read",callback:n})},n.prototype.listIndexes=function(e,t){var i="";return void 0===e||"function"==typeof e?t=e:i="?page="+e,this._jsonRequest({method:"GET",url:"/1/indexes"+i,hostType:"read",callback:t})},n.prototype.initIndex=function(e){return new r(this,e)},n.prototype.listUserKeys=function(e){return this._jsonRequest({method:"GET",url:"/1/keys",hostType:"read",callback:e})},n.prototype.getUserKeyACL=function(e,t){return this._jsonRequest({method:"GET",url:"/1/keys/"+e,hostType:"read",callback:t})},n.prototype.deleteUserKey=function(e,t){return this._jsonRequest({method:"DELETE",url:"/1/keys/"+e,hostType:"write",callback:t})},n.prototype.addUserKey=function(t,i,n){var s=e(10),r="Usage: client.addUserKey(arrayOfAcls[, params, callback])";if(!s(t))throw new Error(r);1!==arguments.length&&"function"!=typeof i||(n=i,i=null);var o={acl:t};return i&&(o.validity=i.validity,o.maxQueriesPerIPPerHour=i.maxQueriesPerIPPerHour,o.maxHitsPerQuery=i.maxHitsPerQuery,o.indexes=i.indexes,o.description=i.description,i.queryParameters&&(o.queryParameters=this._getSearchParams(i.queryParameters,"")),o.referers=i.referers),this._jsonRequest({method:"POST",url:"/1/keys",body:o,hostType:"write",callback:n})},n.prototype.addUserKeyWithValidity=o(function(e,t,i){return this.addUserKey(e,t,i)},a("client.addUserKeyWithValidity()","client.addUserKey()")),n.prototype.updateUserKey=function(t,i,n,s){var r=e(10),o="Usage: client.updateUserKey(key, arrayOfAcls[, params, callback])";if(!r(i))throw new Error(o);2!==arguments.length&&"function"!=typeof n||(s=n,n=null);var a={acl:i};return n&&(a.validity=n.validity,a.maxQueriesPerIPPerHour=n.maxQueriesPerIPPerHour,a.maxHitsPerQuery=n.maxHitsPerQuery,a.indexes=n.indexes,a.description=n.description,n.queryParameters&&(a.queryParameters=this._getSearchParams(n.queryParameters,"")),a.referers=n.referers),this._jsonRequest({method:"PUT",url:"/1/keys/"+t,body:a,hostType:"write",callback:s})},n.prototype.startQueriesBatch=o(function(){this._batch=[]},a("client.startQueriesBatch()","client.search()")),n.prototype.addQueryInBatch=o(function(e,t,i){this._batch.push({indexName:e,query:t,params:i})},a("client.addQueryInBatch()","client.search()")),n.prototype.sendQueriesBatch=o(function(e){return this.search(this._batch,e)},a("client.sendQueriesBatch()","client.search()")),n.prototype.batch=function(t,i){var n=e(10),s="Usage: client.batch(operations[, callback])";if(!n(t))throw new Error(s);return this._jsonRequest({method:"POST",url:"/1/indexes/*/batch",body:{requests:t},hostType:"write",callback:i})},n.prototype.destroy=s,n.prototype.enableRateLimitForward=s,n.prototype.disableRateLimitForward=s,n.prototype.useSecuredAPIKey=s,n.prototype.disableSecuredAPIKey=s,n.prototype.generateSecuredApiKey=s},{10:10,15:15,16:16,25:25,26:26,27:27,28:28,9:9}],15:[function(e,t,i){function n(t,i,n){var r=e(3)("algoliasearch"),a=e(25),c=e(10),u=e(30),d="Usage: algoliasearch(applicationID, apiKey, opts)";if(n._allowEmptyCredentials!==!0&&!t)throw new l.AlgoliaSearchError("Please provide an application ID. "+d);if(n._allowEmptyCredentials!==!0&&!i)throw new l.AlgoliaSearchError("Please provide an API key. "+d);this.applicationID=t,this.apiKey=i;var h=o([this.applicationID+"-1.algolianet.com",this.applicationID+"-2.algolianet.com",this.applicationID+"-3.algolianet.com"]);this.hosts={read:[],write:[]},this.hostIndex={read:0,write:0},n=n||{};var p=n.protocol||"https:",f=void 0===n.timeout?2e3:n.timeout;if(/:$/.test(p)||(p+=":"),"http:"!==n.protocol&&"https:"!==n.protocol)throw new l.AlgoliaSearchError("protocol must be `http:` or `https:` (was `"+n.protocol+"`)");n.hosts?c(n.hosts)?(this.hosts.read=a(n.hosts),this.hosts.write=a(n.hosts)):(this.hosts.read=a(n.hosts.read),this.hosts.write=a(n.hosts.write)):(this.hosts.read=[this.applicationID+"-dsn.algolia.net"].concat(h),this.hosts.write=[this.applicationID+".algolia.net"].concat(h)),this.hosts.read=u(this.hosts.read,s(p)),this.hosts.write=u(this.hosts.write,s(p)),this.requestTimeout=f,this.extraHeaders=[],this.cache=n._cache||{},this._ua=n._ua,this._useCache=!(void 0!==n._useCache&&!n._cache)||n._useCache,this._useFallback=void 0===n.useFallback||n.useFallback,this._setTimeout=n._setTimeout,r("init done, %j",this)}function s(e){return function(t){return e+"//"+t.toLowerCase()}}function r(e){if(void 0===Array.prototype.toJSON)return JSON.stringify(e);var t=Array.prototype.toJSON;delete Array.prototype.toJSON;var i=JSON.stringify(e);return Array.prototype.toJSON=t,i}function o(e){for(var t,i,n=e.length;0!==n;)i=Math.floor(Math.random()*n),n-=1,t=e[n],e[n]=e[i],e[i]=t;return e}function a(e){var t={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n;n="x-algolia-api-key"===i||"x-algolia-application-id"===i?"**hidden for security purposes**":e[i],t[i]=n}return t}t.exports=n;var l=e(28),c=e(29),u=e(18),d=500;n.prototype.initIndex=function(e){return new u(this,e)},n.prototype.setExtraHeader=function(e,t){this.extraHeaders.push({name:e.toLowerCase(),value:t})},n.prototype.addAlgoliaAgent=function(e){this._ua+=";"+e},n.prototype._jsonRequest=function(t){function i(e,c){function d(e){var t=e&&e.body&&e.body.message&&e.body.status||e.statusCode||e&&e.body&&200;o("received response: statusCode: %s, computed statusCode: %d, headers: %j",e.statusCode,t,e.headers);var i=2===Math.floor(t/100),r=new Date;if(g.push({currentHost:C,headers:a(s),content:n||null,contentLength:void 0!==n?n.length:null,method:c.method,timeout:c.timeout,url:c.url,startTime:w,endTime:r,duration:r-w,statusCode:t}),i)return h._useCache&&u&&(u[_]=e.responseText),e.body;var d=4!==Math.floor(t/100);if(d)return p+=1,b();o("unrecoverable error");var f=new l.AlgoliaSearchError(e.body&&e.body.message,{debugData:g,statusCode:t});return h._promise.reject(f)}function v(e){o("error: %s, stack: %s",e.message,e.stack);var i=new Date;return g.push({currentHost:C,headers:a(s),content:n||null,contentLength:void 0!==n?n.length:null,method:c.method,timeout:c.timeout,url:c.url,startTime:w,endTime:i,duration:i-w}),e instanceof l.AlgoliaSearchError||(e=new l.Unknown(e&&e.message,e)),p+=1,e instanceof l.Unknown||e instanceof l.UnparsableJSON||p>=h.hosts[t.hostType].length&&(f||!m)?(e.debugData=g,h._promise.reject(e)):e instanceof l.RequestTimeout?y():b()}function b(){return o("retrying request"),h.hostIndex[t.hostType]=(h.hostIndex[t.hostType]+1)%h.hosts[t.hostType].length,i(e,c)}function y(){return o("retrying request with higher timeout"),h.hostIndex[t.hostType]=(h.hostIndex[t.hostType]+1)%h.hosts[t.hostType].length,c.timeout=h.requestTimeout*(p+1),i(e,c)}var _,w=new Date;if(h._useCache&&(_=t.url),h._useCache&&n&&(_+="_body_"+c.body),h._useCache&&u&&void 0!==u[_])return o("serving response from cache"),h._promise.resolve(JSON.parse(u[_]));if(p>=h.hosts[t.hostType].length)return!m||f?(o("could not get any response"),h._promise.reject(new l.AlgoliaSearchError("Cannot connect to the AlgoliaSearch API. Send an email to support@algolia.com to report and resolve the issue. Application id was: "+h.applicationID,{debugData:g}))):(o("switching to fallback"),p=0,c.method=t.fallback.method,c.url=t.fallback.url,c.jsonBody=t.fallback.body,c.jsonBody&&(c.body=r(c.jsonBody)),s=h._computeRequestHeaders(),c.timeout=h.requestTimeout*(p+1),h.hostIndex[t.hostType]=0,f=!0,i(h._request.fallback,c));var C=h.hosts[t.hostType][h.hostIndex[t.hostType]],S=C+c.url,T={body:c.body,jsonBody:c.jsonBody,method:c.method,headers:s,timeout:c.timeout,debug:o};return o("method: %s, url: %s, headers: %j, timeout: %d",T.method,S,T.headers,T.timeout),e===h._request.fallback&&o("using fallback"),e.call(h,S,T).then(d,v)}var n,s,o=e(3)("algoliasearch:"+t.url),u=t.cache,h=this,p=0,f=!1,m=h._useFallback&&h._request.fallback&&t.fallback;this.apiKey.length>d&&void 0!==t.body&&(void 0!==t.body.params||void 0!==t.body.requests)?(t.body.apiKey=this.apiKey,s=this._computeRequestHeaders(!1)):s=this._computeRequestHeaders(),void 0!==t.body&&(n=r(t.body)),o("request start");var g=[],v=i(h._request,{url:t.url,method:t.method,body:n,jsonBody:t.body,timeout:h.requestTimeout*(p+1)});return t.callback?void v.then(function(e){c(function(){t.callback(null,e)},h._setTimeout||setTimeout)},function(e){c(function(){t.callback(e)},h._setTimeout||setTimeout)}):v},n.prototype._getSearchParams=function(e,t){
if(void 0===e||null===e)return t;for(var i in e)null!==i&&void 0!==e[i]&&e.hasOwnProperty(i)&&(t+=""===t?"":"&",t+=i+"="+encodeURIComponent("[object Array]"===Object.prototype.toString.call(e[i])?r(e[i]):e[i]));return t},n.prototype._computeRequestHeaders=function(t){var i=e(7),n={"x-algolia-agent":this._ua,"x-algolia-application-id":this.applicationID};return t!==!1&&(n["x-algolia-api-key"]=this.apiKey),this.userToken&&(n["x-algolia-usertoken"]=this.userToken),this.securityTags&&(n["x-algolia-tagfilters"]=this.securityTags),this.extraHeaders&&i(this.extraHeaders,function(e){n[e.name]=e.value}),n},n.prototype.search=function(t,i,n){var s=e(10),r=e(30),o="Usage: client.search(arrayOfQueries[, callback])";if(!s(t))throw new Error(o);"function"==typeof i?(n=i,i={}):void 0===i&&(i={});var a=this,l={requests:r(t,function(e){var t="";return void 0!==e.query&&(t+="query="+encodeURIComponent(e.query)),{indexName:e.indexName,params:a._getSearchParams(e.params,t)}})},c=r(l.requests,function(e,t){return t+"="+encodeURIComponent("/1/indexes/"+encodeURIComponent(e.indexName)+"?"+e.params)}).join("&"),u="/1/indexes/*/queries";return void 0!==i.strategy&&(u+="?strategy="+i.strategy),this._jsonRequest({cache:this.cache,method:"POST",url:u,body:l,hostType:"read",fallback:{method:"GET",url:"/1/indexes/*",body:{params:c}},callback:n})},n.prototype.setSecurityTags=function(e){if("[object Array]"===Object.prototype.toString.call(e)){for(var t=[],i=0;i<e.length;++i)if("[object Array]"===Object.prototype.toString.call(e[i])){for(var n=[],s=0;s<e[i].length;++s)n.push(e[i][s]);t.push("("+n.join(",")+")")}else t.push(e[i]);e=t.join(",")}this.securityTags=e},n.prototype.setUserToken=function(e){this.userToken=e},n.prototype.clearCache=function(){this.cache={}},n.prototype.setRequestTimeout=function(e){e&&(this.requestTimeout=parseInt(e,10))}},{10:10,18:18,25:25,28:28,29:29,3:3,30:30,7:7}],16:[function(e,t,i){function n(){r.apply(this,arguments)}var s=e(9),r=e(18),o=e(26),a=e(27),l=e(29),c=e(28);t.exports=n,s(n,r),n.prototype.addObject=function(e,t,i){var n=this;return 1!==arguments.length&&"function"!=typeof t||(i=t,t=void 0),this.as._jsonRequest({method:void 0!==t?"PUT":"POST",url:"/1/indexes/"+encodeURIComponent(n.indexName)+(void 0!==t?"/"+encodeURIComponent(t):""),body:e,hostType:"write",callback:i})},n.prototype.addObjects=function(t,i){var n=e(10),s="Usage: index.addObjects(arrayOfObjects[, callback])";if(!n(t))throw new Error(s);for(var r=this,o={requests:[]},a=0;a<t.length;++a){var l={action:"addObject",body:t[a]};o.requests.push(l)}return this.as._jsonRequest({method:"POST",url:"/1/indexes/"+encodeURIComponent(r.indexName)+"/batch",body:o,hostType:"write",callback:i})},n.prototype.partialUpdateObject=function(e,t,i){1!==arguments.length&&"function"!=typeof t||(i=t,t=void 0);var n=this,s="/1/indexes/"+encodeURIComponent(n.indexName)+"/"+encodeURIComponent(e.objectID)+"/partial";return t===!1&&(s+="?createIfNotExists=false"),this.as._jsonRequest({method:"POST",url:s,body:e,hostType:"write",callback:i})},n.prototype.partialUpdateObjects=function(t,i){var n=e(10),s="Usage: index.partialUpdateObjects(arrayOfObjects[, callback])";if(!n(t))throw new Error(s);for(var r=this,o={requests:[]},a=0;a<t.length;++a){var l={action:"partialUpdateObject",objectID:t[a].objectID,body:t[a]};o.requests.push(l)}return this.as._jsonRequest({method:"POST",url:"/1/indexes/"+encodeURIComponent(r.indexName)+"/batch",body:o,hostType:"write",callback:i})},n.prototype.saveObject=function(e,t){var i=this;return this.as._jsonRequest({method:"PUT",url:"/1/indexes/"+encodeURIComponent(i.indexName)+"/"+encodeURIComponent(e.objectID),body:e,hostType:"write",callback:t})},n.prototype.saveObjects=function(t,i){var n=e(10),s="Usage: index.saveObjects(arrayOfObjects[, callback])";if(!n(t))throw new Error(s);for(var r=this,o={requests:[]},a=0;a<t.length;++a){var l={action:"updateObject",objectID:t[a].objectID,body:t[a]};o.requests.push(l)}return this.as._jsonRequest({method:"POST",url:"/1/indexes/"+encodeURIComponent(r.indexName)+"/batch",body:o,hostType:"write",callback:i})},n.prototype.deleteObject=function(e,t){if("function"==typeof e||"string"!=typeof e&&"number"!=typeof e){var i=new c.AlgoliaSearchError("Cannot delete an object without an objectID");return t=e,"function"==typeof t?t(i):this.as._promise.reject(i)}var n=this;return this.as._jsonRequest({method:"DELETE",url:"/1/indexes/"+encodeURIComponent(n.indexName)+"/"+encodeURIComponent(e),hostType:"write",callback:t})},n.prototype.deleteObjects=function(t,i){var n=e(10),s=e(30),r="Usage: index.deleteObjects(arrayOfObjectIDs[, callback])";if(!n(t))throw new Error(r);var o=this,a={requests:s(t,function(e){return{action:"deleteObject",objectID:e,body:{objectID:e}}})};return this.as._jsonRequest({method:"POST",url:"/1/indexes/"+encodeURIComponent(o.indexName)+"/batch",body:a,hostType:"write",callback:i})},n.prototype.deleteByQuery=function(t,i,n){function s(e){if(0===e.nbHits)return e;var t=d(e.hits,function(e){return e.objectID});return h.deleteObjects(t).then(r).then(o)}function r(e){return h.waitTask(e.taskID)}function o(){return h.deleteByQuery(t,i)}function a(){l(function(){n(null)},p._setTimeout||setTimeout)}function c(e){l(function(){n(e)},p._setTimeout||setTimeout)}var u=e(25),d=e(30),h=this,p=h.as;1===arguments.length||"function"==typeof i?(n=i,i={}):i=u(i),i.attributesToRetrieve="objectID",i.hitsPerPage=1e3,i.distinct=!1,this.clearCache();var f=this.search(t,i).then(s);return n?void f.then(a,c):f},n.prototype.browseAll=function(t,i){function n(e){if(!a._stopped){var t;t=void 0!==e?"cursor="+encodeURIComponent(e):u,l._jsonRequest({method:"GET",url:"/1/indexes/"+encodeURIComponent(c.indexName)+"/browse?"+t,hostType:"read",callback:s})}}function s(e,t){return a._stopped?void 0:e?void a._error(e):(a._result(t),void 0===t.cursor?void a._end():void n(t.cursor))}"object"==typeof t&&(i=t,t=void 0);var r=e(31),o=e(17),a=new o,l=this.as,c=this,u=l._getSearchParams(r({},i||{},{query:t}),"");return n(),a},n.prototype.ttAdapter=function(e){var t=this;return function(i,n,s){var r;r="function"==typeof s?s:n,t.search(i,e,function(e,t){return e?void r(e):void r(t.hits)})}},n.prototype.waitTask=function(e,t){function i(){return u._jsonRequest({method:"GET",hostType:"read",url:"/1/indexes/"+encodeURIComponent(c.indexName)+"/task/"+e}).then(function(e){a++;var t=r*a*a;return t>o&&(t=o),"published"!==e.status?u._promise.delay(t).then(i):e})}function n(e){l(function(){t(null,e)},u._setTimeout||setTimeout)}function s(e){l(function(){t(e)},u._setTimeout||setTimeout)}var r=100,o=5e3,a=0,c=this,u=c.as,d=i();return t?void d.then(n,s):d},n.prototype.clearIndex=function(e){var t=this;return this.as._jsonRequest({method:"POST",url:"/1/indexes/"+encodeURIComponent(t.indexName)+"/clear",hostType:"write",callback:e})},n.prototype.getSettings=function(e){var t=this;return this.as._jsonRequest({method:"GET",url:"/1/indexes/"+encodeURIComponent(t.indexName)+"/settings?getVersion=2",hostType:"read",callback:e})},n.prototype.searchSynonyms=function(e,t){return"function"==typeof e?(t=e,e={}):void 0===e&&(e={}),this.as._jsonRequest({method:"POST",url:"/1/indexes/"+encodeURIComponent(this.indexName)+"/synonyms/search",body:e,hostType:"read",callback:t})},n.prototype.saveSynonym=function(e,t,i){return"function"==typeof t?(i=t,t={}):void 0===t&&(t={}),this.as._jsonRequest({method:"PUT",url:"/1/indexes/"+encodeURIComponent(this.indexName)+"/synonyms/"+encodeURIComponent(e.objectID)+"?forwardToSlaves="+(t.forwardToSlaves?"true":"false"),body:e,hostType:"write",callback:i})},n.prototype.getSynonym=function(e,t){return this.as._jsonRequest({method:"GET",url:"/1/indexes/"+encodeURIComponent(this.indexName)+"/synonyms/"+encodeURIComponent(e),hostType:"read",callback:t})},n.prototype.deleteSynonym=function(e,t,i){return"function"==typeof t?(i=t,t={}):void 0===t&&(t={}),this.as._jsonRequest({method:"DELETE",url:"/1/indexes/"+encodeURIComponent(this.indexName)+"/synonyms/"+encodeURIComponent(e)+"?forwardToSlaves="+(t.forwardToSlaves?"true":"false"),hostType:"write",callback:i})},n.prototype.clearSynonyms=function(e,t){return"function"==typeof e?(t=e,e={}):void 0===e&&(e={}),this.as._jsonRequest({method:"POST",url:"/1/indexes/"+encodeURIComponent(this.indexName)+"/synonyms/clear?forwardToSlaves="+(e.forwardToSlaves?"true":"false"),hostType:"write",callback:t})},n.prototype.batchSynonyms=function(e,t,i){return"function"==typeof t?(i=t,t={}):void 0===t&&(t={}),this.as._jsonRequest({method:"POST",url:"/1/indexes/"+encodeURIComponent(this.indexName)+"/synonyms/batch?forwardToSlaves="+(t.forwardToSlaves?"true":"false")+"&replaceExistingSynonyms="+(t.replaceExistingSynonyms?"true":"false"),hostType:"write",body:e,callback:i})},n.prototype.setSettings=function(e,t,i){1!==arguments.length&&"function"!=typeof t||(i=t,t={});var n=t.forwardToSlaves||!1,s=this;return this.as._jsonRequest({method:"PUT",url:"/1/indexes/"+encodeURIComponent(s.indexName)+"/settings?forwardToSlaves="+(n?"true":"false"),hostType:"write",body:e,callback:i})},n.prototype.listUserKeys=function(e){var t=this;return this.as._jsonRequest({method:"GET",url:"/1/indexes/"+encodeURIComponent(t.indexName)+"/keys",hostType:"read",callback:e})},n.prototype.getUserKeyACL=function(e,t){var i=this;return this.as._jsonRequest({method:"GET",url:"/1/indexes/"+encodeURIComponent(i.indexName)+"/keys/"+e,hostType:"read",callback:t})},n.prototype.deleteUserKey=function(e,t){var i=this;return this.as._jsonRequest({method:"DELETE",url:"/1/indexes/"+encodeURIComponent(i.indexName)+"/keys/"+e,hostType:"write",callback:t})},n.prototype.addUserKey=function(t,i,n){var s=e(10),r="Usage: index.addUserKey(arrayOfAcls[, params, callback])";if(!s(t))throw new Error(r);1!==arguments.length&&"function"!=typeof i||(n=i,i=null);var o={acl:t};return i&&(o.validity=i.validity,o.maxQueriesPerIPPerHour=i.maxQueriesPerIPPerHour,o.maxHitsPerQuery=i.maxHitsPerQuery,o.description=i.description,i.queryParameters&&(o.queryParameters=this.as._getSearchParams(i.queryParameters,"")),o.referers=i.referers),this.as._jsonRequest({method:"POST",url:"/1/indexes/"+encodeURIComponent(this.indexName)+"/keys",body:o,hostType:"write",callback:n})},n.prototype.addUserKeyWithValidity=o(function(e,t,i){return this.addUserKey(e,t,i)},a("index.addUserKeyWithValidity()","index.addUserKey()")),n.prototype.updateUserKey=function(t,i,n,s){var r=e(10),o="Usage: index.updateUserKey(key, arrayOfAcls[, params, callback])";if(!r(i))throw new Error(o);2!==arguments.length&&"function"!=typeof n||(s=n,n=null);var a={acl:i};return n&&(a.validity=n.validity,a.maxQueriesPerIPPerHour=n.maxQueriesPerIPPerHour,a.maxHitsPerQuery=n.maxHitsPerQuery,a.description=n.description,n.queryParameters&&(a.queryParameters=this.as._getSearchParams(n.queryParameters,"")),a.referers=n.referers),this.as._jsonRequest({method:"PUT",url:"/1/indexes/"+encodeURIComponent(this.indexName)+"/keys/"+t,body:a,hostType:"write",callback:s})}},{10:10,17:17,18:18,25:25,26:26,27:27,28:28,29:29,30:30,31:31,9:9}],17:[function(e,t,i){"use strict";function n(){}t.exports=n;var s=e(9),r=e(6).EventEmitter;s(n,r),n.prototype.stop=function(){this._stopped=!0,this._clean()},n.prototype._end=function(){this.emit("end"),this._clean()},n.prototype._error=function(e){this.emit("error",e),this._clean()},n.prototype._result=function(e){this.emit("result",e)},n.prototype._clean=function(){this.removeAllListeners("stop"),this.removeAllListeners("end"),this.removeAllListeners("error"),this.removeAllListeners("result")}},{6:6,9:9}],18:[function(e,t,i){function n(e,t){this.indexName=t,this.as=e,this.typeAheadArgs=null,this.typeAheadValueOption=null,this.cache={}}var s=e(24);t.exports=n,n.prototype.clearCache=function(){this.cache={}},n.prototype.search=s("query"),n.prototype.similarSearch=s("similarQuery"),n.prototype.browse=function(t,i,n){var s,r,o=e(31),a=this;0===arguments.length||1===arguments.length&&"function"==typeof arguments[0]?(s=0,n=arguments[0],t=void 0):"number"==typeof arguments[0]?(s=arguments[0],"number"==typeof arguments[1]?r=arguments[1]:"function"==typeof arguments[1]&&(n=arguments[1],r=void 0),t=void 0,i=void 0):"object"==typeof arguments[0]?("function"==typeof arguments[1]&&(n=arguments[1]),i=arguments[0],t=void 0):"string"==typeof arguments[0]&&"function"==typeof arguments[1]&&(n=arguments[1],i=void 0),i=o({},i||{},{page:s,hitsPerPage:r,query:t});var l=this.as._getSearchParams(i,"");return this.as._jsonRequest({method:"GET",url:"/1/indexes/"+encodeURIComponent(a.indexName)+"/browse?"+l,hostType:"read",callback:n})},n.prototype.browseFrom=function(e,t){return this.as._jsonRequest({method:"GET",url:"/1/indexes/"+encodeURIComponent(this.indexName)+"/browse?cursor="+encodeURIComponent(e),hostType:"read",callback:t})},n.prototype.searchFacet=function(t,i){var n=e(25),s=e(32),r="Usage: index.searchFacet({facetName, facetQuery, ...params}[, callback])";if(void 0===t.facetName||void 0===t.facetQuery)throw new Error(r);var o=t.facetName,a=s(n(t),function(e){return"facetName"===e}),l=this.as._getSearchParams(a,"");return this.as._jsonRequest({method:"POST",url:"/1/indexes/"+encodeURIComponent(this.indexName)+"/facets/"+encodeURIComponent(o)+"/query",hostType:"read",body:{params:l},callback:i})},n.prototype._search=function(e,t,i){return this.as._jsonRequest({cache:this.cache,method:"POST",url:t||"/1/indexes/"+encodeURIComponent(this.indexName)+"/query",body:{params:e},hostType:"read",fallback:{method:"GET",url:"/1/indexes/"+encodeURIComponent(this.indexName),body:{params:e}},callback:i})},n.prototype.getObject=function(e,t,i){var n=this;1!==arguments.length&&"function"!=typeof t||(i=t,t=void 0);var s="";if(void 0!==t){s="?attributes=";for(var r=0;r<t.length;++r)0!==r&&(s+=","),s+=t[r]}return this.as._jsonRequest({method:"GET",url:"/1/indexes/"+encodeURIComponent(n.indexName)+"/"+encodeURIComponent(e)+s,hostType:"read",callback:i})},n.prototype.getObjects=function(t,i,n){var s=e(10),r=e(30),o="Usage: index.getObjects(arrayOfObjectIDs[, callback])";if(!s(t))throw new Error(o);var a=this;1!==arguments.length&&"function"!=typeof i||(n=i,i=void 0);var l={requests:r(t,function(e){var t={indexName:a.indexName,objectID:e};return i&&(t.attributesToRetrieve=i.join(",")),t})};return this.as._jsonRequest({method:"POST",url:"/1/indexes/*/objects",hostType:"read",body:l,callback:n})},n.prototype.as=null,n.prototype.indexName=null,n.prototype.typeAheadArgs=null,n.prototype.typeAheadValueOption=null},{10:10,24:24,25:25,30:30,31:31,32:32}],19:[function(e,t,i){"use strict";var n=e(14),s=e(20);t.exports=s(n)},{14:14,20:20}],20:[function(e,t,i){(function(i){"use strict";var n=e(8),s=n.Promise||e(5).Promise;t.exports=function(t,r){function o(t,i,n){var s=e(25),r=e(21);return n=s(n||{}),void 0===n.protocol&&(n.protocol=r()),n._ua=n._ua||o.ua,new a(t,i,n)}function a(){t.apply(this,arguments)}var l=e(9),c=e(28),u=e(22),d=e(23),h=e(33);r=r||"","debug"===i.env.NODE_ENV&&e(3).enable("algoliasearch*"),o.version=e(34),o.ua="Algolia for vanilla JavaScript "+r+o.version,o.initPlaces=h(o),n.__algolia={debug:e(3),algoliasearch:o};var p={hasXMLHttpRequest:"XMLHttpRequest"in n,hasXDomainRequest:"XDomainRequest"in n};return p.hasXMLHttpRequest&&(p.cors="withCredentials"in new XMLHttpRequest,p.timeout="timeout"in new XMLHttpRequest),l(a,t),a.prototype._request=function(e,t){return new s(function(i,n){function s(){if(!l){p.timeout||clearTimeout(a);var e;try{e={body:JSON.parse(h.responseText),responseText:h.responseText,statusCode:h.status,headers:h.getAllResponseHeaders&&h.getAllResponseHeaders()||{}}}catch(t){e=new c.UnparsableJSON({more:h.responseText})}e instanceof c.UnparsableJSON?n(e):i(e)}}function r(e){l||(p.timeout||clearTimeout(a),n(new c.Network({more:e})))}function o(){p.timeout||(l=!0,h.abort()),n(new c.RequestTimeout)}if(!p.cors&&!p.hasXDomainRequest)return void n(new c.Network("CORS not supported"));e=u(e,t.headers);var a,l,d=t.body,h=p.cors?new XMLHttpRequest:new XDomainRequest;h instanceof XMLHttpRequest?h.open(t.method,e,!0):h.open(t.method,e),p.cors&&(d&&("POST"===t.method?h.setRequestHeader("content-type","application/x-www-form-urlencoded"):h.setRequestHeader("content-type","application/json")),h.setRequestHeader("accept","application/json")),h.onprogress=function(){},h.onload=s,h.onerror=r,p.timeout?(h.timeout=t.timeout,h.ontimeout=o):a=setTimeout(o,t.timeout),h.send(d)})},a.prototype._request.fallback=function(e,t){return e=u(e,t.headers),new s(function(i,n){d(e,t,function(e,t){return e?void n(e):void i(t)})})},a.prototype._promise={reject:function(e){return s.reject(e)},resolve:function(e){return s.resolve(e)},delay:function(e){return new s(function(t){setTimeout(t,e)})}},o}}).call(this,e(2))},{2:2,21:21,22:22,23:23,25:25,28:28,3:3,33:33,34:34,5:5,8:8,9:9}],21:[function(e,t,i){"use strict";function n(){var e=window.document.location.protocol;return"http:"!==e&&"https:"!==e&&(e="http:"),e}t.exports=n},{}],22:[function(e,t,i){"use strict";function n(e,t){return e+=/\?/.test(e)?"&":"?",e+s(t)}t.exports=n;var s=e(13)},{13:13}],23:[function(e,t,i){"use strict";function n(e,t,i){function n(){t.debug("JSONP: success"),g||h||(g=!0,d||(t.debug("JSONP: Fail. Script loaded but did not call the callback"),a(),i(new s.JSONPScriptFail)))}function o(){"loaded"!==this.readyState&&"complete"!==this.readyState||n()}function a(){clearTimeout(v),f.onload=null,f.onreadystatechange=null,f.onerror=null,p.removeChild(f)}function l(){try{delete window[m],delete window[m+"_loaded"]}catch(e){window[m]=window[m+"_loaded"]=void 0}}function c(){t.debug("JSONP: Script timeout"),h=!0,a(),i(new s.RequestTimeout)}function u(){t.debug("JSONP: Script error"),g||h||(a(),i(new s.JSONPScriptError))}if("GET"!==t.method)return void i(new Error("Method "+t.method+" "+e+" is not supported by JSONP."));t.debug("JSONP: start");var d=!1,h=!1;r+=1;var p=document.getElementsByTagName("head")[0],f=document.createElement("script"),m="algoliaJSONP_"+r,g=!1;window[m]=function(e){return l(),h?void t.debug("JSONP: Late answer, ignoring"):(d=!0,a(),void i(null,{body:e}))},e+="&callback="+m,t.jsonBody&&t.jsonBody.params&&(e+="&"+t.jsonBody.params);var v=setTimeout(c,t.timeout);f.onreadystatechange=o,f.onload=n,f.onerror=u,f.async=!0,f.defer=!0,f.src=e,p.appendChild(f)}t.exports=n;var s=e(28),r=0},{28:28}],24:[function(e,t,i){function n(e,t){return function(i,n,r){if("function"==typeof i&&"object"==typeof n||"object"==typeof r)throw new s.AlgoliaSearchError("index.search usage is index.search(query, params, cb)");0===arguments.length||"function"==typeof i?(r=i,i=""):1!==arguments.length&&"function"!=typeof n||(r=n,n=void 0),"object"==typeof i&&null!==i?(n=i,i=void 0):void 0!==i&&null!==i||(i="");var o="";return void 0!==i&&(o+=e+"="+encodeURIComponent(i)),void 0!==n&&(o=this.as._getSearchParams(n,o)),this._search(o,t,r)}}t.exports=n;var s=e(28)},{28:28}],25:[function(e,t,i){t.exports=function(e){return JSON.parse(JSON.stringify(e))}},{}],26:[function(e,t,i){t.exports=function(e,t){function i(){return n||(console.log(t),n=!0),e.apply(this,arguments)}var n=!1;return i}},{}],27:[function(e,t,i){t.exports=function(e,t){var i=e.toLowerCase().replace(".","").replace("()","");return"algoliasearch: `"+e+"` was replaced by `"+t+"`. Please see https://github.com/algolia/algoliasearch-client-js/wiki/Deprecated#"+i}},{}],28:[function(e,t,i){"use strict";function n(t,i){var n=e(7),s=this;"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):s.stack=(new Error).stack||"Cannot get a stacktrace, browser is too old",this.name="AlgoliaSearchError",this.message=t||"Unknown error",i&&n(i,function(e,t){s[t]=e})}function s(e,t){function i(){var i=Array.prototype.slice.call(arguments,0);"string"!=typeof i[0]&&i.unshift(t),n.apply(this,i),this.name="AlgoliaSearch"+e+"Error"}return r(i,n),i}var r=e(9);r(n,Error),t.exports={AlgoliaSearchError:n,UnparsableJSON:s("UnparsableJSON","Could not parse the incoming response as JSON, see err.more for details"),RequestTimeout:s("RequestTimeout","Request timedout before getting a response"),Network:s("Network","Network issue, see err.more for details"),JSONPScriptFail:s("JSONPScriptFail","<script> was loaded but did not call our provided callback"),JSONPScriptError:s("JSONPScriptError","<script> unable to load due to an `error` event on it"),Unknown:s("Unknown","Unknown error occured")}},{7:7,9:9}],29:[function(e,t,i){t.exports=function(e,t){t(e,0)}},{}],30:[function(e,t,i){var n=e(7);t.exports=function(e,t){var i=[];return n(e,function(n,s){i.push(t(n,s,e))}),i}},{7:7}],31:[function(e,t,i){var n=e(7);t.exports=function s(e){var t=Array.prototype.slice.call(arguments);return n(t,function(t){for(var i in t)t.hasOwnProperty(i)&&("object"==typeof e[i]&&"object"==typeof t[i]?e[i]=s({},e[i],t[i]):void 0!==t[i]&&(e[i]=t[i]))}),e}},{7:7}],32:[function(e,t,i){t.exports=function(t,i){var n=e(11),s=e(7),r={};return s(n(t),function(e){i(e)!==!0&&(r[e]=t[e])}),r}},{11:11,7:7}],33:[function(e,t,i){function n(t){return function(i,n,r){var o=e(25);r=r&&o(r)||{},r.hosts=r.hosts||["places-dsn.algolia.net","places-1.algolianet.com","places-2.algolianet.com","places-3.algolianet.com"],0!==arguments.length&&"object"!=typeof i&&void 0!==i||(i="",n="",r._allowEmptyCredentials=!0);var a=t(i,n,r),l=a.initIndex("places");return l.search=s("query","/1/places/query"),l}}t.exports=n;var s=e(24)},{24:24,25:25}],34:[function(e,t,i){"use strict";t.exports="3.19.0"},{}]},{},[19])(19)}),$.Gal.prototype.updateOption=function(e){var t=Object.keys(e),i=this;t.forEach(function(t){i.options[t]=e[t]})},$.Gal.prototype.resize=function(e){if(this.box.width()!==this.boxWidth||void 0!=e&&0!=e){this.box.trigger("gridalicious:toResize"),this.box.css("display","block");var t=this.box.find($(".galcolumn"));t.detach(),this._setCols(),this.ifCallback=!1,this.isResizing=!0,this._renderGrid("append"),this.ifCallback=!0,this.isResizing=!1,this.boxWidth=this.box.width(),t.remove(),this.box.trigger("gridalicious:resized")}},Module("HeaderCustomImageSupport")({prototype:{customImageBindings:function(){var e=this;this.files.forEach(function(t,i){var n,s,r=$(t),o={name:"record-"+i+".upload_screen",layers:[{image:"",visible:!0}]};r.data("viewport-width")&&r.data("viewport-height")&&r.data("grab-from-url")&&(n=[r.data("viewport-width"),r.data("viewport-height")].join("x")),o.viewport=n;var a=r.attr("id");a&&""!==a.trim()||(a="customG_"+i,r.attr("id",a));var l=t.dataset.customTitle,c=t.dataset.userAgent,u=new UI.SmartTemplate.CustomGraphicControl({name:a,acceptedFiles:{"image/png":!0,"image/jpg":!0,"image/jpeg":!0},maxSize:12e6,isMobilePhone:e.isMobilePhone,record:o,controlTitle:l,userAgent:c}),d=(u.controlTitle||"No custom experience control title")+" Custom Experience";window.apiPage&&(s=u),u.$loader=$('<div class="lds-ring file"><div></div><div></div><div></div><div></div></div>'),u.$loader.hide(),u.fileInputControl.$fileLabel.prepend(u.$loader),u.urlInputControl&&(u.urlInputControl.$loader=$('<div class="lds-ring url"><div></div><div></div><div></div><div></div></div>'),u.urlInputControl.$loader.hide(),u.urlInputControl.urlButton.prepend(u.urlInputControl.$loader));var h,p,f,m=function(t){var i;this.dataset.imageData=JSON.stringify(t),this.dataset.path=t.cropped_image_url,u.cropParams=t.crop_params,i=t.cropped_image_url,userImageFileName=t.user_image_filename,u.setUrlParameter(t.id),i||Helpers.GlobalEventTracker.track("cropEnd:missingUrl",{method:"remote",response:JSON.stringify(t)}),u.userImageFileName=userImageFileName,u.userImagePath=userImagePath,u.element.attr("id",r.attr("id")),e.dispatch("graphicCropSuccess",{croppedImageUrl:i,customGraphicControl:u,id:t.id})}.bind(t),g=function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("uploadStart",{fileName:e.name,label:d}),CropperRemote.uploadImage(e).then(function(e){return new Promise(function(t,i){$.get(e.data.user_image_url).done(t).fail(i)}).then(function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("uploadEnd",{id:e.id,label:d}),e})})},v=function(e){if(!e)return Promise.reject();var t,i;this.cropperError=e,g(s.getFile()).then(function(e){var t={s3:e,cropperError:this.cropperError};Helpers.GlobalEventTracker.track("StageCanvas-ImageIsCorrupted",t)}.bind(this)),t=JSON.parse(e.responseText),i=t.error||"Couldn't process image, please try again",h&&p&&(u.userImageFileName=h,u.userImagePath=p);return Helpers.GlobalEventTracker.customExperiencesEvent("cropError",{message:i,userImage:u.userImageFileName}),page.flash(i,"alert",{autoclose:{milliseconds:PageController.NOTIFICATION_AUTODISMISS_TIME}}),Promise.reject()};u.bind("file.loaded",function(i){var n,o;s=i.data.target,n=s.getFile(),o=new FormData,o.append("user_image",n,n.name),u.element.find(".lds-ring.file").fadeIn(),s.hideDiscardButton(),s.hideRepositionButton(),h=s.userImageFileName,p=s.userImagePath;var a=function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("localCropper-uploadStart",{fileName:e.name,label:d}),CropperLocalUploader.upload(e).then(function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("remoteCropper-uploadEnd",{id:e.id,label:d}),e})},l=function(e){var t;try{var i,n;i=JSON.parse(e.responseText),n=i.error,t=n,page.flash(n,"alert",{autoclose:{milliseconds:PageController.NOTIFICATION_AUTODISMISS_TIME}})}catch(s){t="Unable to parse JSON",page.flash("Something went wrong, please try again later.","alert",{autoclose:{milliseconds:PageController.NOTIFICATION_AUTODISMISS_TIME}})}return Helpers.GlobalEventTracker.track("customExperience.uploadError",{message:t}),u.element.find(".lds-ring.file").fadeOut(),Promise.reject()},c=function(e){return e.cropperData=null,e.viewport={width:t.dataset.viewportWidth,height:t.dataset.viewportHeight},e},f=function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("cropStart",e),CropperRemote.cropImage(e).then(function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("cropEnd",{id:e.data.id}),e.data})["catch"](function(t){return t.id=e.id,t.cropData=e,Promise.reject(t)})},b=function(t){var i,n,s;return i=t.id,userImagePath=t.user_image_url,n=t.viewport,new Promise(function(r,o){t.cropperData&&(s=t.cropperData);var a=function l(t,s){s.id=i,s.viewport=n,Helpers.GlobalEventTracker.customExperiencesEvent("cropStart",s),u.element.find(".lds-ring.file").fadeIn(),e.cropperModal.unbind("cropImage",l),r(s)};e.cropperModal.bind("cropImage",a),e.cropperModal.bind("modal.cancel",function(t){u.element.find(".lds-ring.file").fadeOut(),e.cropperModal.unbind("cropImage",a),o()}),e.cropperModal.bind("imageLoadError",function(t){u.element.find(".lds-ring.file").fadeOut(),e.cropperModal.unbind("cropImage",a),o({responseText:JSON.stringify({error:t.data.message})})}),e.cropperModal.setViewportDimensions(n),e.cropperModal.loadImage({cropperConstraints:{zoom:!1,movement:!1},existingImageInfo:s},userImagePath)})},y=function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("localCropper-cropStart",e),CropperLocalCropper.crop(u.getFile(),e).then(function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("localCropper-cropEnd",{id:e.id}),e})["catch"](function(t){return t.id=e.id,t.cropData=e,Promise.reject(t)})},_=function(i){var n;return t.dataset.imageData=JSON.stringify(i),t.dataset.path=i.cropped_image_url,u.cropParams=i.crop_params,n=i.cropped_image_url,userImageFileName=i.user_image_filename,n||Helpers.GlobalEventTracker.track("cropEnd:missingUrl",{method:"local",response:JSON.stringify(i)}),u.userImageFileName=userImageFileName,u.userImagePath=userImagePath,u.element.attr("id",r.attr("id")),e.dispatch("graphicCropSuccess",{croppedImageUrl:n,customGraphicControl:u,id:i.id}),i},w=function(t){return Helpers.GlobalEventTracker.smartTemplateEvent("localCropper-persistStart",t),CropperLocalCropper.persist(t,e._onPersistSlowConnection).then(function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("localCropper-persistEnd",{id:e.id}),e.data})["catch"](function(e){var i=e.responseText;return i.id=t.id,i.cropData=t,Promise.reject(e)})},C=function(e){return u.setUrlParameter(e.id),u.record.layers[0].image=e.cropped_image_url,e},S=function(t){return e._persistReject(t,u)};if(e._canUseLocalCropper())a(u.getFile()).then(c)["catch"](l).then(b).then(y)["catch"](v).then(w).then(C)["catch"](S).then(_);else{var T=a(u.getFile()).then(c)["catch"](l).then(b),k=g(u.getFile());Promise.all([T,k]).then(function(e){var t=e[0];return t.id=e[1].id,Promise.resolve(t)}).then(f).then(m)["catch"](v)}}).bind("file.unload",function(e){r.val(""),t.dataset.imageData="",t.dataset.path="",t.dataset.imageFromUrl="",t.dataset.imageHash="",this.dispatch("customExperience.removeImage")}),u.bind("repositionClicked",function(i){var n,o,a,l,c,d=function(t){return new Promise(function(i,n){var r=e.cropperModal,o=t.cropperData,a=function(e){r.unbind("imageLoaded",a),s.element.find(".lds-ring.file").fadeIn(),r.activate()},l=function(e){r.unbind("modal.cancel",l),s.element.find(".lds-ring.file").fadeOut(),n()},c=function(e,n){r.unbind("cropImage",c),n.id=t.id,n.viewport=t.viewport,i(n)};r.bind("imageLoaded",a),r.bind("modal.cancel",l),r.bind("cropImage",c),r.setViewportDimensions(t.viewport),r.loadImage({cropperConstraints:{zoom:!1,movement:!1},existingImageInfo:o},t.user_image_url)})},h=function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("cropStart",e),CropperRemote.cropImage(e).then(function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("cropEnd",{id:e.data.id}),e.data})["catch"](function(t){return t.id=e.id,t.cropData=e,Promise.reject(t)})},p=function(t){var i,n=t.user_image_url;this.dataset.imageData=JSON.stringify(t),this.dataset.path=t.cropped_image_url,u.cropParams=t.crop_params,i=t.cropped_image_url,userImageFileName=t.user_image_filename,u.setUrlParameter(t.id),i||Helpers.GlobalEventTracker.track("cropEnd:missingUrl",{method:"recrop:remote",response:JSON.stringify(t)}),u.userImageFileName=userImageFileName,u.userImagePath=n,u.element.attr("id",r.attr("id")),e.dispatch("graphicCropSuccess",{croppedImageUrl:i,customGraphicControl:u,id:t.id})}.bind(t),m=function(e){var t,i=function(e){return e=e+"?_timestamp="+Date.now(),new Promise(function(t,i){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){var e=new FileReader;e.readAsDataURL(n.response),e.onload=function(e){t(e.target.result)}},n.onerror=function(e){i(e)},n.send()})},n=u.getFile(),s=/^data:image/;return t=u.getFile()||s.test(u.userImagePath)!==!1?Promise.resolve(n||u.userImagePath):i(u.userImagePath),t.then(function(t){return CropperLocalCropper.crop(t,e)}).then(function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("localCropper-cropEnd",{id:e.id}),e})["catch"](function(t){return t.id=e.id,t.cropData=e,Promise.reject(t)})},g=function(i){var n,s=i.user_image_url;return t.dataset.imageData=JSON.stringify(i),t.dataset.path=i.cropped_image_url,u.cropParams=i.crop_params,n=i.cropped_image_url,userImageFileName=i.user_image_filename,n||Helpers.GlobalEventTracker.track("cropEnd:missingUrl",{method:"recrop:local",response:JSON.stringify(i)}),u.userImageFileName=userImageFileName,u.userImagePath=s,u.element.attr("id",r.attr("id")),e.dispatch("graphicCropSuccess",{croppedImageUrl:n,customGraphicControl:u,id:i.id}),i},b=function(t){return Helpers.GlobalEventTracker.smartTemplateEvent("localCropper-persistStart",t),CropperLocalCropper.persist(t,e._onPersistSlowConnection).then(function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("localCropper-persistEnd",{id:e.id}),e.data})["catch"](function(e){var i=e.responseText;return i.id=t.id,i.cropData=t,Promise.reject(i)})},y=function(e){return u.setUrlParameter(e.id),u.record.layers[0].image=e.cropped_image_url,e},_=function(t){return e._persistReject(t,u)};n=i.data.target.userImageFileName?i.data.target:i.data.target.parent,o=Helpers.App.getAllURLParams(),a=t.dataset.imageData?JSON.parse(t.dataset.imageData):{id:o[r.attr("id")]},l=n.cropParams,l&&(c={aw:l.actual_width,ah:l.actual_height,w:l.new_width,h:l.new_height,at:l.actual_top,al:l.actual_left,t:l.image_element_top,l:l.image_element_left,s:l.zoom}),f={id:n.id,user_image_url:n.userImagePath,viewport:{width:t.dataset.viewportWidth,height:t.dataset.viewportHeight},cropperData:c},e._canUseLocalCropper()?d(f).then(m)["catch"](v).then(b).then(y)["catch"](_).then(g):d(f).then(h).then(p)["catch"](v)}),e.appendChild(u),u.bind("grabUrlSuccess",e._grabUrlSuccessHandler.bind(e,u,r)),u.element.attr("id",r.attr("id")),u.render(r),Helpers.App.isApiPage()!==!0&&setTimeout(function(){u.checkUrlParams()},0)});var t=function(t){var i,n,s;i=t.data,n={croppedImageUrl:i.croppedImageUrl,id:i.id},customGraphic=t.data.customGraphicControl,customGraphic.id=i.id,customGraphic.element.find(".lds-ring.file").fadeOut(),s=customGraphic.record.layers[0].image;var r=customGraphic.element.attr("id");
$("#"+r)[0].dataset.path=i.croppedImageUrl,$("#"+r)[0].dataset.imageData=JSON.stringify({id:i.id}),customGraphic.record.hash=i.id,customGraphic.record.layers[0].image=i.croppedImageUrl,customGraphic.record.layers[0].visible=!0,customGraphic.showDiscardButton(),customGraphic.showRepositionButton(),customGraphic.hideUrlInputControl(),Helpers.App.isRecentlyUploadedExperimentFixedVariantsActive()&&customGraphic.hideDropdownControl(),Helpers.GlobalEventTracker.customExperiencesEvent("cropEnd",n),e.process()};e.bind("graphicCropSuccess",t);var i=function(t){var i,n;if(t.data&&t.data.target&&"CustomGraphicControl"===t.data.target.constructor.className){i=t.data.target,n=t.data.file,i.showLoader();var s=function(e){return"image/png"!=e.type.toLowerCase()&&"image/jpeg"!=e.type.toLowerCase()?Promise.reject():Promise.resolve(e)},r=function(){return stageCanvas.dispatch("stage.error",{message:"Please upload a valid image format"}),stageCanvas._removeLoaderDivElement(),stageCanvas._enableTabbedControls(),stageCanvas.enableAllFileUploads(),i.hideLoader(),Promise.reject()},o=function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("uploadStart",{fileName:e.name,label:"Upload Screenshot From URL"}),CropperRemote.uploadImage(e).then(function(e){return new Promise(function(t,i){$.get(e.data.user_image_url).done(t).fail(i)}).then(function(e){return Helpers.GlobalEventTracker.smartTemplateEvent("uploadEnd",{id:e.id,label:"Upload Screenshot From URL"}),e})})},a=function(e){if(!e)return Promise.reject();var t=function(e){var t;try{t=JSON.parse(e.responseText).error}catch(i){t="Couldn't process image, please try again"}return t};return i.getRecordLayerImage()&&(i.showDiscardButton(),i.showRepositionButton()),Helpers.GlobalEventTracker.smartTemplateEvent("uploadError",{message:t(e),fileName:i.getFile().name}),stageCanvas.dispatch("stage.error",{message:t(e)}),stageCanvas._removeLoaderDivElement(),stageCanvas._enableTabbedControls(),stageCanvas.enableAllFileUploads(),i.hideLoader(),Promise.reject()},l=function(e){return e.cropped_image_url=e.user_image_url,e},c=function(t){var n=i.urlInputControl;return i.id=t.id,i.userImagePath=t.user_image_url,i.cropParams=t.crop_params,i.record.hash=i.id,i.record.layers[0].image=t.cropped_image_url,i.record.layers[0].visible=!0,i.showDiscardButton(),i.showRepositionButton(),i.hideLoader(),i.setUrlParameter(t.id),n&&(n.hide(),n.$loader&&n.$loader.hide()),e.dispatch("graphicCropSuccess",{croppedImageUrl:t.cropped_image_url,customGraphicControl:i,id:t.id}),t};s(n)["catch"](r).then(o)["catch"](a).then(l).then(c)}};e.bind("screenshotLoad",i);var n=function(t){var i=t.data;if(i&&i.target&&"CustomGraphicControl"===i.target.constructor.className){var n=i.target,s=i.url,r=s.split("/").pop();n.showLoader();var o=function(e){var t=Utils.getCleanedUpURL(e);return Utils.isValidURL(t)===!0?Promise.resolve(t):Promise.reject(new Error("Please, Enter a valid URL"))},a=function(e){var t=[".jpg",".jpeg",".png"],i=e.split("/").pop(),n=Boolean(t.find(function(e){return i.includes(e)}));return n?Promise.resolve(e):Promise.reject(new Error("Please, Enter a valid image format"))},l=function(e){return page.flash(e.message,"alert",{autoclose:{milliseconds:PageController.NOTIFICATION_AUTODISMISS_TIME}}),Promise.reject(e)},c=function(e){return n.dispatch("grabUrlFail",{message:e.message}),Promise.reject(e)},u=function(e){var t=e.data,i=Utils.validateData(["id","file_name","user_image_url"],t);return i.length>0?Promise.reject(new Error("Cannot load image. Missing data "+i.join(", ")+".")):t.id},d=function(e){return CropperRemoteUploader.uploadByUrl({image_url:e,image_name:r})},h=function(t){return n.id=t.id,n.userImagePath=t.user_image_url,n.record.hash=n.id,n.record.layers[0].image=t.user_image_url,n.record.layers[0].visible=!0,n.hideLoader(),n.setUrlParameter(t.id),e.dispatch("graphicCropSuccess",{croppedImageUrl:t.user_image_url,customGraphicControl:n,id:t.id}),n.dispatch("grabImageByURLEnd",{data:t}),t};return o(s).then(a)["catch"](l).then(d).then(u).then(CustomAsset.fetch).then(h)["catch"](Utils.bindFn(this)(c))}};e.bind("grabImageByURLStart",n)},_canUseLocalCropper:function(){return page.customExperience&&page.customExperience.grid.canProcessWithEngine===!0&&this.isMobilePhone===!1},traceFn:function(e){console.log("StageCanvasCustomGraphicSupport",e)},_persistReject:function(e,t){if(!e)return Promise.reject();t.element.find(".lds-ring.file").fadeOut();var i=UploadAssetSupport.getPersistErrorMessage(e.responseText);return Helpers.GlobalEventTracker.smartTemplateEvent("persistError",{message:e.responseText,id:e.id}),page.flash(i,"alert",{autoclose:{milliseconds:PageController.NOTIFICATION_AUTODISMISS_TIME}}),Promise.reject()},_onPersistSlowConnection:function(e){page.flash(e,"alert",{autoclose:{milliseconds:PageController.NOTIFICATION_AUTODISMISS_TIME}})}}}),Module("CleanRecordSupport")({newLineRegex:/\n/g,httpRegex:/^http[s]+:/,prototype:{getCleanRecord:function(e){var t,i;return t=JSON.parse(JSON.stringify(e)),i=function(e){return e.filter(function(e){return e.visible})},t.graphic&&t.graphic.forEach(function(e){e.layers&&(e.layers=i(e.layers))}),t.background&&t.background.forEach(function(e){e.layers&&(e.layers=i(e.layers))}),t.video&&t.video.forEach(function(e){e.layers&&(e.layers=i(e.layers))}),t.asset_library&&t.asset_library.forEach(function(e){e.layers&&(e.layers=i(e.layers))}),t.text&&t.text.forEach(function(e){e.allowedFonts=e.allowedFonts.filter(function(t){return e.font===t.name})}),t.customRules&&t.customRules.forEach(function(e){delete e.accumulatedInteractions}),t.options&&t.options.length>0&&t.options.forEach(function(e){e.options=[]}),delete t.previewImage,delete t.md5Hash,t._slideData=null,t},getNormalizedJSON:function(e){var t=this.getCleanRecord(e),i=this._sortObjectByProperties,n=this.constructor.newLineRegex,s=this.constructor.httpRegex;if(window._pl_featureFlags.t17627.enableNormalizer!==!0&&window.devMode!==!0)return t;if(console.log("Using JSON normalizer"),t.images&&t.images.forEach(function(e){e.name=e.name.replace("ae.custom_graphic.",""),e.layers&&e.layers.length>0&&null===e.layers[0].image&&(e.layers=[]),delete e.hash}),t.text&&t.text.forEach(function(e){e.allowedFonts&&Array.isArray(e.allowedFonts)&&(e.allowedFonts=e.allowedFonts.map(function(e){return delete e.id,delete e.visible,delete e.isPremium,i(e)})),e.contents&&(e.contents=e.contents.replace(n,"\r")),e.visible===!1&&(e.contents=""),e.color&&(e.color=e.color.toLowerCase()),e.capitalization="ALLCAPS",delete e.excludable,delete e.maxCharacters,delete e.layers,delete e.maxLines}),t.video&&t.video.forEach(function(e){e.layers=[],e.selectedLayer&&(delete e.selectedLayer.assetType,delete e.selectedLayer.tags,delete e.selectedLayer.usage,delete e.selectedLayer.updatedAt,delete e.selectedLayer.assetGroups,delete e.selectedLayer.smallImageSize,delete e.selectedLayer.allowTrimmer,delete e.selectedLayer.duration,delete e.selectedLayer.isPremium,delete e.selectedLayer.objectID,delete e.selectedLayer.layers,"customGraphic"===e.selectedLayer.id&&(delete e.selectedLayer.name,delete e.selectedLayer.userImageFileName,delete e.selectedLayer.path),"null"===e.selectedLayer.id&&delete e.selectedLayer.size,e.selectedLayer=i(e.selectedLayer)),e.hasLayers===!0&&null===e.selectedLayer&&(e.selectedLayer={id:"null",image:null,visible:!0}),delete e.preconfiguredSearch}),t.asset_library&&t.asset_library.forEach(function(e){e.layers=[],e.selectedLayer&&(delete e.selectedLayer.assetType,delete e.selectedLayer.tags,delete e.selectedLayer.usage,delete e.selectedLayer.updatedAt,delete e.selectedLayer.assetGroups,delete e.selectedLayer.hasAnimated,delete e.selectedLayer.originalFile,delete e.selectedLayer.duration,delete e.selectedLayer.smallImageSize,delete e.selectedLayer.allowTrimmer,delete e.selectedLayer.isPremium,delete e.selectedLayer.objectID,delete e.selectedLayer.layers,"customGraphic"===e.selectedLayer.id&&(delete e.selectedLayer.name,delete e.selectedLayer.userImageFileName,delete e.selectedLayer.path,s.test(e.selectedLayer.image)===!1&&delete e.selectedLayer.image),e.selectedLayer.image&&(e.selectedLayer.image=e.selectedLayer.image.replace("small.jpg","medium.jpg")),"null"===e.selectedLayer.id&&delete e.selectedLayer.size,e.selectedLayer=i(e.selectedLayer)),e.hasLayers===!0&&null===e.selectedLayer&&(e.selectedLayer={id:"null",image:null,visible:!0}),delete e.preconfiguredSearch}),t.graphic&&t.graphic.forEach(function(e){e.selectedLayer&&(delete e.selectedLayer.assetType,delete e.selectedLayer.tags,delete e.selectedLayer.updatedAt,delete e.selectedLayer.assetGroups,delete e.selectedLayer.usage,delete e.selectedLayer.hasAnimated,delete e.selectedLayer.originalFile,delete e.selectedLayer.duration,delete e.selectedLayer.smallImageSize,delete e.selectedLayer.allowTrimmer,delete e.selectedLayer.isPremium,delete e.selectedLayer.objectID,s.test(e.selectedLayer.image)===!1&&delete e.selectedLayer.image,s.test(e.selectedLayer.video)===!1&&delete e.selectedLayer.video,delete e.selectedLayer.path,e.selectedLayer.layers&&Array.isArray(e.selectedLayer.layers)&&e.selectedLayer.layers.forEach(function(e){delete e.keyFrame,e.color&&(e.color=e.color.toLowerCase())}),"null"===e.selectedLayer.id&&delete e.selectedLayer.size,e.selectedLayer=i(e.selectedLayer)),e.hasLayers===!0&&null===e.selectedLayer&&(e.selectedLayer={id:"null",image:null,visible:!0}),Array.isArray(e.layers)&&0===e.layers.length&&delete e.selectedLayer.layers,delete e.groupTags,delete e.width,delete e.height,delete e.preconfiguredSearch,e.color?e.color=e.color.toLowerCase():e.color="#000000",delete e.layers,e.layers=[]}),t.color_picker&&t.color_picker.forEach(function(e){delete e.layers,e.color&&(e.color=e.color.toLowerCase())}),delete t.composition,delete t.defaultAssetColors,t=i(t),t.linkedSmartTemplateId){var r=t.linkedSmartTemplateId;delete t.linkedSmartTemplateId,t.linkedSmartTemplateId=r}return t},_sortObjectByProperties:function(e){return Object.keys(e).sort().reduce(function(t,i){return t[i]=e[i],t},{})}}}),Module("CDNSupport")({_cdnRoundRobin:0,prototype:{_CDNConfig:{development:{basePath:"https://smart-templates.us",cdnPath:"https://assets-staging-#.placeit.net",cdnPublicPath:"https://nice-assets-staging#.s3-accelerate.amazonaws.com"},staging:{basePath:"https://smart-templates.us",cdnPath:"https://assets-staging-#.placeit.net",cdnPublicPath:"https://nice-assets-staging#.s3-accelerate.amazonaws.com"},production:{basePath:"https://nicev2.placeit.net",cdnPath:"https://assets-#.placeit.net",cdnPublicPath:"https://nice-assets#.s3-accelerate.amazonaws.com"}},_cdnBasePath:function(){var e=this._CDNConfig[window.environment].cdnPath;return CDNSupport._cdnRoundRobin=CDNSupport._cdnRoundRobin%3+1,e.replace(/#/,CDNSupport._cdnRoundRobin)},_cdnBasePublicPath:function(){var e=this._CDNConfig[window.environment].cdnPublicPath;return CDNSupport._cdnRoundRobin=CDNSupport._cdnRoundRobin%3+1,1===CDNSupport._cdnRoundRobin?e.replace(/#/,""):e.replace(/#/,"-"+CDNSupport._cdnRoundRobin)}}}),Class(UI,"AlgoliaSearch")({_instance:null,getInstance:function(){return UI.AlgoliaSearch._instance?UI.AlgoliaSearch._instance:(UI.AlgoliaSearch._instance=new this,UI.AlgoliaSearch._instance)},prototype:{APP_ID:window.algoliaConfig.appId,READ_API_KEY:window.algoliaConfig.readApiKey,TEMPLATE_INDEX:window.algoliaConfig.niceTemplatesIndex,ASSET_INDEX:window.algoliaConfig.niceAssetsIndex,algolia:null,templatesIndex:null,assetIndex:null,controls:null,queries:[],requests:[],stageData:[],layersCache:[],init:function(){this.algolia=window.algoliasearch(window.algoliaConfig.appId,window.algoliaConfig.readApiKey,{timeouts:{connect:1e3,read:7e3,write:3e4}}),this.templatesIndex=this.algolia.initIndex(this.TEMPLATE_INDEX),this.assetIndex=this.algolia.initIndex(this.ASSET_INDEX)},initialize:function(){return Promise.resolve({})},_successGetControls:function(e){var t=this;t.requests.forEach(function(i){var n=t._getQuery(e,i);null===n?i.resolve(t.buildResponseLayers()):(i.query.filters=n.queryLayer,t.assetIndex.search(i.search,i.query).then(function(e){i.successFn(e,n.querySelectedLayer)})["catch"](function(e){i.reject(e)})),i.done=!0}),t.requests=t.requests.filter(function(e){return e.done!==!0})},changeSlide:function(e){var t=this;return t.requests=[],t.controls=null,t.queries=[],new Promise(function(i,n){t.getControls(e).then(function(e){t._successGetControls(e),i(e)})["catch"](function(e){n(e)})})},_getQuery:function(e,t){var i,n,s,r=this,o=null,a="";if(0===e.length)return null;var l=r.queries.find(function(e){return e.propertyName===t.propertyName&&e.position===t.position});if(l&&l.query)return l.query;n=e.filter(function(e){return e.propertyName===t.propertyName&&e.position===t.position}),s=[],n.forEach(function(e){s=s.concat(e.graphics)}),i=t.selectedLayerId;var c={graphics:s,selectedLayer:i};return a=r.buildFilterByAssigned(c),o=""===a?null:{queryLayer:a,querySelectedLayer:i?"id:"+i:null},r.queries.push({query:o,position:t.position,propertyName:t.propertyName}),o},buildFilterByAssigned:function(e){var t="";return t=1===e.graphics.length?"id:"+e.graphics[0]:e.graphics.filter(function(t){return t!==e.selectedLayer}).map(function(e){return"id:"+e}).join(" OR ")},updateQuery:function(e,t){this.queries.forEach(function(i){i.position===e.position&&i.propertyName===e.propertyName&&(i.query=t)})},getControls:function(e){var t=this,i="",n={filters:"templateID:"+e,distinct:0,hitsPerPage:1e3};return new Promise(function(s,r){var o=t.stageData.find(function(t){return e===t.templateId});void 0===o?t.templatesIndex.search(i,n).then(function(i){var n=[];i.hits.forEach(function(e){n.push({position:e.position,propertyName:e.propertyName,graphics:e.graphics,selectedLayer:e.selectedLayer})}),t.stageData.push({templateId:e,data:n}),t.controls=n,s(t.controls)})["catch"](function(e){r(e)}):(t.controls=o.data,s(t.controls))})},getLayersByControl:function(e,t){var i,n,s,r=this;i=t&&t.search||"",n={},n.page=t&&t.page||0,n.hitsPerPage=t&&t.perPage||30,s=e&&e.selectedLayerId||null;var o=r.buildResponseLayers();return new Promise(function(t,a){if("number"!=typeof e.position||"string"!=typeof e.propertyName||""===e.propertyName)return void a({error:"all control params are requires",controlParams:e});var l=r._buildRequest({propertyName:e.propertyName,position:e.position,search:i,query:n,selectedLayerId:s,resolve:t,reject:a});if(null===r.controls)return void r.requests.push(l);var c=r._getQuery(r.controls,l);if(null===c)return void t(o);l.query.filters=c.queryLayer;var u=c.querySelectedLayer;r.assetIndex.search(i,l.query).then(function(e){l.successFn(e,u)})["catch"](function(e){a(e)})})},_buildRequest:function(e){var t=this,i=e.resolve,n=e.reject;return e.successFn=function(s,r){s.searchTerm=e.search,1===s.hits.length&&s.hits[0].id===e.selectedLayerId&&(s.hits=[]);var o=t.buildResponseLayers(s);return"string"==typeof r?void t.assetIndex.search("",{filters:r},function(e,s){return e?void n(e):(s.hits.length>0&&(o.selectedLayer=s.hits[0],t.craftPaths(o.selectedLayer)),void i(o))}):void i(o)},e},getLayers:function(e){var t=this,i=null,n=[],s=[];return e.forEach(function(e){var i=t.layersCache.find(function(t){return t.id===e});void 0===i?s.push(e):n.push(i)}),new Promise(function(r,o){if(Array.isArray(e)!==!0)return void o({error:"layerIds is required"});if(s.length>0){i=s.map(function(e){return"id:"+e}).join(" OR ");var a=AlgoliaClient.getAssetIndex();a.search("",{filters:i}).then(function(e){e.hits.forEach(function(e){t.craftPaths(e)}),t.craftPaths(e.selectedLayer),t.layersCache=t.layersCache.concat(e.hits),n=n.concat(e.hits),r(n)})["catch"](function(e){o(e)})}else r(n)})},changeSelectedLayer:function(){},buildResponseLayers:function(e){var t=this;return e&&(e.hits.forEach(function(e){t.craftPaths(e)}),t.craftPaths(e.selectedLayer)),{data:e&&e.hits||[],selectedLayer:e&&e.selectedLayer||null,page:e&&e.page,perPage:e&&e.hitsPerPage||null,totalPages:e&&e.nbPages||null,total:e&&e.nbHits||null,searchTerm:e&&e.searchTerm}},craftPaths:function(e){if(e)switch(delete e.objectID,delete e._highlightResult,Helpers.App.shouldPreferVideoAsset(e)&&(e.assetType="animated"),e.assetType){case"image":Helpers.App.isMobile()?e.image="/image_library/"+e.id+"/images/medium.jpg":e.image="/image_library/"+e.id+"/images/small.jpg",e.path="image_library/"+e.id+"/image"+e.type;break;case"video":e.image="/video_library/"+e.id+"/images/small.jpg",e.video="/video_library/"+e.id+"/videos/preview.mp4";break;case"animated":Helpers.App.isMobile()?e.image="/image_library/"+e.id+"/images/medium.jpg":e.image="/image_library/"+e.id+"/images/small.jpg",e.video="/image_library/"+e.id+"/animated_preview.mp4",e.assetType="video"}},getLayer:function(e){var t=this;return new Promise(function(i,n){t.assetIndex.search("",{filters:"id:"+e}).then(function(e){return 0===e.hits.length?void i({}):(t.craftPaths(e.hits[0]),void i(e.hits[0]))})["catch"](function(e){n(e)})})},getLayersByGroups:function(e){var t,i,n=this,s="",r="";return t=e&&e.search||"",i={},i.page=e&&e.page||0,i.hitsPerPage=e&&e.perPage||30,i.filters="",e.assetGroups&&(s=e.assetGroups.trim().split(" ").map(function(e){return"assetGroups:"+e}).join(" OR ")),e.selectedLayerId&&"null"!==e.selectedLayerId?(i.filters=s+" AND NOT id:"+e.selectedLayerId,r=s+" AND id:"+e.selectedLayerId):i.filters=s,new Promise(function(s,o){n.assetIndex.search(t,i).then(function(i){i.searchTerm=t,e.selectedLayerId&&"null"!==e.selectedLayerId&&0===e.page?n.assetIndex.search(t,{filters:r}).then(function(e){e.hits.length>0?(i.selectedLayer=e.hits[0],n.craftPaths(i.selectedLayer),i.hits.unshift(i.selectedLayer)):i.selectedLayer=null,s(n.buildResponseLayers(i))}):(i.selectedLayer=null,s(n.buildResponseLayers(i)))})["catch"](function(e){o(e)})})}}}),Class(UI,"JsonFetcher")({RETRIES:3,RETRY_AFTER:1e3,prototype:{init:function(e){this.async=e.async||!1,this.path=e.path,this.retries=e.retries||UI.JsonFetcher.RETRIES,this.retryAfter=e.retryAfter||UI.JsonFetcher.RETRY_AFTER},fetch:function(){var e=this,t=new Promise(function(t,i){var n={method:"GET",url:e.path,dataType:"json",async:e.async,retries:e.retries,retryAfter:e.retryAfter},s=function(r){n.retries-=1,n.retries>0?setTimeout(function(){$.ajax(n).done(t).fail(s)},n.retryAfter):(r.url=e.jsonPath,i(r))};$.ajax(n).done(t).fail(s)});return t}}}),Module("FetchLayersSupport").includes(CDNSupport)({prototype:{setSelectedLayers:function(e){var t=UI.AlgoliaSearch.getInstance();e.filter(function(e){return e.selectedLayer}).forEach(function(e){t.craftPaths(e.selectedLayer),e.selectedLayer.visible=!0})},fetchAndSetAssetLayers:function(e,t){return new Promise(function(i,n){var s;if(!e||!e.id||"document"!==e.type)return i(e);s=this._cdnBasePath()+"/image_library/"+e.id+"/ui.json";var r=new UI.JsonFetcher({path:s});r.fetch().then(function(n){var s=Helpers.App.getLayerFromRecordByName("accent",n),r=null,o=null;s&&(r=Helpers.App.getLayerFromRecordByName("accent",e),o=Array.isArray(t)&&t.length>0?t[0]:s.color,s.color=r?r.color:o),e.layers=n.layers,i(e)})["catch"](function(t){e.layers=e.layers||[],i(e)})}.bind(this))},fetchGraphicLayers:function(e){var t=e.map(function(e){var t,i,n,s,r;return t=e.layers.map(function(e){return e.visible}).indexOf(!0),r=e.layers[t],!r||"document"!==r.type||Array.isArray(r.layers)?Promise.resolve():(i=this._cdnBasePath()+"/image_library/"+r.id+"/ui.json",n=new UI.JsonFetcher({path:i}),s=n.fetch(),s.then(function(i){e.layers[t]=$.extend({},r,i)},function(e){}))},this);return Promise.all(t)},fetchLayers:function(e){var t,i;return t=UI.AlgoliaSearch.getInstance(),i=e.map(function(e){return"undefined"==typeof e.layer?Promise.resolve():new Promise(function(i,n){t.assetIndex.search("",{filters:"id: "+e.layer},function(s,r){return s?void n(s):(r.hits[0]&&(t.craftPaths(r.hits[0]),e.layers=[r.hits[0]],e.layers[0].visible=!0),void i())})})}),Promise.all(i)}}}),Class("CustomAsset")({_cache:{},fetch:function(e){var t=[Helpers.App.getUserUploadsUrl(),e,"data.json"].join("/"),i="/uploads/tmp/"+e+"/data.json",n=[new Promise(function(e,i){$.get(t).then(e).fail(function(e){i({bucket:"S3",data:e})})}),new Promise(function(e,t){$.get(i).then(e).fail(function(e){t({bucket:"tmp",data:e})})})];return Promise.any(n)["catch"](function(e){var t="S3"===e[0].bucket?e[0]:e[1];return Promise.reject(t.data)})},fetchWithCache:function(e){var t=CustomAsset._cache;return e in t?Promise.resolve(t[e]):CustomAsset.fetch(e).then(function(i){return t[e]=i,i})},mapAssetFromCropData:function(e){var t,i;return Boolean(e)===!1?null:(i=e.croppedImageUrl||e.cropped_image_url,t=Helpers.App.isBase64Image(i)?"."+i.split(";").shift().split("/").pop():"."+i.split(".").pop(),{assetType:"image",id:"customGraphic",image:i,thumb:e.thumb||e.thumbnail_url,isPremium:!1,path:null,record_hash:e.id,type:t,visible:!0})}}),Module("UiJsonSupport")({prototype:{map:{color_control:"colorPicker_",custom_image:"customG_",video:{video:"video",search:"search",color:"color"},graphic:{graphic:"multi",color:"color",search:"search"},audio:{enabled:"audio_enabled",track:"audio_track"},asset_library:{graphic:"multi",color:"color",search:"search"},text_control:{color:"color",text:"text",checkbox:"checkbox",font:"font",font_size:"_fontSize"},alternate_values:"option_"},_getSeparator:function(e){var t="?";return e.indexOf(t)>-1&&(t="&"),t},_getUrlParams:function(e,t){var i,n,s=this;return i="",e.text.forEach(function(e){return n="Text_"+e.name,e.visible===!1?(i=i.concat(this._getSeparator(i),encodeURIComponent("checkbox"+n),"=",!1),void(t&&(i=i.concat(this._getSeparator(i),encodeURIComponent("text"+n),'=""')))):(e.contents?i=i.concat(this._getSeparator(i),encodeURIComponent("text"+n),"=",encodeURIComponent(e.contents)):t&&(i=i.concat(this._getSeparator(i),encodeURIComponent("text"+n),'=""')),i=i.concat(this._getSeparator(i),encodeURIComponent("color"+n),"=",encodeURIComponent(e.color)),void(t&&(i=i.concat(this._getSeparator(i),encodeURIComponent("font"+n),"=",encodeURIComponent(e.font)))))},this),e.graphic.forEach(function(e,t){if(n="Folder_"+e.name,e.layers&&1===e.layers.length&&0===Object.keys(e.layers[0]).length)return void(i=i.concat(this._getSeparator(i),encodeURIComponent("graphic"+n),"=-1"));if(e.layer){var r=e.preconfiguredSearch||"";i=i.concat(this._getSeparator(i),encodeURIComponent("multi"+n),"=",encodeURIComponent(e.layer)),this.isNlpEnabled===!0&&(this.selectedByUser===!0?r="":this.query&&(r=this.query)),null!==r&&(i=i.concat(this._getSeparator(i),"search",encodeURIComponent(n),"=",encodeURIComponent(r)))}else e.selectedLayer&&"null"===e.selectedLayer.id&&(i=Helpers.App.isRefactorEnabled()?i.concat(this._getSeparator(i),encodeURIComponent("state"+n),"=hidden"):i.concat(this._getSeparator(i),encodeURIComponent("multi"+n),"=null"));if(e.layers){var o=e.layers.filter(function(e){return e.visible===!0})[0];o&&o.layers&&o.layers.forEach(function(e){"accent"===e.name.toLowerCase().trim()&&(i=i.concat(s._getSeparator(i),encodeURIComponent("colorAccent"+n),"=",encodeURIComponent(e.color)))})}i=i.concat(this._getSeparator(i),encodeURIComponent("color"+n),"=",encodeURIComponent(e.color))},this),e.customGraphic.forEach(function(e,t){e.hash&&(n="customG_"+t,i=i.concat(this._getSeparator(i),encodeURIComponent(n),"=",encodeURIComponent(e.hash)))},this),e.backgroundColor&&e.backgroundColor.color&&(n="colorFolder_Background",i=i.concat(this._getSeparator(i),encodeURIComponent(n),"=",encodeURIComponent(e.backgroundColor.color))),i},_getUrlParamsForVideo:function(e,t){this.slidePrefix=t+"_";var i="";return i=this.getTextParams(e.text,i),i=this.getColorPickerParams(e.color_picker,i),i=this.getAudioParams(e.audio,i),i=this.getOptionParams(e.options,i),i=this.getImagesParams(e.images,i),i=this.getAssetLibraryParams(e.asset_library,i),i=this.getVideoParams(e.video,i),i=this.getGraphicParams(e.graphic,i)},getTextParams:function(e,t){var i=this;return e.forEach(function(e,n){var s=n+e.name,r=i.slidePrefix+i.map.text_control.color+s;t=t.concat(i._getSeparator(t),r,"=",encodeURIComponent(e.color));var o=i.slidePrefix+i.map.text_control.text+s,a=e.contents;e.visible===!1&&(a=""),t=t.concat(i._getSeparator(t),o,"=",encodeURIComponent(a));var l=i.slidePrefix+i.map.text_control.font+s;t=t.concat(i._getSeparator(t),l,"=",encodeURIComponent(e.font))}),t},getColorPickerParams:function(e,t){var i=this;return e.forEach(function(e,n){var s=n+e.name,r=i.slidePrefix+i.map.color_control+s;t=t.concat(i._getSeparator(t),r,"=",encodeURIComponent(e.color))}),t},getAudioParams:function(e,t){if(e){var i=this.map.audio.enabled;t=t.concat(this._getSeparator(t),i,"=",encodeURIComponent(e.enabled));var n=this.map.audio.track;t=t.concat(this._getSeparator(t),n,"=",encodeURIComponent(e.track&&e.track.id||null))}return t},getOptionParams:function(e,t){var i=this;return e.forEach(function(e){var n=i.map.alternate_values+e.name;t=t.concat(i._getSeparator(t),n,"=",encodeURIComponent(e.selectedOptions[0].value))}),t},getImagesParams:function(e,t){var i=this;return e.forEach(function(e,n){var s=i.slidePrefix+i.map.custom_image+n;e.hash&&(t=t.concat(i._getSeparator(t),s,"=",encodeURIComponent(e.hash)))}),t},getAssetLibraryParams:function(e,t){var i=this;return e.forEach(function(e,n){var s=n+e.name,r=i.slidePrefix+i.map.asset_library.color+s;if(t=t.concat(i._getSeparator(t),r,"=",encodeURIComponent(e.color)),e.selectedLayer){var o=i.slidePrefix+i.map.asset_library.graphic+s,a="customGraphic"!==e.selectedLayer.id?e.selectedLayer.id:e.selectedLayer.record_hash;t=t.concat(i._getSeparator(t),o,"=",encodeURIComponent(a))}var l=i.slidePrefix+i.map.asset_library.search+s;t=t.concat(i._getSeparator(t),l,"=",encodeURIComponent(e.preconfiguredSearch?e.preconfiguredSearch.toLowerCase():""))}),t},getVideoParams:function(e,t){var i=this;return e.forEach(function(e,n){var s=n+e.name;if(e.selectedLayer){var r=i.slidePrefix+i.map.video.video+s;t=t.concat(i._getSeparator(t),r,"=",encodeURIComponent(e.selectedLayer.id))}var o=i.slidePrefix+i.map.video.color+s;t=t.concat(i._getSeparator(t),o,"=",encodeURIComponent(e.color));var a=i.slidePrefix+i.map.video.search+s;t=t.concat(i._getSeparator(t),a,"=",encodeURIComponent(e.preconfiguredSearch?e.preconfiguredSearch.toLowerCase():""))}),t},getGraphicParams:function(e,t){var i=this;return e.forEach(function(e,n){var s=n+e.name,r=i.slidePrefix+i.map.graphic.color+s;if(t=t.concat(i._getSeparator(t),r,"=",encodeURIComponent(e.color)),e.selectedLayer){var o=i.slidePrefix+i.map.graphic.graphic+s,a=e.selectedLayer.id;Helpers.App.isRefactorEnabled()&&e.selectedLayer.visible===!1&&(a=null),t=t.concat(i._getSeparator(t),o,"=",encodeURIComponent(a)),Array.isArray(e.selectedLayer.layers)&&e.selectedLayer.layers.filter(function(e){return e.allowColorpicker}).forEach(function(e){var n=i.slidePrefix+i.map.graphic.color+e.name+s;t=t.concat(i._getSeparator(t),n,"=",encodeURIComponent(e.color))})}var l=i.slidePrefix+i.map.graphic.search+s;t=t.concat(i._getSeparator(t),l,"=",encodeURIComponent(e.preconfiguredSearch?e.preconfiguredSearch.toLowerCase():""))}),t}}}),Class("Queue")({prototype:{init:function(e){$.extend(this,e),this._items=[]},push:function(e){var t=this;e.forEach(function(e){t._items.push(e)})},next:function(){return this._items.shift()},clear:function(){var e=this._items;return this._items=[],e},size:function(){return this._items.length}}}),Class("SmartConsumer")({prototype:{init:function(e){$.extend(this,e),this.keepRunning=!1},start:function(){this.keepRunning=!0,this.run()},run:function(){if(this.keepRunning!==!1){var e=this,t=this.queue.next();return t?void(this.queue.actionName?t[this.queue.actionName].call(t,function(){setTimeout(function(){e.run()})}):this.queue.action(t,function(){setTimeout(function(){e.run()})})):void(this.queue.consumers.length>this.queue.minConsumers?this.destroy():this.stop())}},stop:function(){this.keepRunning=!1},destroy:function(){this.stop(),this.queue.removeConsumer(this),this.queue=null}}}),Class("SmartQueue").inherits(Queue)({prototype:{consumers:[],maxConsumers:1,minConsumers:1,itemsPerConsumer:1,consumerClass:null,init:function(e){this.consumers=[],Queue.prototype.init.call(this,e),null===this.consumerClass&&(this.consumerClass=SmartConsumer);for(var t=0;t<this.minConsumers;t++)this.instantiateConsumer()},push:function(e){Queue.prototype.push.call(this,e);for(var t=this.consumers.length,i=this._items.length,n=Math.floor(i/this.itemsPerConsumer-t),s=Math.min(this.maxConsumers-t,n),r=0;s>r;r++)this.instantiateConsumer();this.consumers.forEach(function(e){0==e.keepRunning&&e.start()})},instantiateConsumer:function(){var e=new this.consumerClass;e.queue=this,this.consumers.push(e)},removeConsumer:function(e){var t=this.consumers.indexOf(e);this.consumers.splice(t,1)}}}),Class("IframePool")({_instance:null,getInstance:function(){return IframePool._instance?IframePool._instance:(IframePool._instance=new IframePool,IframePool._instance)},prototype:{minIframes:1,maxIframes:3,_iframeCollection:[],pendingRequests:[],init:function(e){$.extend(this,e),this._iframeCollection.push(this._createIframe()),this._iframeCollection.push(this._createIframe()),this._iframeCollection.push(this._createIframe())},get:function(e){var t=this._getIdleIframe();return t?(t.data("idle",!1),e(t)):void this.pendingRequests.push(e)},destroyIframe:function(e){var t=e[0].contentWindow;t.engine&&t.engine.destroy(),delete t.engine,delete t.wrapper,delete t.RuleClass,delete t.layer,delete t.parent,delete t.app,t.app={activeDocument:{}},delete t.texts,delete t.effect,delete t.canvas,delete t.globalThis,delete t.window,delete t.self,e.data("idle",!0),this.pendingRequests.length&&this.get(this.pendingRequests.pop())},_getIdleIframe:function(){var e=this._iframeCollection.find(function(e){return e.data("idle")});return e?e:this._iframeCollection.length===this.maxIframes?null:(e=this._createIframe(),this._iframeCollection.push(e),e)},_createIframe:function(){var e=this,t=$("<iframe></iframe>");t.attr("id",performance.now()),t.addClass("off-screen"),t.appendTo("body"),t[0].src="/simple_engine";var i=function(n){var s=t[0].contentWindow;s===n.source&&(window.removeEventListener("message",i),t.data("idle",!0),e.pendingRequests.length&&e.get(e.pendingRequests.pop()))}.bind(this);return window.addEventListener("message",i),t}}}),Class("IntegrityCheck")({_bannedBrowsers:[/(AppleWebKit\/).+(Version\/9\.[0-1]).+(Safari\/)/,/(Macintosh; Intel Mac OS X 10_11_6).*(Version\/(10|11)).*(Safari\/)/,/(Macintosh; Intel Mac OS X 10_11_6).*(Chrome\/)/,/(Windows NT 10).*(Edge\/18)/],isRunning:!1,getIntegrityTestCookie:function(){return document.cookie.replace(/(?:(?:^|.*;\s*)new_integrity_result\s*\=\s*([^;]*).*$)|^.*$/,"$1")},_checkCapability:function(){var e=!0,t=Helpers.App.getUrlParam("ngin"),i=this.getIntegrityTestCookie(),n=Helpers.App.isMobile(),s=Helpers.StageType.getStageData();if("off"===t)return console.log("Test param found, using backend server"),e=!1;if("on"===t)return console.log("Test param found, forcing engine"),e=!0;if(s.force_fallback===!0)return e=!1;if(window.defaultToV4Engine===!0)return console.log("Default to engine flag found, using engine"),e=!0;try{new ImageData(200,200)}catch(r){return console.log("Older browser found, using backend server"),Helpers.GlobalEventTracker.track("3dCheck:missingFeature",{eventCategory:Helpers.StageType._types[s.image_type],eventAction:"3dCheck:missingFeature",resultUrl:window.location.href}),e=!1}for(var o=0;o<this._bannedBrowsers.length;o++)if(navigator&&this._bannedBrowsers[o].test(navigator.userAgent))return console.log("Older browser found, using backend server"),Helpers.GlobalEventTracker.track("3dCheck:unsupportedBrowser",{eventCategory:Helpers.StageType._types[s.image_type],eventAction:"3dCheck:missingFeature",resultUrl:window.location.href}),e=!1;var a=this.isWebGLSupported();return a.result===!1?(console.log("WebGL is not supported by browser, using backend server"),Helpers.GlobalEventTracker.track("noWebGL",{eventCategory:Helpers.StageType._types[s.image_type],eventAction:"noWebGL",errorMessage:a.errorMessage,errorContext:a.errorContext,resultUrl:window.location.href}),e=!1):navigator.cookieEnabled?n&&window.forceMobileFallbackForMockups===!0&&"Mockups"===s.category_name?(console.log("Mobile device found and force mobile fallback for mockups on"),e=!1):n&&window.forceMobileFallback===!0?(console.log("Mobile device found and force mobile fallback on"),e=!1):this.isInFallbackExperiment()===!0?(console.log("Using fallback per experiment"),e=!1):(console.log("Integrity cookie: "+i),e=i&&"true"!==i?!1:!0):(console.log("No access to cookies, defaulting to backend low res server"),e=!1)},checkCapability:function(){var e=IntegrityCheck._checkCapability();return this.checkCapability=function(){return e},this.checkCapability()},isInFallbackExperiment:function(){$.cookie("gtmc_prefer_fallback"),$.cookie("gtmc_user_location");
return!1},isWebGLSupported:function(){var e,t={stencil:!0},i="",n="";try{if(!window.WebGLRenderingContext)return i="3dCheck:noWebGLContext",{result:!1,errorMessage:i,errorContext:n};var s=document.createElement("canvas");e=s.getContext("webgl",t)||s.getContext("experimental-webgl",t);var r=!(!e||!e.getContextAttributes().stencil);if(!!e==!1?i="3dCheck:noGLContext":!!e.getContextAttributes().stencil==!1&&(i="3dCheck:noStencil"),e){var o=e.getExtension("WEBGL_lose_context");o&&o.loseContext()}return window.WebGLMemoryEstimator&&WebGLMemoryEstimator.stopTrackingContext(e),{result:r,errorMessage:i,errorContext:n}}catch(a){return i="3dCheck:genericError",n=a&&a.toString&&a.toString(),window.WebGLMemoryEstimator&&WebGLMemoryEstimator.stopTrackingContext(e),{result:!1,errorMessage:i,errorContext:n}}},shouldRunIntegrityTest:function(e,t,i){var n=this.getIntegrityTestCookie();return"development"===window.environment?(console.log("Not running integrity because of local environment."),!1):e&&!n&&t&&i?!0:!1},setIntegrityResultCookie:function(e){var t=Helpers.App.isMobile(),i=t===!0?10:30,n=new Date;n=new Date(n.getTime()+6e4*i),document.cookie="integrity_result=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/",document.cookie="new_integrity_result="+e+"; expires="+n.toUTCString()+"; path=/",document.cookie="integrity_version=v3; expires="+n.toUTCString()+"; path=/"},_uploadIntegrityImage:function(e,t){e.toBlob(function(e){var i=new FormData;i.append("inputFile",e),$.ajax({url:NICE_DOMAIN.protocol+"://"+NICE_DOMAIN.hostname+"/files",type:"POST",data:i,processData:!1,contentType:!1}).done(function(e){t(e.url)}).fail(function(e){console.log("Failed to upload integrity image"),t("")})})},saveTransparencyResult:function(e){var t,i="3dCheck:transparencyFail",n=this;return 0==Helpers.App.isLoggedIn()&&Helpers.GlobalEventTracker.identifyNotLoggedUser(),t=function(e){Helpers.GlobalEventTracker.track(i,{eventCategory:Helpers.StageType._types[window._stageData.stage_data.image_type],eventAction:i,previewResult:e,isMobile:Helpers.App.isMobile(),integrityVersion:n.getIntegrityVersionCookie()||"v1"})},"function"!=typeof e.toBlob?void t(""):void this._uploadIntegrityImage(e,function(e){t(e)})},runTransparencyTest:function(){var e=engine.getTransformationsBounds(),t=!0;return console.log("Running transparency test"),e.forEach(function(e){var i=e.right-e.left,n=e.bottom-e.top;e.visible!==!1&&(0===i||0===n)&&(t=!1)}),console.log("Transparency test result: "+t),t},runIntegrity:function(e,t,i,n,s){var r,o,a=this,l=!0,c={};a.isRunning!==!0&&(a.isRunning=!0,console.log("Running integrity..."),r=function(e){var t=document.createElement("canvas"),i=t.getContext("2d");return t.width=e.naturalWidth,t.height=e.naturalHeight,i.drawImage(e,0,0,e.naturalWidth,e.naturalHeight,0,0,e.naturalWidth,e.naturalHeight),t},o=function(e,t,i){var n=.3,s=document.createElement("canvas"),r=s.width=i.right-i.left,o=s.height=i.bottom-i.top,a=e.getContext("2d"),l=t.getContext("2d"),c=l.getImageData(i.left,i.top,r,o),u=a.getImageData(i.left,i.top,r,o),d=s.getContext("2d"),h=d.createImageData(r,o),p={diffCanvas:s};return p.pixelDiff=pixelmatch(c.data,u.data,h.data,r,o,{threshold:n}),d.putImageData(h,0,0),p.pixelDiff>0?(p.passed=!1,p):(p.passed=!0,p)},e.noText=!0,n.niceImageRequest(e,function(e){var u,d,h=r(e),p=engine.getTransformationsBounds(),f=IntegrityCheck.runTransparencyTest();return f===!1?(n.reportTransparencyFail(t),void(a.isRunning=!1)):(p.forEach(function(e){if(e.visible!==!1){var i=o(h,t,e);i.passed===!1&&(u=i.diffCanvas,d=i.pixelDiff,l=!1)}}),c={passed:l,engineCanvas:t,fallbackCanvas:h,pixelDiff:d,diffCanvas:u},Helpers.GlobalEventTracker.track("3dCheck:validation",{eventAction:"3dCheck:validation",resultUrl:s,testPassed:c.passed,isMobile:Helpers.App.isMobile()}),a.setIntegrityResultCookie(c.passed),void(i&&(console.log("Integrity finished, result: "+l),a.isRunning=!1,i(c))))},function(e,t,i){a.isRunning=!1,Helpers.GlobalEventTracker.track("3dCheck:requestFail",{error:i})}))},getIntegrityVersionCookie:function(){return document.cookie.replace(/(?:(?:^|.*;\s*)integrity_version\s*\=\s*([^;]*).*$)|^.*$/,"$1")},saveIntegrityResult:function(e,t){var i,n,s,r,o,a=e.passed===!0?"3dCheck:log":"3dCheck:fail",l=this;return o=/(Windows NT 10.0; Win64; x64).*(Chrome\/)/.test(navigator.userAgent),0==Helpers.App.isLoggedIn()&&Helpers.GlobalEventTracker.identifyNotLoggedUser(),r=function(i,s){Helpers.GlobalEventTracker.track(a,{eventCategory:Helpers.StageType._types[window._stageData.stage_data.image_type],eventAction:a,integrityTestResult:i,fallbackResult:n,diffResult:s,pixelDiff:e.pixelDiff,resultUrl:t,testPassed:e.passed,isMobile:Helpers.App.isMobile(),integrityVersion:l.getIntegrityVersionCookie()||"v1"})},"function"!=typeof e.engineCanvas.toBlob?void r(""):e.passed!==!0||o?(l._uploadIntegrityImage(e.engineCanvas,function(e){i=e,s&&n&&r(i,s,n)}),e.diffCanvas?l._uploadIntegrityImage(e.diffCanvas,function(e){s=e,i&&n&&r(i,s,n)}):s=" ",void l._uploadIntegrityImage(e.fallbackCanvas,function(e){n=e,s&&i&&r(i,s,n)})):void r("")}}),Module("ColorPalettesSupport")({prototype:{_fullPalette:[["#000000","#171717","#2B2B2B","#3F3F3F","#565656","#6D6D6D","#848484","#A0A0A0","#B5B5B5","#C0C0C0","#CECECE","#DADADA","#E5E5E5","#F2F2F2","#FFFFFF"],["#EFDFE2","#EFE3E1","#EAE4DA","#E5E1D1","#EAE7D6","#E9EDDA","#DDEDE0","#E4EFEC","#DFEBED","#E3EDF2","#DFE3EF","#E3E1EF","#E9E2F2","#F2EAF4","#F4E6EE"],["#FED9DF","#FED5CB","#FEE6C2","#FFF2C3","#FFF9C9","#EEFEB2","#BFFECE","#BDFFF4","#B8F1FE","#B0E8FE","#CFDAFF","#DBD2FF","#E7CFFF","#F9D2FF","#FED0E9"],["#FFA4AF","#FFB297","#FFCF83","#FFE578","#FFF388","#F0F998","#9FFFB3","#A0F2E2","#7BE6FF","#7DD4FF","#B3C7FF","#BFB0FF","#D6ABFF","#F4A9FF","#FD9ED1"],["#FF5572","#FF8A66","#F4B460","#F2D86D","#FCE963","#E0F48C","#8EEF9D","#8FEAD9","#80D9E8","#5CC1FF","#7DA5FF","#9988FF","#B678FF","#EA83FF","#FD72CA"],["#F9354C","#F76943","#FFB133","#F2D455","#F9E535","#D1F746","#5DED6B","#61F2D9","#57D5EA","#39AAFF","#407BFF","#6B48FF","#915CF7","#D959EF","#FC46A8"],["#FF0013","#FF4800","#FFA300","#FFCE00","#FFEC00","#BBFF00","#00FF4E","#00FFDA","#00C9FF","#007AFF","#0031FF","#3E00FF","#8F00FF","#E600FF","#FC1681"],["#e2142d","#E24610","#E09722","#E2B80A","#EAC800","#B1E007","#00EA3D","#1FDBB7","#10BAE2","#0E78D8","#002EC1","#3636BA","#6F2EBC","#C813E2","#DE2386"],["#c1112f","#C13610","#C98B27","#C19D0A","#CCB409","#A2C914","#06C633","#1FB598","#14A9C1","#0068C6","#002A91","#2020B7","#5816B7","#B00ECC","#B8287C"],["#aa0b2d","#A52A0E","#AF761B","#8C7206","#A08E10","#85A317","#24AA3D","#1C8E78","#0096AF","#005A9E","#0B316D","#1212A0","#33048E","#8F15AD","#8F1F65"],["#820828","#841E0D","#723E00","#6B5600","#685D12","#66702E","#298939","#237061","#117A8C","#004466","#012354","#0E0E7F","#281868","#69187C","#712057"],["#560a22","#5E180E","#563610","#4F420B","#443F15","#3F4C11","#215127","#174940","#085663","#063244","#061D38","#16104C","#10064C","#440E51","#531342"]],_limitedPalette:[["#ffffff","#1d1d1d","#142649","#303538","#00a86b","#26306c","#f16b81","#a2a7ab","#74242e","#004b94","#e0a0b0","#263a31","#2c2c2c","#404040","#93bce4"],["#ad362d","#474747","#b72e6d","#c4beb2","#d6dbdd","#f6ab1b","#574b8b","#5b2534","#4b6b90","#0079a2","#008eb3","#a1e3bb","#336633","#c0e336","#f8f07c"],["#ffeb99","#d5b74f","#9c8e74","#3f2d1f","#f59c58","#e65a39"]],getFullPalette:function(){return $.extend(!0,[],this._fullPalette)},getFlattenFullPalette:function(){return this.getFullPalette().flat()},getLimitedColorsPalette:function(){return $.extend(!0,[],this._limitedPalette)},_getRamdomColor:function(e){var t=Math.floor(Math.random()*(e.length-1)+1),i=Math.floor(Math.random()*(e[t].length-1)+1);return e[t][i]},getFullPaletteRandomColor:function(){return this._getRamdomColor(this.getFullPalette())}}}),Module("LayerDataSupport")({_layerJSONDataCallbackExecuted:!1,prototype:{_getLayerJSONData:function(e,t){var i=this,n=!1,s=!1;this._layerJSONDataCallbackExecuted=!1;var r=[Helpers.App.getUserUploadsUrl(),e,"data.json"].join("/"),o=this._layerJSONDataCallback.bind(this,e,t);$.get(r).done(o).fail(function(t){s=!0,s&&n&&(404===t.status||403===t.status)&&i._jsonDataNotFound(e)}),$.get("/uploads/tmp/"+e+"/data.json").done(o).fail(function(t){n=!0,s&&n&&404===t.status&&i._jsonDataNotFound(e)})}}}),Module("StageControlsDestroySupport")({prototype:{clearTimeouts:function(){this._timeouts.forEach(function(e){clearTimeout(e)})},clearPopstateEventHandler:function(){window.removeEventListener("popstate",this._popstateHandler)}}}),Class("ColorPickerPosition")({prototype:{$colorpicker:null,$control:null,$dragAreas:null,$container:null,$horizontalLimit:null,$verticalLimit:null,sidebarSide:null,$toggleButtons:null,_containerPosition:null,$alignmentElement:null,init:function(e){this._isStagePage()&&!Helpers.App.isMobile()&&(this.$colorpicker=e.$colorpicker,this.$control=e.$control,this.$container=e.$container,this.$dragAreas=e.$dragAreas.add(this.$container.find(".dialog-topbar",".ic-drag")),this.$horizontalLimit=e.$horizontalLimit,this.$verticalLimit=e.$verticalLimit,this.sidebarSide=e.sidebarSide,this.$toggleButtons=e.$toggleButtons,this.$alignmentElement=e.$alignmentElement,this._bindEvents(),this._bindDragEvents(),this._setDefaultContainerPosition())},setSidebarSide:function(e){this.sidebarSide=e},_isStagePage:function(){return window.page&&window.page.isStagePage()},_bindEvents:function(){var e=this;this.$control.on("click touchstart",function(){e._setDefaultContainerPosition()}),this.$toggleButtons.bind("click.spectrum",function(){e._alignContainerVerticallyInsideBounds()}),this.$colorpicker&&this.$colorpicker.bind("reflow.spectrum",function(){e._restoreContainerPosition()}),$(window).resize(function(){e._alignContainerHorizontallyInsideBounds()})},_setDefaultContainerPosition:function(){return this.$alignmentElement?void this._alignWithElement(this.$alignmentElement):void(this.sidebarSide&&(this.$container.css("right","initial"),this["_"+this.sidebarSide+"EdgeAlign"](),this._alignContainerVerticallyToControl()))},_alignWithElement:function(e){var t=e.offset();this._setNewContainerPosition({top:t.top,left:t.left})},_restoreContainerPosition:function(){this._containerPosition&&this.$container.css(this._containerPosition)},_leftEdgeAlign:function(){var e=page.stage.leftSideBar.element;this._setNewContainerPosition({left:e.offset().left})},_rightEdgeAlign:function(){var e=page.stage.rightSideBar.element;this._setNewContainerPosition({left:e.offset().left+e.outerWidth()-this.$container.outerWidth()})},_alignContainerVerticallyToControl:function(){var e=this.$control.offset().top,t=this._getMovAreaBounds(!0).bottom,i=this._getMovAreaBounds(!0).top;e+this.$container.outerHeight()>t&&(e=t-this.$container.outerHeight()),i>e&&(e=i),this._setNewContainerPosition({top:e})},_alignContainerVerticallyInsideBounds:function(){var e=this._getElementBounds(this.$container),t=this._getMovAreaBounds(!0).bottom;e.bottom>t&&this._setNewContainerPosition({top:t-this.$container.outerHeight()})},_alignContainerHorizontallyInsideBounds:function(){var e=this._getElementBounds(this.$container),t=this._getMovAreaBounds(!0).right;e.right>t&&this._setNewContainerPosition({left:t-this.$container.outerWidth()})},_setNewContainerPosition:function(e){var t=this._containerPosition||{};e=$.extend({},t,e),this.$container.css(e),this._containerPosition=e},_bindDragEvents:function(){var e,t=this,i=!1;$(document).bind("mousedown",function(t){e=t.target}),this.$container.on("mousedown",function(e){if(2!=e.button&&t.$dragAreas.is(e.target)){i=!0,e.preventDefault();var n={x:e.pageX,y:e.pageY};$(document).bind("mousemove",function(e){var i={x:e.pageX,y:e.pageY},s=t._getNewPosition(n,i);t._setNewContainerPosition(s),n=i})}}),$(document).bind("mouseup",function(e){$(document).unbind("mousemove"),i&&(e.stopImmediatePropagation(),setTimeout(function(){i=!1},0))}),$(document).bind("click.spectrum",function(t){e!==t.target&&t.stopImmediatePropagation()}),this.$dragAreas.bind("click.spectrum",function(e){e.stopImmediatePropagation(),e.stopPropagation()})},_getNewPosition:function(e,t){var i=t.x-e.x,n=t.y-e.y,s=this._getElementBounds(this.$container),r=this._getMovAreaBounds(),o=this._getContainerOutOfBoundsSides(e,t);return o.top&&(n=r.top-s.top),o.bottom&&(n=r.bottom-s.bottom),o.left&&(i=r.left-s.left),o.right&&(i=r.right-s.right),t.y<r.top&&n>0&&(n=0),t.y>r.bottom&&0>n&&(n=0),t.x<r.left&&i>0&&(i=0),t.x>r.right&&0>i&&(i=0),{top:parseInt(this.$container.css("top"),10)+Math.floor(n),left:parseInt(this.$container.css("left"),10)+Math.floor(i)}},_getElementBounds:function(e){return{top:e.offset().top+parseInt(e.css("padding-top")),left:e.offset().left,right:e.offset().left+e.outerWidth(),bottom:e.offset().top+e.outerHeight()}},_getMovAreaBounds:function(e){var t=this._getElementBounds(this.$horizontalLimit),i=this._getElementBounds(this.$verticalLimit),n=$(window).scrollTop()+$(window).height(),s=e&&n<i.bottom?n:i.bottom;return{top:i.top,left:t.left,right:t.right,bottom:s}},_getContainerOutOfBoundsSides:function(e,t){var i=this._getElementBounds(this.$container),n=this._getMovAreaBounds(),s=t.x-e.x,r=t.y-e.y;return{top:i.top+r<n.top,left:i.left+s<n.left,right:i.right+s>n.right,bottom:i.bottom+r>n.bottom}}}}),Class("ColorpickerSharedColors")({RECENTLY_USED_COLORS_LIMIT:15,prototype:{_colors:null,_buttonsState:null,_timestampedRecentlyUsedColors:null,_recentlyUsedChanged:!1,init:function(){var e=this;this._colors={templateDefaults:[],recentlyUsed:[]},this._buttonsState={templateDefaults:{active:!1},recentlyUsed:{active:!1}},this.setRecentlyUsedColors(),$(window).bind("beforeunload",function(){e.saveRecentlyUsedColors()})},saveRecentlyUsedColors:function(){this._saveUserRecentlyUsed(),this._saveLocalRecentlyUsed()},setRecentlyUsedColors:function(){var e=this;this._getRecentlyUsed(function(t){e._timestampedRecentlyUsedColors=t||[],e._colors.recentlyUsed=t.map(function(e){return e.color})||[]})},setColor:function t(e,i){var n=this,s=this._colors[i],t={};t.templateDefaults=function(e){n._colorIsInColorCollection(e,s)||s.push(e)},t.recentlyUsed=function(e){var t=n._timestampColor(e);n._setTimestampedRecentlyUsedColor(t),n._colorIsInColorCollection(e,s)||(s.unshift(e),n._colors.recentlyUsed=s.filter(function(e){return this.map(function(e){return e.color}).indexOf(e)>=0},n._timestampedRecentlyUsedColors))},t[i](e)},getButtonState:function(e){return this._buttonsState[e].active},setButtonState:function(e,t){this._buttonsState[e].active=t},getColors:function(e,t){var i=this._colors[e];return t?i:i.filter(function(e){return"transparent"!==e})},_timestampColor:function(e){var t=new Date;return{color:e,timestamp:t.getTime()}},_colorIsInColorCollection:function(e,t){return-1!=t.indexOf(e)},_setTimestampedRecentlyUsedColor:function(e){var t=this._timestampedRecentlyUsedColors.map(function(e){return e.color}).indexOf(e.color);-1!=t&&this._timestampedRecentlyUsedColors.splice(t,1),this._timestampedRecentlyUsedColors.unshift(e),this._timestampedRecentlyUsedColors.length>this.constructor.RECENTLY_USED_COLORS_LIMIT&&(this._timestampedRecentlyUsedColors.length=this.constructor.RECENTLY_USED_COLORS_LIMIT),this._recentlyUsedChanged=!0},_getRecentlyUsed:function(e){var t=this,i=this._getLocalRecentlyUsed();return Helpers.App.getUser().email?void this._getUserRecentlyUsed(function(n){var s=$.merge(i,n||[]);s.sort(function(e,t){return t.timestamp-e.timestamp}),s=t._getUnique(s,"color"),s.length>this.constructor.RECENTLY_USED_COLORS_LIMIT&&(s.length=this.constructor.RECENTLY_USED_COLORS_LIMIT),e(s)}):void e(i)},_getUnique:function(e,t){var i=e.map(function(e){return e[t]}).map(function(e,t,i){return i.indexOf(e)===t&&t}).filter(function(t){return e[t]}).map(function(t){return e[t]});return i},_getLocalRecentlyUsed:function(){var e=null;return this._localStoreSupport()&&(e=window.localStorage.getItem("recentlyUsedColors")),JSON.parse(e)||[]},_getUserRecentlyUsed:function(e){return window._userRecentlyUsedColors?void e(window._userRecentlyUsedColors):void $.ajax({url:"/recently_used_colors",method:"GET"}).done(function(t){var i=t.recently_used_colors;if(i||i[0]){var n=JSON.parse(i[0]);e(n)}}).error(function(t){e()})},_saveUserRecentlyUsed:function(){Helpers.App.getUser().email&&this._recentlyUsedChanged&&$.ajax({url:"/recently_used_colors",method:"POST",data:"user[recently_used_colors]="+JSON.stringify(this._timestampedRecentlyUsedColors),context:this}).done(function(e){this._recentlyUsedChanged=!1})},_saveLocalRecentlyUsed:function(){var e=JSON.stringify(this._timestampedRecentlyUsedColors);this._localStoreSupport()&&window.localStorage.setItem("recentlyUsedColors",e)},_localStoreSupport:function(){var e="localStoreSupport";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(t){return!1}}}}),Class("SpectrumWrapper")({SHARED_COLORS_TYPES:["templateDefaults","recentlyUsed"],COLORS_TABS:["templateDefaults","recentlyUsed","swatches","custom"],prototype:{$colorpicker:null,$container:null,$toggleButton:null,$chooseButton:null,$dragger:null,$dragHelper:null,$pickerContainer:null,$tabsContainer:null,$paletteElements:null,$palette:null,$paletteContainer:null,$inputContainer:null,$spInput:null,$inputColorPreviewInner:null,$colorCircle:null,$popupContainer:null,$modal:null,$emptyState:null,spectrumConfig:null,limitedColors:null,colorIsTemplateDefault:null,_chooseButtonVisible:!1,_colorFromURLParams:null,_customDefaultColor:null,_colorpickerEventHandlers:{},_selectedTab:"templateDefaults",$control:null,closeCallback:null,_colorpickerSharedColors:null,_allowTransparency:!1,showRecentlyUsed:!1,keepModalOpenOnChange:!0,init:function(e){return e.standardBehavior?void e.$colorpicker.spectrum(e.spectrumConfig):(this.onCloseButtonClick=e.onCloseButtonClick||function(){},this.$colorpicker=e.$colorpicker,this.$popupContainer=e.$popupContainer,this.$modal=e.$modal,this.spectrumConfig=e.spectrumConfig,this.limitedColors=e.limitedColors,this.showRecentlyUsed=e.showRecentlyUsed||this._isStagePage(),this.keepModalOpenOnChange=e.keepModalOpenOnChange!==!1,this.colorIsTemplateDefault=e.colorIsTemplateDefault!==!1,this._colorpickerSharedColors=e.colorpickerSharedColors||page.stage.colorpickerSharedColors,this._allowTransparency=e.allowTransparency,this._setCustomDefaultColor(),this._configureSpectrum(),this.$container=this.$colorpicker.spectrum("container"),this.$control=e.$colorControl.find(".sp-replacer"),this.closeCallback=e.closeCallback,this.$toggleButton=this.$container.find(".sp-palette-toggle"),this.$chooseButton=this.$container.find(".sp-choose"),this.$dragger=this.$container.find(".sp-color"),this.$dragHelper=this.$container.find(".sp-dragger"),this.$pickerContainer=this.$container.find(".sp-picker-container"),this.$tabsContainer=$('<div class="tabs-container sp-cf">'),this.$paletteElements=this.$container.find(".sp-thumb-el"),this.$palette=this.$container.find(".sp-palette"),this.$paletteContainer=this.$container.find(".sp-palette-container"),this.$inputContainer=this.$container.find(".sp-input-container"),this.$spInput=this.$container.find(".sp-input"),this.$inputColorPreviewInner=$('<div class="input-color-preview-inner"></div>'),this.$colorCircle=$('<div class="color-circle"></div>'),this.$tabs={templateDefaults:$('<div class="picker-layout picker-active">Default</div>'),recentlyUsed:$('<div class="picker-layout picker-inactive">Recent</div>'),swatches:$('<div class="picker-layout picker-inactive">Colors</div>'),custom:$('<div class="picker-layout picker-inactive">Custom</div>')},this.$emptyState=$('<div class="recents-empty">                                    <i class="recent-fonts-icon"></i>                                    <div class="title">No recent swatches used yet</div>                                </div>'),this.$eyeDropperButtonTemplate='<button type="button" class="eyedropper-button">                                                <span class="p-icon eyedropper-icon"></span>                                            </button>',this._isMobile=Helpers.App.isMobile(),this.$container.addClass("new-color-picker"),this._removeButtonContainer(),this._appendChooseButtonToPicker(),this._appendColorCircleToPicker(),this._appendInputColorPreview(),this._prependTabsContainer(),this._prependEmptyState(),this.limitedColors||this._addTabs(),this._initializeState(),this._addTopbar(),Helpers.StageType.isSmartTemplate()===!0&&this._isStagePage()===!0&&(this.setEyeDropperButton(),this.$pickerContainer.addClass("has-eyedropper")),this._bindEvents(),void this._updateColorInputPreview())},_addTopbar:function(){var e=new UI.DialogTopbar({showDragIcon:!this._isMobile&&this._isStagePage()});this.$container.prepend(e.element),e.bind("close",function(){this.onCloseButtonClick(),this.$control.click(),"function"==typeof this.closeCallback&&this.closeCallback()}.bind(this))},_prependTabsContainer:function(){this.$container.prepend(this.$tabsContainer)},_prependEmptyState:function(){this.$paletteContainer.prepend(this.$emptyState)},_removeButtonContainer:function(){this.$container.find(".sp-palette-button-container").css("display","none")},_isStagePage:function(){return window.page&&window.page.isStagePage()},_setCustomDefaultColor:function(){this.colorIsTemplateDefault?(this._customDefaultColor=this.spectrumConfig.color.toLowerCase(),this._colorpickerSharedColors.setColor(this._customDefaultColor,"templateDefaults")):this._colorFromURLParams=this.spectrumConfig.color.toLowerCase()},_configureSpectrum:function(){var e=$.extend({},this.spectrumConfig,{hideAfterPaletteSelect:!0,clickoutFiresChange:!1,showSelectionPalette:!1,palette:this._getFullPalette(),showButtons:!0});this.$colorpicker.spectrum(e)},_appendChooseButtonToPicker:function(){this.$pickerContainer.append(this.$chooseButton),this.$chooseButton.hide()},_appendColorCircleToPicker:function(){this._isMobile&&(this.$pickerContainer.append(this.$colorCircle),this.$colorCircle.hide())},_appendInputColorPreview:function(){var e=$('<div class="input-color-preview"></div>');e.append(this.$inputColorPreviewInner),this.$inputContainer.append(e)},_addTabs:function(){this.showRecentlyUsed&&this.$tabsContainer.append(this.$tabs.recentlyUsed),this._isStagePage()&&this.$tabsContainer.append(this.$tabs.templateDefaults),this.$tabsContainer.append(this.$tabs.swatches),this.$tabsContainer.append(this.$tabs.custom)},_bindEvents:function(){var e=this;this._colorpickerEventHandlers={"dragstop.spectrum":function(t){e._repositionChooseButton(),e._hideColorCircle(),e._removePaletteClone(),e._showChooseButton()},"dragstart.spectrum":function(t){e._hideChooseButton(),e._showColorCircle(),e._placePaletteClone()},"change.spectrum":function(t){return e._updateColorInputPreview(),e.$container.is(":visible")?(e._hideChooseButton(),e._setRecentlyUsedColor(),void e._updatePalette()):void e._setcolorFromURLParams()},"show.spectrum":function(){e._updatePalette(),$(window).unbind("resize.spectrum")},"move.spectrum":function(){e._updateColorInputPreview(),e._repositionColorCircle()},"hide.spectrum":function(t){e._hideChooseButton(),e._updateColorInputPreview(),setTimeout(function(){e.$container.is(":visible")||e._colorpickerSharedColors.saveRecentlyUsedColors()},0)}},Object.keys(this._colorpickerEventHandlers).forEach(function(t){e.$colorpicker.bind(t,e._colorpickerEventHandlers[t])}),this.keepModalOpenOnChange===!0&&(this.$chooseButton.bind("click.spectrum",function(t){e.$colorpicker.spectrum("show")}),this.$palette.delegate(".sp-thumb-el","click.spectrum",function(){e.$colorpicker.spectrum("show")})),this.$toggleButton.bind("click.spectrum",function(t){e._updatePalette(),e._handleToggleButtonClick(),e._scrollPopupToBottom(),e._chooseButtonVisible&&e._showChooseButton()}),this.$spInput.on("change",function(){e.$spInput.hasClass("sp-validation-error")||(e._repositionChooseButton(),e._updateColorInputPreview(),e._showChooseButton())}),this.$spInput.bind("paste",function(){setTimeout(function(){e.$spInput.hasClass("sp-validation-error")||(e._repositionChooseButton(),e._updateColorInputPreview(),e._hideChooseButton(),e.setChooseButtonSelection())},1)}),this.constructor.COLORS_TABS.forEach(function(t){e.$tabs[t].click(function(){e._handleTabClick(t)})})},destroy:function(){var e=this;Object.keys(this._colorpickerEventHandlers).forEach(function(t){e.$colorpicker.unbind(t,e._colorpickerEventHandlers[t])}),this.$colorpicker.spectrum("destroy")},_placePaletteClone:function(){this.$paletteClone&&this.$paletteClone.remove(),this.$paletteClone=this.$palette.clone(),this.$paletteContainer.prepend(this.$paletteClone),this._isMobile&&this.$palette.hide(),this.$colorpicker.spectrum("option","palette",[])},_removePaletteClone:function(){this._isMobile&&this.$palette.show(),this._updatePalette(),this.$paletteClone.remove()},_showChooseButton:function(){this.$chooseButton.fadeIn(200),this._chooseButtonVisible=!0},_hideChooseButton:function(){this.$chooseButton.hide(),this._chooseButtonVisible=!1},_handleToggleButtonClick:function(){var e=this.$container.hasClass("sp-palette-only");e?this.$tabsContainer.append(this.$toggleButton):this.$inputContainer.append(this.$toggleButton),this.$toggleButton.hide()},_handleTabClick:function(e){this.$emptyState.css("display","none");var t=this._selectedTab;this._selectedTab=e,this.$tabs[t].removeClass("picker-active").addClass("picker-inactive"),this.$tabs[e].removeClass("picker-inactive").addClass("picker-active"),this._updatePalette(),"custom"!==e&&"custom"===t?(this.$toggleButton.click(),this.$container.removeClass("sp-picker-only").addClass("sp-palette-only")):"custom"===e&&"custom"!==t&&(this.$toggleButton.click(),this.$container.removeClass("sp-palette-only").addClass("sp-picker-only"))},_getActiveTabName:function(){return this.$tabs[this._selectedTab].text()},_initializeState:function(){this._isStagePage()?this._colorpickerSharedColors.getColors("recentlyUsed",this._allowTransparency).length>0?this._handleTabClick("recentlyUsed"):this._handleTabClick("templateDefaults"):this._handleTabClick("swatches")},_colorIsCustomDefault:function(e){return e.toLowerCase()===this._customDefaultColor},_updatePalette:function(){if("swatches"===this._selectedTab||"custom"===this._selectedTab||this.limitedColors)this.$colorpicker.spectrum("option","palette",this.spectrumConfig.palette);else{var e=this._colorpickerSharedColors.getColors(this._selectedTab,this._allowTransparency);this.$colorpicker.spectrum("option","palette",e),e.length||this.$emptyState.css("display","flex")}},_updateColorInputPreview:function(){this.$colorCircle.css("background-color",this.$spInput.val()),this.$inputColorPreviewInner.css("background-color",this.$spInput.val())},_scrollPopupToBottom:function(){if(this.$popupContainer&&this.$container.is(":visible")){var e=this.$modal||this.$container,t=e.outerHeight()-this.$popupContainer.outerHeight();this.$popupContainer.scrollTop(t)}},_getFullPalette:function(){if(this.limitedColors)return this.spectrumConfig.palette;var e=$.merge([],this.spectrumConfig.palette),t=e.push(this._getSelectionPalette());return this._colorFromURLParams&&!this._colorIsInPalette(this._colorFromURLParams,e)&&e[t-1].unshift(this._colorFromURLParams),e},_getSelectionPalette:function(){var e=[];return this._customDefaultColor&&!this._colorIsInPalette(this._customDefaultColor,this.spectrumConfig.palette)&&e.push(this._customDefaultColor),this._colorpickerSharedColors.getButtonState("templateDefaults")&&(e=e.concat(this._getColorsForPalette("templateDefaults"))),e=e.concat(this._getColorsForPalette("recentlyUsed")),this._getUniqueColors(e)},_getColorsForPalette:function(e){var t=this,i=this._colorpickerSharedColors.getColors(e);return i.filter(function(i){return"transparent"===i?!1:t._colorIsInPalette(i,t.spectrumConfig.palette)?!1:"recentlyUsed"===e?!0:!t._colorIsCustomDefault(i)})},_colorIsInPalette:function(e,t){for(var i=0;i<t.length;i++){var n=t[i].map(function(e){return e.toLowerCase()});if(n.indexOf(e.toLowerCase())>=0)return!0}return!1},_setRecentlyUsedColor:function(){this._colorpickerSharedColors.setColor(this._getCurrentHexColor(),"recentlyUsed")},_setcolorFromURLParams:function(){this._colorFromURLParams||(this._colorFromURLParams=this._getCurrentHexColor())},_getCurrentHexColor:function(){var e=this.$colorpicker.spectrum("get");if(e.toHexString){if(0===e._a)return"transparent";var t=e.toHexString();return t.toLowerCase()}},_repositionChooseButton:function(){var e=this._getElementPosition(this.$dragHelper),t=this._getElementPaddings(this.$pickerContainer),i=(this.$dragHelper.outerWidth()-this.$chooseButton.outerWidth())/2,n=this._getChooseButtonTopOffset(e,8,-10);e.top+=n+2*t.top,e.left+=i+2*t.left,e.left<0&&this._isMobile&&(e.left=0),this.$chooseButton.css(e)},_getElementPosition:function(e){return{top:parseInt(e.css("top"),10),left:parseInt(e.css("left"),10)}},_getElementPaddings:function(e){return{top:parseInt(e.css("padding-top"),10),left:parseInt(e.css("padding-left"),10)}},_getChooseButtonTopOffset:function(e,t,i){var n=this._getElementPaddings(this.$pickerContainer),s=e.top+n.top+this.$dragHelper.outerHeight()+this.$chooseButton.outerHeight()+t;return s>this.$pickerContainer.find(".sp-top-inner").outerHeight()-i?-t-this.$chooseButton.outerHeight():t+this.$dragHelper.outerHeight()},_repositionColorCircle:function(){var e=this._getElementPosition(this.$dragHelper),t=this._getElementPaddings(this.$pickerContainer),i=(this.$dragHelper.outerWidth()-this.$colorCircle.outerWidth())/2,n=-this.$colorCircle.outerWidth()-18;e.top+=n+2*t.top,e.left+=i+2*t.left,this.$colorCircle.css(e)},_showColorCircle:function(){this.$colorCircle.fadeIn(200)},_hideColorCircle:function(){this.$colorCircle.hide()},_getUniqueColors:function(e){var t={};return e.forEach(function(e){t[e]=!0}),Object.keys(t)},undelegateTouchStartEvents:function(){this.$palette.undelegate(".sp-thumb-el","touchstart.spectrum")},setEyeDropperButton:function(){this.$eyeDropperBtn=$(this.$eyeDropperButtonTemplate),this.$inputContainer.append(this.$eyeDropperBtn)},setChooseButtonSelection:function(){this.$chooseButton.click()}}}),Class(UI.SmartTemplate,"ColorControl").inherits(Widget).includes(BubblingSupport,GenericDestroySupport,ColorPalettesSupport,SkeletonCardSupport)({html:'        <div>            <label class="title"> Color </label>            <input class="colorpicker" value="#000000" type="text" />        </div>',elementClass:"color-control",prototype:{initialValue:null,_popstateHandler:null,_prefillColorTimeout:null,allowTransparency:!1,_alwaysOpen:!1,colorKey:"color",handleUrlParams:!0,isHistorySupportDisabled:!1,dispatchHideModal:!0,dispatchComponentOpen:!0,dispatchNotVisible:!0,dispatchShowModal:!0,keepModalOpenOnChange:!0,sendTrackingEvent:!0,init:function(e){var t=this;Widget.prototype.init.call(this,e),t.initialValue=this.getValue(),t.prefix=e.prefix||"",t.sidebarSide=e.sidebarSide||"",t.colorPickerUrlParameterName=e.urlParameterName||t.prefix+t.name,t.changeColorEventName=t.changeColorEventName||"colorChange",t.sendTrackingEvent=t.sendTrackingEvent!==!1,t.allowTransparency=e.allowTransparency,void 0===t.colorPickerPopupTopOffset&&(t.colorPickerPopupTopOffset=22),this.label&&""!=this.label?this.element.find("label.title").html(this.label):this.element.find("label.title").hide(),this.$colorpicker=this.element.find(".colorpicker"),this.$colorpicker.val(this.getValue()),this.$colorpicker.bind("change",function(e){var i=t.$colorpicker.spectrum("get"),n=0==i._a;n?t.allowTransparency?t.setValue(null):t.setValue("#FFFFFF"):t.setValue(i.toHexString()),t.isExtraColor&&t.dispatch("extracolorchanged",{originalDispatcher:t,color:t.getValue()})}),t._showSmartTemplateModal=t._showSmartTemplateModal.bind(t),t.$colorpicker.bind("reflow.spectrum",t._showSmartTemplateModal),t._changeColorHandler=t._changeColorHandler.bind(t),t.element.bind("change",t._changeColorHandler),this.previousValue=this.getValue()||"transparent";var i=e.isMobilePhone?"colorpicker-container-mobile":"colorpicker-container-background-color-control",n=null;if("1"==this.record.limited_colors?(n=this.getLimitedColorsPalette(),i+=" limited-colors"):n=this.getFullPalette(),this.colorPickerDataSet={preferredFormat:"hex",showPaletteOnly:!0,togglePaletteOnly:!e.isMobilePhone&&("0"==this.record.limited_colors||void 0===this.record.limited_colors),showInput:!0,allowEmpty:!1,clickoutFiresChange:!1,palette:n,color:this.previousValue,containerClassName:i,replacerClassName:e.isMobilePhone?"colorpicker-container-mobile":"colorpicker-container",hideAfterPaletteSelect:!0,appendTo:e.isMobilePhone?$("#smartTemplateModal .modal-body"):null,show:function(e){t._alwaysOpen!==!0&&(t.dispatchComponentOpen&&t.dispatch("componentOpen",{component:t.$colorpicker}),t._colorPickerPosition.setSidebarSide(t._identifySide()))},hide:function(i){return t.$colorpicker.spectrum("set",this.value),
t._alwaysOpen===!0?(t.$colorpicker.spectrum("show"),void t.dispatch("hideColor")):(t.previousValue&&t.previousValue.toLowerCase()!==this.value&&t.$colorpicker.trigger("change",{triggeredByUser:!0,originalDispatcher:t}),e.isMobilePhone&&t.dispatchHideModal&&t.dispatch("hideModal",{originalDispatcher:t}),t.dispatch("hideColor"),void(t.dispatchComponentOpen&&t.dispatch("componentOpen")))},change:function(){t.$colorpicker.trigger("change",{triggeredByPopState:!1,triggeredByUser:!0,originalDispatcher:t})}},this.colorPickerDataSet=$.extend({},this.colorPickerDataSet,this.spectrumOptions),this._spectrumWrapper=new SpectrumWrapper({$colorpicker:this.$colorpicker,spectrumConfig:this.colorPickerDataSet,limitedColors:"1"==this.record.limited_colors,standardBehavior:this.standardBehavior,$colorControl:this.element,closeCallback:this._boundHideEyeDropper,colorpickerSharedColors:this.colorpickerSharedColors,allowTransparency:this.allowTransparency,keepModalOpenOnChange:this.keepModalOpenOnChange,onCloseButtonClick:Utils.bindFn(this)(this.disableColorControlAlwaysOpen),showRecentlyUsed:this.showRecentlyUsed}),t._popstateHandler=function(e){if(t.isHistorySupportDisabled!==!0){var i=Helpers.App.getAllURLParams(),n=i[t.colorPickerUrlParameterName];"null"===n&&(n="rgba(0,0,0,0)"),t.$colorpicker.spectrum("set",n||t.initialValue||"#F1F1F1"),t.$colorpicker.trigger("change",{triggeredByPopState:!0})}},e.isMobilePhone&&this.element.find(".sp-replacer").unbind("touchstart"),this._boundEyeDropperEvent=this._dispatchEyeDropperActivate.bind(this),window.addEventListener("popstate",t._popstateHandler),Helpers.App.isMobile()===!1&&Helpers.StageType.isSmartTemplate()===!0&&Helpers.StageType.isStage()===!0&&this._spectrumWrapper.$eyeDropperBtn.bind("click",this._boundEyeDropperEvent),this._setColorPickerPositioning(),this.bindSkeleton(),e.prefillColor){var s=e.prefillColor;"null"===s&&(s="rgba(0,0,0,0)"),t._prefillColorTimeout=setTimeout(function(){t.$colorpicker.spectrum("set",s),t.skipDispatchChangeForPrefillColor&&t.setValue(t.prefillColor),t.$colorpicker.trigger("change",{triggeredByPopState:!0})},0)}else{var r=this.getValue(),o={triggeredByUser:!1,originalDispatcher:t,color:r};t._prefillColorTimeout=setTimeout(function(){t.dispatch("colorControlReady",o)},0)}},_changeColorHandler:function(e,t,i){var n=this,s=this.getValue(),r=t&&t.triggeredByPopState;i=t&&t.triggeredByUser;var o={triggeredByPopState:r,triggeredByUser:i,originalDispatcher:n,color:s},a=n.previousValue&&n.previousValue.toLowerCase();a!==s&&(n.record.visible===!1&&this.dispatchNotVisible===!0?n.dispatch("notVisible"):n.dispatch("change",o),!r&&n.handleUrlParams&&Helpers.App.replaceUrlParamWithHistory(n.colorPickerUrlParameterName,s),window._stageData&&n.sendTrackingEvent===!0&&Helpers.GlobalEventTracker.smartTemplateEvent(n.changeColorEventName,Object.assign({name:n.name,previous:n.previousValue,"new":s},Helpers.App.getProductShownData())),n.previousValue=s),n.dispatch("colorControlReady",o)},_showSmartTemplateModal:function(){var e=this;return e.isMobilePhone&&e.dispatchShowModal?e.dispatch("showModal",{originalDispatcher:e}):void 0},_identifySide:function(){for(var e=this.parent;e;){if("leftSideBar"===e.name)return"left";e=e.parent}return"right"},_setColorPickerPositioning:function(){var e=this.$colorpicker.spectrum("container"),t=this._identifySide(),i=$("#main-content-wrapper");this._boundHideEyeDropper=this._hideEyeDropper.bind(this),Helpers.StageType.isSmartTemplate()&&!Helpers.App.isMobile()&&(i=$(".smart-templates__sidebar."+t)),this._colorPickerPosition=new ColorPickerPosition({$colorpicker:this.$colorpicker,$control:this.element.find(".sp-replacer"),$container:e,$toggleButtons:e.find(".sp-palette-toggle"),$horizontalLimit:$("body"),$verticalLimit:i,$dragAreas:e.find(".sp-container, .sp-palette-container, .sp-picker-container, .show-colors-buttons-container").add(e),sidebarSide:t,closeCallback:this._boundHideEyeDropper,$alignmentElement:this.$alignmentElement})},_hideEyeDropper:function(){this.dispatch("hideColor")},updatePrefix:function(e){this.prefix=e,this.colorPickerUrlParameterName=this.prefix+this.name},refreshColorpicker:function(){var e=this,t=this.getValue();null===t&&(t="rgba(0,0,0,0)"),e.$colorpicker.spectrum("set",t)},destroy:function(){this.element&&(this.$colorpicker.spectrum("destroy"),clearTimeout(this._prefillColorTimeout),window.removeEventListener("popstate",this._popstateHandler),this.genericDestroy())},callSpectrumWrapper:function(e){return this.$colorpicker.spectrum(e)},enableColorControlAlwaysOpen:function(){this._alwaysOpen=!0},disableColorControlAlwaysOpen:function(){this._alwaysOpen=!1},resetColorPickerPosition:function(){void 0!==this._colorPickerPosition&&this._colorPickerPosition._setDefaultContainerPosition()},_dispatchEyeDropperActivate:function(){var e=this;e.dispatch("eyedropper",{originalDispatcher:this})},setEyeDropperColor:function(e){this.$colorpicker.spectrum("set",e),this._spectrumWrapper._updateColorInputPreview(),this._spectrumWrapper.setChooseButtonSelection()},getUrlParamNames:function(){return[this.colorPickerUrlParameterName]},getValue:function(){return this.record[this.colorKey]},getActiveTabName:function(){return this._spectrumWrapper._getActiveTabName()},setValue:function(e){this.record[this.colorKey]=e},setColor:function(e){this.$colorpicker.spectrum("set",e),this.setValue(e),this.previousValue=e},setMobileBindings:function(){var e=this;e.element.find(".sp-replacer").unbind("touchstart"),e.element.find(".sp-replacer").unbind("touchstart.spectrum"),e.element.find(".sp-palette").undelegate(".sp-thumb-el","touchstart.spectrum"),Helpers.StageType.isSmartTemplate()===!0&&(e._boundEyeDropperEvent=e._dispatchEyeDropperActivate.bind(e),e._spectrumWrapper.$eyeDropperBtn.bind("click",e._boundEyeDropperEvent)),e.colorPickerDataSet.flat===!0&&(e.element.find(".sp-palette").delegate(".sp-palette-row-selection .sp-thumb-el","click",function(){e.$colorpicker.trigger("change")}),e.element.find(".sp-palette").delegate(".sp-palette-row .sp-thumb-el","click",function(){e.$colorpicker.trigger("change")}))},showModal:function(){this.$colorpicker.spectrum("show")},hideModal:function(){this.$colorpicker.spectrum("hide")},enable:function(){this.$colorpicker.spectrum("enable")},disable:function(){this.$colorpicker.spectrum("disable")}}}),Class(UI,"RemoteUrlModal").inherits(Widget)({html:'        <div class="modal" id="screenshotGrapper" tabindex="-1" role="dialog" aria-labelledby="screenshotGrappertageLabel" aria-hidden="true">          <div class="modal-dialog">            <div class="modal-content">              <div class="modal-header">                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                <h4></h4>                <p class="center"></p>              </div>              <div class="modal-body">                <form class="form-inline" role="form">                  <div class="input-group input-group-sm">                    <input class="form-control url-field" placeholder="http://..." value="http://">                    <span class="input-group-btn btn-group-sm">                      <input class="button primary submit-btn" type="submit" value="Go">                    </span>                  </div>                </form>              </div>            </div>          </div>        </div>',prototype:{mainText:"",secondaryText:"",init:function(e){Widget.prototype.init.call(this,e),this.$form=this.element.find("form"),this.$title=this.element.find(".modal-header h4"),this.$pretitle=this.element.find(".modal-header p"),this.$textField=this.element.find(".url-field"),this.storedUrl="",this.updateTitle(this.mainText),this.updatePretitle(this.secondaryText),this.bindings()},destroy:function(){this.$form=null,this.$title=null,this.$pretitle=null,this.$textField=null,Widget.prototype.destroy.call(this)},bindings:function(){this.element.on("shown.bs.modal",function(){var e=this.getTextFieldValue().length;this.$textField.focus(),this.$textField[0].setSelectionRange(e,e)}.bind(this)),this.$form.on("submit",function(){return Helpers.App.isMobileDevice()&&document.activeElement.blur(),Helpers.StageType.isMultiStage()&&(this.storedUrl=this.$textField.val()),this.grabUrl(),!1}.bind(this))},grabUrl:function(){var e=this.$textField.val();e.length>0&&this.isValidURL(e)===!0?(e=this.getCleanedUpURL(e),this.$textField.val("http://"),this.dispatch("grab.remoteURL",e)):this.constructor.dispatch("url.invalid",'The URL "'+e+"\" doesn't seem to be valid! Please try again."),this.hide()},isValidURL:function i(e){var t=/[-a-zA-Z0-9.:]{1,256}\.[a-z0-9]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&!//=]*)/g,i=!1,n=e.match(t);return null!==n&&n.length>0&&(i=!0),i},getTextFieldValue:function(){return this.$textField.val()},updateTitle:function(e){return this.$title.text(e),this},updatePretitle:function(e){return this.$pretitle.text(e),this},show:function(){""!=this.storedUrl&&this.$textField.val(this.storedUrl),this.element.modal("show")},hide:function(){this.element.modal("hide")},getCleanedUpURL:function(e){var t,i=["http://http://","http://https://","https://http://","https://https://"],n=["http://","https://","http://","https://"];if(e.indexOf("http")>-1){for(var s=0;s<i.length;s++)e.indexOf(i[s])>-1&&(t=e.replace(i[s],n[s]));"undefined"==typeof t&&(t=e)}else t="http://"+e;return t}}}),Class(UI.SmartTemplate,"FileInputControl").inherits(Widget).includes(BubblingSupport,GenericDestroySupport)({html:'        <div class="form-group">            <label class="title file-upload-title"></label>            <div class="button composite-button">                <input class="form-control st-file-upload" accept=".jpg, .png, .jpeg" type="file" />                <label class="file-reposition-label button composite middle">                    <span class="p-icon p-sm crop-gray"></span>                    <div class="file-reposition-label__title">Resize</div>                </label>                <label class="file-upload-label button show-pixels-dimensions secondary composite">                    <span class="p-icon p-sm replace-gray"></span>                    <span class="file-upload-label__control-title"> Upload Image </span>                    <span class="file-upload-label__pixels-dimensions"></span>                </label>                <label class="file-delete-label button composite right">                    <span class="p-icon p-sm remove-gray"></span>                    <div class="file-delete-label__title">Remove</div>                </label>            </div>        </div>',elementClass:"input-file-control",prototype:{record:null,userImageFileName:null,userImagePath:null,buttonClass:null,previewThumb:null,hasPlaceholder:!0,placeholderThumbnail:"/assets/placeholder-thumbnail.png",transparentPixel:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII",$compositeButton:null,allowPlaceholderThumbnail:!1,init:function(e){var t=this;Widget.prototype.init.call(this,e),t.$compositeButton=this.element.find(".composite-button"),t.$label=this.element.find("label.title"),t.$file=this.element.find("input"),t.$fileLabel=this.element.find("label.file-upload-label"),t.$fileDeleteLabel=this.element.find("label.file-delete-label"),t.$fileRepositionLabel=this.element.find("label.file-reposition-label"),t.$fileButtonLabel=this.element.find("span.file-upload-label__control-title");var i=this.record.name;i=i.substr(i.lastIndexOf(".")+1),i=i.split("_").map(function(e){var t,i;return t=e[0].toUpperCase(),i=e.substr(1),t+i}).join(" "),t.$label.html(i),t.$file.attr("id","input"+t.name),t.$fileLabel.attr("for","input"+t.name),t.$fileDeleteLabel.hide(),t.$fileRepositionLabel.hide(),t.allowPlaceholderThumbnail===!0&&t.showPlaceholderThumbnail(),t.controlTitle=e.controlTitle||"Upload Image",t.$fileLabel.find("span.file-upload-label__control-title").html(t.controlTitle),this.insertPixelsDimensions(),t.bindings(),this.changeButtonClass()},bindings:function(){var e=this;e.$file.get(0).onclick=function(){e.dispatch("fileUploadClick"),this.value=null},e.bind("file.change",e.fileChangeHandler),e.$file.on("change",function(t){e.setFile(this.files[0])}),e.$fileDeleteLabel.on("click",function(){e.removeFile(),e.dispatch("removeFile")}),e.$fileRepositionLabel.bind("click",function(t){e.dispatch("repositionClicked",e)})},fileChangeHandler:function(){return this.file.size>this.maxSize?void page.flash("File is too big, maximum allowed is "+this.maxSize/1e3/1e3+" MB","alert",{autoclose:{milliseconds:5e3}}):this.acceptedFiles[this.file.type]?(this.dispatch("loading"),void(this.file&&this.dispatch("file.loaded"))):void alert("Invalid image file. Please upload only .png or .jpeg")},setFile:function(e){this.file=e,this.dispatch("file.change")},getFile:function(){return this.file},getFileInput:function(){return this.$file},getFileLabel:function(){return this.$fileLabel},getPixelDimensions:function(){return{width:this.record.width,height:this.record.height}},insertPixelsDimensions:function(){var e=this.getPixelDimensions();e.width&&e.height&&this.element.find(".file-upload-label__pixels-dimensions").text(e.width+"x"+e.height+"px")},removeFile:function(){var e=this;e.record.hash=null,e.record.layers[0].image=null,e.record.layers[0].visible=!1,e.file=null,e.hideDiscardButton(),e.hideRepositionButton(),e._hidePreviewThumb(),e.allowPlaceholderThumbnail===!0&&e.showPlaceholderThumbnail(),e.dispatch("file.unload")},changeButtonClass:function(){this.buttonClass&&(this.$fileLabel.hasClass("left")||this.$fileLabel.hasClass("has-placeholder")?(this.$fileLabel.removeClass(this.buttonClass),this.$fileLabel.addClass("secondary")):(this.$fileLabel.removeClass("secondary"),this.$fileLabel.addClass(this.buttonClass)))},showDiscardButton:function(){this.$fileDeleteLabel.show(),this.$fileLabel.addClass("left-spacing"),this.changeCompositeButtonClass(),this.allowPlaceholderThumbnail===!0&&this.hidePlaceholderRemovalOptions()},hideDiscardButton:function(){this.$fileDeleteLabel.hide(),this.$fileLabel.removeClass("left-spacing"),this.changeCompositeButtonClass()},showRepositionButton:function(){this.$fileRepositionLabel.show(),this.$fileLabel.addClass("left"),this.$fileLabel.addClass("left-spacing"),this.changeButtonClass(),this.changeCompositeButtonClass()},hideRepositionButton:function(){this.$fileRepositionLabel.hide(),this.$fileLabel.removeClass("left"),this.$fileLabel.removeClass("left-spacing"),this.changeButtonClass(),this.changeCompositeButtonClass()},hideFileButton:function(){this.$fileLabel.hide()},showFileButton:function(){this.$fileLabel.show()},disableUpload:function(){var e=this;e.$fileLabel.addClass("disabled"),e.$fileDeleteLabel.addClass("disabled"),e.$fileRepositionLabel.addClass("disabled"),e.$fileLabel.removeAttr("for")},enableUpload:function(){var e=this;e.$fileLabel.removeClass("disabled"),e.$fileDeleteLabel.removeClass("disabled"),e.$fileRepositionLabel.removeClass("disabled"),e.$fileLabel.attr("for","input"+e.name)},showLoader:function(){return this.$fileButtonLabel.addClass("ellipsing"),this},hideLoader:function(){return this.$fileButtonLabel.removeClass("ellipsing"),this},setLabelDragged:function(){var e=this;return e.$fileLabel.find("span.file-upload-label__control-title").fadeOut(500,function(){$(this).html("Drop File Here!").fadeIn(500)}),e},setLabel:function(e){this.$fileButtonLabel.text(e)},resetLabel:function(){var e=this;return e.$fileLabel.find("span.file-upload-label__control-title").fadeOut(500,function(){$(this).html(e.controlTitle).fadeIn(500)}),e},getLabel:function(){return this.$label.text()},triggerUpload:function(){this.$fileLabel.trigger("click")},triggerReposition:function(){this.$fileRepositionLabel.trigger("click")},triggerRemove:function(){this.$fileDeleteLabel.trigger("click")},destroy:function(){this.genericDestroy()},_createPreviewThumb:function(e){var t=this;this.previewThumb=new UI.ImageContainer({name:t.name+"-preview",imageURL:e,cssClass:"file-input-preview"}),t.appendChild(this.previewThumb),this.previewThumb.render(t.$compositeButton,!0)},_hidePreviewThumb:function(){this.previewThumb&&(this.previewThumb.hide(),this.element.removeClass("has-preview"))},_showPreviewThumb:function(){this.previewThumb&&(this.element.addClass("has-preview"),this.previewThumb.show())},updatePreviewThumb:function(e){var t=this;t.previewThumb?t.previewThumb.update(e):t._createPreviewThumb(e),t.element.addClass("has-preview"),t.previewThumb.show()},enableInputControl:function(){var e=this;e.$file.prop("disabled",!1)},disableInputControl:function(){var e=this;e.$file.prop("disabled",!0)},enablePixelDimensions:function(){var e=this;e.$fileLabel.addClass("show-pixels-dimensions")},disablePixelDimensions:function(){var e=this;e.$fileLabel.removeClass("show-pixels-dimensions")},showPlaceholderThumbnail:function(){this.updatePreviewThumb(this.placeholderThumbnail),this.$fileLabel.addClass("left-spacing has-placeholder"),this.changeButtonClass()},hidePlaceholderRemovalOptions:function(){this.$fileLabel.removeClass("left-spacing has-placeholder")},removePlaceholder:function(){this.record.layers[0].image=this.transparentPixel,this.record.layers[0].visible=!1,this.hasPlaceholder=!1,this.hidePlaceholderRemovalOptions(),this._hidePreviewThumb(),this.dispatch("change"),this.dispatch("removePlaceholder")},addPlaceholder:function(){this.record.layers[0].image=null,this.record.layers[0].visible=!0,this.hasPlaceholder=!0,this.showPlaceholderThumbnail(),this._showPreviewThumb(),this.dispatch("change"),this.dispatch("addPlaceholder")},changeCompositeButtonClass:function(){this.$compositeButton&&(this.$fileRepositionLabel.is(":visible")||this.$fileDeleteLabel.is(":visible")?this.$compositeButton.addClass("btn-group"):this.$compositeButton.removeClass("btn-group"))},getFileInputId:function(){return this.$file.attr("id")}}}),Class(UI.SmartTemplate,"URLInputControl").inherits(Widget).includes(BubblingSupport,GenericDestroySupport)({elementClass:"url-input-control",html:'        <div style="display: inline-block">            <label class="url-input-label button secondary">                <span> From URL </span>            </label>        </div>',prototype:{record:null,_popstateHandler:null,_pingScreenshotTimeout:null,init:function(e){Widget.prototype.init.apply(this,e),this.urlButton=this.element.find(".url-input-label"),this.name=e.name;var t=this;this.urlButton.on("click",function(e){t.remoteUrlModal.show()}),this.appendChild(new UI.RemoteUrlModal({name:"remoteUrlModal",mainText:"Grab Screenshot from URL"})),e.record.userAgent=e.userAgent||navigator.userAgent,this.remoteUrlModal.bind("grab.remoteURL",function(e){var i={url:e.data,targetName:t.record.name};t.dispatch("grabUrlStart"),t._loadFromUrl(i,t._loadFromUrlResponseHandler.bind(t,i)),t.hasUrl=!0}),this.record=e.record},_loadFromUrlResponseHandler:function(e,t,i){var n,s;return s=this,n=e.targetName,t?void this.dispatch("grabUrlFail",{message:t.message}):void this._getImageFromServer(i).then(function(e){return new File([e],"image.png",{type:"image/png"})}).then(function(e){s.dispatch("screenshotLoad",{file:e})})["catch"](function(e){s.dispatch("grabUrlFail",{message:"We could not save your image, please try again"}),Helpers.GlobalEventTracker.smartTemplateEvent("UploadFailUrlToPng",e)})},_getImageFromServer:function(e){return new Promise(function(t,i){var n=new XMLHttpRequest;n.open("GET",window.location.origin+e,!0),n.responseType="arraybuffer",n.onload=function(e){n.status>=200&&n.status<300?t(n.response):i(n.statusText)},n.onerror=function(){i(n.statusText)},n.send()})},_pingScreenshot:function(e,t,i){var n=this;$.ajax({method:"HEAD",url:e}).done(function(){i(null,e)}).fail(function(){Date.now()-t.startedOn>=t.stopAt?(n.dispatch("grabUrlFail"),i({message:"There was an error grabbing your screenshot"})):n._pingScreenshotTimeout=setTimeout(n._pingScreenshot.bind(n,e,t,i),1e3)})},_loadFromUrl:function(e,t){var i,n;i=this,n=this.record.viewport,i.$loader&&i.$loader.fadeIn(),$.post("/screenshots/create",{viewport:n,user_agent:i.record.userAgent,remote_url:e.url}).done(function(e){console.log(e);var n,s;n=45e3,s=Date.now(),i._pingScreenshot(e.path,{stopAt:n,startedOn:s},t)}).fail(function(e){t(e.responseJSON)})},hide:function(){this.element.hide()},show:function(){this.element.show()},disableUpload:function(){this.urlButton.addClass("disabled")},enableUpload:function(){this.urlButton.removeClass("disabled")},destroy:function(){clearInterval(this._pingScreenshotTimeout),window.removeEventListener("popstate",this._popstateHandler),this.genericDestroy()},showRemoteUrlModal:function(){this.remoteUrlModal.show()}}}),Class(UI.SmartTemplate,"CustomGraphicControl").inherits(Widget).includes(BubblingSupport,GenericDestroySupport,StageControlsDestroySupport,SkeletonCardSupport)({elementClass:"custom-graphic-control",STATE_FROM_FILE:"upload",STATE_FROM_URL:"from_url",STATE_FROM_DOWNLOADS:"from_downloads",STATE_FROM_RECENTLY:"from_recently",FOCUS_ANIMATION_DURATION:500,FOCUS_ANIMATION_CLASS:"wobble-vertical",DROPDOWN_OPTIONS:{removePlacholder:{label:"Remove this Image",cssClass:"remove-placeholder"},recentlyUploaded:{label:"Recently Uploaded",cssClass:"recently-uploaded"},uploadFromDevice:{label:"Upload From Your Device",cssClass:"upload-from-device"},importFromDownloads:{label:"Import from Downloads",cssClass:"import-from-downloads"},fromUrl:{label:"From URL",cssClass:"from-url"}},TEXT_INSERT_IMAGE:"Insert Image",TEXT_REPLACE_IMAGE:"Replace",TEXT_DROP_FILE:"Drop File Here!",prototype:{record:null,fileInputControl:null,id:null,userImageFilePath:null,pendingImageUrl:null,_popstateHandler:null,isMobilePhone:null,presetValue:null,$dropdownControl:null,_dropdownOptions:[],nextState:null,currentState:null,userDownloadsModal:null,controlTitle:null,thumbImageUrl:null,_tmpFile:null,fetchCustomAssetDataTask:null,init:function(e){var t=this;Widget.prototype.init.apply(this,e),this.prefix=e.prefix||"",this.name=this.prefix+e.name,this.urlParameterName=this.name,this.record=e.record,this.showPreview=e.showPreview,this.allowImportFromDownloads=e.allowImportFromDownloads,this.allowPlaceholderRemoval=e.allowPlaceholderRemoval,this.allowPlaceholderThumbnail=e.allowPlaceholderThumbnail,this.controlTitle=e.controlTitle,this.recentlyUploadedModal=e.recentlyUploadedModal,this.isMobilePhone=Helpers.App.isMobileDevice(),this.presetValue=this.record.layers.filter(function(e){return e.visible}).map(function(e){return e.image.split("/")[3]})[0];var i=this.isMobilePhone&&!e.record.viewport?"primary":null;this.fileInputControl=new UI.SmartTemplate.FileInputControl({name:e.name+"-file-input",acceptedFiles:e.acceptedFiles,isMobilePhone:e.isMobilePhone,maxSize:e.maxSize,record:e.record,controlTitle:e.controlTitle,buttonClass:i,allowPlaceholderRemoval:this.allowPlaceholderRemoval,allowPlaceholderThumbnail:this.allowPlaceholderThumbnail}),this.appendChild(this.fileInputControl),this.fileInputControl.render(this.element);var n=this.fileInputControl.$fileRepositionLabel;if(e.record.viewport&&(this.urlInputControl=new UI.SmartTemplate.URLInputControl({name:e.name+"Scr",record:e.record,userAgent:e.userAgent||navigator.userAgent}),this.appendChild(this.urlInputControl),this.urlInputControl.element.insertBefore(n),this.urlInputControl.urlButton.addClass("composite right"),this.fileInputControl.$fileLabel.addClass("composite left"),this.urlInputControl.bind("screenshotLoad",function(e){var i=e.data;this.id=i.id,t.nextState=UI.SmartTemplate.CustomGraphicControl.STATE_FROM_URL,t.hideDropdownControl(),t.fileInputControl&&(t.fileInputControl.file=i.file),e.stopPropagation(),this.dispatch("screenshotLoad",{file:i.file})}.bind(this))),this.fileInputControl.bind("removePlaceholder",function(){t._hidePlaceholderRemovalOption(),t.dispatch("customGraphicChange")}),this.fileInputControl.bind("addPlaceholder",function(){t._showPlaceholderRemovalOption(),t.dispatch("customGraphicChange")}),this.fileInputControl.bind("removeFile",function(){t.nextState=null,t.setState(!0),Helpers.App.replaceUrlParamWithHistory(this.urlParameterName,"")}.bind(this)),this._popstateHandler=this._popstateEventHandler.bind(this),window.addEventListener("popstate",this._popstateHandler),this.bindSkeleton(),this.addTapBinding(),this.setFileInputControlBindings(),this.allowImportFromDownloads&&this._setUserDownloadsModalInstance(),this.allowPlaceholderThumbnail&&this.element.addClass("has-placeholder"),(this.allowImportFromDownloads===!0||this.allowPlaceholderRemoval===!0)&&(this._buildDropdown(),this.fileInputControl.$compositeButton.addClass("primary")),Helpers.App.isRecentlyUploadedExperimentFixedVariantsActive()){var s=this,r=Utils.bindFn(s)(s._thumbnailSelectedHandler),o=Utils.bindFn(s.fileInputControl)(s.fileInputControl.triggerUpload);s._userImagesTabbedModalController=new Controller.UserImagesTabbedModal({targetName:s.name}),s._userImagesTabbedModalController.bind("thumbnail.selected",r),s._userImagesTabbedModalController.bind("click.emptyViewButton",o),s._userImagesTabbedModalController.bind("thumbnailDropArea.fileDropped",function(e){s.name===e.data.targetName&&s.setFile(e.data.file)}),s._userImagesTabbedModalController.bind("thumbnailDropArea.click",function(e){s.nextState=UI.SmartTemplate.CustomGraphicControl.STATE_FROM_FILE,s.fileInputControl.$fileLabel.trigger("click","from_submenu")}),s.bind("customGraphicCropError",function(){_removedWithRecentlyUploadedExperiment=!1});var a=[{label:"Upload From Your Device",value:s.constructor.STATE_FROM_FILE,cssClass:"upload-from-device"},{label:"Recently Uploaded",value:s.constructor.STATE_FROM_RECENTLY,cssClass:"recently-uploaded"},{label:"Import from Downloads",value:s.constructor.STATE_FROM_DOWNLOADS,cssClass:"import-from-downloads"}],l="custom-graphic-experiment-dropdown-"+s.name;s._dropdownSubmenu=new UI.SimpleDropdown({name:"dropdownSubmenu_"+s.name,cssOptionsContainer:l,label:"Menu",options:a}),$("."+l).addClass("custom-graphic-experiment-dropdown"),s._dropdownSubmenu.getElement().addClass("custom-graphic-experiment-dropdown");var c=s.fileInputControl.$fileLabel;Helpers.App.isMobile()&&(c=s.getElement().find(".file-input-preview")),s.appendChild(s._dropdownSubmenu).render(c),s._dropdownSubmenu.bind("selectoption",function(){t._removedWithRecentlyUploadedExperiment=!1;var e=s._dropdownSubmenu.getValue();e===UI.SmartTemplate.CustomGraphicControl.STATE_FROM_URL?t.urlInputControl.showRemoteUrlModal():e===UI.SmartTemplate.CustomGraphicControl.STATE_FROM_DOWNLOADS?t._activateTabbedModal(t.constructor.STATE_FROM_DOWNLOADS):e===UI.SmartTemplate.CustomGraphicControl.STATE_FROM_RECENTLY?t._activateTabbedModal(t.constructor.STATE_FROM_RECENTLY):(t.nextState=UI.SmartTemplate.CustomGraphicControl.STATE_FROM_FILE,t.fileInputControl.$fileLabel.trigger("click","from_submenu"))})}},_popstateEventHandler:function(){var e=this,t=this.getUrlParameter();if(this.fileInputControl.file=null,Helpers.App.isPinAssetEnabled()&&this.dispatch("changeByPopstate",{originalDispatcher:this,previousId:this.id,newId:t||this.presetValue}),t)this.fetchData(t).then(function(i){return e._layerJSONDataCallback(t,i)})["catch"](function(i){return"Cancelation Error"===i.message?void console.warn(i):void e._jsonDataNotFound(t)});else if(this.id){if(this.presetValue)return void this.fetchData(this.presetValue).then(function(t){return e._layerJSONDataCallback(e.presetValue,t)})["catch"](function(i){return"Cancelation Error"===i.message?void console.warn(i):void e._jsonDataNotFound(t)});this.removeFile(),this.setDefaultState()}},setDefaultState:function(){this.fileInputControl.show(),this.urlInputControl&&this.urlInputControl.show(),this.showDropdownControl()},setUrlParameter:function(e){return Helpers.App.replaceUrlParamWithHistory(this.urlParameterName,e),Helpers.GlobalEventTracker.smartTemplateEvent("customGraphicChange",Helpers.App.getProductShownData()),this},getUrlParameter:function(){var e,t;return e=Helpers.App.getAllURLParams(),t=e[this.urlParameterName]},checkUrlParams:function(){var e,t,i=this;if(e=this.getUrlParameter(),t=e||this.presetValue,t&&Utils.isValidURL(t)===!1)this.fetchData(t).then(function(e){return i._layerJSONDataCallback(t,e)})["catch"](function(e){return"Cancelation Error"===e.message?void console.warn(e):void i._jsonDataNotFound(t)})["finally"](function(){i.dispatch("customGraphicReady",i)});else{if(this.id)return this.removeFile(),void this.setDefaultState();Promise.resolve().then(function(){i.dispatch("customGraphicReady",i)})}},_layerJSONDataCallback:function(e,t){t.cropped_image_url||(t.cropped_image_url=t.user_image_url),this.id=e,this.userImagePath=t.user_image_url,this.cropParams=t.crop_params,this.dispatch("graphicCropSuccess",{croppedImageUrl:t.cropped_image_url,customGraphicControl:this,triggeredByPopState:!0,id:e}),this.fileInputControl.showFileButton(),this.thumbImageUrl=t.thumbnail_url?t.thumbnail_url:t.cropped_image_url,this.updatePreviewThumb(),this.nextState=UI.SmartTemplate.CustomGraphicControl.STATE_FROM_FILE,this.setState(!0),this.dispatch("customGraphicChange"),Helpers.StageType&&Helpers.StageType.isSmartTemplate()&&this.dispatch("change",{originalDispatcher:this,croppedImageUrl:t.cropped_image_url,customGraphicControl:this,triggeredByPopState:!0,id:e})},_jsonDataNotFound:function(e){this.dispatch("customGraphicNotFound",{id:e}),this.dispatch("customGraphicChange")},showDiscardButton:function(){return this.fileInputControl.showDiscardButton()},showUrlDiscardButton:function(){return this.urlInputControl.urlButton.removeClass("right"),this.urlInputControl.showDiscardButton()},removeFile:function(){return this.userImagePath=null,this.id=null,this.fileInputControl.removeFile()},getRecordLayerImage:function(){return this.record.layers&&this.record.layers.length?this.record.layers[0].image:null},hideDiscardButton:function(){return this.fileInputControl.hideDiscardButton()},showRepositionButton:function(){return this.fileInputControl.showRepositionButton()},hideRepositionButton:function(){return this.fileInputControl.hideRepositionButton()},showFileButton:function(){this.fileInputControl&&this.fileInputControl.showFileButton()},hideFileButton:function(){return this.fileInputControl.hideFileButton()},disableUpload:function(){this.urlInputControl&&this.disableUploadByUrl(),this.disableDropdownControl(),this.disableUploadByFile()},enableUpload:function(){return this.urlInputControl&&(this.fileInputControl.$fileLabel.addClass("composite left"),this.enableUploadByUrl()),this.enableDropdownControl(),this.enableUploadByFile()},disableUploadByUrl:function(){this.urlInputControl.disableUpload()},enableUploadByUrl:function(){this.urlInputControl.enableUpload()},disableUploadByFile:function(){this.fileInputControl.disableUpload()},showLoader:function(){return this.isMobilePhone===!1?this:void this.fileInputControl.showLoader()},hideLoader:function(){return this.isMobilePhone===!1?this:void(this.fileInputControl&&this.fileInputControl.hideLoader())},enableUploadByFile:function(){this.fileInputControl.enableUpload()},setLabelDragged:function(){return this.$dropdownControl&&this.element.find(".custom-graphic-dropdown.bootstrap-select .dropdown-toggle .filter-option").fadeOut(500,function(){$(this).html(UI.SmartTemplate.CustomGraphicControl.TEXT_DROP_FILE).fadeIn(500)}),this.fileInputControl.setLabelDragged()},resetLabel:function(){this.$dropdownControl?(this.$dropdownControl.selectpicker("refresh"),this.setLabel(this.constructor.TEXT_REPLACE_IMAGE)):this.fileInputControl.resetLabel()},getLabel:function(){return this.fileInputControl.getLabel()},setFile:function(e){this.nextState=UI.SmartTemplate.CustomGraphicControl.STATE_FROM_FILE,this.fileInputControl.setFile(e)},getFile:function(){return this.fileInputControl.getFile()},getFileInput:function(){return this.fileInputControl.getFileInput()},hideUrlInputControl:function(){this.urlInputControl&&this.urlInputControl.hide()},updatePrefix:function(e){this.prefix=e,this.name=this.name.replace(/^\d+_/,e),this.urlParameterName=this.name},destroy:function(){this.$dropdownControl&&this.$dropdownControl.selectpicker("destroy"),this.clearPopstateEventHandler(),this.cancelFetchCustomAssetDataTask(),this.genericDestroy()},hasUpload:function(){return this.urlInputControl&&this.urlInputControl.hasUrl===!0?!0:this.thumbImageUrl||this.fileInputControl.getFile()?!0:!1},getLayerByName:function(e){return this.record.layers.filter(function(t){return t.name===e})[0]},getSelectedLayer:function(){return this.record.layers[0]},hasImage:function(){var e=this.getSelectedLayer();if("undefined"==typeof e)return!1;var t=e.image;return"string"==typeof t&&t.length>0?!0:!1},getReplacementArea:function(){var e=this.getSelectedLayer();return e?{name:e.name,x:e.x,y:e.y,width:e.width,height:e.height}:null},setTapHandler:function(e){
var t=function(){};"function"==typeof e&&(t=e),this._tapHandler=t},fetchData:function(e){this.cancelFetchCustomAssetDataTask();var t=P.cancelable(function(e){return CustomAsset.fetch(e)});return this.fetchCustomAssetDataTask=t(e),this.fetchCustomAssetDataTask},addTapBinding:function(){var e=this,t=Helpers.StageType.getStageData().category_name;this.isMobilePhone!==!1&&"Mockups"===t&&(e.setTapHandler(function(){}),e.bind("fileUploadClick",function(t){e._tapHandler(t),e.setTapHandler(function(){})}),e.bind("repositionClicked",function(t){e._tapHandler(t),e.setTapHandler(function(){})}),e.bind("removeFile",function(t){e._tapHandler(t),e.setTapHandler(function(){})}))},updatePreviewThumb:function(){var e,t;e=this,e.showPreview&&e.fileInputControl&&(t=e.getFile(),t?Helpers.Image.getBase64FromBlob(t).then(function(t){e.fileInputControl.updatePreviewThumb(t)})["catch"](function(){e.dispatch("updatePreviewThumb.fail")}):e.thumbImageUrl&&e.fileInputControl.updatePreviewThumb(e.thumbImageUrl))},setFileByUrl:function(e){var t=this,i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){if(200===this.status){var n=i.response,s=e.split("/").pop(),r=new File([n],s,{type:n.type});t.dispatch("setFileByUrl.success"),t.fileInputControl.setFile(r)}else t.dispatch("setFileByUrl.fail",{url:e})},i.onerror=function(){t.dispatch("setFileByUrl.fail",{url:e})},t.dispatch("setFileByUrl.start"),i.send()},showDropdownControl:function(){var e=this;e.$dropdownControl&&(e.fileInputControl.$fileLabel.addClass("composite left"),e.$dropdownControl.selectpicker("show"),e.hideUrlInputControl(),e.hideFileButton())},hideDropdownControl:function(){var e=this;e.$dropdownControl&&e.$dropdownControl.selectpicker("hide"),e.showFileButton()},enableDropdownControl:function(){var e=this;e.$dropdownControl&&(e.$dropdownControl.prop("disabled",!1),e.$dropdownControl.selectpicker("refresh"))},disableDropdownControl:function(){var e=this;e.$dropdownControl&&(e.$dropdownControl.prop("disabled",!0),e.$dropdownControl.selectpicker("refresh"))},_addDropdownOption:function(e,t,i){var n=this;void 0===i&&(i=null),n._dropdownOptions.push({label:e,callback:t,cssClass:i})},_buildDropdown:function(){var e,t,i,n,s,r;e=this,e.$dropdownControl&&e.$dropdownControl.selectpicker("destroy"),e._setDropdownOptions(),e.element.addClass("with-dropdown"),i=document.createElement("select"),i.classList.add("custom-graphic-dropdown"),r=e.constructor.TEXT_INSERT_IMAGE,e.fileInputControl&&(s=e.fileInputControl.getPixelDimensions(),r+='<span class="pixel-dimensions">'+s.width+"x"+s.height+"px</span>"),i.setAttribute("title",r),n=document.createElement("option"),n.setAttribute("value",""),n.setAttribute("disable","disable"),n.dataset.hidden=!0,i.append(n),e._dropdownOptions.forEach(function(e,t){n=document.createElement("option"),n.append(document.createTextNode(e.label)),n.setAttribute("value",t),null!==e.cssClass&&n.classList.add(e.cssClass),i.append(n)}),e.$dropdownControl=$(i),e.$dropdownControl.insertAfter(e.fileInputControl.$fileDeleteLabel),e.fileInputControl.$fileLabel.addClass("composite left"),Helpers.App.isMobile()&&(t=$('<div class="custom-graphic-dropdown-mobile-container"></div>'),$("body").append(t)),e.$dropdownControl.selectpicker({container:t?t:$("body"),dropupAuto:!0,mobile:!1}),e._setDropdownDropZone(),e.showDropdownControl();var o=e.fileInputControl.getElement().find(".button.composite-button:first"),a=Utils.bindFn(e)(e._recentlyUploadedExperimentClickHandler);o.bind("click",a),e.$dropdownControl.bind("change",function(){""!==$(this).val()&&(e._dropdownOptions[$(this).val()].callback(),$(this).find("option:selected").prop("selected",!1),e.$dropdownControl.selectpicker("val",""))})},_recentlyUploadedExperimentClickHandler:function(){var e=this;Helpers.App.isRecentlyUploadedExperimentActive(["C"])===!1||Helpers.App.isBrandkitPage()||Helpers.App.isLoggedIn()===!1||Helpers.StageType&&Helpers.StageType.isStage()===!1||(Boolean(Helpers.App.getUser().hasRecentlyUploadedImages)===!1?e.$dropdownControl.find("option:eq(2)").attr("disabled","disabled"):e.$dropdownControl.find("option:eq(2)").removeAttr("disabled"),Boolean(Helpers.App.getUser().hasUserDownloadsImages)===!1?e.$dropdownControl.find("option:eq(3)").attr("disabled","disabled"):e.$dropdownControl.find("option:eq(3)").removeAttr("disabled"),e.$dropdownControl.selectpicker("refresh"))},setLabel:function(e){this.fileInputControl&&this.fileInputControl.setLabel(e)},setFileInputControlBindings:function(){var e,t;e=this,t=e.fileInputControl.getFileLabel(),t.bind("click",function(i,n){if(Helpers.App.isRecentlyUploadedExperimentFixedVariantsActive()){var s=t.find(".file-upload-label__control-title"),r=(s.text()===e.constructor.TEXT_REPLACE_IMAGE||"Cropped!"===s.text())&&s.is(":visible");if(e.fileInputControl.enableInputControl(),r&&Boolean(n)===!1){if(e._dropdownSubmenu.$dropdown.find("option:selected").prop("selected",!1),i.preventDefault(),i.stopPropagation(),e._dropdownSubmenu.isOpen())return;e._dropdownSubmenu.getElement().find(".bootstrap-select .dropdown-toggle").trigger("click")}else-1!==navigator.userAgent.indexOf("Firefox")&&$("#input"+e.name+"-file-input").trigger("click")}else e.currentState===UI.SmartTemplate.CustomGraphicControl.STATE_FROM_URL?e.urlInputControl.showRemoteUrlModal():e.currentState===UI.SmartTemplate.CustomGraphicControl.STATE_FROM_DOWNLOADS?e.userDownloadsModal.activate():e.currentState===UI.SmartTemplate.CustomGraphicControl.STATE_FROM_RECENTLY?e._activateRecentlyUploadedModal():e.nextState=UI.SmartTemplate.CustomGraphicControl.STATE_FROM_FILE}),e.fileInputControl.bind("file.loaded",function(){e.hideDropdownControl()}),e.fileInputControl.bind("file.unload",function(){Helpers.App.isRecentlyUploadedExperimentFixedVariantsActive()&&(e._removedWithRecentlyUploadedExperiment=!0),Helpers.App.isPinAssetEnabled()&&(e.dispatch("assetRemoved",{originalDispatcher:e,id:e.id}),e.id=null),e.nextState=null,e.setState(!0),e._showPlaceholderRemovalOption()})},setState:function(e){var t,i,n;switch(t=this,e&&t.fileInputControl?t._tmpFile=t.fileInputControl.file:!e&&t.fileInputControl&&t._tmpFile&&(t.fileInputControl.file=t._tmpFile,t._tmpFile=null),e?(i=t.nextState,t.currentState=i):i=t.currentState,e&&i&&t.updatePreviewThumb(),i){case UI.SmartTemplate.CustomGraphicControl.STATE_FROM_FILE:if(t.fileInputControl&&(t.fileInputControl.enableInputControl(),t.fileInputControl.enablePixelDimensions()),n=void 0===t.controlTitle?t.constructor.TEXT_REPLACE_IMAGE:t.controlTitle,t.setLabel(n),Helpers.App.isRecentlyUploadedExperimentFixedVariantsActive()&&t._removedWithRecentlyUploadedExperiment){t._removedWithRecentlyUploadedExperiment=!1;break}t.hideUrlInputControl(),t.hideDropdownControl();break;case UI.SmartTemplate.CustomGraphicControl.STATE_FROM_URL:t._removedWithRecentlyUploadedExperiment=!1,t.setLabel(t.constructor.TEXT_REPLACE_IMAGE),t.hideUrlInputControl(),t.hideDropdownControl(),t.fileInputControl&&(t.fileInputControl.disableInputControl(),t.fileInputControl.disablePixelDimensions());break;case UI.SmartTemplate.CustomGraphicControl.STATE_FROM_DOWNLOADS:t._removedWithRecentlyUploadedExperiment=!1,t.setLabel(t.constructor.TEXT_REPLACE_IMAGE),t.hideUrlInputControl(),t.hideDropdownControl(),t.fileInputControl&&(t.fileInputControl.disableInputControl(),t.fileInputControl.disablePixelDimensions());break;case UI.SmartTemplate.CustomGraphicControl.STATE_FROM_RECENTLY:t._removedWithRecentlyUploadedExperiment=!1,t.setLabel(t.constructor.TEXT_REPLACE_IMAGE),t.hideUrlInputControl(),t.hideDropdownControl(),t.fileInputControl&&(t.fileInputControl.disableInputControl(),t.fileInputControl.disablePixelDimensions());break;default:t.fileInputControl&&(t.fileInputControl.enableInputControl(),t.fileInputControl.enablePixelDimensions()),n=void 0===t.controlTitle?t.constructor.TEXT_INSERT_IMAGE:t.controlTitle;var s=Helpers.StageType&&Helpers.StageType.isStage()&&Boolean(t._removedWithRecentlyUploadedExperiment)===!0;!s&&null!==i||"Cropped!"===t.fileInputControl.$fileLabel.find(".file-upload-label__control-title").text()||(t.nextState=t.constructor.STATE_FROM_FILE),t.setLabel(n);var r=t.name[t.name.length-1];t.fileInputControl.$fileLabel.attr("for","inputcustomG_"+r+"-file-input"),(s||(void 0===e||e===!0)&&null===i)&&(t.showUrlInputControl(),t.showDropdownControl())}},showUrlInputControl:function(){var e=this;e.urlInputControl&&(e.fileInputControl.$fileLabel.addClass("composite left"),e.urlInputControl.show())},_createUploadFromDeviceOption:function(){var e=this;e.fileInputControl&&e._addDropdownOption(e.constructor.DROPDOWN_OPTIONS.uploadFromDevice.label,function(){e.fileInputControl.triggerUpload()},e.constructor.DROPDOWN_OPTIONS.uploadFromDevice.cssClass)},_setDropdownOptions:function(){var e=this;e._dropdownOptions=[],Helpers.App.isRecentlyUploadedExperimentFixedVariantsActive()&&e._createUploadFromDeviceOption(),e.recentlyUploadedModal&&e._addDropdownOption(e.constructor.DROPDOWN_OPTIONS.recentlyUploaded.label,function(){Helpers.App.isRecentlyUploadedExperimentFixedVariantsActive()?e._activateTabbedModal(e.constructor.STATE_FROM_RECENTLY):e._activateRecentlyUploadedModal()},e.constructor.DROPDOWN_OPTIONS.recentlyUploaded.cssClass),Helpers.App.isRecentlyUploadedExperimentActive(["B","C","D"])===!1&&e._createUploadFromDeviceOption(),e.userDownloadsModal&&e._addDropdownOption(e.constructor.DROPDOWN_OPTIONS.importFromDownloads.label,function(){Helpers.App.isRecentlyUploadedExperimentFixedVariantsActive()?e._activateTabbedModal(e.constructor.STATE_FROM_DOWNLOADS):e.userDownloadsModal.activate()},e.constructor.DROPDOWN_OPTIONS.importFromDownloads.cssClass),e.urlInputControl&&(e.urlInputControl.hide(),e._addDropdownOption(e.constructor.DROPDOWN_OPTIONS.fromUrl.label,function(){e.urlInputControl.showRemoteUrlModal()},e.constructor.DROPDOWN_OPTIONS.fromUrl.cssClass)),e.allowPlaceholderRemoval===!0&&e._addDropdownOption(e.constructor.DROPDOWN_OPTIONS.removePlacholder.label,e.triggerRemovePlaceholder.bind(e),e.constructor.DROPDOWN_OPTIONS.removePlacholder.cssClass)},_setUserDownloadsModalInstance:function(){var e=this;e.userDownloadsModal=new UI.UserDownloadsModal({name:e.name+"_UserDownloadsModal"}),e.appendChild(e.userDownloadsModal),e._setUserDownloadsModalBindings()},_setUserDownloadsModalBindings:function(){var e=this;e.userDownloadsModal.bind("userDownloadItem.selected",function(t){e.nextState=UI.SmartTemplate.CustomGraphicControl.STATE_FROM_DOWNLOADS,e.userDownloadsModal.deactivate(),Helpers.PurchasesHelper.getDownloadPathById(t.data.id).then(function(t){e.setFileByUrl(t)})["catch"](function(){e.dispatch("stage.error",{message:"Couldn't import image, please try again",purchaseId:t.data.id})})})},_activateRecentlyUploadedModal:function(){var e=this;e.imageUrlFromRecently=null,e.recentlyUploadedModal.activate().then(function(t){e.nextState=UI.SmartTemplate.CustomGraphicControl.STATE_FROM_RECENTLY,e.recentlyUploadedModal.deactivate(),e.imageUrlFromRecently=t.imgUrl,e.setFileByUrl(t.imgUrl)})},hideInStage:function(){var e=this;e.removeFile(),e.nextState=null,e.setState(!0),Helpers.App.replaceUrlParamWithHistory(this.urlParameterName,"")},focus:function(){if(!Helpers.App.isMobile()){var e=this;e.element.addClass(e.constructor.FOCUS_ANIMATION_CLASS),setTimeout(function(){e.element.removeClass(e.constructor.FOCUS_ANIMATION_CLASS)},e.constructor.FOCUS_ANIMATION_DURATION)}},triggerUpload:function(e){e&&e.triggeredByFloatingBar&&(this.triggeredByFloatingBar=!0),this.fileInputControl.triggerUpload()},triggerRecentlyUploaded:function(e){e&&e.triggeredByFloatingBar&&(this.triggeredByFloatingBar=!0),this._activateRecentlyUploadedModal()},triggerReposition:function(){this.fileInputControl.triggerReposition()},triggerRemove:function(){this.fileInputControl.triggerRemove()},triggerAddPlaceholder:function(){this.fileInputControl.addPlaceholder()},triggerRemovePlaceholder:function(){this.fileInputControl.removePlaceholder()},getState:function(){var e=!0;return this.fileInputControl&&(e=this.getSelectedLayer().image!==this.fileInputControl.transparentPixel),{hasPlaceholder:e,hasImage:this.hasImage()===!0&&this.getSelectedLayer().visible===!0}},_getDropdownOptionByClass:function(e){var t,i;return t=this,null===t.$dropdownControl?null:(i=t.$dropdownControl.find("."+e),i.length?i:null)},_hidePlaceholderRemovalOption:function(){var e,t;e=this,t=e._getDropdownOptionByClass(e.constructor.DROPDOWN_OPTIONS.removePlacholder.cssClass),null!==t&&(t.hide(),e.$dropdownControl.selectpicker("refresh"))},_showPlaceholderRemovalOption:function(){var e,t;e=this,t=e._getDropdownOptionByClass(e.constructor.DROPDOWN_OPTIONS.removePlacholder.cssClass),null!==t&&(t.show(),e.$dropdownControl.selectpicker("refresh"))},_setDropdownDropZone:function(){var e,t;e=this,e.fileInputControl&&(t=e.element.find(".custom-graphic-dropdown.bootstrap-select .dropdown-toggle .filter-option"),t.length&&(t.addClass("drop-zone"),t.attr("data-drop-target-id",e.fileInputControl.getFileInputId())))},afterReady:function(){this.checkUrlParams()},cancelFetchCustomAssetDataTask:function(){null!==this.fetchCustomAssetDataTask&&(this.fetchCustomAssetDataTask.cancel(),this.fetchCustomAssetDataTask=null)},setOutputImage:function(e){var t=[Helpers.App.getUserUploadsUrl(),"output_images",e+".png"].join("/");this.pendingImageUrl=t,this.record.hash=e,this.record.layers[0].image=t,this.record.layers[0].visible=!0,this.nextState=UI.SmartTemplate.CustomGraphicControl.STATE_FROM_FILE,this.thumbImageUrl=t,this.updatePreviewThumb(),this.showDiscardButton(),this.showRepositionButton(),this.setState(!0),this.urlInputControl&&this.urlInputControl.hide()},getViewportDimensions:function(){return this.record.viewportDimensions?this.record.viewportDimensions:{width:this.record.width,height:this.record.height}},setImageUrl:function(e){this.record.url=e,this.record.layers[0].image=e,this.record.layers[0].visible=!0},getDropdownToggle:function(){return this.element.find(".custom-graphic-dropdown")},toggleDropdown:function(){this.element.find(".dropdown-toggle").click()},dropdownIsOpen:function(){return this.element.find(".custom-graphic-dropdown").hasClass("open")},setDropdownPosition:function(e){var t=$(".custom-graphic-dropdown.open"),i=t.find(".dropdown-menu").outerWidth(),n=e.left;i+n>window.innerWidth&&(n=window.innerWidth-i),$(".custom-graphic-dropdown.open").css({left:n+"px",top:e.top+"px"})},grabUrl:function(e){return e&&e.length>0&&this.dispatch("grabImageByURLStart",{url:e}),this},_thumbnailSelectedHandler:function(e){var t=this;return t.nextState=e.data.type,Boolean(e.data.id)===!1?(t.imageUrlFromRecently=e.data.src,void t.setFileByUrl(e.data.src)):void Helpers.PurchasesHelper.getDownloadPathById(e.data.id).then(function(e){t.setFileByUrl(e)})["catch"](function(){customGraphicControl.dispatch("stage.error",{message:"Couldn't import image, please try again",purchaseId:e.data.id})})},_activateTabbedModal:function(e){var t=this;return Helpers.App.isLoggedIn()===!1?void t._userImagesTabbedModalController._showSSOModal():t._userImagesTabbedModalController.tabbedModalExists()?void t._userImagesTabbedModalController.show().setState(e):void Promise.resolve(t._userImagesTabbedModalController.create()).then(function(){Helpers.App.isLoggedIn()!==!1&&Boolean(t._userImagesTabbedModalController)!==!1&&t._userImagesTabbedModalController.show().setState(e)})}}}),Class(Helpers,"Image")({getImageFromSrc:function(e){return new Promise(function(t,i){var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){t(n)},n.onerror=function(){i(new Error("Error loading image"))},n.src=e})},getCanvasFromImage:function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t},getBase64FromImage:function(e){return Helpers.Image.getCanvasFromImage(e).toDataURL("image/png")},getBase64FromSrc:function(e){return Helpers.Image.getImageFromSrc(e).then(Helpers.Image.getBase64FromImage)},getBase64FromBlob:function(e){return new Promise(function(t,i){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){t(n.result)},n.onerror=function(e){i(e)}})},getCanvasFromImageData:function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t},getImageDataFromImage:function(e){return Helpers.Image.getCanvasFromImage(e).getContext("2d").getImageData(0,0,e.width,e.height)},getImageDataFromSrc:function(e){return Helpers.Image.getImageFromSrc(e).then(Helpers.Image.getImageDataFromImage)},diffImageDatas:function(e,t,i,n){var s,r,o=document.createElement("canvas"),a=o.getContext("2d");return o.width=e.width,o.height=e.height,r=a.getImageData(0,0,e.width,e.height),s=pixelmatch(e.data,t.data,r.data,e.width,e.height,{threshold:i,includeAA:n}),a.putImageData(r,0,0),{score:s,result:o}},hasTransparency:function(e,t){var i,n,s,r,o,a,l,c,u,d,h=document.createElement("canvas"),p=h.getContext("2d");for(t=t||1024,i=e.width/t,n=e.height/t,s=0;n>s;s++)for(r=0;i>s;s++)for(a=s*t,l=r*t,c=Math.min(t,e.width-a),u=Math.min(t,e.height-l),h.width=c,h.height=u,p.drawImage(e,a,l,c,u,0,0,c,u),d=p.getImageData(0,0,c,u).data,o=0;o<d.length;o+=4)if(255!==d[o+3])return!0;return!1},crop:function(e){var t,i,n;return t=this,uploadData=e.uploadData,i=uploadData.userImage,n=Object.assign({},e),n.uploadData=void 0,CropResize.run(i,n).then(function(e){return CropResize.generateThumbnail(e).then(function(t){return{cropParams:n,userImage:i,thumbnail:t,croppedImage:e}})}).then(function(e){var t=new Promise(function(t,i){$.ajax({method:"POST",url:"/cropper/persist",data:JSON.stringify(e),processData:null,contentType:"application/json"}).done(function(e){t(e)}).fail(function(e,t,n){i(e.responseText)})});return{id:uploadData.id,user_image_filename:uploadData.userImageFilename,crop_params:e.cropParams,user_image_url:"".concat(e.userImage),cropped_image_url:"".concat(e.croppedImage),thumbnail_url:"".concat(e.thumbnail),persistCall:t}})}}),Class("ImageValidation")({JPEG_HEADER:"ffd8",PNG_HEADER:"89504e47",IMAGE_JPEG:"image/jpeg",IMAGE_PNG:"image/png",run:function(e){return ImageValidation.getRealMimeType(e).then(ImageValidation._validateMimeType)},getRealMimeType:function(e){return new Promise(function(t){var i,n,s="unknown",r="",o=ImageValidation._getDataFromBase64(e);for(i=ImageValidation._b64toUint8Array(o,0,4),n=0;n<i.length;n++)r+=i[n].toString(16);r.slice(0,4)===ImageValidation.JPEG_HEADER?s=ImageValidation.IMAGE_JPEG:r===ImageValidation.PNG_HEADER&&(s=ImageValidation.IMAGE_PNG),t({realMimeType:s,base64:e})})},_validateMimeType:function(e){return new Promise(function(t,i){var n=e.realMimeType;n!==ImageValidation.IMAGE_JPEG&&n!==ImageValidation.IMAGE_PNG&&i("Image mime type is not png or jpeg"),t(e)})},_b64toUint8Array:function(e,t,i){var n=atob(e).slice(t,i).split("");return new Uint8Array(n.map(function(e){return e.charCodeAt()}))},_getDataFromBase64:function(e){return e.split(",")[1]}}),Class("CropResize")({TILE_SIZE:1024,BLUR_THRESHOLD:2/3,BLUR_DOWNSAMPLE_THRESHOLD:.25,JPG_BLUR_FACTOR:.18,PNG_BLUR_FACTOR:.28,TRANSP_BLUR_FACTOR:.37,FAST_DOWNSAMPLE_THRESHOLD:.3,UNIT_SQUARE:new Float32Array([1,1,-1,1,1,-1,-1,-1]),_GL_CONFIGS:{alpha:!0,antialias:!1,depth:!1,stencil:!1},run:function(e,t){var i=new CropResize;return CropResize.downsampleInput(e,t).then(function(e){return i._cropResize(e.base64,e.params)})},resize:function(e,t,i){return ImageValidation.run(e).then(function(){return Helpers.Image.getImageFromSrc(e)}).then(function(n){var s=n.width,r=n.height;return CropResize.run(e,{converted:!0,srcX:0,srcY:0,srcW:s,srcH:r,dstX:0,dstY:0,dstW:t,dstH:i,inW:s,inH:r,outW:t,outH:i,scale:t/s})})},crop:function(e,t){var i=CropResize.convertParams(t),n=document.createElement("canvas");return n.width=i.outW,n.height=i.outH,ImageValidation.run(e).then(function(){return Helpers.Image.getImageFromSrc(e)}).then(function(e){return n.getContext("2d").drawImage(e,i.srcX,i.srcY,i.srcW,i.srcH,i.dstX,i.dstY,i.dstW,i.dstH),n.toDataURL("image/png")})},generateThumbnail:function(e){return Helpers.Image.getImageFromSrc(e).then(function(t){var i=t.width,n=t.height,s=i/n,r=110,o=Math.round(r/s);return CropResize.run(e,{converted:!0,srcX:0,srcY:0,srcW:i,srcH:n,dstX:0,dstY:0,dstW:r,dstH:o,inW:i,inH:n,outW:r,outH:o,scale:r/i})})},convertParams:function(e){var t,i,n,s,r,o,a,l,c,u,d,h;return e.converted?e:(e.x?(n=parseFloat(e.x),s=parseFloat(e.y),r=e.width,o=e.height,a=e["viewport[width]"],l=e["viewport[height]"]):(a=e.viewport.width,l=e.viewport.height,"width"===e.longer_side?(t=e.actual_width/a,i=e.new_width/a):(t=e.actual_height/l,i=e.new_height/l),n=e.left/i,s=e.top/i,r=e.actual_width/t*e.zoom,o=e.actual_height/t*e.zoom),c=r/e.actual_width,u={x:0,y:0,w:a,h:l},d={x:n,y:s,w:r,h:o},h=CropResize._getRectIntersection(u,d),{converted:!0,srcX:(h.x-n)/c,srcY:(h.y-s)/c,srcW:h.w/c,srcH:h.h/c,dstX:Math.round(h.x),dstY:Math.round(h.y),dstW:Math.round(h.w),dstH:Math.round(h.h),inW:e.actual_width,inH:e.actual_height,outW:a,outH:l,scale:c})},downsampleInput:function(e,t){var i,n,s,r=CropResize.convertParams(t),o=2,a=CropResize.FAST_DOWNSAMPLE_THRESHOLD;if(r.scale>a/2)return Promise.resolve({base64:e,params:r});for(;r.scale*o<a;)o*=2;return Helpers.Image.getImageFromSrc(e).then(function(e){return i=Helpers.Image.getCanvasFromImage(e),n=document.createElement("canvas"),s=n.getContext("2d"),n.width=i.width/o,n.height=i.height/o,s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="low",s.globalCompositeOperation="copy",s.drawImage(e,0,0,i.width,i.height,0,0,n.width,n.height),r.scale*=o,r.srcX/=o,r.srcY/=o,r.srcW/=o,r.srcH/=o,r.inW=n.width,r.inH=n.height,{base64:n.toDataURL("image/png"),params:r}})},_getRectIntersection:function(e,t){var i,n,s,r;return i=Math.max(e.x,t.x),n=Math.max(e.y,t.y),s=Math.min(e.x+e.w,t.x+t.w),r=Math.min(e.y+e.h,t.y+t.h),{x:i,y:n,w:s-i,h:r-n}},prototype:{_image:null,_canvas:null,_ctx:null,_glCanvas:null,_gl:null,_fb1:null,_fb2:null,_tex1:null,_tex2:null,_shaders:null,_programs:null,_cropResize:function(e,t){var i,n,s,r,o,a=this,l=CropResize.convertParams(t),c=Date.now();return 1===l.scale?CropResize.crop(e,l):ImageValidation.run(e).then(function(e){i=e}).then(function(){return Helpers.Image.getImageFromSrc(e)}).then(function(e){return a._image=e,a._initGL(l),n="image/jpeg"===i?!1:Helpers.Image.hasTransparency(e),s=a._getResizingStrategy(i,n,l.scale),r=a._getTiles(l,s),o=a._processTiles(r,s),a._cleanGL(),Helpers.GlobalEventTracker.track("clientCropResize",{eventAction:"clientCropResize",time:Date.now()-c,cropParams:l,isMobile:Helpers.App.isMobile()}),o})},_initGL:function(e){var t,i=document.createElement("canvas"),n=i.getContext("webgl",CropResize._GL_CONFIGS)||i.getContext("experimental-webgl",CropResize._GL_CONFIGS),s=document.createElement("canvas"),r=s.getContext("2d");n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.disable(n.SAMPLE_COVERAGE),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),n.activeTexture(n.TEXTURE0),n.clearColor(0,0,0,0),s.width=e.outW,s.height=e.outH,i.width=CropResize.TILE_SIZE,i.height=CropResize.TILE_SIZE,this._canvas=s,this._ctx=r,this._glCanvas=i,this._gl=n,this._fb1=n.createFramebuffer(),this._fb2=n.createFramebuffer(),this._tex1=this._createTexture(),this._tex2=this._createTexture(),this._shaders=[],this._programs=[],n.bindTexture(n.TEXTURE_2D,this._tex1),n.bindFramebuffer(n.FRAMEBUFFER,this._fb1),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this._tex1,0),n.bindTexture(n.TEXTURE_2D,this._tex2),n.bindFramebuffer(n.FRAMEBUFFER,this._fb2),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this._tex2,0),t=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t),n.bufferData(n.ARRAY_BUFFER,CropResize.UNIT_SQUARE,n.STATIC_DRAW)},_createTexture:function(){var e=this._gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},_processTiles:function(e,t){var i=this;return e.forEach(function(e){i._loadTileIntoTexture(e),t.forEach(function(t){t.draw(e)})}),this._canvas.toDataURL("image/png")},_getTiles:function(e,t){var i,n,s,r,o,a,l,c,u,d,h,p,f,m,g,v,b,y,_,w,C,S,T=[],k=e.scale;for(i=t.reduce(function(e,t){return Math.max(e,t.radius)},0)+2,1>k?(s=CropResize.TILE_SIZE,n=s-2*i,r=Math.floor(n*k),n=r/k,i=(s-n)/2,o=Math.ceil(e.dstW/r),a=Math.ceil(e.dstH/r)):(r=CropResize.TILE_SIZE,n=r/k,s=Math.ceil(n+2*i),o=Math.ceil(e.dstW/r),a=Math.ceil(e.dstH/r)),C=0;a>C;C++)for(c=C*r,d=Math.min(r,e.dstH-c),p=c/k,m=d/k,p+=e.srcY,c+=e.dstY,v=Math.max(0,Math.floor(p-i)),w=p-v,y=Math.min(s,e.inH-v),S=0;o>S;S++)l=S*r,u=Math.min(r,e.dstW-l),h=l/k,f=u/k,h+=e.srcX,l+=e.dstX,g=Math.max(0,Math.floor(h-i)),_=h-g,b=Math.min(s,e.inW-g),T.push({srcW:f,srcH:m,dstX:l,dstY:c,dstW:u,dstH:d,texX:g,texY:v,texW:b,texH:y,srcOffsetX:_,srcOffsetY:w});return T},_getResizingStrategy:function(e,t,i){var n,s=[];return i>1?[this._generateBicubicResize()]:(i<CropResize.BLUR_THRESHOLD&&(n=i<CropResize.BLUR_DOWNSAMPLE_THRESHOLD?this._generateDownsampleBlur.bind(this):this._generateBlur.bind(this),"image/jpeg"===e?s.push(n(this._calcBlurSigma(i,CropResize.JPG_BLUR_FACTOR))):t?s.push(n(this._calcBlurSigma(i,CropResize.TRANSP_BLUR_FACTOR))):s.push(n(this._calcBlurSigma(i,CropResize.PNG_BLUR_FACTOR)))),i>=CropResize.BLUR_DOWNSAMPLE_THRESHOLD&&s.push(this._generateBicubicResize()),s)},_calcBlurSigma:function(e,t){return t/e},_loadTileIntoTexture:function(e){var t=this._gl,i=document.createElement("canvas"),n=i.getContext("2d");i.width=e.texW,i.height=e.texH,n.globalCompositeOperation="copy",n.drawImage(this._image,e.texX,e.texY,e.texW,e.texH,0,0,e.texW,e.texH),t.bindTexture(t.TEXTURE_2D,this._tex1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)},_getGaussian:function(e){var t=e*e;return function(i){return 1/(Math.sqrt(2*Math.PI)*e)*Math.exp(-i*i/(2*t))}},_getGaussianKernel:function(e){var t,i=this._getGaussian(e),n=Math.max(Math.ceil(2*e),2),s=new Array(n+1),r=0;for(s[0]=i(0),r+=s[0],t=1;n>=t;t++)s[t]=i(t),r+=2*s[t];for(t=0;n>=t;t++)s[t]/=r;return{array:s,radius:n}},_generateBlur:function(e){var t,i=this._gl,n=this,s=this._getGaussianKernel(e),r=CropResizeShaders.vert1,o=CropResizeShaders.generateBlurFrag(s.array),a=this._initShaderProgram(r,o),l=i.getAttribLocation(a,"pos"),c=i.getUniformLocation(a,"direction"),u=i.getUniformLocation(a,"srcSize"),d=i.getUniformLocation(a,"invTexSize"),h=i.getUniformLocation(a,"offset"),p=i.getUniformLocation(a,"tex");return t=function(e){var t,s;for(i.useProgram(a),i.viewport(0,0,e.texW,e.texH),i.enableVertexAttribArray(l),i.vertexAttribPointer(l,2,i.FLOAT,!1,0,0),i.uniform2f(u,e.texW,e.texH),i.uniform2f(d,1/e.texW,1/e.texH),i.uniform2f(h,0,0),i.uniform1i(p,0),i.bindFramebuffer(i.FRAMEBUFFER,n._fb2),i.bindTexture(i.TEXTURE_2D,n._tex2),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.texW,e.texH,0,i.RGBA,i.UNSIGNED_BYTE,null),t=0;2>t;t++)s=t%2===0,i.bindFramebuffer(i.FRAMEBUFFER,s?n._fb2:n._fb1),i.clear(i.COLOR_BUFFER_BIT),i.bindTexture(i.TEXTURE_2D,s?n._tex1:n._tex2),i.uniform2fv(c,s?[1,0]:[0,1]),i.drawArrays(i.TRIANGLE_STRIP,0,4)},{draw:t,radius:s.radius}},_generateDownsampleBlur:function(e){var t,i=this._gl,n=this,s=this._getGaussianKernel(e),r=CropResizeShaders.vert1,o=CropResizeShaders.generateBlurFrag(s.array),a=this._initShaderProgram(r,o),l=i.getAttribLocation(a,"pos"),c=i.getUniformLocation(a,"direction"),u=i.getUniformLocation(a,"srcSize"),d=i.getUniformLocation(a,"invTexSize"),h=i.getUniformLocation(a,"offset"),p=i.getUniformLocation(a,"flip"),f=i.getUniformLocation(a,"tex");return t=function(e){var t,s,r,o,m,g;for(i.useProgram(a),i.enableVertexAttribArray(l),i.vertexAttribPointer(l,2,i.FLOAT,!1,0,0),i.uniform1i(f,0),i.bindTexture(i.TEXTURE_2D,n._tex2),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.dstW,e.texH,0,i.RGBA,i.UNSIGNED_BYTE,null),t=0;2>t;t++)s=t%2===0,r=s?[e.dstW,e.texH]:[e.dstW,e.dstH],o=s?[e.srcW,e.texH]:[e.dstW,e.srcH],m=s?[1/e.texW,1/e.texH]:[1/e.dstW,1/e.texH],g=s?[e.srcOffsetX,0]:[0,e.srcOffsetY],i.viewport(0,0,r[0],r[1]),i.uniform2fv(u,o),i.uniform2fv(d,m),i.uniform2fv(h,g),i.uniform1f(p,!s),i.bindFramebuffer(i.FRAMEBUFFER,s?n._fb2:null),i.clear(i.COLOR_BUFFER_BIT),i.bindTexture(i.TEXTURE_2D,s?n._tex1:n._tex2),i.uniform2fv(c,s?[1,0]:[0,1]),i.drawArrays(i.TRIANGLE_STRIP,0,4);n._ctx.drawImage(n._glCanvas,0,CropResize.TILE_SIZE-e.dstH,e.dstW,e.dstH,e.dstX,e.dstY,e.dstW,e.dstH)},{draw:t,radius:s.radius}},_generateBicubicResize:function(){var e,t=this._gl,i=this,n=CropResizeShaders.bicubicVert,s=CropResizeShaders.bicubicFrag,r=this._initShaderProgram(n,s),o=t.getAttribLocation(r,"pos"),a=t.getUniformLocation(r,"srcSize"),l=t.getUniformLocation(r,"invTexSize"),c=t.getUniformLocation(r,"offset"),u=t.getUniformLocation(r,"tex"),d=t.getUniformLocation(r,"flip");return e=function(e){t.useProgram(r),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),t.uniform1i(u,0),t.uniform1f(d,!0),t.uniform2f(c,e.srcOffsetX,e.srcOffsetY),t.uniform2f(a,e.srcW,e.srcH),t.uniform2f(l,1/e.texW,1/e.texH),t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,CropResize.TILE_SIZE-e.dstH,e.dstW,e.dstH),t.clear(t.COLOR_BUFFER_BIT),t.bindTexture(t.TEXTURE_2D,i._tex1),t.drawArrays(t.TRIANGLE_STRIP,0,4),i._ctx.drawImage(i._glCanvas,0,0,e.dstW,e.dstH,e.dstX,e.dstY,e.dstW,e.dstH)},{draw:e,radius:2}},_initShaderProgram:function(e,t){var i=this._gl,n=this._loadShader(i.VERTEX_SHADER,e),s=this._loadShader(i.FRAGMENT_SHADER,t),r=i.createProgram();if(i.attachShader(r,n),i.attachShader(r,s),i.linkProgram(r),this._shaders.push(n),this._shaders.push(s),this._programs.push(r),!i.getProgramParameter(r,i.LINK_STATUS))throw this._cleanGL(),new Error("Unable to initialize the shader program:\n"+i.getProgramInfoLog(r));return r},_loadShader:function(e,t){var i=this._gl,n=i.createShader(e);if(i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw this._cleanGL(),new Error("An error occurred compiling the shaders:\n"+i.getShaderInfoLog(n)+t);return n},_cleanGL:function(){var e=this._gl;this._shaders.forEach(function(t){e.deleteShader(t)}),this._programs.forEach(function(t){e.deleteProgram(t)}),e.deleteTexture(this.tex1),e.deleteTexture(this.tex2),e.deleteFramebuffer(this.fb1),e.deleteFramebuffer(this.fb2),window.WebGLMemoryEstimator&&WebGLMemoryEstimator.stopTrackingContext(this._gl),this._gl=null,this._glCanvas=null,this._ctx=null,this._canvas=null,this._image=null}}}),Class("ResizeIntegrityCheck")({_TEST_IMAGE_SRC:"/assets/crop-resize/integrity_test_{}.png",_ORIGINAL_SIZE:100,_TEST_SIZES:[80,300],_TEST_REPETITIONS:2,_DIFF_THRESHOLD:.2,_MAX_DIFF:0,_bannedBrowsers:[/(AppleWebKit\/).+(Version\/9\.[0-1]).+(Safari\/)/,/(Macintosh; Intel Mac OS X 10_11_6).*(Version\/(10|11)).*(Safari\/)/,/(Macintosh; Intel Mac OS X 10_11_6).*(Chrome\/)/,/(Windows NT 10).*(Edge\/18)/],_deviceWhitelist:[{brandRegex:new RegExp("SAMSUNG(?! ?Browser)|Maple |SC-(?:02[CH]|04E|01F)|N[57]100|N5110|N9100|S(?:CH|GH|PH|EC|AM|HV|HW|M)-|SMART-TV|GT-|Galaxy|(?:portalmmm|o2imode)/2.0 [SZ]|sam[rua]|vollo Vi86[);/ ]|(?:OTV-)?SMT-E5015|ISW11SC|SCV3[1-9]|404SC"),modelRegexes:[/(?:SAMSUNG[- ])?SM-N950|SCV37/,/(?:SAMSUNG[- ])?SM-N960/,/(?:SAMSUNG-)?SM-G892[AU]/,/(?:SAMSUNG-)?SM-G955[AFKLNPRTUVW0]|SCV35/,/(?:SAMSUNG-)?SM-G960[FNUWX0]|SCV38/,/(?:SAMSUNG-)?SM-G965[FNUWX0]|SCV39/,/(?:SAMSUNG-)?SM-G973/,/(?:SAMSUNG-)?SM-G975[0FUW]/]},{brandRegex:/Nexus|GoogleTV|Glass|CrKey[^a-z0-9]|Pixel Build|Pixel (?:XL|C|[23]|[23] XL)/,modelRegexes:[/Pixel 3 XL/,/Pixel 3/]},{brandRegex:new RegExp("(HW-)?(?:Huawei|Ideos|Honor[ _]?|(?:(?:AGS|AGS2|ALE|ALP|AMN|ANE|ARE|ATH|ATU|AUM|BAC|BAH|BG2|BGO|BKK|BKL|BLA|BLL|BLN|BND|BTV|CAG|CAM|CAN|CAZ|CHC|CHE[12]?|CHM|CLT|CMR|COL|COR|CPN|CRO|CRR|CUN|DIG|DIG|DLI|DRA|DUA|DUB|DUK|EDI|ELE|EML|EVA|EVR|FDR|FIG|FLA|FRD|GRA|HMA|HRY|HWI|H[36]0|INE|JAT|JDN2|JKM|JMM|JSN|KIW|KOB|KSA|LDN|LLD|LND|LON|LUA|LYA|MAR|MHA|MRD|MYA|NEM|NEO|NXT|PAR|PCT|PIC|PLE|PLK|POT|PRA|RIO|RNE|RVL|SCC|SCL|SEA|SHT|SLA|SNE|STF|STK|TAG|TIT|TNY|TRT|VCE|VEN|VIE|VKY|VNS|VOG|VTR|WAS|YAL|G(?:527|620S|621|630|735)|Y(?:221|330|550|6[23]5))-(?:[A-Z]{0,2}[0-9]{1,4}[A-Z]{0,2}?)|H1711|U(?:8230|8500|8661|8665|8667|8800|8818|8860|9200|9508))[);/ ])|hi6210sft|HRY-LX1MEB"),modelRegexes:[/VOG-AL00[);/ ]/]}],_appleDeviceWhitelist:{brandRegex:/(?:iTunes-)?Apple[ _]?TV|(?:Apple-|iTunes-)?(?:iPad|iPhone)|iPh[0-9],[0-9]|CFNetwork/,osVersionRegex1:/(?:CPU OS|iPh(?:one)?[ _]OS|iOS)[ _\/](\d+(?:[_\.]\d+)*)/,osVersionRegex2:/(?:Apple-)?(?:iPhone|iPad|iPod)(?:.*Mac OS X.*Version\/(\d +\.\d+) |; Opera)?/,
minOsVersion:12},_isMobileDeviceSupported:function(){var e=ResizeIntegrityCheck,t=navigator.userAgent;return e._deviceWhitelist.reduce(function(i,n){return i||e._isWhitelistedModel(t,n)},!1)||e._isWhitelistedAppleDevice(t)},_isWhitelistedModel:function(e,t){return t.brandRegex.test(e)&&t.modelRegexes.reduce(function(t,i){return t||i.test(e)},!1)},_isWhitelistedAppleDevice:function(e){var t,i,n;return this._appleDeviceWhitelist.brandRegex.test(e)?(t=e.match(this._appleDeviceWhitelist.osVersionRegex1),i=e.match(this._appleDeviceWhitelist.osVersionRegex2),n=t&&t[1]||i&&i[1],n?parseInt(n.slice(0,2),10)>=this._appleDeviceWhitelist.minOsVersion:!1):!1},runIfNeeded:function(){var e=new Date,t=$.cookie("resizeIntegrityCheckPassed");t?window.localCropper="true"===t:ResizeIntegrityCheck._run().then(function(t){window.localCropper=t,e.setTime(e.getTime()+18e5),$.cookie("resizeIntegrityCheckPassed",t,{expires:e})})},_run:function(){var e,t=ResizeIntegrityCheck,i=t._getSrcForSize(t._ORIGINAL_SIZE),n=t._TEST_SIZES,s=IntegrityCheck.isWebGLSupported();for(e=0;e<t._bannedBrowsers.length;e++)if(!navigator||t._bannedBrowsers[e].test(navigator.userAgent))return Helpers.GlobalEventTracker.track("resizeCheck:unsupportedBrowser",{eventAction:"resizeCheck:unsupportedBrowser"}),Promise.resolve(!1);if(Helpers.App.isMobile()&&!t._isMobileDeviceSupported())return Helpers.GlobalEventTracker.track("resizeCheck:mobileNotWhitelisted",{eventAction:"resizeCheck:mobileNotWhitelisted"}),Promise.resolve(!1);if(!s.result)return Helpers.GlobalEventTracker.track("resizeCheck:webglCapabilityFailed",{eventAction:"resizeCheck:webglCapabilityFailed"}),Promise.resolve(!1);for(e=1;e<t._TEST_REPETITIONS;e++)n=n.concat(n);return Helpers.Image.getBase64FromSrc(i).then(function(e){return t._pipe(n.map(function(i){return t._diffAgainstExpected.bind(null,e,i)}))([])}).then(t._evaluateResult)["catch"](function(e){return Helpers.GlobalEventTracker.track("resizeCheck:unknownError",{eventAction:"resizeCheck:unknownError",error:e}),!1})},_diffAgainstExpected:function(e,t,i){var n,s,r=ResizeIntegrityCheck,o=r._getSrcForSize(t);return Helpers.Image.getImageDataFromSrc(o).then(function(e){n=e}).then(function(){return CropResize.resize(e,t,t)}).then(function(e){return Helpers.Image.getImageDataFromSrc(e)}).then(function(e){return s=Helpers.Image.diffImageDatas(n,e,r._DIFF_THRESHOLD,!0),s.resized=Helpers.Image.getCanvasFromImageData(e),i.push(s),i})},_getSrcForSize:function(e){var t=ResizeIntegrityCheck;return t._TEST_IMAGE_SRC.replace("{}",e)},_evaluateResult:function(e){var t=ResizeIntegrityCheck,i=e.filter(function(e){return e.score>t._MAX_DIFF});return i.forEach(function(e){t._track(e)}),0===i.length},_track:function(e){var t,i,n=ResizeIntegrityCheck,s="resizeCheck:fail";Helpers.App.isLoggedIn()===!1&&Helpers.GlobalEventTracker.identifyNotLoggedUser(),n._uploadImage(e.result).then(function(i){return t=i,n._uploadImage(e.resized)}).then(function(n){i=n,Helpers.GlobalEventTracker.track(s,{eventAction:s,result:t,resized:i,score:e.score,isMobile:Helpers.App.isMobile()})})},_uploadImage:function(e){return new Promise(function(t,i){IntegrityCheck._uploadIntegrityImage(e,function(e){e?t(e):i()})})},_pipe:function(e){return function(t){return e.reduce(function(e,t){return e.then(t)},Promise.resolve(t))}}}),Class("CropResizeShaders")({vert1:"precision mediump float;\nattribute vec4 pos;\nvarying vec2 uv;\nuniform bool flip;\nuniform vec2 srcSize;\nuniform vec2 invTexSize;\nuniform vec2 offset;\nvoid main() {\n   gl_Position = pos;\n   uv = (pos.xy + 1.0) * 0.5;\n   if (flip) {\n	    uv.y = 1.0 - uv.y;\n   }\n   uv = (uv * srcSize + offset) * invTexSize;\n}",bicubicVert:"precision mediump float;\nattribute vec4 pos;\nvarying vec2 uv;\nuniform bool flip;\nuniform vec2 srcSize;\nuniform vec2 offset;\nvoid main(void) {\n    gl_Position = pos;\n    uv = (pos.xy + 1.0) * 0.5;\n    if (flip) {\n        uv.y = 1.0 - uv.y;\n    }\n    uv = uv * srcSize - 0.5 + offset;\n}",
// Copyright :copyright: 2014 Inigo Quilez
// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
bicubicFrag:"precision mediump float;\nuniform sampler2D tex;\nuniform vec2 invTexSize;\nvarying vec2 uv;\n#define SAM(a,b)  texture2D(tex, (i+vec2(a,b)+0.5) * invTexSize)\nvec4 ca = vec4(  21.0, -36.0,   0.0, 16.0 ) / 18.0;\nvec4 cb = vec4(  -7.0,  36.0, -60.0, 32.0 ) / 18.0;\nvec4 powers( float x ) { return vec4(x*x*x, x*x, x, 1.0); }\nvec4 spline( float x, vec4 c0, vec4 c1, vec4 c2, vec4 c3 )\n{\n    return c0 * dot( cb, powers(x + 1.0)) + \n        c1 * dot( ca, powers(x      )) +\n        c2 * dot( ca, powers(1.0 - x)) +\n        c3 * dot( cb, powers(2.0 - x));\n}\nvoid main() {\n    vec2 f = fract(uv);\n    vec2 i = floor(uv);\n    gl_FragColor = spline( f.y, spline( f.x, SAM(-1.0,-1.0), SAM( 0.0,-1.0), SAM( 1.0,-1.0), SAM( 2.0,-1.0)),\n                                spline( f.x, SAM(-1.0, 0.0), SAM( 0.0, 0.0), SAM( 1.0, 0.0), SAM( 2.0, 0.0)),\n                                spline( f.x, SAM(-1.0, 1.0), SAM( 0.0, 1.0), SAM( 1.0, 1.0), SAM( 2.0, 1.0)),\n                                spline( f.x, SAM(-1.0, 2.0), SAM( 0.0, 2.0), SAM( 1.0, 2.0), SAM( 2.0, 2.0)));\n}",generateBlurFrag:function(e){var t,i="precision mediump float;\nuniform sampler2D tex;\nuniform vec2 invTexSize;\nuniform vec2 direction;\nvarying vec2 uv;\nvoid main() {\n    vec4 color = vec4(0.0);\n    vec2 offset = direction * invTexSize;";for(i+="color += texture2D(tex, uv) * "+e[0].toFixed(8)+" ;\n",t=1;t<e.length;t++)i+="color += texture2D(tex, uv + "+t+".0 * offset) * "+e[t].toFixed(8)+";\n",i+="color += texture2D(tex, uv - "+t+".0 * offset) * "+e[t].toFixed(8)+";\n";return i+="gl_FragColor = color;\n}"}}),UI.RelatedTemplates={},Class(UI.RelatedTemplates,"SmartTemplateItem").inherits(Widget).includes(CleanRecordSupport,BubblingSupport,FetchLayersSupport,UiJsonSupport)({PROCESS_URL:{development:"https://smart-templates.us/api/v4/related_templates_jobs",staging:"https://smart-templates.us/api/v4/related_templates_jobs",production:"https://nicev2.placeit.net/api/v4/related_templates_jobs"},RELATED_INFO_URL:{development:"https://smart-templates.us/api/v4/related_templates_info",staging:"https://smart-templates.us/api/v4/related_templates_info",production:"https://nicev2.placeit.net/api/v4/related_templates_info"},prototype:{busy:!1,baseUrl:null,presetId:null,smartTemplateId:null,graphicId:null,niceCategoryId:null,query:null,uiJson:null,$loader:null,$image:null,placeholderSrc:null,$anchor:null,processUrl:null,engineCachedData:null,originalUiJSON:null,structureJSON:null,useFallbackProcessing:!1,strategyNotFound:!1,strategy:null,_processUniqueId:null,_processStartTime:null,pendingChanges:null,_firstRun:!0,onlyCaching:!1,didCaching:!1,isSafari:/^((?!chrome|android).)*safari/i,isApi:!1,init:function(e){Widget.prototype.init.call(this,e);var t=this;this.pendingChanges=null,this.uiJson=e.uiJson,this.processUrl=UI.RelatedTemplates.SmartTemplateItem.PROCESS_URL[window.environment],this.$loader=this.element.find(".loading-overlay"),this.$image=this.element.find("img.thumb-image"),this.placeholderSrc=this.$image[0]&&this.$image[0].src,this.$anchor=this.element.find("> a"),this.query=e.query,this.$loagingGif=this.element.find(".loading-gif");var i=this.element.prop("dataset");("true"===i.forceFallback||e.forceFallback===!0||window.forceRTFallback||"Mockups"===i.categoryName)&&(this.useFallbackProcessing=!0),this.isSafari.test(navigator.userAgent)===!0&&(this.useFallbackProcessing=!0),Helpers.App.isMobile()===!0&&(this.useFallbackProcessing=!0),this.useFallbackProcessing&&setTimeout(function(){t.dispatch("fallbackToRemoteProcess")},500),i.smartTemplateId&&(this.smartTemplateId=i.smartTemplateId.trim()),i.presetId&&(this.presetId=i.presetId),this.appendChild(new UI.Bookmark({name:"bookmark",element:this.element})),this.baseUrl=this.$anchor.data("href"),this._hideNlpItem(),this._bindings()},_bindings:function(){var e=this;e.bind("process",function(){e._showNlpLoader()})},_hideNlpItem:function(){this._firstRun&&this.isNlpEnabled===!0&&(this.$loagingGif.detach(),this.$loader.append('<div class="item-spinner"></div>'),this.$loader.addClass("nlp-loading"),this.element.addClass("first-run"))},_showNlpLoader:function(){this._firstRun&&this.isNlpEnabled===!0&&(this.element.removeClass("first-run"),this._firstRun=!1)},getRelatedTemplateData:function(){var e=this,t={preset_id:this.presetId,target_id:this.smartTemplateId};return e.isCustomExperience===!0?(t.strategy="input",t.source_ui_id="fake"):(t.category=this.uiJson.category,t.source_ui_id=this.uiJson.id),t},setStrategyNotFound:function(e){return this.strategyNotFound=e,this},updateRelatedTemplateInfo:function(e){var t=this;return t.strategy=e.strategy,t.originalUiJSON=e.target,"output"===t.strategy&&t.dispatch("outputFound"),t.pendingChanges&&(t.loadPreview(t.pendingChanges),t.pendingChanges=null),this},getRelatedTemplateInfo:function(){var e=this,t=UI.RelatedTemplates.SmartTemplateItem.RELATED_INFO_URL[window.environment],i={source_ui_json:this.uiJson,preset_id:this.presetId,target_id:this.smartTemplateId};e.isCustomExperience===!0&&(i.strategy="input",i.source_ui_json={id:"fake"}),$.ajax({url:t,method:"POST",data:JSON.stringify(i),contentType:"application/json",json:!0}).done(function(t){e.strategy=t.strategy,e.originalUiJSON=t.target,"output"===e.strategy&&e.dispatch("outputFound"),e.pendingChanges&&(e.loadPreview(e.pendingChanges),e.pendingChanges=null)}).fail(function(){e.strategyNotFound=!0})},_clearColors:function(e){var t=JSON.parse(JSON.stringify(e));return t.text.forEach(function(e){e.color=null}),t.graphic.forEach(function(e){e.color=null,e.layers=[]}),t.backgroundColor=null,t.defaultAssetColors=[],t},loadPreview:function(e){var t={shouldRun:!0,eventOrigin:this};return this.dispatch("beforeProcessTemplate",t),e.onlyCaching=this.onlyCaching,e.didCaching=this.didCaching,t.shouldRun?this.useFallbackProcessing===!0?void this._loadPreviewFromRemote(e):this.originalUiJSON||this.strategyNotFound?this.originalUiJSON&&this.originalUiJSON.forceReload===!0?void this._loadPreviewFromRemote(e):"output"===this.strategy?void this._loadPreviewFromRemote(e):this.strategyNotFound?void e():void this._loadPreviewFromIframe(e):void(this.pendingChanges=e):void e()},_loadPreviewFromRemote:function(e){var t,i,n;if(e.onlyCaching)return e.onlyCaching=!1,void e();if(t=this,i=t.lastChange,t.lastChange===t.lastProcess||null===t.smartTemplateId)return t.lastProcess=i,e();if(null==t.strategy&&"fake"!=t.uiJson.id)return t.lastProcess=i,e();this.toggleLoader(!0),this.dispatch("beforeProcess"),this._processUniqueId=Helpers.App.generateUid(),this._processStartTime=performance.now(),this.busy=!0,t.$image[0].dataset.busy=!0;var s=this.getCleanRecord(this.uiJson);"input"!==this.strategy||this.isCustomExperience||(s=this._clearColors(s)),this.graphicId&&s.graphic[0]&&(s.graphic[0].layer=this.graphicId),s.referrer=window.location.href,n={source_ui_json:s,target_id:this.smartTemplateId,preset_id:this.presetId},this.presetStrategy&&(n.strategy=this.presetStrategy),$.ajax({url:this.processUrl,method:"POST",data:JSON.stringify(n),contentType:"application/json",json:!0}).done(function(n){t.busy=!1,t.$image.on("load",function(){t.$image.off("load"),t.lastChange===i&&t.toggleLoader(!1),t.dispatch("process")}),t.$image.attr("src",n.previewImage.value),t.$image.length&&(t.$image[0].dataset.processed=!0,t.$image[0].dataset.busy=!1),t._setUrlParams(n),t._processStartTime=null,t._processUniqueId=null,t.lastProcess=i,t.dispatch("free"),t._setDesignPlan(n),e()}).fail(function(i){return i&&429===i.status?(console.log("Throttled! Awaiting 2 secs before retrying"),void setTimeout(function(){console.log("Retrying after throttle"),t._loadPreviewFromRemote(e)},2e3)):(t.busy=!1,t.$image[0].dataset.busy=!1,t.dispatch("process"),t.toggleLoader(!1),Helpers.GlobalEventTracker.noticeError("stItem:remoteProcessFail",{response:i.responseText,smartTemplateId:t.smartTemplateId,presetId:t.presetId}),void e())})},_setUrlParams:function(e){return this.isApi===!0?void this._setAPIUrlParams(e):void this._setDefaultUrlParams(e)},_setAPIUrlParams:function(e){if(this.$anchor.attr("href",this.baseUrl),e.customGraphic&&e.customGraphic[0]&&e.customGraphic[0].hash){var t=new Helpers.URL(this.$anchor[0].href);t.searchParams.set("customG_0",e.customGraphic[0].hash),this.$anchor[0].href=t.href}},_setDefaultUrlParams:function(e){var t=this,i=t.baseUrl,n=t._getUrlParams(e).replace("?","");if(n){var s=-1!==i.indexOf("?"),r=i+(s?"&":"?")+n;t.$anchor.attr("href",r)}},_loadPreviewFromIframe:function(e){var t,i=this,n=i.lastChange;if(i.lastChange===i.lastProcess||null===i.smartTemplateId)return i.lastProcess=n,e();t=function(t){return t?(i._processStartTime=performance.now(),e.onlyCaching||(i._processUniqueId=Helpers.App.generateUid(),i.busy=!0,i.$image[0].dataset.busy=!0,i.toggleLoader(!0)),e.lastChange=n,void i._handleMessageFromIframe(t,e)):void e()};IframePool.getInstance().get(t)},_handleMessageFromIframe:function(e,t){var i=e[0].contentWindow.wrapper;i||(e[0].wrapper=new e[0].contentWindow.SimpleEngineWrapper,i=e[0].wrapper),i.setErrorCallback(this._iframeFailCallback.bind(this,e,t)),i.setSmartTemplateId(this.smartTemplateId),i.setEnvironment(window.environment),this.structureJSON?this._onStructureFetched(e,i,t,this.structureJSON):i.fetchStructure(this.originalUiJSON&&this.originalUiJSON.size||"",this._onStructureFetched.bind(this,e,i,t))},_onStructureFetched:function(e,t,i,n){var s,r=JSON.parse(JSON.stringify(n));this.structureJSON=r,t._structureJSON=n,s=i.onlyCaching?this._initialCachingCallback.bind(this,e,t,i):this._requestIframeProcess.bind(this,e,t,i),t.bootstrap(this.originalUiJSON,this.engineCachedData,s,i.onlyCaching)},_removeCachedElementsFromDOM:function(){var e=this;e.engineCachedData&&e.engineCachedData.textures&&Object.keys(e.engineCachedData.textures).forEach(function(t){var i=e.engineCachedData.textures[t];i.parentNode.removeChild(i),e.engineCachedData.textures[t]=null}),e.engineCachedData&&e.engineCachedData.masks&&Object.keys(e.engineCachedData.masks).forEach(function(t){var i=e.engineCachedData.masks[t];i.parentNode.removeChild(i),e.engineCachedData.masks[t]=null})},_addNewCachedElementsToDOM:function(){var e=this;Object.keys(e.engineCachedData.textures).forEach(function(t){var i=e.engineCachedData.textures[t];i.classList.add("off-screen"),document.body.append(i)}),Object.keys(e.engineCachedData.masks).forEach(function(t){var i=e.engineCachedData.masks[t];i.classList.add("off-screen"),document.body.append(i)})},_initialCachingCallback:function(e,t,i,n,s){var r=this;this._removeCachedElementsFromDOM(),r.engineCachedData=s,r.engineCachedData._structureJSON=r.structureJSON,r.$image[0].dataset.busy=!1,r.busy=!1,this._addNewCachedElementsToDOM(),IframePool.getInstance().destroyIframe(e),console.log("Caching finish",this.smartTemplateId),i()},transferColors:function(e,t){var i,n,s,r,o,a;i=function(e){return(e||[]).filter(function(e){return e.visible===!0})},n=function(e,t){return t.filter(function(t){return t.name&&-1!==t.name.indexOf(e)})[0]},s=function(e,t){var s=i(e.layers)[0]||{},l=i(t.layers)[0]||{},c=n("Main",l.layers||[]);c&&(c.color=t.color),l.layers&&l.layers.forEach(function(e){var t=n(e.name,s.layers||[]);if(t)return void(e.color=t.color);if("Accent"===e.name){if(r&&r[0])return void(e.color=r[0]);if(a&&a.color)return void(e.color=a.color);if(o&&o[0])return void(e.color=o[0])}})},r=e.defaultAssetColors,o=t.defaultAssetColors,a=n("Accent Color",e.graphic),t.graphic.forEach(function(t,i){var n=UiJsonMap.findTag(t.tag,e.graphic)[0]||{};s(n,t)})},_requestIframeProcess:function(e,t,i,n){var s,r,o,a,l,c=this;s=this.engineCachedData?!1:!0,r=!0,o=JSON.parse(JSON.stringify(n)),a=this.getCleanRecord(this.uiJson),"input"!==this.strategy||this.isCustomExperience||(a=this._clearColors(a)),this.graphicId&&a.graphic[0]&&(a.graphic[0].layer=this.graphicId),this.setSelectedLayers(o.graphic),this.fetchLayers(a.graphic).then(function(){return l=UiJsonMap.map(this.strategy,a,o),this.fetchGraphicLayers(l.graphic).then(function(){return c.transferColors(a,l)}).then(function(){s&&this.presetId&&(r=!1),!s&&this.presetId&&i.didCaching&&(r=!1),this._sendFinishBootstrapOrProcessEvent("related-iframe-bootstrap:finish",s),t.process(l,this._iframeProcessCallback.bind(this,e,l,i),this._iframeFailCallback.bind(this,e,i),r)}.bind(this))}.bind(this))["catch"](function(e){throw e})},_iframeFailCallback:function(e,t){var i=this;i.engineCachedData=null,i.busy=!1,i.$image[0].dataset.busy=!1,i.dispatch("process"),IframePool.getInstance().destroyIframe(e),i.toggleLoader(!1),Helpers.GlobalEventTracker.noticeError("stItem:localProcessFail",{smartTemplateId:i.smartTemplateId,presetId:i.presetId}),t()},_iframeProcessCallback:function(e,t,i,n,s){var r,o,a;r=this,o=this.engineCachedData?!1:!0,a=i.lastChange,this._removeCachedElementsFromDOM(),r.engineCachedData=s,r.engineCachedData._structureJSON=r.structureJSON,this.$image.on("load",function(){r.$image.off("load"),r.lastChange===a&&r.toggleLoader(!1),r.dispatch("process")}),r.$image.attr("src",n),r.$image[0].dataset.processed=!0,r.$image[0].dataset.busy=!1,r._setUrlParams(t),r.busy=!1,r.$image.length&&(r.$image[0].dataset.processed=!0,r.$image[0].dataset.busy=!1),this._addNewCachedElementsToDOM(),this._sendFinishBootstrapOrProcessEvent("related-iframe-process:finish",o),Math.random()<.01&&this._sendResultingImageEvent(),this._processStartTime=null,this._processUniqueId=null,IframePool.getInstance().destroyIframe(e),i(),r.lastProcess=a,r.dispatch("free")},fallbackToRemoteProcess:function(){this.useFallbackProcessing=!0},setPlaceholderSrc:function(e){if(e.setDefaultPlaceHolder&&this.$image.attr("src",this.placeholderSrc),this.$anchor&&this.$anchor.length){var t=this.$anchor.data("href");t=Helpers.App.removeParam(e.customGraphicId,t),this.$anchor.attr("href",t)}this.$image.length&&(this.$image[0].dataset.processed=!1)},toggleLoader:function(e){e?(this.element.addClass("item-loading"),this.$loader.show()):(this.element.removeClass("item-loading"),this.$loader.hide())},_sendFinishBootstrapOrProcessEvent:function(e,t){var i=performance.now()-this._processStartTime,n=Math.random();n>.05||Helpers.GlobalEventTracker.track(e,{processId:this._processUniqueId,smartTemplateId:this.smartTemplateId,stageId:this.uiJson.id,timestamp:Date.now(),duration:i,strategy:this.strategy,isFirstRun:t,isCustomExperience:this.isCustomExperience})},_sendResultingImageEvent:function(){var e=this,t=function(t){Helpers.GlobalEventTracker.track("related-iframe-process:image-uploaded",{processId:e._processUniqueId,smartTemplateId:e.smartTemplateId,stageId:e.uiJson.id,timestamp:Date.now(),imageUrl:t,isCustomExperience:e.isCustomExperience})};if(this.engineCachedData&&this.engineCachedData._canvas){if("function"!=typeof this.engineCachedData._canvas.toBlob)return void t();this.engineCachedData._canvas.toBlob(function(e){var i=new FormData;i.append("inputFile",e),$.ajax({url:NICE_DOMAIN.protocol+"://"+NICE_DOMAIN.hostname+"/files",type:"POST",data:i,processData:!1,contentType:!1}).done(function(e){t(e.url)}).fail(function(e){console.log("Failed to upload resulting image"),t()})})}},_setDesignPlan:function(e){Helpers.App.isMerchPreviewEnabled()&&(this.designPlan=e)},getImageSrc:function(){return this.$image.attr("src")||this.$image[0].dataset.src},getCategory:function(){return this.element[0].dataset.categoryName},getTitle:function(){return this.element.find(".figure-title").text()},getStageUrl:function(){return this.$anchor.attr("href")},getId:function(){return this.element[0].dataset.stageId},getSmartTemplateId:function(){return this.element[0].dataset.smartTemplateId}}}),Module(UI.RelatedTemplates,"InfoSupport")({RELATED_INFO_URL:{development:"https://smart-templates.us/api/v4/related_templates_info",staging:"https://smart-templates.us/api/v4/related_templates_info",production:"https://nicev2.placeit.net/api/v4/related_templates_info"},RELATED_INFO_BATCH_URL:{development:"https://smart-templates.us/api/v4/related_templates_info_batch",staging:"https://smart-templates.us/api/v4/related_templates_info_batch",production:"https://nicev2.placeit.net/api/v4/related_templates_info_batch"},RETRIES:3,REQUEST_DELAY:500,prototype:{requestRelatedTemplatesInfo:function(e){var t=this,i={sources:t._buildRequestData(e)},n=UI.RelatedTemplates.InfoSupport.RELATED_INFO_URL[window.environment];window._pl_featureFlags.T22545===!0&&(n=UI.RelatedTemplates.InfoSupport.RELATED_INFO_BATCH_URL[window.environment]);var s={url:n,type:"post",data:JSON.stringify(i),dataType:"json",contentType:"application/json; charset=utf-8"};t._infoRetryableRequest(s,UI.RelatedTemplates.InfoSupport.RETRIES,UI.RelatedTemplates.InfoSupport.REQUEST_DELAY).then(function(i){t._updateSmartTemplateItemsData(e,i)})["catch"](function(i){t._handleInfoRequestError(i,e)})},_buildRequestData:function(e){return e.map(function(e){return e.getRelatedTemplateData()})},_infoRetryableRequest:function(e,t,i){var n=P.retryableDelayed(function(){return P.ajax(e)},t,i);return n()},_updateSmartTemplateItemsData:function(e,t){var i={};e.forEach(function(e){var t=e.getRelatedTemplateData();i[t.target_id+t.preset_id]=e}),t.targets.forEach(function(e){var t=i[e.target_id+e.preset_id];t&&t.updateRelatedTemplateInfo(e)})},_handleInfoRequestError:function(e,t){t.forEach(function(e){e.setStrategyNotFound(!0)}),window.page.flash("Oops! We're having difficulties processing your changes at this time, try again later.","warning",{autoclose:{milliseconds:PageController.NOTIFICATION_AUTODISMISS_TIME}})}}}),Class(UI.RelatedTemplates,"DownloadableSmartTemplateItem").inherits(UI.RelatedTemplates.SmartTemplateItem).includes()({DOWNLOAD_BUTTON:'<div class="smart-template-download-button">                    </div>',downloadTooltipContent:{normal:'            <div class="download-tooltip-content">                <div class="only-download">Click to download</div>            </div>'},LICENSE_ID:2,PLAN_ID:14,prototype:{stageId:null,designPlan:null,imageType:null,$downloadButton:null,purchaseURL:null,init:function(e){var t=this;UI.RelatedTemplates.SmartTemplateItem.prototype.init.call(this,e);var i=this.element.prop("dataset");this.stageId=i.stageId,this.imageType=i.imageType,this.$downloadButton=$(UI.RelatedTemplates.DownloadableSmartTemplateItem.DOWNLOAD_BUTTON),this.$downloadButton.on("click",t._clickDownloadHandler.bind(t)),this.figcaption=this.element[0].querySelector(".figcaption"),this.figcaption.append(this.$downloadButton[0]),Helpers.App.isMobile()===!1&&this.$downloadButton.popover({content:UI.RelatedTemplates.DownloadableSmartTemplateItem.downloadTooltipContent.normal,html:!0,container:"body",trigger:"hover",placement:function(e){return $(e).addClass("downloadable-popover"),"top"}})},_getPurchaseUrl:function(){return"/purchases/"+UI.RelatedTemplates.DownloadableSmartTemplateItem.PLAN_ID+"/"+UI.RelatedTemplates.DownloadableSmartTemplateItem.LICENSE_ID+"/smart_template_subscription"},_setDesignPlan:function(e){if(Helpers.App.isSubscriptionValid()&&this.uiJson.customGraphic.length>0){this.designPlan=this.getCleanRecord(e);var t=encodeURI(window.location.href);this.designPlan.referrer=t,this.showDownloadButton()}else this.designPlan=null,this.hideDownloadButton()},hideDownloadButton:function(){this.$downloadButton.hide(),this.element[0].classList.remove("downloadable")},showDownloadButton:function(){this.element[0].classList.add("downloadable"),this.$downloadButton.show()},_clickDownloadHandler:function(e){e.preventDefault(),e.stopPropagation(),Helpers.App.isSubscriptionValid()&&this._makeRequest()},_makeRequest:function(){var e,t,i=this;if(!this.stageId||!this.designPlan)return void i.dispatch("purchase.failed");var n="image",s={stage_id:this.stageId,designPlan:JSON.stringify(this.designPlan)};e=Helpers.App.getUrlParam("pod_subscription"),t=Helpers.App.getUrlParam("pod_id"),Utils.isValidURL(e)&&t&&(s.pod_subscription=e,s.pod_id=t);var r=EventTracker.info({type:"Purchase:success:"+n,data:{}});s.eventData=r;var o={url:this._getPurchaseUrl(),data:s,type:"POST",dataType:"json"};o=Helpers.RequestConfig.prepareConfig(o),$.ajax(o).done(function(e){Helpers.GlobalEventTracker.subscriptionDownloadFromGrid({stage_id:i.stageId,license_id:UI.RelatedTemplates.DownloadableSmartTemplateItem.LICENSE_ID,resolution_id:UI.RelatedTemplates.DownloadableSmartTemplateItem.PLAN_ID,thumb:i.placeholderSrc,imageType:i.imageType}),i.dispatch("purchase.success",{message:e.message||"success"})}).fail(function(e){e.responseJSON=e.responseJSON||{};var t=e.message||e.responseJSON.message||e.responseJSON.error;412===e.status&&Helpers.App.setSubscription(!1),i.dispatch("purchase.failed",{message:t,errorType:e.responseJSON.errorType})})},setPlaceholderSrc:function(e){UI.RelatedTemplates.SmartTemplateItem.prototype.setPlaceholderSrc.call(this,e),this.hideDownloadButton()}}}),Class(UI.RelatedTemplates,"SmartVideoItem").inherits(Widget).includes(CleanRecordSupport,BubblingSupport)({prototype:{$image:null,placeholderSrc:null,init:function(e){Widget.prototype.init.call(this,e),this.$image=this.element.find("img"),this.placeholderSrc=this.$image[0]&&this.$image[0].src,this.appendChild(new UI.Bookmark({name:"bookmark",element:this.element}))},loadPreview:function(e){e()},getRelatedTemplateInfo:function(){},setPlaceholderSrc:function(e){this.$image.attr("src",this.placeholderSrc)}}}),Class(UI,"BasePage").inherits(Widget)({supTitleHTML:"<sup>Ready Instantly!</sup>",prototype:{isTagPage:!1,isCategoryPage:!1,heroPushTimeout:null,youtubeAPILoaded:!1,youTubePlayer:null,bindFilter:!1,filterDropdown:null,detached:!1,$navbarMain:null,init:function(e){Widget.prototype.init.call(this,e),this.$window=$(window),this.$navbarMain=$(".navbar-main"),this.navbar=$(".navbar-container"),this.subNavbar=$(".navbar-container .sub-navbar"),this.windowHeight=this.$window.height(),this.elementParent=this.element.parent(),this.filterBar=this.element.find(".homepage-filter"),this.topFilterBar=this.element.find(".filters-top-bar"),this.mobileFilterBtn=this.filterBar.find(".dropdown-toggle"),this.mobileFilterInner=this.filterBar.find("ul.dropdown-menu.inner:not(#additional-tags):not(#additional-devices)"),this.desktopDropdown=this.filterBar.find(".dropdown-menu.open"),this.gridContainer=this.element.find(".gridalicious__grid-wrapper"),this.paginationElement=$(".pagination"),this.supTitleHTML=$(this.constructor.supTitleHTML),this.playerBtn=this.element.find(".intro-play-button"),this.linksIndexWrapper=this.element.find("#links-index"),this.loadingUI=function(){return!1},this.loadedUI=function(){return!1},this.filterBar.get(0)&&this.appendChild(new UI.Filters({name:"filters",element:this.filterBar})),this.topFilterBar.get(0)&&this.appendChild(new UI.TopFilters({name:"topFilters",element:this.topFilterBar})),this.filtersOff&&this.filterBar.hide(),this.paginationElement.get(0)&&this.appendChild(new UI.Pagination({name:"paginator",element:this.paginationElement}))},_bindings:function(){this.$window.resize(function(){this.windowHeight=this.$window.height(),this.checkOffsets()}.bind(this)),this.playerBtn.click(function(){this.showSignupForm()}.bind(this)),this.$window.scroll(function(){return this.checkOffsets(),!1}.bind(this))},hide:function(){return this.bindFilter=!1,this.detached=!0,this.element.detach(),this.thumbnailList&&(this.thumbnailList.stopCurrentProcess().clearData(),this.removeChild(this.thumbnailList)),document.getElementsByTagName("html")[0].style.overflow="",this},showSignupForm:function(){return this.isTagPage===!0?this:(this._handleHeroPush(),this)},hideSignupForm:function(){return this.isTagPage===!0?this:(this._handleHeroPush(),this)},playIntroVideo:function(){return this.isTagPage===!0?this:this},stopIntroVideo:function(){return this.isTagPage===!0?this:this},applyFiltered:function(e,t){return this.thumbnailList.renderThumbnailsByStages(e.matches),this.filterDropdown.setCountersByFilter(e.counts,t),this.showElementsInViewport().checkOffsets(),this},handleFilterOverflow:function(){this.classList.contains("open")?document.getElementsByClassName("page-container homepage")[0].classList.remove("filter-no-overflow"):document.getElementsByClassName("page-container homepage")[0].classList.add("filter-no-overflow")},createFilterBar:function(e){var t;return this.bindFilter=!0,null!==this.filterDropdown?this:(e.appendTo(this.filterBar),this.appendChild(new UI.FilterDropdown({name:"filterDropdown",element:e,type:"devices",hasAllOption:!0,areAllUnactive:!0})),this.filterDropdown.bind("sidebar:filter",function(e){var t=e.data;this._filterHandler(e),null!==this.linksIndexWrapper&&(t.types.length>0||t.devices.length>0||t.tags.length>0)&&(this.linksIndexWrapper.remove(),this.linksIndexWrapper=null),this.thumbnailList.resetConfig(t)}.bind(this)).refresh(),t=this.filterBar.find(".bootstrap-select").bind("scroll",function(e){return e.stopPropagation(),!1}).bind("mouseenter",function(){this.scrollTop+=0}),Helpers.App.isMobile()&&t.bind("mouseup",this.handleFilterOverflow),this.showElementsInViewport().checkOffsets(),this)},selectFilters:function(e){return this.bindFilter===!0&&e.length>0&&this.filterDropdown&&this.filterDropdown.selectOptionsForFilters(e).filter(),this},showAllThumbnails:function(){this.bindFilter===!0&&this.filterDropdown&&this.filterDropdown.selectAll().filter()},_filterHandler:function(e){return this.dispatch("sidebar:filter",e.data),this},_handleHeroPush:function(){return this.heroPushTimeout&&clearTimeout(this.heroPushTimeout),this.filterBar.addClass("hero-pushing"),this.heroPushTimeout=setTimeout(function(){this.showElementsInViewport().checkOffsets(),this.filterBar.removeClass("hero-pushing")}.bind(this),600),this},checkOffsets:function(){var e,t=62*$("#headerstrip.pride-month").is(":visible"),i=42*$("#headerstrip.july-fourth").is(":visible");e=0,Helpers.App.isMobile()||(e=this.$navbarMain.outerHeight()+t+i),Helpers.App.elementFixedOnScroll(this.filterBar,e);var n,s,r,o;n=0!==this.gridContainer.length?this.gridContainer.offset().top:0,r=n,o=0;var a=0;if(this.$window.width()<1024){r=0,s="relative";var l=n-$(window).scrollTop();l=0>l?0:l,a=Helpers.App.isIOSSafari()?this.$window.height()-l-85:this.$window.height()-l-this.mobileFilterBtn.outerHeight(!0)-20,this.mobileFilterInner.css("max-height",a)}else this.desktopDropdown.css("height","auto");return!1},showElementsInViewport:function(){return this},loadEllipsis:function(){var e,t;return document.querySelectorAll('[src="'+window._pl_clampPluginPath+'"]').length<1&&(e=document.createElement("script"),t=document.getElementsByTagName("head")[0],e.src=window._pl_clampPluginPath,t.appendChild(e)),this},showCouponText:function(){var e,t=$("#heading-title"),i=$("#heading-subtitle"),n=t.html(),s=i.html();return this.supTitleHTML.hide(),t.html('Pick from one of the stages below<span style="font-size: 0.6em;">\u2193</small>'),i.text("Your discount will be applied when you buy an image or subscription!"),e=function(){this.supTitleHTML.show(),t.html(n),i.html(s),this.body.off("scroll",e)}.bind(this),this.body.on("scroll",e),this}}}),Class(UI,"Filters").inherits(Widget).includes(BubblingSupport)({prototype:{init:function(e){Widget.prototype.init.call(this,e),this.$options=this.element.find("a.opt"),this.$clearFilters=this.element.find("a.clear-all-filters"),this.$sortByMixed=this.element.find("a.all"),this.$sortByNewest=this.element.find("a.new"),this.$sortByBestSelling=this.element.find("a.best-selling"),this.$sortByFree=this.element.find("a.free"),this.$mobileSelect=this.element.find(".mobile-filter-select"),this.$desktopSelect=this.element.find(".desktop-filter-select.filters-rest"),[this.$mobileSelect,this.$desktopSelect].forEach(function(e){$additionalTagsTrigger=e.find("#additional-tags-trigger"),$additionalTags=e.find("#additional-tags"),$additionalDevicesTrigger=e.find("#additional-devices-trigger"),$additionalDevices=e.find("#additional-devices"),this.setAdditionalTags($additionalTags,$additionalTagsTrigger),this.setAdditionalTags($additionalDevices,$additionalDevicesTrigger)}.bind(this)),this.bindings()},bindings:function(){var e=this;this.$mobileSelect.bind("keydown",function(e){e.stopPropagation()}),this.$options.bind("click contextmenu touchstart",function(t){var i=$(this).find("span");e.dispatch("filters:click",{key:"f_"+i.data("filter-by"),value:i.data("item-name"),heading:i.data("category-heading-id"),$anchor:$(this)}),t.stopPropagation()}),this.$clearFilters.bind("click",function(t){t.preventDefault(),t.stopPropagation(),e.clearFilters()}),this.$sortByMixed.bind("click",function(e){e.preventDefault(),e.stopPropagation(),this.requestFilter("mixed")}.bind(this)),this.$sortByNewest.bind("click",function(e){e.preventDefault(),e.stopPropagation(),this.requestFilter("newest")}.bind(this)),this.$sortByBestSelling.bind("click",function(e){e.preventDefault(),e.stopPropagation(),this.requestFilter("best-selling")}.bind(this)),this.$sortByFree.bind("click",function(e){e.preventDefault(),e.stopPropagation(),this.requestFilter("free")}.bind(this))},setAdditionalTags:function(e,t){var i,n,s;i=t.find(".dropdown-filters"),n=t.find("#title"),s=n.text().replace("More ",""),e.bind("show.bs.collapse",function(e){i.removeClass("dropdown-filters").addClass("dropup-filters"),n.html("Less "+s)}),e.bind("hide.bs.collapse",function(e){i.removeClass("dropup-filters").addClass("dropdown-filters"),n.html("More "+s)}),t.find("> a").bind("click",function(t){t.stopPropagation(),e.collapse("toggle")}),this.toggleAdditionalIfSelected(e)},toggleAdditionalIfSelected:function(e){var t=e.find("li.selected");t.length>0&&e.collapse("show")},requestFilter:function(e,t,i){this.dispatch("filters:filtering",{key:e,value:t,heading:i})},clearFilters:function(){this.dispatch("filters:none")},destroy:function(){this.$options=null,this.$clearFilters=null,this.$sortByMixed=null,this.$sortByNewest=null,this.$sortByBestSelling=null,this.$mobileSelect=null,this.$sortByFree=null,this.$desktopSelect=null,Widget.prototype.destroy.call(this)}}}),Class(UI,"TopFilters").inherits(Widget).includes(BubblingSupport)({SORTBY_MAP:{"new":"newest",all:"mixed","best-selling":"best-selling",free:"free"},prototype:{init:function(e){Widget.prototype.init.call(this,e),this.$filtersContainer=this.element.find(".filters-ctn"),this.$sortByContainer=this.element.find(".filters-sortby-ctn"),this.$appliedFiltersContainer=this.element.find(".applied-filters-ctn"),this._setBindings()},_setBindings:function(){var e=this.$appliedFiltersContainer.find(".applied-filter");e.size()?e.click(this._appliedFilterCloseHandler.bind(this)):$(".applied_filters").removeClass("applied_filters"),this.$filtersContainer.find("a.opt").click(this._filterHandler.bind(this)),this.$sortByContainer.find("a").click(this._sortByHandler.bind(this))},_appliedFilterCloseHandler:function(e){var t=$(e.target);if(t.hasClass("applied-filter")){var i=$(e.target).find(".item-text"),n=i.data("item-name"),s=this.$filtersContainer.find('[data-item-name="'+n+'"]').parent();s.size()&&s[0].click();var r=$(".homepage-filter").find('[data-item-name="'+n+'"]');r.size()&&r.click(),t.remove(),0===this.$appliedFiltersContainer.find(".applied-filter").size()&&$(".applied_filters").removeClass("applied_filters")}},_filterHandler:function(e){e.stopPropagation();var t=$(e.target);this._requestFilter(this._getFilterData(t)),t.parent().addClass("selected"),this._closeAllDropdowns(),this._preventOpenDropdown()},_sortByHandler:function(e){e.stopPropagation();var t=$(e.target),i=t.attr("class");this._requestSorting(UI.TopFilters.SORTBY_MAP[i]),this.$sortByContainer.find("li").removeClass("selected"),t.parent().addClass("selected"),this._closeAllDropdowns(),this._preventOpenDropdown()},_getFilterData:function(e){var t=$(e).find("span");return{key:"f_"+t.data("filter-by"),value:t.data("item-name"),heading:t.data("category-heading-id"),$anchor:$(e)}},_requestSorting:function(e){this.dispatch("filters:filtering",{key:e})},_requestFilter:function(e){this.dispatch("filters:click",e)},_closeAllDropdowns:function(){this.$filtersContainer.find(".filter-dropdown").removeClass("open"),this.$sortByContainer.find(".filter-dropdown").removeClass("open")},_preventOpenDropdown:function(){this.$filtersContainer.find(".dropdown-toggle").addClass("disabled"),this.$sortByContainer.find(".dropdown-toggle").addClass("disabled")}}}),Class(UI,"Pagination").inherits(Widget).includes(BubblingSupport)({prototype:{init:function(e){Widget.prototype.init.call(this,e),this.pages=this.element.find("a"),this.$gap=this.element.find(".gap"),this.$gap.length>0&&this.$gap.text("..."),this.bindings()},bindings:function(){var e=this;this.pages.click(function(t){t.preventDefault();var i=Helpers.App.getUrlParam("page",t.target.getAttribute("href"));e.dispatch("paginator:change",{pageNumber:i})})}}}),Module("PreviewThumbSupport")({prototype:{tapCounter:0,tapCallback:[],helpText:null,
textViewsLimit:1,setMobileBindings:function(){var e=this,t=e.thumbContainer||e.element;if(Helpers.App.isMobile()&&!e.previewDisabled){var i=function(e){e.preventDefault()},n=function(){"function"==typeof e.tapCallback[e.tapCounter]?(e.tapCallback[e.tapCounter](),e.tapCounter++):"undefined"==typeof e.tapCallback[e.tapCounter]&&(e.resetTap(),t.unbind("click",i))},s=function(t){t.preventDefault(),t.stopPropagation(),e._dispatchForPreviewOverlay()};this.disablePreviewOverlay===!0?(this.tapCallback.length>0&&t.bind("mousedown",n),t.bind("click",i)):t.bind("click",s)}},_setPreviewData:function(){var e=this,t={};t.imageSrc=e._getThumbnailImage(),t.videoSrc=e._getThumbnailVideo(),t.imageType=this.element.attr("data-stage-type-id");var i=e.anchor[e.anchor.length-1];return t.anchor=i?i.href:"",t.isBookmarked="true"===e.element.attr("data-bookmarked")?!0:!1,t.stageId=e.stageID,t.bookmark=e.element.find(".bookmark"),t},_getThumbnailImage:function(){var e,t=this;if("true"===t.img.attr("data-processed"))e=t.img.attr("src");else if(t.previewSrc.length>0&&(e=t.previewSrc),!this._isImagePreview(e)){if(!(t.img.length>0))return"";e=t.img.attr("data-src")}return e},_getThumbnailVideo:function(){var e,t=this;return t.video.length>0?e=t.video.attr("data-src"):t.previewSrc.length>0&&(e=t.previewSrc),this._isImagePreview(e)?"":e},_isImagePreview:function(e){if(void 0===e)return!1;var t=e.split(".").pop();return"jpg"===t||"png"===t||"jpeg"===t?!0:!1},_dispatchForPreviewOverlay:function(){var e=this;e.dispatch("thumbnailPreview",{title:"",listAnchor:"",previews:[e._setPreviewData()],originalDispatcher:e})},resetTap:function(){this.tapCounter=0},showHelpText:function(){var e=this;if(!(Helpers.App.getMobileHelpTextCounter()>e.textViewsLimit)||this.alwaysShowHelpText){if($(".help-text",e.element).length||(e.helpText=$('<div class="help-text">'+e.helpString+"</div>"),e.badge.append(e.helpText)),this.useOffsetInHelpText){var t=$(".figcaption",e.element).css("height");t&&e.helpText.css("bottom",t)}e.helpText.show(),Helpers.App.setMobileHelpTextCounter()}},hideHelpText:function(){this.helpText&&this.helpText.hide()},cleanUpVideo:function(){if(Helpers.App.isMobile()!==!1&&0!==this.video.length){var e=this.video;this.video=this.video.clone(!0,!0),this.video.load(),this.video.hide(),this.video.insertAfter(e),e.hide(),e[0].src="",e[0].load(),e.remove()}},setTapCounter:function(e){e?this.tapCounter=e:this.tapCounter++}}}),Class(UI,"Bookmark").inherits(Widget)({BOOKMARK_BUTTON:'<div class="bookmark hvr-grow bookmark-off">                        <button></button>                    </div>',prototype:{stageId:null,isBookmarked:!1,bookmarkAfterLogin:!1,bookmarkingNotSupported:!1,setParent:function(e){return null===e?this.parent&&this.parent.element.removeClass("bookmarkable"):e.element.addClass("bookmarkable"),Widget.prototype.setParent.call(this,e),this},init:function(e){Widget.prototype.init.call(this,e);var t=this;return t.isBookmarked="true"===t.element.attr("data-bookmarked"),t.stageId=t.element.attr("data-stage-id"),t.element.hasClass("type-list")||!t.stageId?void(t.bookmarkingNotSupported=!0):(t.$button=$(UI.Bookmark.BOOKMARK_BUTTON),t.$button.click(t._clickHandler.bind(t)),t.element.append(this.$button),void t._setBookmarkedStyle(t.isBookmarked))},_setBookmarkedStyle:function(e){var t=this;e?t.$button.removeClass("bookmark-off").addClass("bookmark-on"):t.$button.removeClass("bookmark-on").addClass("bookmark-off")},_clickHandler:function(e){var t=this;return e.preventDefault(),e.stopPropagation(),Helpers.App.isLoggedIn()?void(t.isBookmarked?t.setBookmarked(!1):t.setBookmarked(!0)):(t.dispatch("notLoggedIn"),t.bookmarkAfterLogin=!0,void page.appNavBar.ssoModal.activate())},_isBookmarksPage:function(){return $(".page-container.bookmarks").length>0},afterLogin:function(e){this.bookmarkingNotSupported||(e=!!e,this.isBookmarked=e,this._setBookmarkedStyle(e),this.element.attr("data-bookmarked",e))},afterLogout:function(){this.bookmarkingNotSupported||(this.isBookmarked=!1,this.element.attr("data-bookmarked",!1),this._setBookmarkedStyle(!1))},setBookmarked:function(e){var t,i,n,s,r,o=this;if(!o.bookmarkingNotSupported){t=Helpers.App.getUser().id,i=o.stageId,r="/bookmarks/"+i,n={user:t,stage:i},s=e?"POST":"DELETE";var a=Helpers.App.getUrlParam("draftId")||null;$.ajax({dataType:"json",data:{draftId:a},url:r,type:s,success:function(t){var i=Helpers.App.getBookmarksCount()||0;o._setBookmarkedStyle(e),o.isBookmarked=e,o.element.attr("data-bookmarked",e),window.page&&window.page.dispatch&&(o.isBookmarked?(n.tags=t.tags.join(","),Helpers.GlobalEventTracker.bookmarked(n),Helpers.App.setBookmarksCount(++i),window.page.dispatch("user-has-bookmarks",!0)):(Helpers.GlobalEventTracker.track("BookmarkedStageEvent:Unbookmark",n),Helpers.App.setBookmarksCount(--i),0===i&&window.page.dispatch("user-has-bookmarks",!1)),window._pl_numberOfBookmarks=i),o.dispatch("bookmark",o.isBookmarked),!window.foldersVersion&&o._isBookmarksPage()&&o.isBookmarked===!1&&o.element.fadeOut(400,function(){o.parent.parent.element.gridalicious("resize",!0)})},error:function(e){n.method=s,n.url=r,o.bookmarkingNotSupported=!0,o.$button.hide(),Helpers.GlobalEventTracker.track("bookmark:errorOnRequest",n)}})}},updateBookmark:function(e){return e?void this.afterLogin(!0):this.bookmarkAfterLogin?void this.setBookmarked(!0):void this.afterLogin(!1)}}}),Class(UI,"HomepageThumbnail").inherits(Widget).includes(PreviewThumbSupport,AlgoliaAnalyticsSupport)({prototype:{previewDisabled:!1,onPreview:!1,helpString:"",trackAlgoliaAnalytics:!1,init:function(e){Widget.prototype.init.call(this,e),this.badge=e.badge||this.element.find(".badge"),this.anchor=this.element.find("a"),this.img=this.element.find("img").not(".loading-gif"),this.previewSrc=this.img.attr("data-preview-image"),this.stageID=this.element.attr("data-stage-id"),this.video=this.element.find("video"),this.$bundleIndicatorBackgroundCard=this.element.find(".bundle-indicator .card-background-container svg"),this.$bundleIndicatorForegroundCard=this.element.find(".bundle-indicator .card-foreground-container svg"),this.firstLoad=!0,this.loadingOverlay=this.element.find(".loading-overlay"),this.helpString=e.helpString||"Tap Again to Open",this.onPreview=!1,this.appendChild(new UI.Bookmark({name:"bookmark",element:this.element})),this.bindings(),this.trackAlgoliaAnalytics&&this._setAlgoliaAnalyticsBindings(),new UI.BundleIndicator({foregroundCard:this.$bundleIndicatorForegroundCard,backgroundCard:this.$bundleIndicatorBackgroundCard})},bindings:function(){var e=this,t=this.handleClick.bind(this);this.video.length>0&&this.video[0].addEventListener("loadeddata",this.hideLoader.bind(this),!1),this.previewSrc&&this.previewSrc.length>0&&this.img[0].addEventListener("load",this.hideLoader.bind(this),!1),Helpers.App.isMobileDevice()?(this.tapCallback=[],this.tapCallback.push(this.showPreview.bind(this)),this.setMobileBindings()):(this.element.mouseenter(function(t){e.showPreview(),t.stopPropagation()}),this.element.mouseleave(function(t){e.hidePreview(),t.stopPropagation()})),this.bookmark.bind("notLoggedIn",function(){e.dispatch("notLoggedIn")}),this.element.on("click",t)},handleClick:function(){this.trackAlgoliaAnalytics&&AlgoliaAnalyticsClient.sendStageClickEvent(this.stageID,this.position)},showPreview:function(){if(this.previewDisabled!==!0){if(Helpers.App.shouldDisableGridRollovers()===!0&&this.element.hasClass("is-in-bundle"))return void this.element.find("img").addClass("new-animation");if(Helpers.App.shouldDisableGridRollovers()===!0)return void this.element.addClass("new-animation");this.showVideoPreview(),this.showImgPreview(),(Helpers.App.isMobile()||this.alwaysShowHelpText)&&(this.showHelpText(),Helpers.App.isMobile()&&this.dispatch("preview.shown")),this.onPreview=!0}},hidePreview:function(){return this.hideVideoPreview(),this.hideImgPreview(),Helpers.App.shouldDisableGridRollovers()===!0&&this.element.hasClass("is-in-bundle")?void this.element.find("img").removeClass("new-animation"):Helpers.App.shouldDisableGridRollovers()===!0?void this.element.removeClass("new-animation"):((Helpers.App.isMobile()||this.alwaysShowHelpText)&&(this.hideHelpText(),Helpers.App.isMobile()&&this.resetTap()),void(this.onPreview=!1))},showImgPreview:function(){if(this.previewSrc&&this.previewSrc.length>0){var e=this.img[0].dataset.processed?JSON.parse(this.img[0].dataset.processed):!1;e||(this.firstLoad&&(this.loadingOverlay.fadeIn("fast"),this.img[0].src=this.previewSrc,this.firstLoad=!1),this.img[0].src=this.previewSrc)}},hideImgPreview:function(){var e=this.img[0].dataset.processed?JSON.parse(this.img[0].dataset.processed):!1;this.previewSrc&&!e&&(this.img[0].src=this.img.attr("data-src"))},showVideoPreview:function(){if(this.video.length>0){var e=this.img[0].dataset.processed?JSON.parse(this.img[0].dataset.processed):!1;e||(this.firstLoad&&(this.showLoader(),this.video[0].src=this.video.attr("data-src"),this.firstLoad=!1),this.video.show(),this.video[0].play(),Helpers.App.isMobileDevice()&&(this.video[0].loop=!0))}},hideVideoPreview:function(){this.video.length>0&&this.video.hide(),Helpers.App.isMobile()&&this.onPreview&&(this.video.length>0&&this.video[0].removeEventListener("loadeddata",this.hideLoader.bind(this)),this.cleanUpVideo(),this.hideLoader(),this.firstLoad=!0,this.video.length>0&&this.video[0].addEventListener("loadeddata",this.hideLoader.bind(this)))},showLoader:function(){this.loadingOverlay.fadeIn("fast")},hideLoader:function(){this.loadingOverlay.fadeOut("fast")}}}),Class(UI,"DropdownMultilevel").inherits(Widget).includes(BubblingSupport)({html:'<div class="dropdown-multilevel">        <label class="title hidden"> </label>        <div class="btn-input-container is-button">            <input type="button" class="btn-input">            <span class="sp-dd p-icon down-arrow"></span>            <span style="display:none" class="glyphicon glyphicon-remove-circle"></span>        </div>        <div class="menu"></div>    </div>',elementClass:"dropdown-multilevel",prototype:{noResultsHtml:'<div style="display:none;" class="no-results">                <div class="title">No industry matches</div>                <div class="message">Try another keyword or browse our Industries below</div>            </div',initialValue:null,isMobile:!1,$select:null,$menu:null,$list:null,selectedOption:null,options:null,placeholder:null,modalName:"multiLevelModal",propertyBySearch:"value",searchPlaceholder:null,_previousSearchValue:null,init:function(e){Widget.prototype.init.call(this,e);var t=this;t.$menu=this.element.find(".menu"),t.isMobilePhone=Helpers.App.isMobile(),t.buildMenuContainer(),t.setConfig(e)},setConfig:function(e){var t=this;t.record=e.record,t.selectedOption=e.record.selectedOption||{},t.propertyBySearch=e.propertyBySearch||t.propertyBySearch,t.placeholder=e.placeholder||"",t.searchPlaceholder=e.searchPlaceholder||"",t.initialValue=t.selectedOption,t.$downArrowIcon=this.element.find(".down-arrow"),t.root={name:"root",children:this.record.options},t.$btnInputContainer=this.element.find(".btn-input-container"),t.$btnInput=t.$btnInputContainer.find(".btn-input"),t.$btnInput.val(t.placeholder),t.options=e.record.options||[],t.$removeIcon=this.element.find(".glyphicon-remove-circle"),t.isMobilePhone?(t.$mobileInput.attr("placeholder",t.searchPlaceholder),t.$removeIconMobile=this[this.modalName].element.find(".glyphicon-remove-circle")):(e.label&&t.element.find("label.title").removeClass("hidden").html(t.label),setTimeout(function(){t.setDropDownHeight()},0)),t.options.length>0&&(t.renderList(t.options),t.setSelected(t.selectedOption.industryId),t._bindings())},_bindings:function(){var e=this;e.$btnInputContainer.bind("click",function(){return"text"===e.$btnInput.attr("type")?void e.showList():void e.toggle()}),$(document.body).bind("mousedown",function(t){e.elementClicked=t.target}),$(document.body).bind("click",function(t){var i=e.element;if(e.elementClicked===t.target)return e.isMobilePhone&&(i=e.multiLevelModal.element.find(".modal-content")),$.contains(i[0],t.target)===!0?void e.buttonClickHandler(t):void e.hideList()}),e.isMobilePhone?(e.$mobileInput.bind("keyup",e.keyUpEventHandler.bind(e)),e.$removeIconMobile.bind("click",e.cleanSearch.bind(e)),e.$mobileInput.bind("focus",function(){e.$mobileInput.val()&&e.showRemoveIcon()}),this.modal.element.on("shown.bs.modal",function(){e.selectedOption.name?(e.$mobileInput.val("").attr("placeholder",e.selectedOption.name),e.$mobileInput.focus()):(e.$mobileInput.val("").attr("placeholder",e.placeholder),e.$mobileInput.focus())})):(e.$btnInput.bind("keyup",e.keyUpEventHandler.bind(e)),$(window).resize(function(){e.windowHeight!==window.innerHeight&&e.setDropDownHeight()}))},selectItemUsedKeyboard:function(e){var t=this,i=null;t.isMobilePhone||t.$list.hasClass("results")===!1||(40===e.keyCode?t.keyDownHandler():38===e.keyCode?t.keyUpHandler():13===e.keyCode&&(i=t.$list.find(".pre-selected"),t.setSelected(i.find(".item.child").attr("data-value"),"value")))},keyDownHandler:function(){var e,t=this,i=0;return e=t.$list.find(".pre-selected"),e.index()+1<t.$list.children().length==!1?this:0===t.$list.find(".pre-selected").length?(t.$list.find("li:first-child").addClass("pre-selected"),this):(e=e.removeClass("pre-selected").next().addClass("pre-selected"),i=t.$menu.height()-(e.position().top+e.height()),0>i&&t.$menu.scrollTop(t.$menu.scrollTop()+Math.abs(i)),this)},keyUpHandler:function(){var e,t,i=this,n=0;e=i.$list.find(".pre-selected");var s=i.$btnInput.val();if(i.$btnInput.val("").val(s),e.is(":first-child")===!0)return this;for(e.removeClass("pre-selected").prev().addClass("pre-selected"),t=0;t<i.$list.find(".pre-selected").index();t++)n+=$(i.$list.children()[t]).height();return i.$menu.scrollTop(n),this},keyUpEventHandler:function(e){var t=this,i=$(e.target).val();t._previousSearchValue===i?this.selectItemUsedKeyboard(e):(t._previousSearchValue=i,this.searchEventHandler(i))},searchEventHandler:function(e){var t=this,i=[];t.$noResults.hide(),e&&e.length>0?(t.showRemoveIcon().hideDownArrowIcon(),i=t.search(e),0===i.length?(i=t.record.options,t.$noResults.show(),t.$list.removeClass("results")):t.$list.addClass("results")):(i=t.record.options,t.showDownArrowIcon().hideRemoveIcon()),t.$list.empty(),t.renderList(i).highlighted(e),t.markSelected(t.propertyBySearch,t.selectedOption[t.propertyBySearch]),t.isListVisible()===!1&&t.showList()},buttonClickHandler:function(e){var t=$(e.target);return this.element[0]===t[0]||$.contains(this.element[0],t[0])===!1?this:t.hasClass("down-arrow")?(this.toggle(),this):(t.hasClass("glyphicon-remove-circle")&&this.isMobilePhone===!1&&(this.showDownArrowIcon().hideRemoveIcon(),this.$btnInput.focus(),this.cleanSearch()),this)},highlighted:function(e){return e?void this.$list.find(".title").each(function(t,i){if(e=e.toLowerCase(),$(i).html().toLowerCase().indexOf(e)>-1){var n=$(i).html(),s=n.substr(n.toLowerCase().indexOf(e),e.length);$(i).html(n.replace(s,"<strong>"+s+"</strong>"))}return this}):this},changeInputType:function(e){return this.isMobilePhone?this:("button"===e?(this.$btnInput.attr("type","button"),this.$btnInputContainer.addClass("is-button"),this.showDownArrowIcon().hideRemoveIcon(),this.selectedOption.name?this.$btnInput.val(this.selectedOption.name).attr("placeholder",this.selectedOption.name):this.$btnInput.val(this.placeholder).attr("placeholder",this.placeholder)):"text"===e&&(this.$btnInput.attr("type","text"),this.$btnInputContainer.removeClass("is-button"),this.$btnInput.val("").focus()),this)},buildMenuContainer:function(){var e,t;t='<ul class="list-multilevel"></ul>',this.isMobilePhone?(e='<div class="input-container search-container">                                <input type="text" class="btn-input">                                <span style="display:none" class="glyphicon glyphicon-remove-circle"></span>                            </div>',this.modal=new UI.SimpleModal({name:this.modalName}),this.appendChild(this.modal).render($(document.body)),this.modal.setHeaderContent(e),this.modal.setContent(t),this.$list=this.modal.element.find("ul.list-multilevel"),this.$mobileInput=this.modal.element.find(".btn-input")):(this.$menu.append(t),this.$list=this.element.find("ul.list-multilevel")),this.$noResults=$(this.noResultsHtml).insertBefore(this.$list)},cleanSearch:function(){return this.isMobilePhone?this.$mobileInput.val("").focus():this.$btnInput.val("").focus(),this.$noResults.hide(),this.hideRemoveIcon(),this.$list.empty(),this.renderList(this.record.options).markSelected(this.propertyBySearch,this.selectedOption[this.propertyBySearch]),this},renderList:function(e){var t=this;return t.buildList(e,t.$list,0,""),t.$list.find(".item").bind("click",function(){t.toggleItem(this)}),this},buildList:function(e,t,i,n){var s,r=this,o="";e.length>-1!=!1&&e.forEach(function(e,a){o=e.children&&e.children.length>0?"parent":"child";var l=0===i?a:n+"_"+a,c='<li class="item-li"><div class="item R_TYPE" data-level="R_LEVEL" data-value="R_VALUE" data-industry-id="R_INDUSTRY_ID" data-name="R_NAME" data-selected="false" data-param="R_PARAM"><div class="icon"></div><div class="title">R_NAME</div></div></li>';c=c.replace("R_LEVEL",l).replace("R_TYPE",o).replace("R_VALUE",e.value).replace("R_INDUSTRY_ID",e.industryId).replace(new RegExp("R_NAME","g"),e.name).replace("R_PARAM",e.param),s=e.name.indexOf("(All)")>-1?$(c).prependTo(t):$(c).appendTo(t),e.children&&e.children.length>0&&(s.find(".icon").html(r._getItemIcon("closedDark")),0===s.find("ul.children").length&&s.append('<ul class="children" style="display:none"></ul>'),r.buildList(e.children,s.find("ul"),i+1,l))})},isListVisible:function(){return this[this.modalName]?this[this.modalName].element.is(":visible")===!0:this.$menu.is(":visible")===!0},showList:function(){return this.isListVisible()===!0?this:(this[this.modalName]?this[this.modalName].activate():(this.$menu.show(),this.setDropDownHeight()),this.dispatch("activate"),this)},hideList:function(){return this.isListVisible()===!1?this:(this[this.modalName]?this[this.modalName].deactivate():this.$menu.hide(),this.selectedOption.name?this.$btnInput.val(this.selectedOption.name):this.$btnInput.val(this.placeholder),this.changeInputType("button"),this.$noResults.hide(),this.$list.empty().removeClass("results"),this.renderList(this.record.options),this.markSelected(this.propertyBySearch,this.selectedOption[this.propertyBySearch]),this.dispatch("deactivate"),this)},toggle:function(){var e=this;e.isListVisible()?e.hideList():(e.changeInputType("text"),e.showList())},camelCaseToDash:function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},toggleItem:function(e){var t=this,i=$(e),n=$(e).parent().find("> ul");if(i.hasClass("child")){var s="data-"+t.camelCaseToDash(t.propertyBySearch);this.selectedOption[t.propertyBySearch]!==i.attr(s)&&t.setSelected(i.attr(s),t.propertyBySearch),this.toggle()}else n.is(":visible")?(n.hide(),i.find(".icon").html(this._getItemIcon("closedDark"))):(n.show(),i.find(".icon").html(this._getItemIcon("openDark")))},setSelected:function(e,t){var i,n,s=this;return i=t||s.propertyBySearch,n=e||s.selectedOption[i],void 0===e||null===e?this:s.selectedOption[i]===e?(this.markSelected(i,n),this):(this._treeWalker(this.root,"children",function(e){e[i]===n&&(s.selectedOption=e)}),s.selectedOption.name?(s.$btnInput.val(s.selectedOption.name).attr("placeholder",s.selectedOption.name),s.isMobilePhone&&s.$mobileInput.val(s.selectedOption.name).attr("placeholder",s.selectedOption.name)):s.$btnInput.val(s.placeholder).attr("placeholder",s.placeholder),this.markSelected(i,n),this.dispatch("ml.change",{selected:s.selectedOption}),this)},markSelected:function(e,t){var i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=this.$list.find(".child[data-"+i+'="'+t+'"]');return 0===n.length?this:(this.$list.find(".active").removeClass("active"),this.$list.find(".glyphicon-ok").remove(".glyphicon-ok"),n.addClass("active"),n.append('<i class="glyphicon glyphicon-ok icon-ok check-mark"></i>'),this)},getSelected:function(){var e=this;return e.selectedOption},setDropDownHeight:function(){var e=this;e.windowHeight=window.innerHeight;var t=window.innerHeight-e.$menu.offset().top-10;e.$menu.css("max-height",t+"px"),e.$menu.css("overflow-y","auto")},hideRemoveIcon:function(){var e=this.$removeIcon;return this.isMobilePhone&&(e=this.$removeIconMobile),e.hide(),this},showRemoveIcon:function(){var e=this.$removeIcon;return this.isMobilePhone&&(e=this.$removeIconMobile),e.show(),this},showDownArrowIcon:function(){return this.isMobilePhone?this:(this.$downArrowIcon.show(),this)},hideDownArrowIcon:function(){return this.isMobilePhone?this:(this.$downArrowIcon.hide(),this)},_treeWalker:function(e,t,i){var n;if(e.hasOwnProperty(t)===!0){for(n=0;n<e[t].length;n++)i(e[t][n]);for(n=0;n<e[t].length;n++)this._treeWalker(e[t][n],t,i)}},search:function(e){var t=[];return this._treeWalker(this.root,"children",function(e){e.children&&e.children.length>0||t.push(e)}),t=t.sort(function(e,t){return e.name.localeCompare(t.name)}),t=t.filter(function(t){return t.name.toLowerCase().indexOf(e.toLowerCase())>-1})},_getItemIcon:function(e){return"closedDark"===e?'<svg width="8px" height="11px" viewBox="0 0 8 11" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">                    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">                        <g id="closed-dark" transform="translate(-617.000000, -123.000000)" fill="#4A4A4A" fill-rule="nonzero">                            <g id="Group-11" transform="translate(606.000000, 85.000000)">                                <g id="Dropdown-Menu-Copy-2">                                    <polygon id="triangle-closed" transform="translate(15.000000, 43.500000) rotate(-90.000000) translate(-15.000000, -43.500000) " points="15 47 10 40 20 40"></polygon>                                </g>                            </g>                        </g>                    </g>                </svg>':"openDark"===e?'<svg width="11px" height="8px" viewBox="0 0 11 8" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">                            <g id="open-dark" transform="translate(-615.000000, -151.000000)" fill="#4A4A4A" fill-rule="nonzero">                                <g id="Group-11" transform="translate(606.000000, 85.000000)">                                    <g id="Dropdown-Menu-Copy-2">                                        <polygon id="Triangle" points="14.5 73.5 9.5 66.5 19.5 66.5"></polygon>                                    </g>                                </g>                            </g>                        </g>                    </svg>':void 0}}}),Class(UI,"DropdownButton").inherits(Widget).includes(BubblingSupport,CDNSupport)({html:'<div>        <label class="title hidden"> </label>        <button type="button" class="btn btn-dropdown">            <div class="placeholder"></div>            <div class="sp-dd p-icon down-arrow"></div>        </button>        <div class="menu"></div>    </div>',elementClass:"dropdown-button",prototype:{$menu:null,content:null,placeholder:null,placeholderIconUrl:null,modalName:null,init:function(e){this.setConfig(e)},setConfig:function(e){Widget.prototype.init.call(this,e),this.$menu=this.element.find(".menu"),this.$button=this.element.find(".btn-dropdown"),this.$placeholder=this.$button.find(".placeholder"),this.placeholder=e.placeholder||"Choose",this.content=e.content,this.placeholderIconUrl?this.changePlaceholderIcon(this.placeholder):this.changePlaceholder(this.placeholder),this.isMobile&&this.buildModal(),this.bindings()},bindings:function(){var e=this;this.$button.bind("click",function(){e.toggle()}),$(document).click(function(t){if(t.stopPropagation(),!$(t.target).hasClass("placeholder")&&!$(t.target).parent().hasClass("active")){var i=e.element;if(0===i.has(t.target).length)if(e[e.modalName]){var n=e[e.modalName].element.find(".modal-body");0===n.has(t.target).length&&e[e.modalName].deactivate()}else e.deactivate()}})},toggle:function(){this.isActive()?this.deactivate():this.activate()},isActive:function(){return this[this.modalName]?this[this.modalName].element.is(":visible")===!0:this.$menu.is(":visible")===!0},buildModal:function(){var e=this,t=new UI.SimpleModal({name:this.modalName});this.appendChild(t).render($(document.body)),t.setContent(this.$menu.detach()),this.$menu=t.element.find(".menu"),t.element.on("shown.bs.modal",function(){e.dispatch("activate")})},setContent:function(e){this.content=e,this[this.modalName]?this[this.modalName].setContent(this.content):this.$menu.html(this.content)},activate:function(){this[this.modalName]?this[this.modalName].activate():(this.$menu.css("display","flex"),this.setDropDownPosition(),this.dispatch("activate"))},deactivate:function(){this[this.modalName]?this[this.modalName].deactivate():this.$menu.hide(),this.dispatch("deactivate")},setDropDownPosition:function(){this.windowHeight=window.innerHeight;var e=window.innerHeight-this.$menu.offset().top-10;this.$menu.css("max-height",e+"px"),this.$menu.css("overflow-y","auto")},changePlaceholder:function(e){this.$placeholder.removeClass("icon"),this.$placeholder.html(e)},changePlaceholderIcon:function(e){var t=$("<img>"),i=this._cdnBasePath()+e;t.attr("src",i),this.$placeholder.addClass("icon"),this.$placeholder.html(t)},getContentElement:function(){return this.$menu}}}),Class(UI.CustomExperience,"Grid").inherits(Widget).includes(UI.RelatedTemplates.InfoSupport)({MIN_DESKTOP_RES:1025,MID_MOBILE_RES:500,MIN_MOBILE_COLS:2,MAX_MOBILE_COLS:3,DESKTOP_COL_WIDTH:315,GUTTER:12,prototype:{isNlpEnabled:!1,isApi:!1,processingComponentsPromise:null,init:function(e){var t=this;Widget.prototype.init.call(this,e),this.isNlpEnabled=e.isNlpEnabled||!1,this.canProcessWithEngine=!1,UiJsonMapSupport.fetch(),t.canProcessWithEngine=IntegrityCheck.checkCapability(),t.uiJson=e.uiJson,t._initalizeHomePageThumbnails(),(window.willProcessRelatedTemplates||this.isNlpEnabled)&&this._initalizeProcessingItems(),this.bindings()},_initalizeHomePageThumbnails:function(){var e=this.element.find(".galcolumn").children(),t=this;if(t.thumbnails=[],t.element.length>0){for(var i=0;i<e.length;i++){var n=new UI.HomepageThumbnail({name:"thumbnail"+i,element:$(e[i]),previewDisabled:t.isNlpEnabled,trackAlgoliaAnalytics:!0,position:i+1}).bind("preview.shown",function(e){t.hidePreviews(e.target)}).bind("thumbnailPreview",function(e){t.dispatch("thumbnailPreview",e.data)});n.img.off("load"),t.thumbnails.push(n)}t.filtersOff&&t.element.addClass("no-filters"),t.element.gridalicious({width:t.constructor.DESKTOP_COL_WIDTH,gutter:t.constructor.GUTTER,selector:".grid-item",animate:!1}),t.element.css("visibility","visible")}},_processingComponentsPromise:function(){var e=this;return null!==e.processingComponentsPromise?e.processingComponentsPromise:(e.processingComponentsPromise=new Promise(function(t,i){try{"Videos"!==window._pl_category&&e.getRelatedTemplatesInfo(),e._setupSmartQueue(),e.startCaching(),t()}catch(n){i(n)}}),e.processingComponentsPromise)},_initalizeProcessingItems:function(){for(var e=this,t=0;t<this.thumbnails.length;t++){var i=e.thumbnails[t].element.prop("dataset"),n=e._getTrimPropertyFromObject(i,"graphicId"),s=e._getTrimPropertyFromObject(i,"graphicId"),r=e._getTrimPropertyFromObject(i,"graphicId"),o={name:"related-template-item-"+t,uiJson:this.uiJson,element:this.thumbnails[t].element,graphicId:n,niceCategoryId:s,query:r,presetStrategy:"input",isCustomExperience:!0,isApi:this.isApi,forceFallback:this.canProcessWithEngine===!1,isNlpEnabled:this.isNlpEnabled},a="Mockups"===i.categoryName&&"13"===i.imageType;a&&!window.apiPage?this.appendChild(new UI.RelatedTemplates.DownloadableSmartTemplateItem(o)):"15"===i.imageType?this.appendChild(new UI.RelatedTemplates.SmartVideoItem(o)):this.appendChild(new UI.RelatedTemplates.SmartTemplateItem(o))}var l=e.children.filter(function(e){return["SmartTemplateItem","DownloadableSmartTemplateItem"].includes(e.constructor.className)});l.forEach(function(t){t.bind("purchase.failed",function(t){e.dispatch("purchase.failed",t.data)}),t.bind("purchase.success",function(t){e.dispatch("purchase.success",t.data)})})},_getTrimPropertyFromObject:function(e,t){return e[t]?e[t].trim():null},_setupSmartQueue:function(){var e=3;this.isNlpEnabled===!0&&Helpers.App.isLoggedIn()===!1&&(e=2),this.smartQueue=new SmartQueue({actionName:"loadPreview",minConsumers:2,maxConsumers:e,itemsPerConsumer:1})},startCaching:function(){this.canProcessWithEngine!==!1&&this._startCaching({text:[],graphic:[],customGraphic:[],background:[],backgroundColor:[],id:"fake"})},bindings:function(){var e=this;$(window).on("load",function(){e.element.gridalicious("resize",!0)}),e.element.on("gridalicious:toResize",function(){return $(window).width()<e.constructor.MID_MOBILE_RES?void e.element.gridalicious("updateOption",{width:e.element.width()/e.constructor.MIN_MOBILE_COLS-e.constructor.GUTTER}):$(window).width()<e.constructor.MIN_DESKTOP_RES?void e.element.gridalicious("updateOption",{width:e.element.width()/e.constructor.MAX_MOBILE_COLS-e.constructor.GUTTER}):void e.element.gridalicious("updateOption",{width:e.constructor.DESKTOP_COL_WIDTH})}),UI.Navigation.NavBar.bind("user:login",e._handleUserLogin.bind(e)),UI.CustomExperience.Grid.bind("user:logout",e._handleUserLogout.bind(e))},_handleUserLogin:function(){var e=this,t=e.children.filter(function(e){return["SmartTemplateItem","DownloadableSmartTemplateItem"].includes(e.constructor.className)});$.get("/api/v2/bookmarked_stages_from_user?user_id="+Helpers.App.getUser().id).done(function(e){t.forEach(function(t){var i=t.bookmark;i&&(-1!=e.bookmarkedStages.indexOf(parseInt(i.stageId))?i.afterLogin(!0):i.bookmarkAfterLogin?(bookmarkAfterLogin=!1,i.setBookmarked(!0)):i.afterLogin(!1))})}).fail(function(e){})},_handleUserLogout:function(e){var t=this,i=t.children.filter(function(e){return["SmartTemplateItem","DownloadableSmartTemplateItem"].includes(e.constructor.className)});i.forEach(function(e){e.bookmark&&e.bookmark.afterLogout()})},update:function(e){var t=this;this._processingComponentsPromise().then(function(){t.children.forEach(function(t){"undefined"!=typeof customExperienceFlag&&(e=$.extend(!0,{},e),e.backgroundColor=null),t.uiJson=e,t.processed=!1,t.didCaching=!1,t.onlyCaching=!1},t),t.smartQueue.clear(),t.setLastChange(performance.now()),t.smartQueue.push(t.children)})},updateGraphicsId:function(e){return this.children.forEach(function(t){t.graphicId=e}),this},setUserSelected:function(){return this.children.forEach(function(e){e.selectedByUser=!0}),this},_startCaching:function(e){this.setLastChange(performance.now()),this.smartQueue.clear(),this.children.forEach(function(t){t.uiJson=e,t.processed=!1,t.didCaching=!0,t.onlyCaching=!0}),this.smartQueue.push(this.children)},setLastChange:function(e){this.children.forEach(function(t){t.lastChange=e})},returnToPlaceholder:function(e){var t=null;this.smartQueue.clear(),this.children.forEach(function(i){t="SmartVideoItem"===i.constructor.className,t||i.setPlaceholderSrc(e)})},hidePreviews:function(e){var t=this;t.thumbnails.forEach(function(t){e&&t.name===e.name||t.hidePreview()})},getRelatedTemplatesInfo:function(){var e=this.children.filter(this._isRelatedTemplate);window._pl_featureFlags.T22545===!0?e.length>0&&this.requestRelatedTemplatesInfo(e):e.forEach(function(e){e.getRelatedTemplateInfo()})},_isRelatedTemplate:function(e){return["SmartTemplateItem","DownloadableSmartTemplateItem"].includes(e.constructor.className)}}}),Class(UI,"PillCarousel").inherits(Widget).includes()({html:'<div>        <div class="left-gradient"></div>        <div class="prev flipped">            <div class="ic-darkblue-chevron"></div>        </div>            <div class="carousel-wrapper"></div>        <div class="next">            <div class="ic-darkblue-chevron"></div>        </div>        <div class="right-gradient"></div>    </div>',elementClass:"pill-carousel",prototype:{_currentItem:null,_currentSlideNum:0,init:function(e){Widget.prototype.init.call(this,e),this.$carousel=this.element.find(".carousel-wrapper"),this.$next=this.element.find(".next"),this.$prev=this.element.find(".prev"),this.$right=this.element.find(".right-gradient"),this.$left=this.element.find(".left-gradient"),this.items=e.items,this._currentItem=this.items[0],this._currentSlideNum=0,this.setContent(this.items),this._bindEvents(),this._checkForOverflow()},getCurrentItem:function(){return this._currentItem},next:function(){this.goToSlide(this._currentSlideNum+1)},prev:function(){this.goToSlide(this._currentSlideNum-1);
},goToSlide:function(e){var t=this.$carousel.children()[e];e===this._currentSlideNum||0>e||(this._currentItem=t,this._currentSlideNum=e,this.$carousel.animate({scrollLeft:t.offsetLeft},500))},_bindEvents:function(){this.$next.bind("click",this.next.bind(this)),this.$prev.bind("click",this.prev.bind(this)),this.$carousel.bind("scroll",this._scrollHandler.bind(this))},_scrollHandler:function(){var e=this;clearTimeout(this._debouncedScroll),this._debouncedScroll=setTimeout(function(){e._checkForOverflow()},100,e._checkForOverflow)},_checkForOverflow:function(){var e=this.$carousel.get(0).scrollLeft,t=e+this.$carousel.get(0).offsetWidth,i=this.$carousel.get(0).scrollWidth;e>0?(this.$prev.show(),this.$left.show()):(this.$prev.hide(),this.$left.hide()),i>t?(this.$next.show(),this.$right.show()):(this.$next.hide(),this.$right.hide())},setContent:function(e){var t=this;e.forEach(function(e){e.render(t.$carousel)})}}}),Class(UI,"Pill").inherits(Widget).includes()({html:'<a href="#">        <span class="text"></span>    </a>',elementClass:"pill",prototype:{init:function(e){Widget.prototype.init.call(this,e),this.$textContainer=this.element.find(".text"),this._eventData=e.eventData,this.setClass(e.customClass),this.$textContainer.text(e.text),this._bindEvents()},_bindEvents:function(){this.element.bind("click",this._clickHandler.bind(this))},_clickHandler:function(e){e.preventDefault(),e.stopPropagation(),console.log("EVENT PILL",this._eventData),this.dispatch("activate",this._eventData)},setClass:function(e){this.element.addClass(e)}}}),Class(UI.CustomExperience,"Header").includes(CustomEventSupport,NodeSupport,HeaderCustomImageSupport)({prototype:{texts:[],files:[],color:[],triggers:[],defaultColors:[],pills:[],customPrepare:null,init:function(e){var t,i=this;Widget.prototype.init.call(this,e),this.texts=this.element.find("[data-type='text']").toArray(),this.files=this.element.find("[data-type='file']").toArray(),this.colors=this.element.find("[data-type='color']").toArray(),this.triggers=this.element.find("[data-trigger='true']").toArray(),this.dropdownMultilevels=this.element.find("[data-type='dropdown-multilevel']").toArray(),this.smartDropdownElements=this.element.find('[data-type="smart-dropdown"]').toArray(),this.dropdownButtons=this.element.find("[data-type='dropdown-button']").toArray(),this.assetControls=this.element.find("[data-type='assets-control']").toArray(),this.colorpickerSharedColors=new ColorpickerSharedColors,this.isMobilePhone=Helpers.App.isMobile(),t=Helpers.App.getAllURLParams(),i.fillParamsContent(t);var n=t.industry;return n&&(n=n.replace("_","/")),this.defaultColors=this._getDefaultColors(n),this.defaultColors=[this.defaultColors.primaryColor,this.defaultColors.secondaryColor],this.colors.forEach(function(e,n){var s=this.defaultColors[n]||e.dataset.colorDefault||"#ffffff";e.record={color:s};var r=new UI.SmartTemplate.ColorControl({name:"picker_"+n,record:e.record,isMobilePhone:i.isMobilePhone,prefillColor:t["picker_"+n],customPosition:!0,colorpickerSharedColors:this.colorpickerSharedColors,standardBehavior:i.isMobilePhone});i.appendChild(r),r.render($(e))},this),("A"===Helpers.App.getAllApparelVariant()||""===Helpers.App.getAllApparelVariant())&&this.createDropdownMultiLevel(this.dropdownMultilevels,t),this.createSmartDropdown(this.smartDropdownElements,t),this.dropdownButtons.forEach(function(e,t){var n="dropdown_"+t;""!==$(e).attr("id")&&(n=$(e).attr("id"));var s=new UI.DropdownButton({name:n,isMobile:Helpers.App.isMobile(),placeholder:$(e).attr("data-placeholder"),element:$(e),modalName:"modal_"+n});i.appendChild(s)}),this.assetControls.forEach(function(e,n){var s="AssetsControl_"+n,r=6,o=$(e);""!==$(e).attr("id")&&(s=$(e).attr("id")),i.isMobilePhone===!0&&(r=4,o=i.assetDropdown.getContentElement());var a={name:"Button",type:"Folder",visible:!0,allowSearch:!0,excludable:!0,allowCustomUpload:!1,selectedLayer:null,hasLayers:!0,preconfiguredSearch:t["search"+s],layers:[]},l=new UI.SmartTemplate.AssetsControl({name:s,record:a,isMobilePhone:i.isMobilePhone,prefillGraphic:t["multi"+s],prefillSearch:t["search"+s],numberOfColumns:r,type:"graphic",cssClass:"nlp-assets-control",blankItemText:"Surprise me",searchInputPlaceholder:"Search Graphics",onlyGraphics:!0,itemsPerPage:24});i.appendChild(l),l.render(o)}),"function"==typeof window.experience.customPrepare&&(this.customPrepare=window.experience.customPrepare),this.instantiateCropperModal(),this._bindings(),"true"===t.trigger&&i.process(),this},createDropdownMultiLevel:function(e,t){var i=this;e.forEach(function(e,n){var s="multiLevel_"+n;""!==$(e).attr("id")&&(s=$(e).attr("id"));var r=new UI.DropdownMultilevel({name:s,placeholder:$(e).attr("data-placeholder"),record:{selectedOption:{},options:[]},prefill:t["ml_"+n]});i.appendChild(r),r.render($(e))})},createSmartDropdown:function(e,t){var i=this;e.forEach(function(e,n){var s={name:"smartDropdown"+n,placeholder:"Search",modalName:"dropdownModal",propertyToSearch:"name",labelProperty:"name",childProperty:"children",options:[],noResultsMessage:"",noResultsTitle:"",isMultiSelection:!0};s=i._getDataFromElement(s,e);var r=new UI.SmartDropdown(s);i.appendChild(r),r.render($(e));var o=$(e).attr("data-urlParamNames");o=o.split(",").map(function(e){return e.trim()}),r.bind("ready",function(){o.forEach(function(e){t[e]&&t[e].split(",").forEach(function(t){r.selectItem(e,t)})}),r.setPlaceholder()}),r.bind("change",function(e){Array.isArray(o)!==!1&&0!==o.length&&i.updateDropdownURLParams(e.data.selected,o)})})},_getDataFromElement:function(e,t){var i=function(e){return"string"==typeof e&&"true"===e||e===!0?!0:!1};return Object.keys(e).forEach(function(n){var s=t.dataset[n.toLowerCase()];"undefined"!=typeof s&&("boolean"==typeof e[n]&&(s=i(s)),e[n]=s)}),e},updateDropdownURLParams:function(e,t){var i=t.reduce(function(t,i){return t[i]=e.filter(function(e){return e[i]}).map(function(e){return e[i]}).join(","),t},{});Array.isArray(t)!==!1&&0!==t.length&&Object.keys(i).forEach(function(e){Helpers.App.replaceUrlParam(e,i[e])})},_getDefaultColors:function(e){var t={};return window.industry&&window.industry.primary_color&&window.industry.secondary_color&&(t={match:e,primaryColor:window.industry.primary_color,secondaryColor:window.industry.secondary_color}),t},fillParamsContent:function(e){this.texts.forEach(function(t,i){e["text_"+i]&&(t.value=e["text_"+i])})},_bindings:function(){var e=this;e.cropperModal.bind("imageLoaded",function(t){e.cropperModal.activate()}),this.triggers.forEach(function(t){t.addEventListener("click",e.process.bind(e))}),this.texts.forEach(function(e,t){e.addEventListener("input",function(){Helpers.App.replaceUrlParam("text_"+t,this.value)})}),this.customImageBindings()},_grabUrlSuccessHandler:function(e,t,i){e.hideFileButton(),t.length&&(t[0].dataset.imageFromUrl=i.data.imagePath,t[0].dataset.imageHash=i.data.imageHash),this.process()},_getInputId:function(e,t){var i="";return e.forEach(function(e){e.name.indexOf("CustomG")>=0&&e.userImageFileName===t&&(i=e.name)}),i},prepareData:function(e){this.texts.forEach(function(t){e.text.push({contents:t.value,tag:t.dataset.position})}),this.files.forEach(function(t){if(t.dataset.path||t.dataset.path.length||t.dataset.imageFromUrl||t.dataset.imageFromUrl.length){if(t.dataset.path){var i=t.dataset.imageData?JSON.parse(t.dataset.imageData).id:"";e.customGraphic.push({layers:[{image:t.dataset.path,tag:t.dataset.position}],hash:i})}if(t.dataset.imageFromUrl){var n=[t.dataset.viewportWidth,"x",t.dataset.viewportHeight].join("");e.customGraphic.push({layers:[{image:t.dataset.imageFromUrl,viewport:n}],hash:t.dataset.imageHash})}}}),this.colors.forEach(function(t){e.colors.push(t.record.color)}),e.backgroundColor={color:e.colors[0]}},createNewRecord:function(){var e={text:[],graphic:[],customGraphic:[],background:[],colors:[],backgroundColor:{},id:"fake"};return e},_upload:function(e){return console.warn("Header:_upload is deprecated"),$.ajax({url:"/cropper/upload",data:e,method:"POST",processData:!1,contentType:!1,cache:!1})},_crop:function(e){return console.warn("Header:_crop is deprecated"),$.ajax("/cropper/crop",{method:"POST",data:e})},instantiateCropperModal:function(){var e=$(document.body);this.cropperModal||this.appendChild(new UI.CropperModal({name:"cropperModal"})).render(e)},process:function(){var e=this.createNewRecord();this.prepareData(e),this.customPrepare&&this.customPrepare(e),e.text.forEach(function(e){e.contents=Helpers.App.sanitizeControlCharacters(e.contents)}),this.dispatch("customExperience.change",e)},_hasColorChanges:function(){return this.colors.some(function(e){var t=e.dataset.colorDefault||"#ffffff";return e.record.color!==t})},_hasTextChanges:function(){var e=this.createNewRecord();return this.prepareData(e),this.customPrepare&&this.customPrepare(e),e.text.some(function(e){return 0!==e.contents.trim().length})},isPristine:function(){return!this._hasTextChanges()&&!this._hasColorChanges()},_createPills:function(e,t){var i=[],n=this;return e.forEach(function(e,s){e.index=s;var r=new UI.Pill({text:e.name,eventData:e,customClass:t});n.appendChild(r),n.pills.push(r),i.push(r)}),i},_renderAllPills:function(e,t){e.forEach(function(e){e.render(t)})},_bindPills:function(e,t){e.forEach(function(e){e.bind("activate",t)})},_pillClickHandler:function(e){var t=e.data;Helpers.GlobalEventTracker.track("subcategoryBubble:clicked",{label:t.value,value:t.index})},_setApparelExperienceVersion:function(e){var t,i=Helpers.App.getAllApparelVariant();switch(i){case"B":t=this._createPills(e.slice(0,8),""),this._renderAllPills(t,$(".hero-unit .form-container")),this._bindPills(t,this._pillClickHandler.bind(this));break;case"C":t=this._createPills(e.slice(0,8),"dark"),this._renderAllPills(t,$(".subcategories-cont")),this._bindPills(t,this._pillClickHandler.bind(this));break;case"D":t=this._createPills(e.slice(0,12),"dark"),this._bindPills(t,this._pillClickHandler.bind(this)),this.subCatCarousel=new UI.PillCarousel({items:t}).render($(".subcategories-cont"))}}}}),Class(UI.CustomExperience,"Page").inherits(UI.BasePage).includes(CustomEventSupport,NodeSupport)({prototype:{init:function(e){UI.BasePage.prototype.init.call(this,e);var t=this;return this.header=this.element.find(".hero-unit"),this.clearFiltersButton=this.element.find("#clear-filters-btn"),this.listStage=this.element.find(".list-stages-b, .list-stages-c"),$(".modal-backdrop.fade").css("z-index","1043"),this.appendChild(new UI.SimpleModal({name:"smartTemplateModal"})).render($(document.body)),this.smartTemplateModal.setContent(""),this.smartTemplateModal.setHeaderContent(""),this.smartTemplateModal.addCloseButton(),this.bind("showModal",function(){$(".modal-backdrop.fade").css("z-index","1043"),smartTemplate.smartTemplateModal.activate()}),this.bind("hideModal",function(){smartTemplate.smartTemplateModal.deactivate()}),this.appendChild(new UI.CustomExperience.Header({name:"header",element:this.header})),this.appendChild(new UI.CustomExperience.Grid({name:"grid",element:this.gridContainer,filtersOff:this.filtersOff,isNlpEnabled:this.isNlpEnabled()})),this.listStage.find(".carousel-item a[href]").each(function(e,i){i.addEventListener("click",function(){t._bindCarouselTrackingEvents(i)})}),this._bindings(),this},requestNewPage:function(e){var t,i,n;if(t=window.location.pathname,i=window._pl_custom_experience_full_url||location.href,["newest","best-selling","mixed","free"].indexOf(e.key)>=0)return Helpers.App.replaceUrlParam("sortby",e.key),"page"!==e.mode||isNaN(parseInt(e.value))||Helpers.App.replaceUrlParam("page",e.value),location.href;n=Helpers.App.getAllURLParams(),delete n.search,delete n.f_types,delete n.f_devices,delete n.f_tags,delete n.f_gender,delete n.f_age,delete n.f_ethnicity,delete n.h,delete n.page,delete n["new"];var s={};switch(s.search=Helpers.App.getUrlParam("search",location.href),s.page=null,s.f_types=Helpers.App.getUrlParam("f_types",i),s.f_devices=Helpers.App.getUrlParam("f_devices",i),s.f_tags=Helpers.App.getUrlParam("f_tags",i),s.f_gender=Helpers.App.getUrlParam("f_gender",i),s.f_age=Helpers.App.getUrlParam("f_age",i),s.f_ethnicity=Helpers.App.getUrlParam("f_ethnicity",i),s.h=Helpers.App.getUrlParam("h",i),s.titles=Helpers.App.getUrlParam("titles",i),s.filters=Helpers.App.getUrlParam("filters",i),e.mode){case"page":s.page=e.value;break;case"filter":if(s[e.key]){var r,o;r=s[e.key].split(","),o=r.indexOf(e.value),o>-1?r.splice(o,1):r.push(e.value),s[e.key]=r.join()}else s[e.key]=e.value;s.ignore=!0;break;case"filters-reset":delete s.f_types,delete s.f_devices,delete s.f_tags,delete s.f_gender,delete s.f_age,delete s.f_ethnicity,s.ignore=!0}for(var a in n)s[a]=n[a];var l="";return e.heading&&s.f_devices&&1==s.f_devices.split(",").length&&""!==s.f_devices?s.h=e.heading:delete s.h,Object.keys(s).length&&(l="?"+Object.keys(s).filter(function(e){return"undefined"!=typeof s[e]&&null!==s[e]&&""!==s[e]}).map(function(e){return e+"="+encodeURIComponent(s[e])}).join("&")),t+l},_bindings:function(){var e=this;if(UI.BasePage.prototype._bindings.call(this),this.header.bind("customExperience.change",function(t){e.grid.update(t.data)}),this.header.bind("customExperience.removeImage",function(t,i){e.grid.returnToPlaceholder(i),e.header.isPristine()===!1&&e.header.process()}),this.filters){this.filters.bind("filters:filtering",this._filtersFilteringHandler.bind(this)),this.filters.bind("filters:click",this._filtersClickHandler.bind(this));var t=function(){location.href=e.requestNewPage({mode:"filters-reset"})};this.filters.bind("filters:none",t),this.clearFiltersButton.click(t)}return this.topFilters&&(this.topFilters.bind("filters:filtering",this._filtersFilteringHandler.bind(this)),this.topFilters.bind("filters:click",this._filtersClickHandler.bind(this))),this.paginator&&this.paginator.bind("paginator:change",function(e){var t={mode:"page",value:e.data.pageNumber},i=Helpers.App.getUrlParam("sortby",location.href);i&&(t.key=i),location.href=this.requestNewPage(t)}.bind(this)),this.mobileFilterBtn.bind("click",function(){if(Helpers.App.isMobileDevice()===!0){var e=this.mobileFilterBtn.offset().top-50;e>0&&$("html, body").animate({scrollTop:e},300,"swing")}}.bind(this)),this.grid.bind("purchase.failed",function(t){e.dispatch("purchase.failed",t.data)}),this.grid.bind("purchase.success",function(t){e.dispatch("purchase.success",t.data)}),this.grid.bind("thumbnailPreview",function(t){e.dispatch("thumbnailPreview",t.data)}),this},_filtersFilteringHandler:function(e){location.href=this.requestNewPage({mode:"filter",key:e.data.key,value:e.data.value,heading:e.data.heading})},_filtersClickHandler:function(e){var t=this.requestNewPage({mode:"filter",key:e.data.key,value:e.data.value,heading:e.data.heading});e.data.$anchor.attr("href",t)},isNlpEnabled:function(){var e=Helpers.App._getUrlParamsFromHref().graph_id||"";return window.experience&&window.experience.isNlpEnabled===!0&&e.length>0},_bindCarouselTrackingEvents:function(e){var t=this.listStage.data("carousel-name"),i=e.getAttribute("href");Helpers.GlobalEventTracker.carouselClick(t,Helpers.App.getSlugFromStageURL(i,!0))}}}),Class(UI.CustomExperience,"Utils")({prototype:{_ignoreList:["additional-tags-trigger","additional-devices-trigger"],hideSortby:function(){var e=document.querySelectorAll(".homepage-filter .mobile-filter-select .dropdown-menu.inner li");$(e).find(".all").hide(),$(e).find(".new").hide(),$(e).find(".best-selling").hide(),$(e).find(".free").hide(),$(".filters-sortby").hide(),$(".filters-top-bar .filters-sortby-ctn").hide()},getCategoryItems:function(e){var t=[],i=!1,n=Helpers.App.isMobile()?$(".homepage-filter .mobile-filter-select .dropdown-menu.inner").find("li"):$(".homepage-filter .desktop-filter-select .dropdown-menu.inner").find("li");return n.each(function(n,s){var r=s.querySelectorAll("dt");r[0]&&(i=r[0].children[0].innerHTML===e?!0:!1),i&&t.push(s)}),t},hideCategoryItems:function(e,t){var i,n=this.getCategoryItems(e),s=this._ignoreList;n.forEach(function(e){$(e).has("ul").length||-1!==s.indexOf(e.id)||(i=e.querySelectorAll("a span")[0].firstChild.textContent.trim(),-1!==t.indexOf(i)&&("DT"===e.firstElementChild.nodeName?$(e.lastElementChild).hide():$(e).hide()))}),this._hideCategoryItemsFromTopBar(e,t)},_hideCategoryItemsFromTopBar:function(e,t){var i=e.toLowerCase().trim().replace(/ /g,"-"),n="#top-"+i+"-dropdown",s=$(n),r=0;s.find(".dropdown-menu li a").each(function(e,i){var n=$(i).find(".item-name").text();-1!==t.indexOf(n)&&($(i).hide(),$('.applied-filter[data-item-name="'+n.trim()+'"]').remove(),r++)}),s.find(".dropdown-menu li a").size()===r&&s.hide()},hideAllCategoryItemsBut:function(e,t){var i,n=this.getCategoryItems(e),s=this._ignoreList,r=null;n.forEach(function(n){if($(n).has("ul").length||-1!==s.indexOf(n.id))return void $(n).hide();if(i=n.querySelectorAll("a span")[0].firstChild.textContent.trim(),-1===t.indexOf(i))$(n).hide();else if(r)$(r).after(n);else{if(r=n,"DT"===n.firstElementChild.nodeName)return;$(n).prepend('<dt><span class="text">'+e+"</span></dt>")}}),this._hideAllCategoryItemsButFromTopBar(e,t)},_hideAllCategoryItemsButFromTopBar:function(e,t){var i=e.toLowerCase().trim().replace(/ /g,"-"),n="#top-"+i+"-dropdown",s=$(n),r=0;s.find(".dropdown-menu li a").each(function(e,i){var n=$(i).find(".item-name").text();-1===t.indexOf(n)&&($(i).hide(),$('.applied-filter[data-item-name="'+n.trim()+'"]').remove(),r++)}),s.find(".dropdown-menu li a").size()===r&&s.hide()}}}),Class("UiJsonMapSupport")({MAPPER_CLASS_PATH:{development:"https://s3.amazonaws.com/nice-assets-staging/components/service_api/lib/ui_json_map.js",staging:"https://s3.amazonaws.com/nice-assets-staging/components/service_api/lib/ui_json_map.js",production:"https://s3.amazonaws.com/nice-assets/components/service_api/lib/ui_json_map.js"},fetch:function(){var e=window.environment,t=document.createElement("script");t.src=this.MAPPER_CLASS_PATH[e],document.head.appendChild(t)}}),Module("PinchDetectSupport")({prototype:{previousDistance:0,touchMoveHandler:null,touchEndHandler:null,boundElement:null,bindPinch:function(e){this.boundElement=e,this.touchMoveHandler=this._touchMoveHandler.bind(this),this.touchEndHandler=this._touchEndHandler.bind(this),e.addEventListener("touchmove",this.touchMoveHandler),e.addEventListener("touchend",this.touchEndHandler)},unbindPinch:function(){this.boundElement.removeEventListener(this.touchMoveHandler),this.boundElement.removeEventListener(this.touchEndHandler)},_getDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(t.clientY-e.clientY,2))},_touchMoveHandler:function(e){var t,i,n=e.touches||e.originalEvent.touches;2===n.length&&(t=this._getDistance(n[0],n[1]),0!==this.previousDistance?(i=t/this.previousDistance,this.previousDistance=t,this.dispatch("pinch",{deltaDistance:i,distance:t})):(i=0,this.previousDistance=t))},_touchEndHandler:function(){this.previousDistance=0,this.dispatch("pinchend")}}}),Class(UI,"CropperModal").inherits(Widget).includes(PinchDetectSupport)({elementClass:"cropper-object-image",html:'        <div class="modal cropper-overlay fade" id="cropperOverlay" tabindex="-1" role="dialog" arial-labelledby="cropperOverlayLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">          <button type="button" class="close circle" data-dismiss="modal" aria-hidden="true">&times;</button>          <div class="modal-dialog">            <div class="modal-content">              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>              <div class="modal-header">              </div>              <div class="modal-body">              </div>            </div>          </div>        </div>    ',_cropperTemplate:'        <div class="cropper-object-image">          <div class="cropMain"></div>          <div class="cropControls">            <div class="cropSlider"></div>            <div class="zoomInputContainer"><input type="number" step="1" class="zoomInput"></div>            <div class="seekable-timeline-container"></div>            <button class="crop-and-trim-button is-hidden button primary">Crop & Trim</button>            <div class="cropButtons">                <button class="cropButton button primary button-sh">Crop</button>                <button class="reset-cropper button secondary button-sh">Reset</button>            </div>          </div>        </div>    ',ERROR_MESSAGES:{imageDimensions:"The height or width of your image is larger than 7500 pixels.             Please upload a smaller resolution image! Click             <a target='_blank' href='https://blog.placeit.net/resize-images-placeit/'>here</a> for help.",imageFormat:"Unfortunately your file is not supported, we support jpg, jpeg, and png",video:"Couldn\u2019t load video"},INVALID_ZOOM_INPUT_CHARS:["-","+","e","E"],STOPPED_ZOOM_INPUT_KEYCODES:[13,27,37,38,39,40],prototype:{$window:null,$modalBody:null,$cropperContainer:null,$cropperModalBody:null,$cropperModalContent:null,$cropMain:null,$cropContainer:null,$lines:null,$cropButton:null,$zoomInput:null,$resetButton:null,$cropAndTrimButton:null,cropperObject:null,_viewportDimensions:null,_fixedCropperModalWithBackdropBreakpointsLabels:{SMALL:"SMALL",MEDIUM:"MEDIUM",LARGE:"LARGE",XLARGE:"XLARGE",ALL:"ALL"},_fixedCropperModalWithBackdropBreakpointsWidth:{SMALL:47,MEDIUM:180,LARGE:267,XLARGE:450,ALL:"ALL"},_fixedCropperModalWithBackdropWidthAndHeight:{LARGE:[253.75,404],MEDIUM:[140,240],SMALL:[86.25,138],ALL:[16.25,26]},active:!1,allowBackdrop:!1,BACKDROP_VIEWPORT_FIXED_WIDTH_OFFSET:800,BACKDROP_VIEWPORT_WIDTH:750,BACKDROP_VIEWPORT_HEIGHT:1200,CROP_SPACE:80,MIN_WIDTH_MODAL:362,pinchHandler:null,pinchEndHandler:null,stageInfo:null,zoomRange:null,init:function(e){Widget.prototype.init.call(this,e),this.stageInfo=Helpers.StageType.getStageInfo(),this.$window=$(window),this.$modalBody=this.element.find(".modal-body"),this._bindEvents()},_bindEvents:function(){return this._arrowKeysHandler=this._arrowKeysHandler.bind(this),this.pinchHandler=this._pinchHandler.bind(this),this.pinchEndHandler=this._pinchEndHandler.bind(this),this.element.on("keydown",function(e){13===e.which&&(this._applyCrop(),Helpers.GlobalEventTracker.cropKeydownEnter({stage_type:Helpers.StageType._types[window._stageData.stage_data.image_type]}))}.bind(this)),this.element.on("click",".cropButton, .crop-and-trim-button",function(){this._applyCrop()}.bind(this)),this.element.on("click",".reset-cropper",function(){return this.cropperObject.imgReset(),!1}.bind(this)),this.element.on("click",".close",function(){this.dispatch("modal.cancel"),this.deactivate()}.bind(this)),this.element.bind("keydown",function(e){27===e.keyCode&&(this.dispatch("modal.cancel"),this.deactivate())}.bind(this)),this.element.on("hidden.bs.modal",function(){this.cropperObject.destroy()}.bind(this)),this.bind("pinch",this.pinchHandler),this.bind("pinchend",this.pinchEndHandler),this},_arrowKeysHandler:function(e){var t,i;return this.active!==!0?!1:(t=0,i=0,37===e.which?t=1:38===e.which?i=1:39===e.which?t=-1:40===e.which&&(i=-1),this.cropperObject.imgMove({t:i,l:t}),this)},_newCropInstance:function(e){return this.$modalBody.empty(),this.$modalBody.html(this.constructor._cropperTemplate),this.element.hasClass("live")?this.CROP_SPACE=0:this.CROP_SPACE=80,this.cropperObject=null,this.cropperObject=new CROP(this.CROP_SPACE/2),this.cropperObject.setConstraints(e.cropperConstraints).init(".cropper-object-image",e.isVideo),this.$cropperContainer=this.element.find(".cropper-object-image"),this.$cropperModalContent=this.element.find(".modal-content"),this.$cropperModalBody=this.element.find(".modal-body .cropper-object-image"),this.$cropMain=this.element.find(".cropMain"),this.$cropContainer=this.element.find(".crop-container").addClass("with-shadow"),this.$lines={top:this.$cropperContainer.find(".cropper-top-line"),right:this.$cropperContainer.find(".cropper-right-line"),bottom:this.$cropperContainer.find(".cropper-bottom-line"),left:this.$cropperContainer.find(".cropper-left-line")},this.$cropButton=this.element.find(".cropButton"),this.$resetButton=this.element.find(".reset-cropper"),this.$cropAndTrimButton=this.element.find(".crop-and-trim-button"),this.zoomRange=this.cropperObject.getZoomRange(),this.bindPinch(this.element[0]),this._setZoomInput(),this.cropperObject.eles.ele.bind("imageLoaded",function(e){this.element.removeAttr("style"),this._setZoomToInput(),this.dispatch("imageLoaded",e)}.bind(this)),this.cropperObject.eles.img.bind("error",function(e){var t;this.element.hide(),t=this.cropperObject.isVideo===!0?this.constructor.ERROR_MESSAGES.video:this.constructor.ERROR_MESSAGES.imageFormat,this.dispatch("imageLoadError",{message:t})}.bind(this)),this.cropperObject.eles.ele.bind("imageDimensionsExceeded",function(e){this.element.hide(),this.dispatch("imageLoadError",{message:this.constructor.ERROR_MESSAGES.imageDimensions,sizeExceeded:!0})}.bind(this)),this.cropperObject.eles.ele.bind("cropperChange",function(){this._setZoomToInput(),this.dispatch("cropperChange")}.bind(this)),this},_setZoomInput:function(){this.$zoomInput=this.element.find(".zoomInput"),this.$zoomInput.attr("min",100*this.zoomRange[0]),this.$zoomInput.attr("max",100*this.zoomRange[1]),this._bindZoomInputEvents()},_bindZoomInputEvents:function(){var e=this,t=Utils.bindFn(this);this.$zoomInput.on("change",function(){e._filterZoomInput(this),e.cropperObject.setZoom(this.value/100),e.dispatch("cropperChange")}).on("keydown",t(this._onZoomInputKeydown))},_onZoomInputKeydown:function(e){this.constructor.STOPPED_ZOOM_INPUT_KEYCODES.includes(e.keyCode)&&e.stopPropagation(),[46,8,9,27,13,110].includes(e.keyCode)||!(65!==e.keyCode&&86!==e.keyCode&&67!==e.keyCode||e.ctrlKey!==!0&&e.metaKey!==!0)||e.keyCode>=35&&e.keyCode<=40||/^[0-9]+$/.test(e.key)===!1&&e.preventDefault()},_filterZoomInput:function(e){var t=100*this.zoomRange[0],i=100*this.zoomRange[1],n=parseInt(e.value,10);!n||t>n?n=t:n>i&&(n=i),e.value=n},_setZoomToInput:function(){var e=100*this.cropperObject.getCurrentZoom();this.$zoomInput.val(parseInt(e,10))},_getViewportDimensions:function(){return this._viewportDimensions},_loadImage:function(e){return e=e.substring(e.search("/uploads"),e.length),this.cropperObject.loadImg(e),this},setAllowBackdrop:function(e){this.allowBackdrop=e},_allowBackdrop:function(){return Boolean(this.allowBackdrop&&this.stageInfo&&this.stageInfo.backdrop_data)},_adjustBackdropViewportVerticalPosition:function(e){var t={"padding-top":"0px","background-position":"center 32px"};switch(e){case this._fixedCropperModalWithBackdropBreakpointsLabels.LARGE:t={"padding-top":"90px","background-position":"center -5px"};break;case this._fixedCropperModalWithBackdropBreakpointsLabels.MEDIUM:t={"padding-top":"40px"};break;case this._fixedCropperModalWithBackdropBreakpointsLabels.SMALL:t={"padding-top":"6px"};break;default:t={"padding-top":"0px","background-position":"center 32px"}}this.$cropperModalBody.css(t)},_getCropperModalCurrentFixedBreakpoint:function(e){return e>=this._fixedCropperModalWithBackdropBreakpointsWidth.LARGE?this._fixedCropperModalWithBackdropBreakpointsLabels.LARGE:e>=this._fixedCropperModalWithBackdropBreakpointsWidth.MEDIUM?this._fixedCropperModalWithBackdropBreakpointsLabels.MEDIUM:e>=this._fixedCropperModalWithBackdropBreakpointsWidth.SMALL?this._fixedCropperModalWithBackdropBreakpointsLabels.SMALL:this._fixedCropperModalWithBackdropBreakpointsLabels.ALL},_getFixedBackdropCropperDimensions:function(e){return this._fixedCropperModalWithBackdropWidthAndHeight[e]||this._fixedCropperModalWithBackdropWidthAndHeight.ALL},_getViewportDivisor:function(e,t){return e>0?e:t},_getBackdropImageURI:function(){var e=this;return e.stageInfo&&e.stageInfo.backdrop_data&&e.stageInfo.backdrop_data.image?e.stageInfo.backdrop_data.image.url:void 0},_getViewportScale:function(e,t){var i=this;return e/i._getViewportDivisor(t,e)},_getNewViewportWidth:function(e,t){var i=this;return(e+i.BACKDROP_VIEWPORT_FIXED_WIDTH_OFFSET)*t},_setVerticalAlignCenterOnlyWithBackdrop:function(){var e=this;e._allowBackdrop()&&e.element.css({display:"flex","align-items":"center"})},_addBackdropClass:function(){var e=this;e.element.addClass("backdrop"),e._setVerticalAlignCenterOnlyWithBackdrop()},_setBackdropAsBackground:function(e,t){var i=this;i.$cropperContainer.css("background-image","url("+e+")").css("background-size",t+"px auto")},_isLargeSize:function(e){return e>=this._fixedCropperModalWithBackdropBreakpointsWidth.MEDIUM},_successBackdropImageLoad:function(e,t,i){var n=this;n._addBackdropClass();var s=n._getViewportScale(e.height,t.height),r=n._getNewViewportWidth(i.width,s);n._setBackdropAsBackground(i.src,r),n._isLargeSize(e.width)&&n._setModalWidth(n._fixedCropperModalWithBackdropBreakpointsWidth.XLARGE)},_errorBackdropImageLoad:function(){var e=this.constructor.ERROR_MESSAGES.imageFormat;this.element.hide(),this.cropperObject.isVideo===!0&&(e=this.constructor.ERROR_MESSAGES.video),this.dispatch("imageLoadError",{message:e})},_loadBackdropImage:function(){var e=this._getBackdropImageURI(),t=new Image;t.src=e;var i=function(e,i){t.onload=function(){e(t)},t.onerror=function(){i()}};return new Promise(i)},_backdropSetup:function(e,t){var i=this;i._loadBackdropImage().then(function(n){i._successBackdropImageLoad(e,t,n)})["catch"](function(){i._errorBackdropImageLoad()})},_backdropRemove:function(){this.element.hasClass("backdrop")&&(this.element.removeClass("backdrop"),this._moveCloseButtonWithinLayout())},_moveCloseButtonOutsideLayout:function(){this.element.prepend(this.$cropperModalContent.find(".close").detach())},_moveCloseButtonWithinLayout:function(){this.$cropperModalContent.prepend(this.element.find(".close").detach())},_resizeContainers:function(){var e,t;if(e=this._getViewportDimensions(),t=this._getCropperDimensions(e.width,e.height),this._backdropRemove(),this._allowBackdrop()){this._moveCloseButtonOutsideLayout();var i=this._getCropperModalCurrentFixedBreakpoint(t.width);this._adjustBackdropViewportVerticalPosition(i);var n=this._getFixedBackdropCropperDimensions(i);t.width=n[0],t.height=n[1],e.width=this.BACKDROP_VIEWPORT_WIDTH,e.height=this.BACKDROP_VIEWPORT_HEIGHT,this._backdropSetup(t,e)}return this._resizeCropperArea({width:t.width+this.CROP_SPACE,height:t.height+this.CROP_SPACE}),this._updateCropperLinesPosition({width:t.width,height:t.height}),this._setModalWidth(t.width),this},_setModalWidth:function(e){var t,i,n;n=this.CROP_SPACE,t=42+n,i=e+t>=this.MIN_WIDTH_MODAL?e+t:this.MIN_WIDTH_MODAL,this.element.find(".modal-dialog").width(i)},_getCropperDimensions:function(e,t){var i,n,s,r,o,a,l;return a=this.CROP_SPACE,i=this.$window.width(),n=this.$window.height(),o=78+a,s=i-o,l=this.cropperObject.isVideo?67:0,heightConstraint=244+l+a,r=n-heightConstraint,fitHorizontally=function(){cropperWidth=s,cropperHeight=t/e*cropperWidth},fitVertically=function(){cropperHeight=r,cropperWidth=e/t*cropperHeight},e>=s?(fitHorizontally(),cropperHeight>r&&fitVertically()):(fitVertically(),cropperWidth>s&&fitHorizontally()),{width:cropperWidth,height:cropperHeight}},_setCustomBorderShadow:function(){var e=$("<div></div>"),t=this.$lines.top,i=this.$lines.left;e.css({"box-sizing":"border-box",border:"solid rgba(0, 0, 0, 0.3)","pointer-events":"none",top:0,left:0,width:"100%",height:"100%","border-top-width":t.css("top"),"border-left-width":i.css("left"),"border-bottom-width":this.$cropContainer.height()-(parseInt(t.css("top"))+i.height()+t.height())+"px","border-right-width":this.$cropContainer.width()-(parseInt(i.css("left"))+t.width()+i.width())+"px",position:"absolute","z-index":6e3}),this.$cropContainer.append(e)},_resizeCropperArea:function(e){return this.$cropMain.css({width:e.width,height:e.height}),this.$cropContainer.css({width:e.width,height:e.height}),this},_updateCropperLinesPosition:function(e,t){return t||(t={top:40,left:40}),this.$lines.top.css({width:e.width,top:t.top+"px",left:t.left+"px"}),this.$lines.bottom.css({width:e.width,top:t.top+e.height+"px",left:t.left+"px"}),this.$lines.left.css({height:e.height,top:t.top+"px",left:t.left+"px"}),this.$lines.right.css({height:e.height,top:t.top+"px",left:t.left+e.width+"px"}),this},_applyCrop:function(){var e,t;return e=this,this.cropperDebounce&&clearTimeout(this.cropperDebounce),this.cropperDebounce=setTimeout(function(){return e.deactivate(),(t=e._getImageScale())?(e.dispatch("cropImage",e._getParamsFromCropper()),!1):!1},200),this},_getImageScale:function(){var e,t=this.element.find(".crop-img"),i=parseFloat(t.get(0).style.width,10);return 0===t.length?!1:(e=t.get(0).naturalWidth,"VIDEO"===t[0].tagName&&(e=t[0].videoWidth),i/e)},_getImageDimensions:function(){var e=this.element.find(".crop-img");return 0===e.length?!1:{width:e.width(),height:e.height()}},_getCropAreaDimensions:function(){return{width:this.$cropMain.width()-this.CROP_SPACE,
height:this.$cropMain.height()-this.CROP_SPACE}},_getParamsFromCropper:function(){var e,t,i,n,s,r,o,a;e=this.element.find(".crop-img");var l,c;return c=this.CROP_SPACE/2,8===_stageData.stage_data.image_type||14===_stageData.stage_data.image_type?(t=this._getImageDimensions(),i=this._getCropAreaDimensions(),n=parseInt(e.css("left"),10)-c,s=parseInt(e.css("top"),10)-c,l={id:this.productShot.id,x:n,y:s,width:i.width,height:i.height,scale:this._getImageScale(),new_width:t.width,new_height:t.height}):(a=this.cropperObject.imgInfo,r=parseInt(e.css("top"),10)-c,o=parseInt(e.css("left"),10)-c,l={id:this.productShot?this.productShot.id:null,actual_height:a.ah,actual_left:a.al,actual_top:a.at,actual_width:a.aw,new_width:a.w,new_height:a.h,top:r,left:o,zoom:a.s,longer_side:this.cropperObject.imgInfo.longerSide,image_element_top:a.t,image_element_left:a.l}),l.trim_start=this.cropperObject.getVideoTrimStart(),l.trim_end=this.cropperObject.getVideoTrimEnd(),l},setViewportDimensions:function(e){return this._viewportDimensions=e,this},loadProductShotData:function(e,t){return this.productShot=e,this._newCropInstance(t),this._resizeContainers(),this.element.show(),this._loadImage(this.productShot.user_image_path),this},loadImage:function(e,t){return this._newCropInstance(e),this._resizeContainers(),this.element.show(),this.cropperObject.loadImg(t,e.existingImageInfo),this},_pinchHandler:function(e){var t=e.data.deltaDistance,i=t*this.cropperObject.getCurrentZoom();i<this.zoomRange[0]&&(i=this.zoomRange[0]),i>this.zoomRange[1]&&(i=this.zoomRange[1]),this.cropperObject.toggleMovementLock(!0),this.cropperObject.setZoom(i),this._setZoomToInput(),this.dispatch("cropperChange")},_pinchEndHandler:function(e){this.cropperObject.toggleMovementLock(!1)},loadVideo:function(e,t){if(this.cropperConfig=e,e.isVideo=!0,!e.videoInfo.fragmentDuration){var i=page.stage.stageImageWidget.getVideoDuration();Helpers.GlobalEventTracker.smartTemplateEvent("cropNTrim-missingSlideDuration",{recordId:page.stage.record.id}),i||(Helpers.GlobalEventTracker.smartTemplateEvent("cropNTrim-cannotGetVideoDurationFallback",{recordId:page.stage.record.id}),i=e.videoInfo.duration),e.videoInfo.fragmentDuration=i}return this._newCropInstance(e),this._resizeContainers(),this.element.show(),this.$cropButton.hide(),this.$resetButton.hide(),this.$cropAndTrimButton.removeClass("is-hidden"),this.cropperObject.loadVideo(t,e.existingImageInfo,e.videoInfo),this},setHeaderText:function(e){var t=this.element.find(".modal-header");t.html("<p> <strong>"+e+"</strong> </p>")},activate:function(){return Widget.prototype.activate.call(this),this.active=!0,this.element.modal("show"),this.element.on("keydown",this._arrowKeysHandler),this._setVerticalAlignCenterOnlyWithBackdrop(),this},deactivate:function(){return Widget.prototype.deactivate.call(this),this.setAllowBackdrop(!1),this.active=!1,this.element.modal("hide"),this.element.off("keydown",this._arrowKeysHandler),this.unbindPinch(),this},getImageElement:function(){return this.element.find(".crop-img").get(0)}}}),Class("CropperLocalUploader")({upload:function(e){var t=this;return new Promise(function(i,n){t._getBase64(e).then(function(e){i(t._buildMock(e))})["catch"](n)})},_buildMock:function(e){var t=this._generateUid(10);return{id:t,user_image_filename:"user_image.jpeg",user_image_url:e}},_getBase64:function(e){return new Promise(function(t,i){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){t(n.result)},n.onerror=function(e){i(e)}})},_generateUid:function(){var e=function(t){var i,n,s,r;for(t=t||32,n="",s=0,r=14,i=0;t>i;i++)n+=e.codes[Math.floor(Math.random()*(r-s+1))+s];return n};return e.codes=[0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f"],e}()}),Class("CropperLocalCropper")({PERSIST_URL:"/cropper/persist",SLOW_CONNECTION_ALERT:{time:3e4,message:"This is taking longer than usual, check your internet connection and try again"},crop:function(e,t){var i,n;return i=this,n={},n.id=t.id,n.user_image_filename=e.name,n.crop_params=t,new Promise(function(s,r){i._getBase64(e).then(function(e){return n.user_image_url=e,CropResize.run(e,t).then(function(e){return n.cropped_image_url=e,CropResize.generateThumbnail(e).then(function(e){n.thumbnail_url=e,s(n)})["catch"](r)})["catch"](r)})["catch"](r)})},persist:function(e,t){var i,n,s,r;return i=this,n={userImage:e.user_image_url,croppedImage:e.cropped_image_url,thumbnail:e.thumbnail_url,cropParams:e.crop_params},s=function(){var e=P.delay(i.SLOW_CONNECTION_ALERT.time);return r=P.runner(Promise.reject(!0)),Promise.race([e,r])},s().then(function(){"function"==typeof t&&t(i.SLOW_CONNECTION_ALERT.message)})["catch"](function(){}),new Promise(function(e,t){console.log("#persist"),$.ajax({method:"POST",url:i.PERSIST_URL,data:JSON.stringify(n),processData:null,contentType:"application/json"}).done(function(t){r.run(),e(t)}).fail(function(e){r.run(),t(e)})})},_getBase64:function(e){return new Promise(function(t,i){if(e instanceof File==!1)return t(e);var n=new FileReader;n.readAsDataURL(e),n.onload=function(){t(n.result)},n.onerror=function(e){i(e)}})}}),Class("CropperRemote")({CROP_URL:"/cropper/crop",CROP_VIDEO_URL:"/cropper/cropVideo",UPLOAD_URL:"/cropper/upload",UPLOAD_VIDEO_URL:"/cropper/uploadVideo",cropImage:function(e){return new Promise(function(t,i){$.ajax(CropperRemote.CROP_URL,{method:"POST",data:e}).done(t).fail(i)})},cropVideo:function(e){return new Promise(function(t,i){$.ajax(CropperRemote.CROP_VIDEO_URL,{method:"POST",data:e}).done(t).fail(i)})},uploadImage:function(e){return new Promise(function(t,i){var n=new FormData;n.append("user_image",e,e.name),$.ajax({url:CropperRemote.UPLOAD_URL,data:n,method:"POST",processData:!1,contentType:!1,cache:!1}).done(t).fail(i)})},uploadImageCropTool:function(e){return new Promise(function(t,i){var n=new FormData;n.append("user_image",e,e.name),n.append("cropperResize",!0),n.append("referrer","image-crop-tool"),$.ajax({url:CropperRemote.UPLOAD_URL,data:n,method:"POST",processData:!1,contentType:!1,cache:!1}).done(t).fail(i)})},uploadImageURI:function(e){return new Promise(function(t,i){var n=new FormData;n.append("user_image_url",e),$.ajax({url:CropperRemote.UPLOAD_URL,data:n,method:"POST",processData:!1,contentType:!1,cache:!1}).done(t).fail(i)})},uploadVideo:function(e){return new Promise(function(t,i){var n=new FormData;n.append("user_video",e,e.name),$.ajax({url:CropperRemoteUploader.UPLOAD_VIDEO_URL,data:n,method:"POST",processData:!1,contentType:!1,cache:!1}).done(t).fail(i)})}}),Class("CropperRemoteCropper")({CROP_URL:"/cropper/crop",CROP_VIDEO_URL:"/cropper/cropNTrimVideo",crop:function(e){return new Promise(function(t,i){$.ajax(CropperRemoteCropper.CROP_URL,{method:"POST",data:e}).done(t).fail(i)})},cropVideo:function(e){return e.viewport.width=Math.ceil(e.viewport.width),e.viewport.height=Math.ceil(e.viewport.height),new Promise(function(t,i){$.ajax(CropperRemoteCropper.CROP_VIDEO_URL,{method:"POST",data:e}).done(t).fail(i)})}}),Class("CropperRemoteUploader")({UPLOAD_URL:"/cropper/upload",UPLOAD_VIDEO_URL:"/cropper/uploadVideo",UPLOAD_BY_URL:"/cropper/uploadByUrl",UPLOAD_VIDEO_BY_URL:"/cropper/uploadVideoByUrl",UPLOAD_VIDEO_BY_PUBLIC_URL:"/cropper/uploadVideoByPublicUrl",STORE_VIDEO:"/cropper/storeVideo",upload:function(e){return new Promise(function(t,i){var n=new FormData;n.append("user_image",e,e.name),"undefined"!=typeof window._stageData&&Helpers.StageType.isCropperTool()&&n.append("cropperResize",!0),$.ajax({url:CropperRemoteUploader.UPLOAD_URL,data:n,method:"POST",processData:!1,contentType:!1,cache:!1}).done(t).fail(i)})},uploadURI:function(e){return new Promise(function(t,i){var n=new FormData;n.append("user_image_url",e),"undefined"!=typeof window._stageData&&Helpers.StageType.isCropperTool()&&n.append("cropperResize",!0),$.ajax({url:CropperRemoteUploader.UPLOAD_URL,data:n,method:"POST",processData:!1,contentType:!1,cache:!1}).done(t).fail(i)})},uploadVideo:function(e,t){return new Promise(function(i,n){var s=new FormData;t=t||{},s.append("user_video",e,e.name),$.ajax({url:CropperRemoteUploader.UPLOAD_VIDEO_URL,data:s,method:"POST",processData:!1,contentType:!1,cache:!1,headers:t}).done(i).fail(n)})},uploadByUrl:function(e){return new Promise(function(t,i){$.ajax(CropperRemoteUploader.UPLOAD_BY_URL,{method:"POST",data:e}).done(t).fail(i)})},uploadVideoByUrl:function(e){return new Promise(function(t,i){$.ajax(CropperRemoteUploader.UPLOAD_VIDEO_BY_URL,{method:"POST",data:e}).done(t).fail(i)})},uploadVideoByPublicUrl:function(e,t){return new Promise(function(i,n){$.ajax(CropperRemoteUploader.UPLOAD_VIDEO_BY_PUBLIC_URL,{method:"POST",data:e,headers:t}).done(i).fail(n)})},storeVideo:function(e,t){return new Promise(function(i,n){var s=new FormData;t=t||{},s.append("user_video",e,e.name),$.ajax({url:CropperRemoteUploader.STORE_VIDEO,data:s,method:"POST",processData:!1,contentType:!1,cache:!1,headers:t}).done(i).fail(n)})}}),Class("StateManager").includes(CustomEventSupport)({prototype:{_current:null,_widget:null,defaultState:null,_states:null,init:function(e){this._widget=e.widget,this._states=e.states,this.defaultState=e.defaultState},set:function(e){return this._current!==e?("function"==typeof this._states[e]?(this._states[e](this._widget),this._current=e):(this._states[this.defaultState](this._widget),this._current=this.defaultState),this.dispatch("changeState",{state:this._current}),this._current):void 0},get:function(){return this._current}}}),Class("UploadAssetSupport").includes(CustomEventSupport)({DELAYED_TIMEOUT:CropperLocalCropper.SLOW_CONNECTION_ALERT.time,createCustomGraphicConfirmButton:function(e,t){var i=UploadAssetSupport.createConfirmWidget("upload-confirm-button"),n=function(){return i.render(e),Promise.resolve(i)};return i.setImage(t)["catch"](function(){return Promise.resolve()}).then(n)},createConfirmWidget:function(e){var t=new UI.ConfirmWidget({name:"uploadConfirmButton",acceptButtonContent:'<span class="p-icon ic-retry"></span>',rejectButtonContent:'<span class="p-icon ic-close"></span>',messageContent:"Uploading Image...",spinnerContent:'<div class="pl-spinner-primary-sm relative"></div> ',cssClass:e});return Helpers.App.isMobile()===!0&&t.getElement().addClass("mobile"),t},confirmRetryBuilder:function(e,t,i){return function(){i.set("failed");var n=e().then(function(e){return i.set("uploading"),e});return Promise.race([n,t])}},shouldRetry:function(e){var t=e&&e.status;return 408===t||0===t?!0:!1},requestBuilder:function(e,t,i){return function(){var n=Promise.race([i.apply(null,arguments),e]);return Promise.race([n,P.timeout(UploadAssetSupport.DELAYED_TIMEOUT)])["catch"](function(e){"timeout"===e.message&&t.set("delayed")}),n}},createCancelPromise:function(e){return e("reject").then(function(){return Promise.reject(new Error("Cancelation Error"))})},createAcceptPromiseBuilder:function(e){return function(){return e("accept")}},retryableByConfirmBuilder:function(e,t,i){var n=UploadAssetSupport;return function(){var s=Utils.currying(Utils.createRetryableByConfirmation);s=s(n.shouldRetry);var r={widget:e,defaultState:"defaultState",states:UploadAssetStates},o=new StateManager(r);o.set(t);var a=Utils.promisifyEventBuilder(e),l=n.createCancelPromise(a),c=n.createAcceptPromiseBuilder(a),u=n.confirmRetryBuilder(c,l,o);s=s(u);var d=n.requestBuilder(l,o,i);return s=s(d),s.apply(null,arguments)["finally"](function(){o.set("defaultState")})}},customImageRetryableByConfirmBuilder:function(e){var t,i,n,s;s=e.widgetToControl,t=UploadAssetSupport.createAssetsGridConfirmButton(e.confirmWidgetTarget),t.setMessage(e.failMessage),i={widget:s,defaultState:"defaultState",states:e.states},n=new StateManager(i),n.bind("changeState",function(i){"failed"===i.data.state?(e.confirmWidgetTarget.addClass("cropping"),t.show()):(e.confirmWidgetTarget.removeClass("cropping"),t.hide())});var r=UploadAssetSupport;return function(){var i=Utils.currying(Utils.createRetryableByConfirmation);i=i(r.shouldRetry);var s=Utils.promisifyEventBuilder(t),o=r.createCancelPromise(s),a=r.createAcceptPromiseBuilder(s),l=r.confirmRetryBuilder(a,o,n);i=i(l);var c=r.requestBuilder(o,n,e.asyncFunction);return i=i(c),n.set("uploading"),i.apply(null,arguments)["finally"](function(){n.set("defaultState"),t.destroy()})}},createAssetsGridConfirmButton:function(e){var t=UploadAssetSupport.createConfirmWidget("asset-grid-confirm-button");return t.hide(),t.showAcceptButton(),t.hideSpinner(),t.addClass("confirm-alert"),t.render(e),t},persistRejectionHandler:function(e){if(!e)return Promise.reject();if("Cancelation Error"===e.message)return Promise.reject(e);var t={message:e.responseText,id:e.cropData&&e.cropData.id};return UploadAssetSupport.notifyPersistError(t),this.dispatch("stage.error",{message:UploadAssetSupport.getPersistErrorMessage(e),cropData:e.responseText}),Promise.reject(e)},notifyPersistError:function(e){Helpers.StageType.isFusionVideo()?Helpers.GlobalEventTracker.track("stage:video:persistError",e):Helpers.GlobalEventTracker.smartTemplateEvent("persistError",e)},getPersistErrorMessage:function(e){var t="We could not save your image, please try again";try{var i=JSON.parse(e);return"Validation"===e.typeError&&(t=i.message),t}catch(n){return t}}}),$.prototype.keydown=function(e){var t,i,n,s,r,o,a,l,c,u,d;if(d=$,t=d(this),n=t.parent(),u=n.data("this"),u&&u.options.container&&(n=u.$menu),i=d("[role=menu] li:not(.divider):visible a",n),i.length){if(/(38|40)/.test(e.keyCode))s=i.index(i.filter(":focus")),o=i.parent(":not(.disabled)").first().index(),a=i.parent(":not(.disabled)").last().index(),r=i.eq(s).parent().nextAll(":not(.disabled)").eq(0).index(),l=i.eq(s).parent().prevAll(":not(.disabled)").eq(0).index(),c=i.eq(r).parent().prevAll(":not(.disabled)").eq(0).index(),38==e.keyCode&&(s!=c&&s>l&&(s=l),o>s&&(s=o)),40==e.keyCode&&(s!=c&&r>s&&(s=r),s>a&&(s=a),-1==s&&(s=0)),i.eq(s).focus();else{var h={48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},p=[];i.each(function(){d(this).parent().is(":not(.disabled)")&&d.trim(d(this).text().toLowerCase()).substring(0,1)==h[e.keyCode]&&p.push(d(this).parent().index())});var f=d(document).data("keycount");f++,d(document).data("keycount",f);var m=d.trim(d(":focus").text().toLowerCase()).substring(0,1);m!=h[e.keyCode]?(f=1,d(document).data("keycount",f)):f>=p.length&&d(document).data("keycount",0),i.eq(p[f-1]).focus()}/(13|32)/.test(e.keyCode)&&(e.preventDefault(),d(":focus").click(),d(document).data("keycount",0))}},$(document).data("keycount",0).off("keydown","[data-toggle=dropdown], [role=menu]"),$(document).data("keycount",0).on("keydown","[data-toggle=dropdown], [role=menu]",$.prototype.keydown),UI.PreviewMode={},Class(UI.PreviewMode,"Controller")({isAssignedToPreviewModeExperiment:function(){var e={development:"QHkhSglp6fVQzQZ288:6q",staging:"QHkhSglp6fVQzQZ288:6q",production:"1fvVmOrosV6EfXY0Io:LL"},t=e[window.environment],i=$.cookie("experiment_id");return i&&i.match(t)?!0:!1},shouldPreviewModeBeAvailable:function(){return Helpers.App.isMobile()?!1:UI.PreviewMode.Controller.isAssignedToPreviewModeExperiment()},prototype:{_grid:null,_gridItems:[],_currentItemPointer:0,_previewModeModal:null,_gridType:"",init:function(e){this._gridType=e.gridType,this._itemDataStrategy={category:this._getItemDataForCategoryGrids,search:this._getItemDataForCategoryGrids,custom_experiences:this._getItemDataForCEGrids};var t=this;this._gridItems=e.gridItems,this._gridItems.forEach(function(e,i){e.element.off("click"),e.element.click(function(n){n.preventDefault(),t._onGridItemClicked(e,i)})})},_initModal:function(){if(!this._previewModeModal){var e=this;this._previewModeModal=new UI.PreviewMode.Modal({name:"this._previewModeModal",initialData:null,cssClass:"preview-mode-modal",dismissable:!0}),this._previewModeModal.bind("next",function(){e._onNextItemRequested()}),this._previewModeModal.bind("prev",function(){e._onPreviousItemRequested()}),this._previewModeModal.bind("close",function(){e._onPreviewModeModalClose()}),this._previewModeModal.bind("cta:clicked",function(){e._onModalCTAClicked()})}},_getItemData:function(e){return this._itemDataStrategy[this._gridType](e)},_getItemDataForCategoryGrids:function(e){var t=e.img.attr("data-src"),i="";return"15"===e.element.attr("data-stage-type-id")&&(i=e.video&&e.video.attr("data-src")||""),{imgSrc:t,videoSrc:i,stageId:e.stageID,title:e.element.find(".figure-title").text(),stageLink:e.anchor[1].href}},_getItemDataForCEGrids:function(e){var t=e.img.attr("src"),i=(e.img.attr("data-src"),"");return"15"===e.element.attr("data-stage-type-id")&&(i=e.video&&e.video.attr("data-src")||""),{imgSrc:t,videoSrc:i,stageId:e.stageID,title:e.element.find(".figure-title").text(),stageLink:e.anchor.attr("href")}},_onGridItemClicked:function(e,t){this._initModal(),this._currentItemPointer=t,this._updatePreviewOnModal(),this._toggleNavigationOnModal(),this._previewModeModal.activate()},_onNextItemRequested:function(){this._currentItemPointer++,this._updatePreviewOnModal(),this._toggleNavigationOnModal(),Helpers.GlobalEventTracker.previewModeNavigationNext()},_onPreviousItemRequested:function(){this._currentItemPointer--,this._updatePreviewOnModal(),this._toggleNavigationOnModal(),Helpers.GlobalEventTracker.previewModeNavigationPrev()},_updatePreviewOnModal:function(){var e=this._gridItems[this._currentItemPointer],t=this._getItemData(e);this._previewModeModal.setPreviewData(t)},_toggleNavigationOnModal:function(){0===this._currentItemPointer?this._previewModeModal.togglePrevDisabled(!0):this._previewModeModal.togglePrevDisabled(!1),this._currentItemPointer===this._gridItems.length-1?this._previewModeModal.toggleNextDisabled(!0):this._previewModeModal.toggleNextDisabled(!1)},_onModalCTAClicked:function(){var e=this._gridItems[this._currentItemPointer],t=this._getItemData(e);Helpers.GlobalEventTracker.previewModeCTAClicked({stageId:t.stageId}),window.location.href=t.stageLink},_onPreviewModeModalClose:function(){Helpers.GlobalEventTracker.previewModeModalClosed()}}}),Class(UI.PreviewMode,"Modal").inherits(UI.SimpleModal)({htmlTemplate:'          <div class="simple-slider-arrow simple-slider-prev">            <span class="angle-right-purple"></span>          </div>          <div class="img-container">            <img class="img-preview" />            <video class="video-preview" autoplay muted />            <div class="loading spinner-container">              <div class="spinner"></div>              <div class="spinner-text">Loading preview...</div>          </div>         </div>          <div class="info-container">            <p class="info-title">Beautiful Girl Wearing a T-Shirt Template While in the Park During Winter</p>            <div class="info-cta-container">              <a class="info-cta-btn">Edit Template</a>            </div>          </div>          <div class="simple-slider-arrow simple-slider-next">            <span class="angle-right-purple"></span>          </div>      ',prototype:{init:function(e){UI.SimpleModal.prototype.init.call(this,e),this.setContent($(UI.PreviewMode.Modal.htmlTemplate)),this.addCloseButton(),this.element.removeAttr("data-keyboard"),this.$title=this.element.find(".info-title"),this.$loading=this.element.find(".loading"),this.$loading.hide(),this.$img=this.element.find(".img-preview"),this.$video=this.element.find(".video-preview"),this.$ctaBtn=this.element.find(".info-cta-btn"),this.$prev=this.element.find(".simple-slider-prev"),this.$next=this.element.find(".simple-slider-next"),e.initialData&&(this.setTitle(e.initialData.title),e.initialData.videoSrc?this.setVideo(e.initialData.videoSrc):this.setImage(e.initialData.imgSrc),this.setCtaLink(e.initialData.stageLink)),this.$prev.click(this.requestPrevItem.bind(this)),this.$next.click(this.requestNextItem.bind(this)),this.element.on("hide.bs.modal",this._beforeClose.bind(this)),this.$ctaBtn.click(this._onCtaClicked.bind(this))},setVideo:function(e){var t=this;t.$loading.show(),t.$img.hide(),t.$video.hide(),t.$video.one("canplay",function(e){t.$loading.hide(),t.$video.show()}),t.$video.attr("src",e)},setImage:function(e){var t=this;t.$loading.show(),t.$video.hide(),t.$img.hide(),t.$img.one("load",function(e){t.$loading.hide(),t.$img.show()}),t.$img.attr("src",e)},setTitle:function(e){this.$title.text(e)},setCtaLink:function(e){this.$ctaBtn.attr("href",e)},setPreviewData:function(e){this._cancelPreviousPreview(),e.videoSrc?this.setVideo(e.videoSrc):this.setImage(e.imgSrc),this.setTitle(e.title),this.setCtaLink(e.stageLink)},_cancelPreviousPreview:function(){this.$img.off("load"),this.$video.off("canplay")},requestNextItem:function(){this.$next.hasClass("disabled")||this.dispatch("next")},requestPrevItem:function(){this.$prev.hasClass("disabled")||this.dispatch("prev")},togglePrevDisabled:function(e){this.$prev.toggleClass("disabled",e)},toggleNextDisabled:function(e){this.$next.toggleClass("disabled",e)},_beforeClose:function(){this.dispatch("close")},_onCtaClicked:function(e){e.preventDefault(),this.dispatch("cta:clicked")}}});